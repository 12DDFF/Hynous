# Nous Module

> Python HTTP client for the Nous TypeScript memory server. This is NOT the memory system itself — it's the integration layer.

---

## Structure

```
nous/
├── client.py      # NousClient — HTTP client wrapping all Nous REST endpoints
├── server.py      # Nous server process management
└── __init__.py
```

The actual memory system lives in `nous-server/` (TypeScript/Hono on `:3100`). This Python module provides `NousClient`, a synchronous HTTP client that wraps all Nous REST endpoints.

---

## NousClient Methods

| Method | Endpoint | Used By |
|--------|----------|---------|
| `create_node()` | `POST /v1/nodes` | `store_memory` tool, `trading.py` |
| `get_node()` | `GET /v1/nodes/:id` | `explore_memory`, `update_memory`, `conflicts` |
| `update_node()` | `PATCH /v1/nodes/:id` | `update_memory` tool, daemon lifecycle updates |
| `delete_node()` | `DELETE /v1/nodes/:id` | `delete_memory` tool |
| `list_nodes()` | `GET /v1/nodes` | `recall_memory` browse mode, watchpoints |
| `search()` | `POST /v1/search` | `recall_memory` tool (with time_range), `memory_manager.py` auto-retrieval. Logs QCS metadata at DEBUG level (MF-10). |
| `get_edges()` | `GET /v1/edges` | `explore_memory` tool, watchpoint cleanup |
| `create_edge()` | `POST /v1/edges` | `explore_memory` link, auto-linking in memory.py |
| `strengthen_edge()` | `POST /v1/edges/:id/strengthen` | Hebbian co-activation: memory_manager auto-retrieval (0.03), recall_memory explicit (0.05), trade lifecycle close (0.1) |
| `delete_edge()` | `DELETE /v1/edges/:id` | `explore_memory` unlink, `delete_memory` cleanup |
| `run_decay()` | `POST /v1/decay` | daemon `_run_decay_cycle()` every 6h |
| `get_conflicts()` | `GET /v1/contradiction/queue` | `manage_conflicts` tool, daemon `_check_conflicts()` |
| `resolve_conflict()` | `POST /v1/contradiction/resolve` | `manage_conflicts` tool |
| `detect_contradiction()` | `POST /v1/contradiction/detect` | Not called (Tier 2 runs automatically on node creation) |
| `classify_query()` | `POST /v1/classify-query` | Not called (QCS runs server-side within search) |
| `create_cluster()` | `POST /v1/clusters` | `manage_clusters` tool (create action) |
| `list_clusters()` | `GET /v1/clusters` | `manage_clusters` tool (list action), `_auto_assign_clusters()` |
| `get_cluster()` | `GET /v1/clusters/:id` | `manage_clusters` tool |
| `update_cluster()` | `PATCH /v1/clusters/:id` | `manage_clusters` tool (update action) |
| `delete_cluster()` | `DELETE /v1/clusters/:id` | `manage_clusters` tool (delete action) |
| `add_to_cluster()` | `POST /v1/clusters/:id/members` | `manage_clusters` tool (add action), `store_memory` auto-assign |
| `remove_from_cluster()` | `DELETE /v1/clusters/:id/members/:node_id` | `manage_clusters` tool (remove action) |
| `get_cluster_members()` | `GET /v1/clusters/:id/members` | `manage_clusters` tool (members action) |
| `get_cluster_health()` | `GET /v1/clusters/:id/health` | `manage_clusters` tool (health action) |
| `backfill_embeddings()` | `POST /v1/nodes/backfill-embeddings` | Daemon `_run_embedding_backfill()` every 12h |
| `health()` | `GET /v1/health` | Daemon `_check_health()` on startup + periodic |

---

## Node Types and Subtypes

Nous uses `type` (base category) + `subtype` (specific kind, prefixed `custom:`):

| Subtype | Type | Purpose | Example |
|---------|------|---------|---------|
| `custom:thesis` | concept | Analytical reasoning | "Why BTC is bullish: support held, funding reset" |
| `custom:lesson` | concept | Learned patterns | "Never trade low-volume weekends" |
| `custom:trade_entry` | concept | Trade records | "LONG BTC @ $69,210" |
| `custom:trade_close` | concept | Trade outcomes | "Closed BTC +3.2%" |
| `custom:turn_summary` | episode | Compressed conversations | Auto-generated by Haiku |
| `custom:signal` | episode | Raw market snapshots | "BTC funding hit 0.15% on Feb 5" |
| `custom:watchpoint` | concept | Price/funding alerts | "Alert when BTC < $65,000" |

---

## Key Patterns

```python
from hynous.nous.client import NousClient

client = NousClient()  # Singleton, connects to localhost:3100

# Create a node
node = client.create_node(
    type="concept",
    subtype="custom:thesis",
    title="BTC bullish thesis",
    body="Full analysis text...",
    summary="Short one-liner",
)

# Search (SSA-powered: BM25 + vector + recency + lifecycle + spreading activation)
results = client.search(query="BTC thesis", limit=5)

# Update (field names match Nous schema)
client.update_node(node["id"], content_body="Updated text", state_lifecycle="WEAK")

# List by type
theses = client.list_nodes(subtype="custom:thesis", lifecycle="ACTIVE", limit=10)

# Edges
edges = client.get_edges(node["id"], direction="both")
client.create_edge(source_id, target_id, edge_type="supports")
```

---

## Known Issues

All NW wiring issues (NW-1 through NW-10) between this client and the Nous server are resolved. See:

- **`revisions/nous-wiring/executive-summary.md`** — Overview of all issue categories
- **`revisions/nous-wiring/nous-wiring-revisions.md`** — All 10 wiring issues (all FIXED)
- **`revisions/nous-wiring/more-functionality.md`** — Remaining Nous features not yet wired

Still unused client methods: `detect_contradiction()` (not needed — Tier 2 runs automatically), `classify_query()` (not needed — QCS runs server-side within search; QCS metadata now logged from search responses — MF-10 DONE).

All 16 MF items resolved: 14 DONE, 2 SKIPPED (MF-11 working memory, MF-14 edge decay). No remaining Nous integration work.
