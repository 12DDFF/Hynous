{"version":3,"sources":["../../src/backend/constants.ts","../../src/backend/types.ts","../../src/backend/adapters.ts","../../src/backend/server.ts","../../src/backend/jobs.ts","../../src/backend/config.ts","../../src/backend/deployment.ts","../../src/backend/health.ts","../../src/backend/observability.ts","../../src/backend/sse.ts","../../src/backend/local-dev.ts"],"names":["z"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @module @nous/core/backend\n * @description Backend Infrastructure constants — deployment targets, job tiers, SSE limits, health checks\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * All constants for the Nous Backend Infrastructure module.\n * Organized by domain: API, deployment, adapters, jobs, SSE, health, middleware, observability.\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/constants.ts} - Spec\n */\n\n// ============================================================\n// API VERSIONING\n// ============================================================\n\n/** Current API version prefix */\nexport const API_VERSION = 'v1' as const;\n\n/** Base path for all API routes */\nexport const API_BASE_PATH = '/v1' as const;\n\n// ============================================================\n// DEPLOYMENT TARGETS\n// ============================================================\n\n/**\n * Supported deployment targets for the Nous backend.\n * - cloudflare_workers: Edge deployment (low latency, global)\n * - fly_io: Regional container deployment (heavy processing)\n * - docker: Self-hosted via Docker Compose\n * - local: Local development with mock adapters\n */\nexport const DEPLOYMENT_TARGETS = ['cloudflare_workers', 'fly_io', 'docker', 'local'] as const;\nexport type DeploymentTarget = typeof DEPLOYMENT_TARGETS[number];\n\nexport function isDeploymentTarget(value: unknown): value is DeploymentTarget {\n  return typeof value === 'string' && (DEPLOYMENT_TARGETS as readonly string[]).includes(value);\n}\n\n// ============================================================\n// DEPLOYMENT ENVIRONMENTS\n// ============================================================\n\n/** Application environments */\nexport const DEPLOYMENT_ENVIRONMENTS = ['development', 'staging', 'production'] as const;\nexport type DeploymentEnvironment = typeof DEPLOYMENT_ENVIRONMENTS[number];\n\nexport function isDeploymentEnvironment(value: unknown): value is DeploymentEnvironment {\n  return typeof value === 'string' && (DEPLOYMENT_ENVIRONMENTS as readonly string[]).includes(value);\n}\n\n// ============================================================\n// ADAPTER TYPES\n// ============================================================\n\n/** Database adapter implementations */\nexport const DATABASE_ADAPTER_TYPES = ['turso', 'sqlite'] as const;\nexport type DatabaseAdapterType = typeof DATABASE_ADAPTER_TYPES[number];\n\n/** Auth adapter implementations */\nexport const AUTH_ADAPTER_TYPES = ['clerk', 'local'] as const;\nexport type AuthAdapterType = typeof AUTH_ADAPTER_TYPES[number];\n\n/** LLM adapter implementations */\nexport const LLM_ADAPTER_TYPES = ['openai', 'anthropic', 'google', 'mock'] as const;\nexport type LLMAdapterType = typeof LLM_ADAPTER_TYPES[number];\n\n/** Embedding adapter implementations */\nexport const EMBEDDING_ADAPTER_TYPES = ['openai', 'mock'] as const;\nexport type EmbeddingAdapterType = typeof EMBEDDING_ADAPTER_TYPES[number];\n\n/** Storage adapter implementations */\nexport const STORAGE_ADAPTER_TYPES = ['s3', 'local', 'mock'] as const;\nexport type StorageAdapterType = typeof STORAGE_ADAPTER_TYPES[number];\n\n/** Job queue adapter implementations */\nexport const JOB_QUEUE_ADAPTER_TYPES = ['cloudflare', 'bullmq', 'memory'] as const;\nexport type JobQueueAdapterType = typeof JOB_QUEUE_ADAPTER_TYPES[number];\n\n// ============================================================\n// JOB SYSTEM\n// ============================================================\n\n/**\n * Job execution tiers.\n *\n * ```\n * ┌─────────────────────────────────────────────────────┐\n * │  TIER 1: INLINE    (<50ms)   Edge Workers           │\n * │  TIER 2: QUEUED    (<30s)    Cloudflare Queues       │\n * │  TIER 3: REGIONAL  (<10min)  Fly.io Containers       │\n * └─────────────────────────────────────────────────────┘\n * ```\n */\nexport const JOB_TIERS = ['inline', 'queued', 'regional'] as const;\nexport type JobTier = typeof JOB_TIERS[number];\n\nexport function isJobTier(value: unknown): value is JobTier {\n  return typeof value === 'string' && (JOB_TIERS as readonly string[]).includes(value);\n}\n\n/**\n * Async job types (enqueued via IJobQueueAdapter).\n * - embed: Generate embedding for a single node (Tier 2)\n * - deduplicate: Check for duplicate content (Tier 2)\n * - infer-edges: Infer relationships between nodes (Tier 2)\n * - process-document: Parse and extract from documents (Tier 3)\n * - batch-embed: Batch embedding generation (Tier 3)\n * - sync-push-notification: Notify other devices of changes (Tier 2)\n */\nexport const JOB_TYPES = [\n  'embed',\n  'deduplicate',\n  'infer-edges',\n  'process-document',\n  'batch-embed',\n  'sync-push-notification',\n] as const;\nexport type JobType = typeof JOB_TYPES[number];\n\nexport function isJobType(value: unknown): value is JobType {\n  return typeof value === 'string' && (JOB_TYPES as readonly string[]).includes(value);\n}\n\n/**\n * Cron-scheduled job types.\n * - decay-cycle: Run FSRS decay calculations (storm-007)\n * - reorganize: Cluster reorganization (storm-006)\n * - cleanup-expired: Remove expired trash items (storm-007)\n */\nexport const CRON_JOB_TYPES = [\n  'decay-cycle',\n  'reorganize',\n  'cleanup-expired',\n] as const;\nexport type CronJobType = typeof CRON_JOB_TYPES[number];\n\nexport function isCronJobType(value: unknown): value is CronJobType {\n  return typeof value === 'string' && (CRON_JOB_TYPES as readonly string[]).includes(value);\n}\n\n/** Job priority levels */\nexport const JOB_PRIORITIES = ['high', 'normal', 'low'] as const;\nexport type JobPriority = typeof JOB_PRIORITIES[number];\n\n/**\n * Maximum duration per job tier.\n * Jobs exceeding their tier limit are killed and moved to DLQ.\n */\nexport const JOB_TIER_LIMITS = {\n  inline: { max_duration_ms: 50 },\n  queued: { max_duration_ms: 30_000 },\n  regional: { max_duration_ms: 600_000 },\n} as const;\n\n/** Job types that run at the queued tier (Cloudflare Queues / BullMQ) */\nexport const QUEUED_JOB_TYPES: readonly JobType[] = [\n  'embed',\n  'deduplicate',\n  'infer-edges',\n  'sync-push-notification',\n] as const;\n\n/** Job types that run at the regional tier (Fly.io / long-running containers) */\nexport const REGIONAL_JOB_TYPES: readonly JobType[] = [\n  'process-document',\n  'batch-embed',\n] as const;\n\n/** Default retry configuration for failed jobs */\nexport const DEFAULT_JOB_RETRY_COUNT = 3;\nexport const DEFAULT_JOB_RETRY_DELAY_MS = 1_000;\n\n// ============================================================\n// SSE STREAMING\n// ============================================================\n\n/**\n * SSE (Server-Sent Events) configuration.\n * Cloudflare Workers have a 30s connection limit,\n * so we cap at 25s and send timeout events for reconnection.\n */\nexport const SSE_MAX_DURATION_MS = 25_000;\nexport const SSE_HEARTBEAT_INTERVAL_MS = 15_000;\nexport const SSE_RECONNECT_DEFAULT = true;\n\n/** SSE event types sent to clients */\nexport const SSE_EVENT_TYPES = ['data', 'ping', 'timeout', 'done', 'error'] as const;\nexport type SSEEventType = typeof SSE_EVENT_TYPES[number];\n\nexport function isSSEEventType(value: unknown): value is SSEEventType {\n  return typeof value === 'string' && (SSE_EVENT_TYPES as readonly string[]).includes(value);\n}\n\n// ============================================================\n// HEALTH CHECKS\n// ============================================================\n\n/** Service health statuses */\nexport const HEALTH_STATUSES = ['healthy', 'degraded', 'unhealthy'] as const;\nexport type HealthStatus = typeof HEALTH_STATUSES[number];\n\nexport function isHealthStatus(value: unknown): value is HealthStatus {\n  return typeof value === 'string' && (HEALTH_STATUSES as readonly string[]).includes(value);\n}\n\n/** Timeout for individual service health checks */\nexport const HEALTH_CHECK_TIMEOUT_MS = 5_000;\n\n/** Services checked by the /v1/health endpoint */\nexport const HEALTH_CHECK_SERVICES = ['database', 'llm', 'embedding', 'auth', 'jobs'] as const;\nexport type HealthCheckService = typeof HEALTH_CHECK_SERVICES[number];\n\n// ============================================================\n// MIDDLEWARE\n// ============================================================\n\n/** Middleware types applied to all requests */\nexport const MIDDLEWARE_TYPES = ['cors', 'auth', 'rate_limit', 'logging', 'error'] as const;\nexport type MiddlewareType = typeof MIDDLEWARE_TYPES[number];\n\n/**\n * Middleware application order.\n * cors → logging → error → auth → rate_limit\n */\nexport const MIDDLEWARE_ORDER: readonly MiddlewareType[] = [\n  'cors',\n  'logging',\n  'error',\n  'auth',\n  'rate_limit',\n] as const;\n\n/** Default CORS origins (override in production) */\nexport const DEFAULT_CORS_ORIGINS = ['*'] as const;\n\n/** Default rate limit: 60 requests per minute */\nexport const DEFAULT_RATE_LIMIT_RPM = 60;\n\n/** Rate limit sliding window duration */\nexport const RATE_LIMIT_WINDOW_MS = 60_000;\n\n// ============================================================\n// SERVER\n// ============================================================\n\n/** Default server port */\nexport const DEFAULT_PORT = 3000;\n\n/** Default server host */\nexport const DEFAULT_HOST = '0.0.0.0';\n\n// ============================================================\n// OBSERVABILITY\n// ============================================================\n\n/** Logging levels (ordered by severity) */\nexport const LOG_LEVELS = ['debug', 'info', 'warn', 'error', 'fatal'] as const;\nexport type LogLevel = typeof LOG_LEVELS[number];\n\nexport function isLogLevel(value: unknown): value is LogLevel {\n  return typeof value === 'string' && (LOG_LEVELS as readonly string[]).includes(value);\n}\n\n/** Default log level */\nexport const DEFAULT_LOG_LEVEL: LogLevel = 'info';\n\n/** Sentry traces sample rate (10% of requests) */\nexport const SENTRY_TRACES_SAMPLE_RATE = 0.1;\n\n// ============================================================\n// DEPLOYMENT SCENARIOS\n// ============================================================\n\n/**\n * Named deployment scenarios for the decision matrix.\n * @see deployment.ts DEPLOYMENT_MATRIX\n */\nexport const DEPLOYMENT_SCENARIOS = [\n  'nous_cloud',\n  'self_host_small',\n  'self_host_scale',\n  'enterprise',\n] as const;\nexport type DeploymentScenario = typeof DEPLOYMENT_SCENARIOS[number];\n\nexport function isDeploymentScenario(value: unknown): value is DeploymentScenario {\n  return typeof value === 'string' && (DEPLOYMENT_SCENARIOS as readonly string[]).includes(value);\n}\n\n// ============================================================\n// ROUTE GROUPS\n// ============================================================\n\n/**\n * API route group prefixes.\n * Each maps to a Hono sub-router registered via app.route().\n */\nexport const ROUTE_PREFIXES = {\n  nodes: '/v1/nodes',\n  edges: '/v1/edges',\n  search: '/v1/search',\n  chat: '/v1/chat',\n  agent: '/v1/agent',\n  sync: '/v1/sync',\n  ingest: '/v1/ingest',\n  settings: '/v1/settings',\n  credits: '/v1/credits',\n  clusters: '/v1/clusters',\n  health: '/v1/health',\n} as const;\n\n/** Paths that do not require authentication */\nexport const AUTH_EXEMPT_PATHS = ['/v1/health'] as const;\n\n// ============================================================\n// ERROR CODES\n// ============================================================\n\n/**\n * Standard API error codes with HTTP status mapping.\n * Used by the error middleware to produce structured responses.\n */\nexport const ERROR_CODES = {\n  UNAUTHORIZED: { status: 401, message: 'Authentication required' },\n  TOKEN_EXPIRED: { status: 401, message: 'Token has expired' },\n  FORBIDDEN: { status: 403, message: 'Insufficient permissions' },\n  NOT_FOUND: { status: 404, message: 'Resource not found' },\n  CONFLICT: { status: 409, message: 'Version conflict' },\n  RATE_LIMITED: { status: 429, message: 'Too many requests' },\n  VALIDATION_ERROR: { status: 400, message: 'Invalid request data' },\n  INTERNAL_ERROR: { status: 500, message: 'Internal server error' },\n  SERVICE_UNAVAILABLE: { status: 503, message: 'Service temporarily unavailable' },\n} as const;\n\nexport type ErrorCode = keyof typeof ERROR_CODES;\n","/**\n * @module @nous/core/backend\n * @description Types and Zod schemas for Nous Backend Infrastructure\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Consolidated interfaces and Zod schemas from all backend spec files.\n * Organized by domain: pagination, search, sync, LLM, auth, transaction,\n * adapter interfaces, jobs, server, SSE, config, health, deployment,\n * observability, and local dev.\n */\n\nimport { z } from 'zod';\nimport type {\n  JobTier, JobType, CronJobType, JobPriority,\n  SSEEventType,\n  HealthStatus, HealthCheckService,\n  LogLevel,\n  DeploymentEnvironment, DeploymentScenario,\n  DeploymentTarget, DatabaseAdapterType, AuthAdapterType, JobQueueAdapterType,\n} from './constants';\n\n// ============================================================\n// SUPPORTING TYPES: PAGINATION\n// ============================================================\n\n/** Options for paginated list queries */\nexport interface ListOptions {\n  /** Maximum items to return */\n  limit: number;\n  /** Number of items to skip */\n  offset: number;\n  /** Field to sort by */\n  sort_by?: string;\n  /** Sort direction */\n  sort_order?: 'asc' | 'desc';\n  /** Filter criteria */\n  filters?: Record<string, unknown>;\n}\n\nexport const ListOptionsSchema = z.object({\n  limit: z.number().int().min(1).max(1000),\n  offset: z.number().int().min(0),\n  sort_by: z.string().optional(),\n  sort_order: z.enum(['asc', 'desc']).optional(),\n  filters: z.record(z.unknown()).optional(),\n});\n\n/** Paginated query result */\nexport interface PaginatedResult<T> {\n  items: T[];\n  total: number;\n  has_more: boolean;\n}\n\n// NOTE: PaginatedResult schema factory is in adapters.ts (generic requires factory pattern)\n\n// ============================================================\n// SUPPORTING TYPES: SEARCH\n// ============================================================\n\n/** Options for vector similarity search */\nexport interface VectorSearchOptions {\n  /** Maximum results to return */\n  limit: number;\n  /** Minimum cosine similarity threshold (0-1) */\n  min_similarity?: number;\n  /** Additional filters */\n  filters?: Record<string, unknown>;\n}\n\nexport const VectorSearchOptionsSchema = z.object({\n  limit: z.number().int().min(1).max(500),\n  min_similarity: z.number().min(0).max(1).optional(),\n  filters: z.record(z.unknown()).optional(),\n});\n\n/** Options for BM25 text search */\nexport interface TextSearchOptions {\n  /** Maximum results to return */\n  limit: number;\n  /** Additional filters */\n  filters?: Record<string, unknown>;\n}\n\nexport const TextSearchOptionsSchema = z.object({\n  limit: z.number().int().min(1).max(500),\n  filters: z.record(z.unknown()).optional(),\n});\n\n/** Options for hybrid (vector + BM25) search */\nexport interface HybridSearchOptions {\n  /** Maximum results to return */\n  limit: number;\n  /** Weight balance between vector and BM25 */\n  weights?: { vector: number; bm25: number };\n  /** Additional filters */\n  filters?: Record<string, unknown>;\n}\n\nexport const HybridSearchOptionsSchema = z.object({\n  limit: z.number().int().min(1).max(500),\n  weights: z.object({\n    vector: z.number().min(0).max(1),\n    bm25: z.number().min(0).max(1),\n  }).optional(),\n  filters: z.record(z.unknown()).optional(),\n});\n\n/** Search result (returned by all search methods) */\nexport interface SearchResult {\n  /** Node ID */\n  id: string;\n  /** Relevance score (0-1, higher is better) */\n  score: number;\n  /** The matched node data */\n  node: Record<string, unknown>;\n}\n\nexport const SearchResultSchema = z.object({\n  id: z.string(),\n  score: z.number().min(0).max(1),\n  node: z.record(z.unknown()),\n});\n\n// ============================================================\n// SUPPORTING TYPES: SYNC (aligned with storm-017)\n// ============================================================\n\n/** A set of changes since a given version */\nexport interface ChangeSet {\n  changes: Change[];\n  currentVersion: number;\n  hasMore: boolean;\n}\n\nexport const ChangeSetSchema = z.object({\n  changes: z.array(z.lazy(() => ChangeSchema)),\n  currentVersion: z.number().int().min(0),\n  hasMore: z.boolean(),\n});\n\n/** A single change record */\nexport interface Change {\n  /** Entity ID (node or edge) */\n  id: string;\n  /** Which table was affected */\n  table: 'nodes' | 'edges';\n  /** Type of operation */\n  operation: 'create' | 'update' | 'delete';\n  /** The changed data */\n  data: Record<string, unknown>;\n  /** Server version at time of change */\n  version: number;\n  /** ISO 8601 timestamp */\n  timestamp: string;\n}\n\nexport const ChangeSchema = z.object({\n  id: z.string(),\n  table: z.enum(['nodes', 'edges']),\n  operation: z.enum(['create', 'update', 'delete']),\n  data: z.record(z.unknown()),\n  version: z.number().int().min(0),\n  timestamp: z.string(),\n});\n\n/** Result of applying client changes to server */\nexport interface ApplyResult {\n  applied: AppliedChange[];\n  conflicts: AdapterConflict[];\n  serverVersion: number;\n}\n\nexport const ApplyResultSchema = z.object({\n  applied: z.array(z.lazy(() => AppliedChangeSchema)),\n  conflicts: z.array(z.lazy(() => AdapterConflictSchema)),\n  serverVersion: z.number().int().min(0),\n});\n\n/** A successfully applied change */\nexport interface AppliedChange {\n  id: string;\n  operation: 'create' | 'update' | 'delete';\n  version: number;\n}\n\nexport const AppliedChangeSchema = z.object({\n  id: z.string(),\n  operation: z.enum(['create', 'update', 'delete']),\n  version: z.number().int().min(0),\n});\n\n/** A conflict detected during sync */\nexport interface AdapterConflict {\n  /** Entity ID */\n  id: string;\n  /** Unique conflict identifier */\n  conflictId: string;\n  /** Type of conflict */\n  type: 'VERSION_MISMATCH' | 'DELETED' | 'CONSTRAINT';\n  /** Client's version of the entity */\n  clientVersion: number;\n  /** Server's current version */\n  serverVersion: number;\n  /** Server's current data */\n  serverData: Record<string, unknown>;\n  /** Available resolution strategies */\n  resolutionOptions: ('keep_local' | 'keep_server' | 'merge')[];\n}\n\nexport const AdapterConflictSchema = z.object({\n  id: z.string(),\n  conflictId: z.string(),\n  type: z.enum(['VERSION_MISMATCH', 'DELETED', 'CONSTRAINT']),\n  clientVersion: z.number().int().min(0),\n  serverVersion: z.number().int().min(0),\n  serverData: z.record(z.unknown()),\n  resolutionOptions: z.array(z.enum(['keep_local', 'keep_server', 'merge'])),\n});\n\n// ============================================================\n// SUPPORTING TYPES: LLM\n// ============================================================\n\n/** Chat message */\nexport interface AdapterMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\nexport const AdapterMessageSchema = z.object({\n  role: z.enum(['system', 'user', 'assistant']),\n  content: z.string(),\n});\n\n/** LLM completion request */\nexport interface CompletionRequest {\n  /** Model identifier (e.g., 'claude-sonnet-4', 'gpt-4o') */\n  model: string;\n  /** Conversation messages */\n  messages: AdapterMessage[];\n  /** Maximum tokens to generate */\n  maxTokens?: number;\n  /** Sampling temperature (0-2) */\n  temperature?: number;\n  /** System prompt (separate from messages for caching) */\n  systemPrompt?: string;\n  /** Whether to cache the system prompt (Anthropic only) */\n  cacheSystemPrompt?: boolean;\n  /** Request tracking ID */\n  requestId?: string;\n}\n\nexport const CompletionRequestSchema = z.object({\n  model: z.string(),\n  messages: z.array(AdapterMessageSchema),\n  maxTokens: z.number().int().min(1).optional(),\n  temperature: z.number().min(0).max(2).optional(),\n  systemPrompt: z.string().optional(),\n  cacheSystemPrompt: z.boolean().optional(),\n  requestId: z.string().optional(),\n});\n\n/** LLM completion response */\nexport interface CompletionResponse {\n  /** Response ID */\n  id: string;\n  /** Generated content */\n  content: string;\n  /** Model that was used */\n  model: string;\n  /** Token usage */\n  usage: AdapterTokenUsage;\n  /** Reason for stopping */\n  finishReason: 'stop' | 'length' | 'tool_use';\n}\n\nexport const CompletionResponseSchema = z.object({\n  id: z.string(),\n  content: z.string(),\n  model: z.string(),\n  usage: z.lazy(() => AdapterTokenUsageSchema),\n  finishReason: z.enum(['stop', 'length', 'tool_use']),\n});\n\n/** Streaming chunk from LLM */\nexport interface CompletionChunk {\n  /** Chunk ID */\n  id: string;\n  /** Text delta */\n  delta: string;\n  /** Set when stream ends */\n  finishReason?: 'stop' | 'length' | 'tool_use';\n}\n\nexport const CompletionChunkSchema = z.object({\n  id: z.string(),\n  delta: z.string(),\n  finishReason: z.enum(['stop', 'length', 'tool_use']).optional(),\n});\n\n/** Token usage from LLM response */\nexport interface AdapterTokenUsage {\n  inputTokens: number;\n  outputTokens: number;\n  cachedTokens?: number;\n}\n\nexport const AdapterTokenUsageSchema = z.object({\n  inputTokens: z.number().int().min(0),\n  outputTokens: z.number().int().min(0),\n  cachedTokens: z.number().int().min(0).optional(),\n});\n\n/** Cost estimate for an LLM request */\nexport interface AdapterCostEstimate {\n  /** Minimum expected cost in USD */\n  min: number;\n  /** Expected cost in USD */\n  expected: number;\n  /** Maximum expected cost in USD */\n  max: number;\n  /** Cost breakdown */\n  breakdown: {\n    embedding?: number;\n    inputTokens: number;\n    outputTokens: number;\n    caching?: number;\n  };\n}\n\nexport const AdapterCostEstimateSchema = z.object({\n  min: z.number().min(0),\n  expected: z.number().min(0),\n  max: z.number().min(0),\n  breakdown: z.object({\n    embedding: z.number().min(0).optional(),\n    inputTokens: z.number().min(0),\n    outputTokens: z.number().min(0),\n    caching: z.number().min(0).optional(),\n  }),\n});\n\n/** Usage callback type for cost tracking */\nexport type UsageCallback = (usage: UsageReport) => void;\n\n/** Usage report emitted after each LLM call */\nexport interface UsageReport {\n  /** Request tracking ID */\n  requestId: string;\n  /** Provider that served the request */\n  provider: string;\n  /** Model used */\n  model: string;\n  /** Input tokens consumed */\n  inputTokens: number;\n  /** Output tokens generated */\n  outputTokens: number;\n  /** Tokens served from cache */\n  cachedTokens: number;\n  /** Actual cost in USD */\n  actualCost: number;\n  /** End-to-end latency */\n  latencyMs: number;\n}\n\nexport const UsageReportSchema = z.object({\n  requestId: z.string(),\n  provider: z.string(),\n  model: z.string(),\n  inputTokens: z.number().int().min(0),\n  outputTokens: z.number().int().min(0),\n  cachedTokens: z.number().int().min(0),\n  actualCost: z.number().min(0),\n  latencyMs: z.number().min(0),\n});\n\n// ============================================================\n// SUPPORTING TYPES: AUTH\n// ============================================================\n\n/** Result of token validation */\nexport interface AdapterAuthResult {\n  /** Whether the token is valid */\n  valid: boolean;\n  /** User ID if valid */\n  userId?: string;\n  /** User's plan tier */\n  tier?: 'free' | 'credits' | 'pro';\n  /** User's privacy tier (storm-022) */\n  privacyTier?: 'standard' | 'private';\n  /** Token expiry (ISO 8601) */\n  expiresAt?: string;\n}\n\nexport const AdapterAuthResultSchema = z.object({\n  valid: z.boolean(),\n  userId: z.string().optional(),\n  tier: z.enum(['free', 'credits', 'pro']).optional(),\n  privacyTier: z.enum(['standard', 'private']).optional(),\n  expiresAt: z.string().optional(),\n});\n\n/** Authenticated user */\nexport interface AdapterUser {\n  id: string;\n  email: string;\n  tier: 'free' | 'credits' | 'pro';\n  privacyTier: 'standard' | 'private';\n}\n\nexport const AdapterUserSchema = z.object({\n  id: z.string(),\n  email: z.string().email(),\n  tier: z.enum(['free', 'credits', 'pro']),\n  privacyTier: z.enum(['standard', 'private']),\n});\n\n/** Token pair from refresh */\nexport interface AdapterTokenPair {\n  accessToken: string;\n  refreshToken: string;\n  expiresAt: string;\n}\n\nexport const AdapterTokenPairSchema = z.object({\n  accessToken: z.string(),\n  refreshToken: z.string(),\n  expiresAt: z.string(),\n});\n\n/** API key validation result */\nexport interface AdapterApiKeyResult {\n  valid: boolean;\n  userId?: string;\n  scopes?: string[];\n}\n\nexport const AdapterApiKeyResultSchema = z.object({\n  valid: z.boolean(),\n  userId: z.string().optional(),\n  scopes: z.array(z.string()).optional(),\n});\n\n// ============================================================\n// SUPPORTING TYPES: TRANSACTION\n// ============================================================\n\n/** Database transaction handle */\nexport interface AdapterTransaction {\n  /** Execute a read query within the transaction */\n  query<T = Record<string, unknown>>(sql: string, params?: unknown[]): Promise<T[]>;\n  /** Execute a write statement within the transaction */\n  execute(sql: string, params?: unknown[]): Promise<void>;\n}\n\n// ============================================================\n// ADAPTER INTERFACE: DATABASE\n// ============================================================\n\n/**\n * Domain-level database adapter.\n *\n * This is a HIGHER-LEVEL interface than storm-017's DatabaseAdapter.\n * storm-017 defines low-level SQL operations (query, execute, batch).\n * This interface provides domain operations (getNode, vectorSearch, etc.)\n * that are implemented by wrapping the low-level adapter.\n *\n * Implementations: @nous/adapter-turso, @nous/adapter-sqlite\n */\nexport interface IDatabaseAdapter {\n  /** Tenant this adapter is scoped to */\n  readonly tenantId: string;\n\n  // --- Node CRUD ---\n  getNode(id: string): Promise<Record<string, unknown> | null>;\n  createNode(node: Record<string, unknown>): Promise<Record<string, unknown>>;\n  updateNode(id: string, updates: Record<string, unknown>, expectedVersion?: number): Promise<Record<string, unknown>>;\n  deleteNode(id: string): Promise<void>;\n  listNodes(options: ListOptions): Promise<PaginatedResult<Record<string, unknown>>>;\n\n  // --- Edge CRUD ---\n  getEdges(nodeId: string, direction: 'in' | 'out' | 'both'): Promise<Record<string, unknown>[]>;\n  createEdge(edge: Record<string, unknown>): Promise<Record<string, unknown>>;\n  deleteEdge(id: string): Promise<void>;\n\n  // --- Search ---\n  vectorSearch(embedding: number[], options: VectorSearchOptions): Promise<SearchResult[]>;\n  textSearch(query: string, options: TextSearchOptions): Promise<SearchResult[]>;\n  hybridSearch(embedding: number[], query: string, options: HybridSearchOptions): Promise<SearchResult[]>;\n\n  // --- Sync (storm-017 protocol) ---\n  getChangesSince(version: number, limit?: number): Promise<ChangeSet>;\n  applyChanges(changes: Change[], clientVersion: number): Promise<ApplyResult>;\n  getCurrentVersion(): Promise<number>;\n\n  // --- Transaction ---\n  transaction<T>(fn: (tx: AdapterTransaction) => Promise<T>): Promise<T>;\n\n  // --- Health ---\n  ping(): Promise<boolean>;\n}\n\n// ============================================================\n// ADAPTER INTERFACE: DATABASE FACTORY (Multi-tenant)\n// ============================================================\n\n/**\n * Multi-tenant database factory.\n * Manages database-per-tenant isolation (aligned with storm-017).\n *\n * In Turso: each tenant gets their own database in a group.\n * In SQLite: single database file (for self-host/dev).\n */\nexport interface IDatabaseFactory {\n  /** Get an adapter scoped to a specific tenant */\n  forTenant(tenantId: string): Promise<IDatabaseAdapter>;\n  /** Create a new tenant database */\n  createTenant(tenantId: string): Promise<void>;\n  /** Delete a tenant database (irreversible) */\n  deleteTenant(tenantId: string): Promise<void>;\n  /** List all tenant IDs */\n  listTenants(): Promise<string[]>;\n  /** Check factory health */\n  ping(): Promise<boolean>;\n}\n\n// ============================================================\n// ADAPTER INTERFACE: LLM (with cost tracking)\n// ============================================================\n\n/**\n * LLM adapter with streaming and cost tracking.\n * Wraps storm-015 LLM types with a provider-agnostic interface.\n *\n * Implementations: @nous/adapter-openai, @nous/adapter-anthropic\n */\nexport interface ILLMAdapter {\n  /** Provider name (e.g., 'openai', 'anthropic', 'google') */\n  readonly provider: string;\n  /** Whether this adapter supports SSE streaming */\n  readonly supportsStreaming: boolean;\n  /** Whether this adapter supports prompt caching */\n  readonly supportsCaching: boolean;\n\n  /** Generate a completion */\n  complete(request: CompletionRequest): Promise<CompletionResponse>;\n  /** Stream a completion via async iterator */\n  stream(request: CompletionRequest): AsyncIterable<CompletionChunk>;\n  /** Estimate cost for a request */\n  estimateCost(request: CompletionRequest): AdapterCostEstimate;\n  /** Register a usage callback for credit deduction */\n  onUsage(callback: UsageCallback): void;\n  /** Check adapter health */\n  ping(): Promise<boolean>;\n}\n\n// ============================================================\n// ADAPTER INTERFACE: EMBEDDING\n// ============================================================\n\n/**\n * Text embedding adapter.\n * Generates vector embeddings for semantic search.\n *\n * Implementations: @nous/adapter-openai (text-embedding-3-small)\n */\nexport interface IEmbeddingAdapter {\n  /** Provider name */\n  readonly provider: string;\n  /** Output embedding dimensions (e.g., 1536) */\n  readonly dimensions: number;\n  /** Whether batch embedding is supported */\n  readonly supportsBatch: boolean;\n\n  /** Embed a single text */\n  embed(text: string): Promise<number[]>;\n  /** Embed multiple texts in batch */\n  embedBatch(texts: string[]): Promise<number[][]>;\n  /** Estimate cost for embedding by token count */\n  estimateCost(tokenCount: number): number;\n  /** Check adapter health */\n  ping(): Promise<boolean>;\n}\n\n// ============================================================\n// ADAPTER INTERFACE: AUTH\n// ============================================================\n\n/**\n * Authentication adapter.\n * Validates tokens and manages user sessions.\n * Wraps storm-022 auth types.\n *\n * Implementations: @nous/adapter-clerk, @nous/adapter-local-auth\n */\nexport interface IAuthAdapter {\n  /** Validate an access token (JWT) */\n  validateToken(token: string): Promise<AdapterAuthResult>;\n  /** Get full user object from token */\n  getUserFromToken(token: string): Promise<AdapterUser | null>;\n  /** Refresh an expired access token */\n  refreshToken(refreshToken: string): Promise<AdapterTokenPair>;\n  /** Validate an API key */\n  validateApiKey(key: string): Promise<AdapterApiKeyResult>;\n  /** Check adapter health */\n  ping(): Promise<boolean>;\n}\n\n// ============================================================\n// ADAPTER INTERFACE: STORAGE\n// ============================================================\n\n/**\n * File/blob storage adapter.\n * Used for document uploads, exports, etc.\n *\n * Implementations: @nous/adapter-s3, @nous/adapter-local (filesystem)\n */\nexport interface IStorageAdapter {\n  /** Upload a file and return its URL/key */\n  upload(key: string, data: Uint8Array, contentType: string): Promise<string>;\n  /** Download a file by key */\n  download(key: string): Promise<Uint8Array>;\n  /** Delete a file */\n  delete(key: string): Promise<void>;\n  /** Generate a pre-signed URL for temporary access */\n  getSignedUrl(key: string, expiresInSeconds: number): Promise<string>;\n  /** Check adapter health */\n  ping(): Promise<boolean>;\n}\n\n// ============================================================\n// JOB DEFINITION\n// ============================================================\n\n/** A job to be enqueued for background processing */\nexport interface Job<T extends JobType | CronJobType = JobType> {\n  /** Unique job ID */\n  id: string;\n  /** Job type (determines handler and tier) */\n  type: T;\n  /** Job-specific payload data */\n  payload: Record<string, unknown>;\n  /** Execution priority */\n  priority?: JobPriority;\n  /** Links this job to the originating HTTP request */\n  correlationId?: string;\n  /** Tenant this job belongs to */\n  tenantId: string;\n  /** ISO 8601 creation timestamp */\n  createdAt: string;\n}\n\nexport const JobSchema = z.object({\n  id: z.string(),\n  type: z.string(),\n  payload: z.record(z.unknown()),\n  priority: z.enum(['high', 'normal', 'low']).optional(),\n  correlationId: z.string().optional(),\n  tenantId: z.string(),\n  createdAt: z.string(),\n});\n\n// ============================================================\n// JOB EVENT (Observability)\n// ============================================================\n\n/** Event emitted during job lifecycle */\nexport interface JobEvent {\n  /** Job ID */\n  jobId: string;\n  /** Job type */\n  type: string;\n  /** Tenant ID */\n  tenantId: string;\n  /** Correlation ID linking to original request */\n  correlationId?: string;\n  /** When the job started processing (ISO 8601) */\n  startedAt?: string;\n  /** When the job completed (ISO 8601) */\n  completedAt?: string;\n  /** Processing duration in milliseconds */\n  durationMs?: number;\n}\n\nexport const JobEventSchema = z.object({\n  jobId: z.string(),\n  type: z.string(),\n  tenantId: z.string(),\n  correlationId: z.string().optional(),\n  startedAt: z.string().optional(),\n  completedAt: z.string().optional(),\n  durationMs: z.number().min(0).optional(),\n});\n\n// ============================================================\n// FAILED JOB (Dead Letter Queue)\n// ============================================================\n\n/** A job that failed all retry attempts */\nexport interface FailedJob {\n  /** The original job */\n  job: Job<JobType>;\n  /** Error message */\n  error: string;\n  /** When the job failed (ISO 8601) */\n  failedAt: string;\n  /** Number of attempts made */\n  attempts: number;\n}\n\nexport const FailedJobSchema = z.object({\n  job: JobSchema,\n  error: z.string(),\n  failedAt: z.string(),\n  attempts: z.number().int().min(1),\n});\n\n// ============================================================\n// JOB HANDLER\n// ============================================================\n\n/** Function that processes a job */\nexport type JobHandler<T extends JobType | CronJobType = JobType> = (job: Job<T>) => Promise<void>;\n\n// ============================================================\n// JOB TIER CONFIGURATION\n// ============================================================\n\n/** Configuration for a specific job type's execution */\nexport interface JobTierConfig {\n  /** Job type */\n  type: JobType | CronJobType;\n  /** Which tier this job runs at */\n  tier: JobTier;\n  /** Maximum execution time before kill */\n  max_duration_ms: number;\n  /** Number of retry attempts on failure */\n  retry_count: number;\n  /** Delay between retries in milliseconds */\n  retry_delay_ms: number;\n}\n\nexport const JobTierConfigSchema = z.object({\n  type: z.string(),\n  tier: z.enum(['inline', 'queued', 'regional']),\n  max_duration_ms: z.number().int().min(0),\n  retry_count: z.number().int().min(0),\n  retry_delay_ms: z.number().int().min(0),\n});\n\n// ============================================================\n// JOB METRICS\n// ============================================================\n\n/** Queue metrics snapshot */\nexport interface JobMetrics {\n  /** Number of jobs waiting in queue */\n  queue_depth: number;\n  /** Number of jobs currently processing */\n  processing_count: number;\n  /** Total jobs completed since startup */\n  completed_count: number;\n  /** Total jobs failed since startup */\n  failed_count: number;\n  /** Average processing time in milliseconds */\n  avg_processing_time_ms: number;\n}\n\nexport const JobMetricsSchema = z.object({\n  queue_depth: z.number().int().min(0),\n  processing_count: z.number().int().min(0),\n  completed_count: z.number().int().min(0),\n  failed_count: z.number().int().min(0),\n  avg_processing_time_ms: z.number().min(0),\n});\n\n// ============================================================\n// ADAPTER INTERFACE: JOB QUEUE\n// ============================================================\n\n/**\n * Job queue adapter interface.\n * Provides background job processing with observability and DLQ.\n *\n * Implementations:\n * - @nous/adapter-cloudflare-queue (Cloudflare Queues for cloud)\n * - @nous/adapter-bullmq (BullMQ + Redis for self-host)\n * - @nous/adapter-mock (in-memory for development/testing)\n */\nexport interface IJobQueueAdapter {\n  /** Enqueue a single job */\n  enqueue<T extends JobType>(job: Job<T>): Promise<string>;\n  /** Enqueue multiple jobs atomically */\n  enqueueBatch<T extends JobType>(jobs: Job<T>[]): Promise<string[]>;\n  /** Schedule a recurring cron job */\n  schedule(cronExpression: string, job: Job<CronJobType>): Promise<string>;\n\n  // --- Observability callbacks ---\n  /** Called when a job starts processing */\n  onJobStart(callback: (event: JobEvent) => void): void;\n  /** Called when a job completes successfully */\n  onJobComplete(callback: (event: JobEvent) => void): void;\n  /** Called when a job fails */\n  onJobError(callback: (event: JobEvent, error: Error) => void): void;\n\n  // --- Dead Letter Queue ---\n  /** Get all failed jobs awaiting manual intervention */\n  getDeadLetterQueue(): Promise<FailedJob[]>;\n  /** Retry a failed job from the DLQ */\n  retryDeadLetter(jobId: string): Promise<void>;\n\n  // --- Metrics ---\n  /** Get current queue depth */\n  getQueueDepth(): Promise<number>;\n  /** Get count of jobs currently processing */\n  getProcessingCount(): Promise<number>;\n}\n\n// ============================================================\n// SERVER CONFIGURATION\n// ============================================================\n\n/**\n * Central server configuration.\n * Holds references to all adapters and deployment settings.\n * Passed to createServer() to wire everything into a Hono app.\n *\n * NOTE: No Zod schema — contains adapter interface references.\n */\nexport interface ServerConfig {\n  /** Multi-tenant database factory */\n  dbFactory: IDatabaseFactory;\n  /** LLM completion adapter */\n  llm: ILLMAdapter;\n  /** Text embedding adapter */\n  embedding: IEmbeddingAdapter;\n  /** Authentication adapter */\n  auth: IAuthAdapter;\n  /** File storage adapter (optional) */\n  storage?: IStorageAdapter;\n  /** Background job queue adapter */\n  jobs: IJobQueueAdapter;\n  /** Deployment environment */\n  mode: DeploymentEnvironment;\n  /** Sentry DSN for error tracking (optional) */\n  sentryDsn?: string;\n  /** CORS allowed origins (defaults to ['*']) */\n  corsOrigins?: string[];\n}\n\n// ============================================================\n// ROUTE GROUP DEFINITIONS\n// ============================================================\n\n/** Route group definition for documentation and registration */\nexport interface RouteGroup {\n  /** URL prefix (e.g., '/v1/nodes') */\n  prefix: string;\n  /** Human-readable description */\n  description: string;\n  /** Whether authentication is required */\n  auth_required: boolean;\n  /** Whether rate limiting is applied */\n  rate_limited: boolean;\n}\n\nexport const RouteGroupSchema = z.object({\n  prefix: z.string(),\n  description: z.string(),\n  auth_required: z.boolean(),\n  rate_limited: z.boolean(),\n});\n\n// ============================================================\n// MIDDLEWARE CONFIGURATION\n// ============================================================\n\n/** CORS middleware configuration */\nexport interface CORSConfig {\n  origins: string[];\n  methods: string[];\n  headers: string[];\n  credentials: boolean;\n}\n\nexport const CORSConfigSchema = z.object({\n  origins: z.array(z.string()),\n  methods: z.array(z.string()),\n  headers: z.array(z.string()),\n  credentials: z.boolean(),\n});\n\n/** Auth middleware configuration */\nexport interface AuthMiddlewareConfig {\n  /** Paths that bypass authentication */\n  exclude_paths: string[];\n  /** Header containing the token */\n  token_header: string;\n  /** Token prefix to strip (e.g., 'Bearer ') */\n  token_prefix: string;\n}\n\nexport const AuthMiddlewareConfigSchema = z.object({\n  exclude_paths: z.array(z.string()),\n  token_header: z.string(),\n  token_prefix: z.string(),\n});\n\n/** Rate limit middleware configuration */\nexport interface ServerRateLimitConfig {\n  /** Maximum requests per window */\n  requests_per_minute: number;\n  /** Sliding window duration in milliseconds */\n  window_ms: number;\n  /** Key prefix for rate limit storage */\n  key_prefix: string;\n}\n\nexport const ServerRateLimitConfigSchema = z.object({\n  requests_per_minute: z.number().int().min(1),\n  window_ms: z.number().int().min(1000),\n  key_prefix: z.string(),\n});\n\n/** Logging middleware configuration */\nexport interface LoggingMiddlewareConfig {\n  level: LogLevel;\n  format: 'json' | 'text';\n  include_request_id: boolean;\n}\n\nexport const LoggingMiddlewareConfigSchema = z.object({\n  level: z.enum(['debug', 'info', 'warn', 'error', 'fatal']),\n  format: z.enum(['json', 'text']),\n  include_request_id: z.boolean(),\n});\n\n/** Error handling middleware configuration */\nexport interface ErrorMiddlewareConfig {\n  /** Whether to expose error details (false in production) */\n  expose_errors: boolean;\n  /** Sentry DSN for error reporting */\n  sentry_dsn?: string;\n}\n\nexport const ErrorMiddlewareConfigSchema = z.object({\n  expose_errors: z.boolean(),\n  sentry_dsn: z.string().optional(),\n});\n\n/** Complete middleware configuration */\nexport interface MiddlewareConfig {\n  cors: CORSConfig;\n  auth: AuthMiddlewareConfig;\n  rateLimit: ServerRateLimitConfig;\n  logging: LoggingMiddlewareConfig;\n  error: ErrorMiddlewareConfig;\n}\n\nexport const MiddlewareConfigSchema = z.object({\n  cors: CORSConfigSchema,\n  auth: AuthMiddlewareConfigSchema,\n  rateLimit: ServerRateLimitConfigSchema,\n  logging: LoggingMiddlewareConfigSchema,\n  error: ErrorMiddlewareConfigSchema,\n});\n\n// ============================================================\n// API ERROR RESPONSE\n// ============================================================\n\n/** Structured API error response */\nexport interface ApiErrorResponse {\n  /** Error code (e.g., 'UNAUTHORIZED', 'NOT_FOUND') */\n  code: string;\n  /** Human-readable error message */\n  message: string;\n  /** Additional details (only in development mode) */\n  details?: Record<string, unknown>;\n  /** Request tracking ID */\n  request_id?: string;\n}\n\nexport const ApiErrorResponseSchema = z.object({\n  code: z.string(),\n  message: z.string(),\n  details: z.record(z.unknown()).optional(),\n  request_id: z.string().optional(),\n});\n\n// ============================================================\n// SERVER FACTORY RETURN TYPE\n// ============================================================\n\n/** Hono app abstraction (the server's public interface) */\nexport interface HonoApp {\n  /** Handle an incoming HTTP request */\n  fetch: (request: Request) => Promise<Response>;\n}\n\n// ============================================================\n// SSE OPTIONS\n// ============================================================\n\n/** Options for creating an SSE stream */\nexport interface SSEOptions {\n  /** Maximum stream duration before sending timeout event (default: 25000ms) */\n  maxDurationMs?: number;\n  /** Heartbeat interval (default: 15000ms) */\n  heartbeatMs?: number;\n  /** Whether to support reconnection via Last-Event-ID (default: true) */\n  reconnectable?: boolean;\n}\n\nexport const SSEOptionsSchema = z.object({\n  maxDurationMs: z.number().int().min(1000).optional(),\n  heartbeatMs: z.number().int().min(1000).optional(),\n  reconnectable: z.boolean().optional(),\n});\n\n// ============================================================\n// SSE EVENT\n// ============================================================\n\n/** A single SSE event sent to the client */\nexport interface SSEEvent {\n  /** Event type */\n  event: SSEEventType;\n  /** Event ID for reconnection tracking */\n  id?: string;\n  /** Event data (JSON stringified) */\n  data: string;\n}\n\nexport const SSEEventSchema = z.object({\n  event: z.enum(['data', 'ping', 'timeout', 'done', 'error']),\n  id: z.string().optional(),\n  data: z.string(),\n});\n\n// ============================================================\n// SSE STREAM STATE\n// ============================================================\n\n/** Internal state of an active SSE stream */\nexport interface SSEStreamState {\n  /** Monotonically increasing event counter */\n  eventId: number;\n  /** Stream start time (Date.now()) */\n  startTime: number;\n  /** Last-Event-ID from reconnection header */\n  lastEventId?: string;\n  /** Whether the stream has been closed */\n  closed: boolean;\n}\n\nexport const SSEStreamStateSchema = z.object({\n  eventId: z.number().int().min(0),\n  startTime: z.number(),\n  lastEventId: z.string().optional(),\n  closed: z.boolean(),\n});\n\n// ============================================================\n// CHAT STREAM CHUNKS\n// ============================================================\n\n/**\n * Chat-specific SSE chunk types for /v1/chat endpoint.\n * The chat endpoint streams these as SSE data events.\n */\nexport interface ChatStreamChunk {\n  /** Chunk type */\n  type: 'token' | 'source' | 'done' | 'error';\n  /** Generated text (for 'token' type) */\n  content?: string;\n  /** Referenced node IDs (for 'source' type) */\n  sources?: string[];\n  /** Error message (for 'error' type) */\n  error?: string;\n}\n\nexport const ChatStreamChunkSchema = z.object({\n  type: z.enum(['token', 'source', 'done', 'error']),\n  content: z.string().optional(),\n  sources: z.array(z.string()).optional(),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// CONFIG SCHEMA: DATABASE (Discriminated Union)\n// ============================================================\n\n/** Turso cloud database configuration */\nexport const TursoDatabaseConfigSchema = z.object({\n  type: z.literal('turso'),\n  /** Turso database URL (libsql://...) */\n  url: z.string().url(),\n  /** Turso auth token */\n  authToken: z.string().min(1),\n});\nexport type TursoDatabaseConfig = z.infer<typeof TursoDatabaseConfigSchema>;\n\n/** Local SQLite database configuration */\nexport const SqliteDatabaseConfigSchema = z.object({\n  type: z.literal('sqlite'),\n  /** Path to SQLite database file */\n  path: z.string().min(1),\n});\nexport type SqliteDatabaseConfig = z.infer<typeof SqliteDatabaseConfigSchema>;\n\n/** Database configuration (one of the above) */\nexport const DatabaseConfigSchema = z.discriminatedUnion('type', [\n  TursoDatabaseConfigSchema,\n  SqliteDatabaseConfigSchema,\n]);\nexport type DatabaseConfig = z.infer<typeof DatabaseConfigSchema>;\n\n// ============================================================\n// CONFIG SCHEMA: AUTH (Discriminated Union)\n// ============================================================\n\n/** Clerk cloud auth configuration */\nexport const ClerkAuthConfigSchema = z.object({\n  type: z.literal('clerk'),\n  /** Clerk secret key (server-side) */\n  secretKey: z.string().min(1),\n  /** Clerk publishable key */\n  publishableKey: z.string().min(1),\n});\nexport type ClerkAuthConfig = z.infer<typeof ClerkAuthConfigSchema>;\n\n/** Local JWT auth configuration (for dev/self-host) */\nexport const LocalAuthConfigSchema = z.object({\n  type: z.literal('local'),\n  /** JWT signing secret (optional, auto-generated if not set) */\n  jwtSecret: z.string().optional(),\n});\nexport type LocalAuthConfig = z.infer<typeof LocalAuthConfigSchema>;\n\n/** Auth configuration (one of the above) */\nexport const AuthConfigSchema = z.discriminatedUnion('type', [\n  ClerkAuthConfigSchema,\n  LocalAuthConfigSchema,\n]);\nexport type AuthConfig = z.infer<typeof AuthConfigSchema>;\n\n// ============================================================\n// CONFIG SCHEMA: LLM\n// ============================================================\n\n/** LLM provider configuration (at least one key required) */\nexport const LLMConfigSchema = z.object({\n  openai: z.object({ apiKey: z.string().min(1) }).optional(),\n  anthropic: z.object({ apiKey: z.string().min(1) }).optional(),\n  google: z.object({ apiKey: z.string().min(1) }).optional(),\n});\nexport type LLMConfig = z.infer<typeof LLMConfigSchema>;\n\n// ============================================================\n// CONFIG SCHEMA: JOBS (Discriminated Union)\n// ============================================================\n\n/** Cloudflare Queues configuration (bound via wrangler.toml) */\nexport const CloudflareJobsConfigSchema = z.object({\n  type: z.literal('cloudflare'),\n});\nexport type CloudflareJobsConfig = z.infer<typeof CloudflareJobsConfigSchema>;\n\n/** BullMQ + Redis configuration (for self-host/scale) */\nexport const BullMQJobsConfigSchema = z.object({\n  type: z.literal('bullmq'),\n  /** Redis connection URL */\n  redisUrl: z.string().url(),\n});\nexport type BullMQJobsConfig = z.infer<typeof BullMQJobsConfigSchema>;\n\n/** In-memory job queue (for development) */\nexport const MemoryJobsConfigSchema = z.object({\n  type: z.literal('memory'),\n});\nexport type MemoryJobsConfig = z.infer<typeof MemoryJobsConfigSchema>;\n\n/** Jobs configuration (one of the above) */\nexport const JobsConfigSchema = z.discriminatedUnion('type', [\n  CloudflareJobsConfigSchema,\n  BullMQJobsConfigSchema,\n  MemoryJobsConfigSchema,\n]);\nexport type JobsConfig = z.infer<typeof JobsConfigSchema>;\n\n// ============================================================\n// CONFIG SCHEMA: OBSERVABILITY\n// ============================================================\n\n/** Observability and monitoring configuration */\nexport const ObservabilityConfigSchema = z.object({\n  /** Sentry DSN for error tracking */\n  sentryDsn: z.string().url().optional(),\n  /** Log level */\n  logLevel: z.enum(['debug', 'info', 'warn', 'error', 'fatal']).default('info'),\n});\nexport type ObservabilityConfig = z.infer<typeof ObservabilityConfigSchema>;\n\n// ============================================================\n// CONFIG SCHEMA: MASTER CONFIG\n// ============================================================\n\n/**\n * Complete Nous backend configuration.\n * Validated at startup — fails fast on invalid config.\n */\nexport const NousConfigSchema = z.object({\n  /** Deployment environment */\n  env: z.enum(['development', 'staging', 'production']).default('development'),\n  /** Server port */\n  port: z.coerce.number().int().min(1).max(65535).default(3000),\n  /** Server host */\n  host: z.string().default('0.0.0.0'),\n  /** Database configuration */\n  database: DatabaseConfigSchema,\n  /** Authentication configuration */\n  auth: AuthConfigSchema,\n  /** LLM provider configuration */\n  llm: LLMConfigSchema,\n  /** Job queue configuration */\n  jobs: JobsConfigSchema,\n  /** Observability configuration */\n  observability: ObservabilityConfigSchema,\n});\nexport type NousConfig = z.infer<typeof NousConfigSchema>;\n\n// ============================================================\n// HEALTH CHECK RESPONSE\n// ============================================================\n\n/** Response from the /v1/health endpoint */\nexport interface HealthCheckResponse {\n  /** Overall system status */\n  status: HealthStatus;\n  /** Application version */\n  version: string;\n  /** Current server time (ISO 8601) */\n  timestamp: string;\n  /** Per-service health status */\n  services: Record<HealthCheckService, ServiceHealth>;\n  /** Optional system metrics */\n  metrics?: HealthMetrics;\n}\n\nexport const HealthCheckResponseSchema = z.object({\n  status: z.enum(['healthy', 'degraded', 'unhealthy']),\n  version: z.string(),\n  timestamp: z.string(),\n  services: z.record(z.lazy(() => ServiceHealthSchema)),\n  metrics: z.lazy(() => HealthMetricsSchema).optional(),\n});\n\n// ============================================================\n// SERVICE HEALTH\n// ============================================================\n\n/** Health status of an individual service/adapter */\nexport interface ServiceHealth {\n  /** Service status */\n  status: HealthStatus;\n  /** Response latency in milliseconds */\n  latency_ms?: number;\n  /** Error message if unhealthy */\n  error?: string;\n}\n\nexport const ServiceHealthSchema = z.object({\n  status: z.enum(['healthy', 'degraded', 'unhealthy']),\n  latency_ms: z.number().min(0).optional(),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// HEALTH METRICS\n// ============================================================\n\n/** Optional system metrics included in health response */\nexport interface HealthMetrics {\n  /** Number of jobs in queue */\n  jobQueueDepth?: number;\n  /** Number of active connections */\n  activeConnections?: number;\n  /** Server uptime in seconds */\n  uptime_seconds?: number;\n}\n\nexport const HealthMetricsSchema = z.object({\n  jobQueueDepth: z.number().int().min(0).optional(),\n  activeConnections: z.number().int().min(0).optional(),\n  uptime_seconds: z.number().min(0).optional(),\n});\n\n// ============================================================\n// READINESS CHECK\n// ============================================================\n\n/** Readiness probe for Kubernetes/Fly.io */\nexport interface ReadinessCheck {\n  /** Whether the server is ready to accept requests */\n  ready: boolean;\n  /** Individual check results */\n  checks: Record<string, boolean>;\n}\n\nexport const ReadinessCheckSchema = z.object({\n  ready: z.boolean(),\n  checks: z.record(z.boolean()),\n});\n\n// ============================================================\n// DEPLOYMENT MATRIX\n// ============================================================\n\n/** A single entry in the deployment decision matrix */\nexport interface DeploymentMatrixEntry {\n  /** Named deployment scenario */\n  scenario: DeploymentScenario;\n  /** Where the API runs */\n  api: DeploymentTarget;\n  /** Job queue adapter type */\n  jobs: JobQueueAdapterType;\n  /** Database adapter type */\n  database: DatabaseAdapterType;\n  /** Auth adapter type */\n  auth: AuthAdapterType;\n  /** Human-readable description */\n  description: string;\n}\n\nexport const DeploymentMatrixEntrySchema = z.object({\n  scenario: z.string(),\n  api: z.string(),\n  jobs: z.string(),\n  database: z.string(),\n  auth: z.string(),\n  description: z.string(),\n});\n\n// ============================================================\n// SELF-HOSTING CONFIGURATION\n// ============================================================\n\n/** Self-hosting system requirements */\nexport interface SelfHostConfig {\n  /** Docker Compose service names */\n  docker_compose_services: string[];\n  /** Environment variables that MUST be set */\n  required_env_vars: string[];\n  /** Environment variables that are optional */\n  optional_env_vars: string[];\n  /** Minimum RAM in megabytes */\n  min_ram_mb: number;\n  /** Recommended RAM in megabytes */\n  recommended_ram_mb: number;\n  /** Docker volumes for persistent data */\n  volumes: string[];\n}\n\nexport const SelfHostConfigSchema = z.object({\n  docker_compose_services: z.array(z.string()),\n  required_env_vars: z.array(z.string()),\n  optional_env_vars: z.array(z.string()),\n  min_ram_mb: z.number().int().min(0),\n  recommended_ram_mb: z.number().int().min(0),\n  volumes: z.array(z.string()),\n});\n\n// ============================================================\n// DOCKER SERVICE CONFIGURATION\n// ============================================================\n\n/** Docker Compose service definition */\nexport interface DockerServiceConfig {\n  /** Service name */\n  name: string;\n  /** Docker image or build context */\n  image: string;\n  /** Exposed port mappings */\n  ports?: string[];\n  /** Environment variables */\n  environment: string[];\n  /** Volume mounts */\n  volumes?: string[];\n  /** Service dependencies */\n  depends_on?: string[];\n}\n\nexport const DockerServiceConfigSchema = z.object({\n  name: z.string(),\n  image: z.string(),\n  ports: z.array(z.string()).optional(),\n  environment: z.array(z.string()),\n  volumes: z.array(z.string()).optional(),\n  depends_on: z.array(z.string()).optional(),\n});\n\n// ============================================================\n// STRUCTURED LOG ENTRY\n// ============================================================\n\n/** A single structured log entry (JSON format) */\nexport interface StructuredLogEntry {\n  /** ISO 8601 timestamp */\n  timestamp: string;\n  /** Unique request identifier */\n  requestId: string;\n  /** Log severity level */\n  level: LogLevel;\n  /** HTTP method (for request logs) */\n  method?: string;\n  /** Request path (for request logs) */\n  path?: string;\n  /** HTTP status code (for response logs) */\n  status?: number;\n  /** Request duration in milliseconds */\n  duration_ms?: number;\n  /** Authenticated user ID */\n  userId?: string;\n  /** Tenant ID */\n  tenantId?: string;\n  /** Log message */\n  message?: string;\n  /** Error string (for error logs) */\n  error?: string;\n}\n\nexport const StructuredLogEntrySchema = z.object({\n  timestamp: z.string(),\n  requestId: z.string(),\n  level: z.enum(['debug', 'info', 'warn', 'error', 'fatal']),\n  method: z.string().optional(),\n  path: z.string().optional(),\n  status: z.number().int().optional(),\n  duration_ms: z.number().min(0).optional(),\n  userId: z.string().optional(),\n  tenantId: z.string().optional(),\n  message: z.string().optional(),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// METRICS CONFIGURATION\n// ============================================================\n\n/** Which metrics to collect */\nexport interface MetricsConfig {\n  /** Track total request count */\n  request_count: boolean;\n  /** Track request duration histogram */\n  request_duration: boolean;\n  /** Track LLM cost per request */\n  llm_cost: boolean;\n  /** Track embedding generation count */\n  embedding_count: boolean;\n  /** Track job queue size */\n  job_queue_size: boolean;\n}\n\nexport const MetricsConfigSchema = z.object({\n  request_count: z.boolean(),\n  request_duration: z.boolean(),\n  llm_cost: z.boolean(),\n  embedding_count: z.boolean(),\n  job_queue_size: z.boolean(),\n});\n\n// ============================================================\n// SENTRY CONFIGURATION\n// ============================================================\n\n/** Sentry error tracking configuration */\nexport interface SentryConfig {\n  /** Sentry DSN */\n  dsn: string;\n  /** Percentage of requests to trace (0-1) */\n  traces_sample_rate: number;\n  /** Deployment environment tag */\n  environment: DeploymentEnvironment;\n  /** Release version tag */\n  release?: string;\n}\n\nexport const SentryConfigSchema = z.object({\n  dsn: z.string().url(),\n  traces_sample_rate: z.number().min(0).max(1),\n  environment: z.enum(['development', 'staging', 'production']),\n  release: z.string().optional(),\n});\n\n// ============================================================\n// REQUEST CONTEXT\n// ============================================================\n\n/** Per-request context passed through middleware chain */\nexport interface RequestContext {\n  /** Unique request identifier (UUID v4) */\n  requestId: string;\n  /** Authenticated user ID (set by auth middleware) */\n  userId?: string;\n  /** Tenant ID (set by auth middleware) */\n  tenantId?: string;\n  /** Request start time (Date.now()) */\n  startTime: number;\n}\n\nexport const RequestContextSchema = z.object({\n  requestId: z.string(),\n  userId: z.string().optional(),\n  tenantId: z.string().optional(),\n  startTime: z.number(),\n});\n\n// ============================================================\n// LOCAL DEV CONFIGURATION\n// ============================================================\n\n/** Configuration for local development server */\nexport interface LocalDevConfig {\n  /** Server port */\n  port: number;\n  /** Path to SQLite database file */\n  database_path: string;\n  /** Whether to auto-seed with sample data */\n  auto_seed: boolean;\n  /** Simulated LLM latency in milliseconds */\n  mock_llm_latency_ms: number;\n  /** Whether mock embeddings are deterministic (same input → same output) */\n  mock_embedding_deterministic: boolean;\n  /** Whether to accept any Bearer token as valid */\n  accept_any_token: boolean;\n  /** Whether to process jobs immediately instead of queuing */\n  process_jobs_immediately: boolean;\n}\n\nexport const LocalDevConfigSchema = z.object({\n  port: z.number().int().min(1).max(65535),\n  database_path: z.string(),\n  auto_seed: z.boolean(),\n  mock_llm_latency_ms: z.number().int().min(0),\n  mock_embedding_deterministic: z.boolean(),\n  accept_any_token: z.boolean(),\n  process_jobs_immediately: z.boolean(),\n});\n\n// ============================================================\n// SEED DATA\n// ============================================================\n\n/** Seed user for development */\nexport interface SeedUser {\n  id: string;\n  email: string;\n  tier: 'free' | 'credits' | 'pro';\n}\n\nexport const SeedUserSchema = z.object({\n  id: z.string(),\n  email: z.string().email(),\n  tier: z.enum(['free', 'credits', 'pro']),\n});\n\n/** Seed data configuration */\nexport interface SeedDataConfig {\n  /** Pre-created users */\n  users: SeedUser[];\n  /** Number of sample nodes to create */\n  node_count: number;\n  /** Number of sample edges to create */\n  edge_count: number;\n}\n\nexport const SeedDataConfigSchema = z.object({\n  users: z.array(SeedUserSchema),\n  node_count: z.number().int().min(0),\n  edge_count: z.number().int().min(0),\n});\n\n// ============================================================\n// MOCK ADAPTER CONFIGURATIONS\n// ============================================================\n\n/** Configuration for mock LLM adapter */\nexport interface MockLLMConfig {\n  /** Simulated response latency */\n  latencyMs: number;\n  /** Whether to generate mock response content */\n  mockResponses: boolean;\n  /** Whether same input produces same output */\n  deterministicOutputs: boolean;\n}\n\nexport const MockLLMConfigSchema = z.object({\n  latencyMs: z.number().int().min(0),\n  mockResponses: z.boolean(),\n  deterministicOutputs: z.boolean(),\n});\n\n/** Configuration for mock embedding adapter */\nexport interface MockEmbeddingConfig {\n  /** Embedding vector dimensions */\n  dimensions: number;\n  /** Whether same input produces same embedding */\n  deterministic: boolean;\n}\n\nexport const MockEmbeddingConfigSchema = z.object({\n  dimensions: z.number().int().min(1),\n  deterministic: z.boolean(),\n});\n\n/** Configuration for mock job queue */\nexport interface MockJobQueueConfig {\n  /** Whether to process jobs immediately (inline) */\n  processImmediately: boolean;\n}\n\nexport const MockJobQueueConfigSchema = z.object({\n  processImmediately: z.boolean(),\n});\n\n/** Configuration for local auth adapter */\nexport interface LocalAuthDevConfig {\n  /** Pre-created users */\n  users: SeedUser[];\n  /** Whether to accept any token */\n  acceptAnyToken: boolean;\n}\n\nexport const LocalAuthDevConfigSchema = z.object({\n  users: z.array(SeedUserSchema),\n  acceptAnyToken: z.boolean(),\n});\n","/**\n * @module @nous/core/backend\n * @description Adapter utilities — schema factories and adapter validation helpers\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Provides utility functions for working with adapter types:\n * - Generic schema factories for paginated results\n * - Adapter type validation helpers\n *\n * The adapter interfaces themselves are defined in types.ts.\n * This file provides runtime utilities for working with adapters.\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/adapter-interfaces.ts} - Spec\n */\n\nimport { z } from 'zod';\n\n// ============================================================\n// SCHEMA FACTORIES\n// ============================================================\n\n/**\n * Create a Zod schema for PaginatedResult<T> with a given item schema.\n * Used to validate paginated responses from IDatabaseAdapter.\n *\n * @param itemSchema - Zod schema for the items in the result\n * @returns A Zod object schema for PaginatedResult<T>\n *\n * @example\n * ```typescript\n * const NodeResultSchema = createPaginatedResultSchema(z.record(z.unknown()));\n * const result = NodeResultSchema.parse({ items: [...], total: 10, has_more: false });\n * ```\n */\nexport function createPaginatedResultSchema<T extends z.ZodType>(itemSchema: T) {\n  return z.object({\n    items: z.array(itemSchema),\n    total: z.number().int().min(0),\n    has_more: z.boolean(),\n  });\n}\n","/**\n * @module @nous/core/backend\n * @description Server configuration — route groups, middleware defaults, error handling, server factory\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Route group data, default middleware configuration, pure functions for\n * API error creation, route lookup, and auth requirement checks.\n * The createServer() stub requires a Hono framework implementation.\n *\n * Middleware application order: cors -> logging -> error -> auth -> rate_limit\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/server-config.ts} - Spec\n */\n\nimport type {\n  RouteGroup,\n  MiddlewareConfig,\n  ServerConfig,\n  ApiErrorResponse,\n  HonoApp,\n} from './types';\n\n// ============================================================\n// ROUTE GROUP DATA\n// ============================================================\n\n/**\n * All API route groups.\n * Each maps to a Hono sub-router via app.route(prefix, router).\n *\n * @see storm-026 spec/server-config.ts - ROUTE_GROUPS\n */\nexport const ROUTE_GROUPS: readonly RouteGroup[] = [\n  { prefix: '/v1/nodes', description: 'Node CRUD operations', auth_required: true, rate_limited: true },\n  { prefix: '/v1/edges', description: 'Edge CRUD operations', auth_required: true, rate_limited: true },\n  { prefix: '/v1/search', description: 'Vector, text, and hybrid search', auth_required: true, rate_limited: true },\n  { prefix: '/v1/chat', description: 'Chat with SSE streaming', auth_required: true, rate_limited: true },\n  { prefix: '/v1/agent', description: 'AI agent tool execution', auth_required: true, rate_limited: true },\n  { prefix: '/v1/sync', description: 'Multi-device sync protocol', auth_required: true, rate_limited: false },\n  { prefix: '/v1/ingest', description: 'Content ingestion pipeline', auth_required: true, rate_limited: true },\n  { prefix: '/v1/settings', description: 'User preferences and settings', auth_required: true, rate_limited: false },\n  { prefix: '/v1/credits', description: 'Credit balance and transactions', auth_required: true, rate_limited: false },\n  { prefix: '/v1/clusters', description: 'Memory cluster management', auth_required: true, rate_limited: true },\n  { prefix: '/v1/health', description: 'Health check endpoint', auth_required: false, rate_limited: false },\n] as const;\n\n// ============================================================\n// DEFAULT MIDDLEWARE CONFIGURATION\n// ============================================================\n\n/**\n * Default middleware configuration.\n * Production deployments should override corsOrigins in ServerConfig.\n *\n * @see storm-026 spec/server-config.ts - DEFAULT_MIDDLEWARE_CONFIG\n */\nexport const DEFAULT_MIDDLEWARE_CONFIG: MiddlewareConfig = {\n  cors: {\n    origins: ['*'],\n    methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],\n    headers: ['Content-Type', 'Authorization', 'Last-Event-ID'],\n    credentials: true,\n  },\n  auth: {\n    exclude_paths: ['/v1/health'],\n    token_header: 'Authorization',\n    token_prefix: 'Bearer ',\n  },\n  rateLimit: {\n    requests_per_minute: 60,\n    window_ms: 60_000,\n    key_prefix: 'rl:',\n  },\n  logging: {\n    level: 'info',\n    format: 'json',\n    include_request_id: true,\n  },\n  error: {\n    expose_errors: false,\n    sentry_dsn: undefined,\n  },\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Create a structured API error response.\n *\n * @param code - Error code from ERROR_CODES (e.g., 'UNAUTHORIZED', 'NOT_FOUND')\n * @param message - Human-readable message\n * @param details - Optional additional details (only exposed in development)\n * @param request_id - Optional request tracking ID\n * @returns Structured ApiErrorResponse object\n */\nexport function createApiError(\n  code: string,\n  message: string,\n  details?: Record<string, unknown>,\n  request_id?: string,\n): ApiErrorResponse {\n  return {\n    code,\n    message,\n    ...(details && { details }),\n    ...(request_id && { request_id }),\n  };\n}\n\n/**\n * Get the route group configuration for a prefix.\n *\n * @param prefix - Route prefix (e.g., '/v1/nodes')\n * @returns RouteGroup or undefined if not found\n */\nexport function getRouteGroup(prefix: string): RouteGroup | undefined {\n  return ROUTE_GROUPS.find(g => g.prefix === prefix);\n}\n\n/**\n * Check if a path requires authentication.\n * Matches against ROUTE_GROUPS by prefix. If no matching group is found,\n * defaults to requiring auth (secure by default).\n *\n * @param path - Request path (e.g., '/v1/health', '/v1/nodes/abc')\n * @returns True if the path requires authentication\n */\nexport function requiresAuth(path: string): boolean {\n  const group = ROUTE_GROUPS.find(g => path.startsWith(g.prefix));\n  return group?.auth_required ?? true;\n}\n\n// ============================================================\n// EXTERNAL STUBS\n// ============================================================\n\n/**\n * Create a Hono server wired with all adapters.\n * Requires Hono framework.\n *\n * @param _config - Server configuration with all adapters\n * @returns A Hono app ready to serve requests\n */\nexport function createServer(_config: ServerConfig): HonoApp {\n  throw new Error('createServer requires Hono framework implementation');\n}\n","/**\n * @module @nous/core/backend\n * @description Job system — tier assignments, job creation, expiration checks\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Job tier assignment data and pure functions for the three-tier execution model:\n *\n * ```\n * TIER 1: INLINE    (<50ms)   Classification, token validation\n * TIER 2: QUEUED    (<30s)    Embedding, dedup, edge inference\n * TIER 3: REGIONAL  (<10min)  Document processing, batch embed\n * ```\n *\n * Tier 1 jobs run inline in the request handler (no queue needed).\n * Tier 2 jobs go through Cloudflare Queues (cloud) or BullMQ (self-host).\n * Tier 3 jobs go through Fly.io Machines (cloud) or BullMQ (self-host).\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/job-system.ts} - Spec\n */\n\nimport type { Job, JobTierConfig } from './types';\nimport type { JobTier, JobType, CronJobType, JobPriority } from './constants';\n\n// ============================================================\n// JOB TIER ASSIGNMENTS\n// ============================================================\n\n/**\n * Tier assignment for each job type.\n * Determines where each job runs and its execution constraints.\n *\n * @see storm-026 spec/job-system.ts - JOB_TIER_ASSIGNMENTS\n */\nexport const JOB_TIER_ASSIGNMENTS: Record<JobType | CronJobType, JobTierConfig> = {\n  // Tier 2: Queued (<30s)\n  'embed': {\n    type: 'embed',\n    tier: 'queued',\n    max_duration_ms: 10_000,\n    retry_count: 3,\n    retry_delay_ms: 1_000,\n  },\n  'deduplicate': {\n    type: 'deduplicate',\n    tier: 'queued',\n    max_duration_ms: 15_000,\n    retry_count: 3,\n    retry_delay_ms: 1_000,\n  },\n  'infer-edges': {\n    type: 'infer-edges',\n    tier: 'queued',\n    max_duration_ms: 20_000,\n    retry_count: 3,\n    retry_delay_ms: 2_000,\n  },\n  'sync-push-notification': {\n    type: 'sync-push-notification',\n    tier: 'queued',\n    max_duration_ms: 5_000,\n    retry_count: 5,\n    retry_delay_ms: 500,\n  },\n\n  // Tier 3: Regional (<10min)\n  'process-document': {\n    type: 'process-document',\n    tier: 'regional',\n    max_duration_ms: 300_000,\n    retry_count: 2,\n    retry_delay_ms: 5_000,\n  },\n  'batch-embed': {\n    type: 'batch-embed',\n    tier: 'regional',\n    max_duration_ms: 600_000,\n    retry_count: 2,\n    retry_delay_ms: 10_000,\n  },\n\n  // Cron jobs: Regional\n  'decay-cycle': {\n    type: 'decay-cycle',\n    tier: 'regional',\n    max_duration_ms: 300_000,\n    retry_count: 1,\n    retry_delay_ms: 60_000,\n  },\n  'reorganize': {\n    type: 'reorganize',\n    tier: 'regional',\n    max_duration_ms: 600_000,\n    retry_count: 1,\n    retry_delay_ms: 60_000,\n  },\n  'cleanup-expired': {\n    type: 'cleanup-expired',\n    tier: 'regional',\n    max_duration_ms: 120_000,\n    retry_count: 1,\n    retry_delay_ms: 30_000,\n  },\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Get the execution tier for a job type.\n *\n * @param type - Job or cron job type\n * @returns The tier this job should run at ('inline' | 'queued' | 'regional')\n */\nexport function getJobTierForType(type: JobType | CronJobType): JobTier {\n  return JOB_TIER_ASSIGNMENTS[type].tier;\n}\n\n/**\n * Get the full tier configuration for a job type.\n *\n * @param type - Job or cron job type\n * @returns Tier configuration including limits and retry settings\n */\nexport function getJobTierConfig(type: JobType | CronJobType): JobTierConfig {\n  return JOB_TIER_ASSIGNMENTS[type];\n}\n\n/**\n * Create a new job instance with a generated ID and timestamp.\n *\n * @param type - Job type\n * @param payload - Job-specific data\n * @param tenantId - Tenant the job belongs to\n * @param options - Optional priority and correlation ID\n * @returns A fully formed Job object ready for enqueue\n */\nexport function createJob<T extends JobType>(\n  type: T,\n  payload: Record<string, unknown>,\n  tenantId: string,\n  options?: { priority?: JobPriority; correlationId?: string },\n): Job<T> {\n  return {\n    id: `job_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n    type,\n    payload,\n    priority: options?.priority ?? 'normal',\n    correlationId: options?.correlationId,\n    tenantId,\n    createdAt: new Date().toISOString(),\n  };\n}\n\n/**\n * Check if a job has exceeded its tier's maximum duration.\n *\n * @param job - The job to check\n * @param startedAt - When the job started processing (ISO 8601)\n * @returns True if the job has exceeded its time limit\n */\nexport function isJobExpired(job: Job<JobType | CronJobType>, startedAt: string): boolean {\n  const config = JOB_TIER_ASSIGNMENTS[job.type];\n  const elapsed = Date.now() - new Date(startedAt).getTime();\n  return elapsed > config.max_duration_ms;\n}\n","/**\n * @module @nous/core/backend\n * @description Configuration schema — environment variable mapping, validation, config loading\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Environment variable mapping data, pure functions for Zod-validated\n * configuration, and the loadConfig() stub for application-level\n * environment reading.\n *\n * @example\n * ```typescript\n * // Validate raw config\n * const config = validateConfig(rawConfigObject);\n *\n * // Safe validation (no throw)\n * const result = safeValidateConfig(rawConfigObject);\n * if (result.success) {\n *   console.log(result.data.port);\n * }\n *\n * // Look up env var name\n * getEnvVarName('database.turso.url'); // 'TURSO_URL'\n * ```\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/config-schema.ts} - Spec\n */\n\nimport type { z } from 'zod';\nimport type { NousConfig } from './types';\nimport { NousConfigSchema } from './types';\n\n// ============================================================\n// ENVIRONMENT VARIABLE MAPPING\n// ============================================================\n\n/**\n * Maps configuration fields to environment variable names.\n * Used by loadConfig() to read from process.env.\n *\n * @see storm-026 spec/config-schema.ts - ENV_VAR_MAPPING\n */\nexport const ENV_VAR_MAPPING = {\n  'env': 'NODE_ENV',\n  'port': 'PORT',\n  'host': 'HOST',\n  'database.turso.url': 'TURSO_URL',\n  'database.turso.authToken': 'TURSO_AUTH_TOKEN',\n  'database.sqlite.path': 'DATABASE_PATH',\n  'auth.clerk.secretKey': 'CLERK_SECRET_KEY',\n  'auth.clerk.publishableKey': 'CLERK_PUBLISHABLE_KEY',\n  'auth.local.jwtSecret': 'JWT_SECRET',\n  'llm.openai.apiKey': 'OPENAI_API_KEY',\n  'llm.anthropic.apiKey': 'ANTHROPIC_API_KEY',\n  'llm.google.apiKey': 'GOOGLE_API_KEY',\n  'jobs.bullmq.redisUrl': 'REDIS_URL',\n  'observability.sentryDsn': 'SENTRY_DSN',\n  'observability.logLevel': 'LOG_LEVEL',\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Validate a raw configuration object against the NousConfigSchema.\n * Throws a ZodError if validation fails -- use for fail-fast startup.\n *\n * @param raw - Raw configuration (e.g., from environment)\n * @returns Validated NousConfig\n * @throws ZodError if validation fails\n */\nexport function validateConfig(raw: unknown): NousConfig {\n  return NousConfigSchema.parse(raw);\n}\n\n/**\n * Safely validate configuration without throwing.\n * Returns a Zod SafeParseReturnType with either data or error details.\n *\n * @param raw - Raw configuration\n * @returns Success result with data, or error result with issues\n */\nexport function safeValidateConfig(raw: unknown): z.SafeParseReturnType<unknown, NousConfig> {\n  return NousConfigSchema.safeParse(raw);\n}\n\n/**\n * Get the environment variable name for a config field path.\n *\n * @param configPath - Dot-separated config path (e.g., 'database.turso.url')\n * @returns Environment variable name or undefined if not mapped\n */\nexport function getEnvVarName(configPath: string): string | undefined {\n  return ENV_VAR_MAPPING[configPath as keyof typeof ENV_VAR_MAPPING];\n}\n\n// ============================================================\n// EXTERNAL STUBS\n// ============================================================\n\n/**\n * Load configuration from environment variables.\n * Reads process.env, maps to config schema, and validates.\n * Exits with error message if validation fails.\n *\n * This must be implemented at the application level where process.env\n * (or platform-specific env access) is available.\n *\n * @returns Validated NousConfig\n */\nexport function loadConfig(): NousConfig {\n  throw new Error('loadConfig requires process.env access and should be implemented at the application level');\n}\n","/**\n * @module @nous/core/backend\n * @description Deployment configuration — targets, decision matrix, self-hosting, Docker Compose\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Deployment decision matrix data, self-hosting defaults, Docker service\n * definitions, and pure functions for deployment scenario lookups.\n *\n * | Scenario          | API                | Jobs       | Database | Auth   |\n * |-------------------|--------------------|------------|----------|--------|\n * | Nous Cloud        | Cloudflare Workers | Cloudflare | Turso    | Clerk  |\n * | Self-Host (Small) | Docker (Bun)       | Memory     | SQLite   | Local  |\n * | Self-Host (Scale) | Docker (multiple)  | BullMQ     | SQLite   | Local  |\n * | Enterprise        | Docker/K8s         | BullMQ     | SQLite   | Local  |\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/deployment.ts} - Spec\n */\n\nimport type {\n  DeploymentMatrixEntry,\n  SelfHostConfig,\n  DockerServiceConfig,\n} from './types';\nimport type { DeploymentScenario } from './constants';\n\n// ============================================================\n// DEPLOYMENT MATRIX\n// ============================================================\n\n/**\n * Deployment decision matrix.\n * Maps named scenarios to their infrastructure choices.\n *\n * @see storm-026 spec/deployment.ts - DEPLOYMENT_MATRIX\n */\nexport const DEPLOYMENT_MATRIX: Record<DeploymentScenario, DeploymentMatrixEntry> = {\n  nous_cloud: {\n    scenario: 'nous_cloud',\n    api: 'cloudflare_workers',\n    jobs: 'cloudflare',\n    database: 'turso',\n    auth: 'clerk',\n    description: 'Production Nous Cloud: edge API + Turso + Clerk + Cloudflare Queues',\n  },\n  self_host_small: {\n    scenario: 'self_host_small',\n    api: 'docker',\n    jobs: 'memory',\n    database: 'sqlite',\n    auth: 'local',\n    description: 'Small self-hosted: single Docker container, in-process jobs, SQLite file',\n  },\n  self_host_scale: {\n    scenario: 'self_host_scale',\n    api: 'docker',\n    jobs: 'bullmq',\n    database: 'sqlite',\n    auth: 'local',\n    description: 'Scaled self-hosted: multiple Docker containers, BullMQ + Redis, SQLite file',\n  },\n  enterprise: {\n    scenario: 'enterprise',\n    api: 'docker',\n    jobs: 'bullmq',\n    database: 'sqlite',\n    auth: 'local',\n    description: 'Enterprise: Kubernetes-ready, BullMQ + Redis, SQLite (or community Postgres adapter)',\n  },\n} as const;\n\n// ============================================================\n// DEFAULT SELF-HOST CONFIGURATION\n// ============================================================\n\n/**\n * Default self-hosting configuration with system requirements.\n *\n * @see storm-026 spec/deployment.ts - DEFAULT_SELF_HOST_CONFIG\n */\nexport const DEFAULT_SELF_HOST_CONFIG: SelfHostConfig = {\n  docker_compose_services: ['api', 'jobs', 'redis'],\n  required_env_vars: ['OPENAI_API_KEY'],\n  optional_env_vars: [\n    'DATABASE_PATH',\n    'PORT',\n    'JWT_SECRET',\n    'ANTHROPIC_API_KEY',\n    'GOOGLE_API_KEY',\n    'REDIS_URL',\n    'SENTRY_DSN',\n    'LOG_LEVEL',\n  ],\n  min_ram_mb: 1024,\n  recommended_ram_mb: 2048,\n  volumes: ['/data/nous.db'],\n} as const;\n\n// ============================================================\n// DOCKER SERVICE DEFINITIONS\n// ============================================================\n\n/**\n * Docker Compose service definitions for self-hosting.\n * These define the three services in the self-host stack.\n *\n * @see storm-026 spec/deployment.ts - DOCKER_SERVICES\n */\nexport const DOCKER_SERVICES: readonly DockerServiceConfig[] = [\n  {\n    name: 'api',\n    image: 'nous-api:latest',\n    ports: ['3000:3000'],\n    environment: [\n      'DATABASE_PATH=/data/nous.db',\n      'AUTH_MODE=local',\n      'REDIS_URL=redis://redis:6379',\n    ],\n    volumes: ['nous-data:/data'],\n    depends_on: ['redis'],\n  },\n  {\n    name: 'jobs',\n    image: 'nous-jobs:latest',\n    environment: [\n      'DATABASE_PATH=/data/nous.db',\n      'REDIS_URL=redis://redis:6379',\n    ],\n    volumes: ['nous-data:/data'],\n    depends_on: ['redis'],\n  },\n  {\n    name: 'redis',\n    image: 'redis:7-alpine',\n    ports: ['6379:6379'],\n    environment: [],\n  },\n] as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Get deployment configuration for a named scenario.\n *\n * @param scenario - Named deployment scenario\n * @returns Deployment matrix entry with all infrastructure choices\n */\nexport function getDeploymentConfig(scenario: DeploymentScenario): DeploymentMatrixEntry {\n  return DEPLOYMENT_MATRIX[scenario];\n}\n\n/**\n * Get self-hosting system requirements.\n *\n * @returns Self-host configuration with required env vars, RAM, and volumes\n */\nexport function getSelfHostRequirements(): SelfHostConfig {\n  return DEFAULT_SELF_HOST_CONFIG;\n}\n\n/**\n * Get Docker Compose service definitions for a scenario.\n * Small deployments get only the API service (in-process jobs, no Redis).\n * Scale and enterprise deployments get the full stack (api + jobs + redis).\n *\n * @param scenario - Deployment scenario\n * @returns Array of Docker service configurations\n */\nexport function getDockerServices(scenario: DeploymentScenario): readonly DockerServiceConfig[] {\n  if (scenario === 'self_host_small') {\n    // Small deployment: no Redis, in-process jobs\n    return DOCKER_SERVICES.filter(s => s.name === 'api');\n  }\n  // Scale and enterprise: full stack\n  return DOCKER_SERVICES;\n}\n\n/**\n * Check if a scenario requires Redis.\n * Only BullMQ-based job queues need Redis.\n *\n * @param scenario - Deployment scenario\n * @returns True if Redis is needed\n */\nexport function requiresRedis(scenario: DeploymentScenario): boolean {\n  const config = DEPLOYMENT_MATRIX[scenario];\n  return config.jobs === 'bullmq';\n}\n","/**\n * @module @nous/core/backend\n * @description Health checks — service health monitoring and readiness probes\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Pure functions for health status aggregation, HTTP status mapping,\n * and external stubs for adapter health probing.\n *\n * The /v1/health endpoint pings all adapters and aggregates their status:\n * - healthy: All services responding\n * - degraded: Some services failing (returns 503)\n * - unhealthy: Critical services down (returns 503)\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/health-checks.ts} - Spec\n */\n\nimport type { HealthStatus } from './constants';\nimport type { HealthCheckResponse, ServiceHealth } from './types';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Check if all services in a health response are healthy.\n * @param response - Health check response\n * @returns True if every service is 'healthy'\n */\nexport function isAllHealthy(response: HealthCheckResponse): boolean {\n  return Object.values(response.services).every(s => s.status === 'healthy');\n}\n\n/**\n * Determine the overall health status from individual service statuses.\n * @param services - Map of service name to health status\n * @returns Overall system status\n */\nexport function determineOverallHealth(services: Record<string, ServiceHealth>): HealthStatus {\n  const statuses = Object.values(services).map(s => s.status);\n\n  if (statuses.every(s => s === 'healthy')) {\n    return 'healthy';\n  }\n  if (statuses.some(s => s === 'unhealthy')) {\n    return 'unhealthy';\n  }\n  return 'degraded';\n}\n\n/**\n * Get the HTTP status code for a health status.\n * - healthy → 200\n * - degraded → 503\n * - unhealthy → 503\n */\nexport function getHttpStatusForHealth(status: HealthStatus): number {\n  return status === 'healthy' ? 200 : 503;\n}\n\n// ============================================================\n// EXTERNAL STUBS\n// ============================================================\n\n/**\n * Check health of all services by pinging their adapters.\n * Requires actual adapter instances.\n *\n * @param _config - Server configuration with adapter references\n * @returns Health check response\n */\nexport async function checkAllServices(_config: unknown): Promise<HealthCheckResponse> {\n  throw new Error('checkAllServices requires adapter instances for health probing');\n}\n\n/**\n * Check health of a single service.\n * @param _service - Service name\n * @param _adapter - Adapter with ping() method\n * @returns Service health result\n */\nexport async function checkServiceHealth(\n  _service: string,\n  _adapter: { ping(): Promise<boolean> },\n): Promise<ServiceHealth> {\n  throw new Error('checkServiceHealth requires adapter instance for health probing');\n}\n","/**\n * @module @nous/core/backend\n * @description Observability -- structured logging, metrics, request context tracking\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Defines structured logging format, metrics configuration, and\n * request context tracking for the Nous backend.\n *\n * Observability stack:\n * - Structured JSON logging (all environments)\n * - Sentry error tracking (production)\n * - Request correlation via requestId\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/observability.ts} - Spec\n */\n\nimport type { LogLevel } from './constants';\n\nimport type {\n  StructuredLogEntry,\n  MetricsConfig,\n  RequestContext,\n} from './types';\n\n// ============================================================\n// DEFAULT CONFIGURATION\n// ============================================================\n\n/** Default metrics configuration (all enabled) */\nexport const DEFAULT_METRICS_CONFIG: MetricsConfig = {\n  request_count: true,\n  request_duration: true,\n  llm_cost: true,\n  embedding_count: true,\n  job_queue_size: true,\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Create a new request context with a unique ID.\n * Generates a request ID using timestamp + random suffix for uniqueness.\n * @returns Fresh request context with requestId and startTime set\n */\nexport function createRequestContext(): RequestContext {\n  return {\n    requestId: `req_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n    startTime: Date.now(),\n  };\n}\n\n/**\n * Format a structured log entry as a JSON string.\n * Used by the logging middleware to emit structured logs.\n * @param entry - Log entry to format\n * @returns JSON string representation of the log entry\n */\nexport function formatLogEntry(entry: StructuredLogEntry): string {\n  return JSON.stringify(entry);\n}\n\n/**\n * Calculate request duration from context.\n * @param context - Request context with start time\n * @returns Duration in milliseconds since the request started\n */\nexport function calculateRequestDuration(context: RequestContext): number {\n  return Date.now() - context.startTime;\n}\n\n/**\n * Check if a log level should be emitted given the configured minimum.\n * Uses ordered severity comparison: debug < info < warn < error < fatal.\n * @param level - Log level to check\n * @param minLevel - Minimum configured log level\n * @returns True if the level should be logged\n */\nexport function shouldLog(level: LogLevel, minLevel: LogLevel): boolean {\n  const levels: readonly LogLevel[] = ['debug', 'info', 'warn', 'error', 'fatal'];\n  return levels.indexOf(level) >= levels.indexOf(minLevel);\n}\n","/**\n * @module @nous/core/backend\n * @description SSE streaming -- event formatting, reconnection, edge timeout strategy\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Server-Sent Events (SSE) streaming utilities for the Nous API.\n * Handles Cloudflare Workers' 30-second connection limit by:\n * 1. Capping streams at 25 seconds\n * 2. Sending timeout events with last event ID\n * 3. Supporting client reconnection via Last-Event-ID header\n * 4. Sending heartbeat pings every 15 seconds to keep connections alive\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/sse-streaming.ts} - Spec\n */\n\nimport type {\n  SSEEvent,\n  SSEOptions,\n  SSEStreamState,\n} from './types';\n\n// ============================================================\n// DEFAULT CONFIGURATION\n// ============================================================\n\n/** Default SSE options */\nexport const DEFAULT_SSE_OPTIONS: Required<SSEOptions> = {\n  maxDurationMs: 25_000,\n  heartbeatMs: 15_000,\n  reconnectable: true,\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Format an SSE event as a string for the wire protocol.\n * Produces the standard SSE text format with event, optional id, and data fields.\n *\n * @example\n * formatSSEEvent({ event: 'data', id: '1', data: '{\"token\":\"hello\"}' })\n * // => 'event: data\\nid: 1\\ndata: {\"token\":\"hello\"}\\n\\n'\n *\n * @param event - SSE event to format\n * @returns Wire-format string ready to be written to the response stream\n */\nexport function formatSSEEvent(event: SSEEvent): string {\n  let result = `event: ${event.event}\\n`;\n  if (event.id !== undefined) {\n    result += `id: ${event.id}\\n`;\n  }\n  result += `data: ${event.data}\\n\\n`;\n  return result;\n}\n\n/**\n * Parse the Last-Event-ID header for reconnection.\n * Returns undefined for empty or missing header values.\n * @param header - Value of the Last-Event-ID header\n * @returns The trimmed event ID string, or undefined if not present\n */\nexport function parseLastEventId(header: string | undefined): string | undefined {\n  if (!header || header.trim() === '') {\n    return undefined;\n  }\n  return header.trim();\n}\n\n/**\n * Create initial SSE stream state.\n * Initializes event counter at 0, records start time, and parses\n * the Last-Event-ID header for reconnection support.\n * @param lastEventIdHeader - Value of Last-Event-ID header (for reconnection)\n * @returns Initial stream state\n */\nexport function createSSEStreamState(lastEventIdHeader?: string): SSEStreamState {\n  return {\n    eventId: 0,\n    startTime: Date.now(),\n    lastEventId: parseLastEventId(lastEventIdHeader),\n    closed: false,\n  };\n}\n\n/**\n * Check if an SSE stream has exceeded its maximum duration.\n * Used to proactively close streams before Cloudflare's 30s limit.\n * @param state - Current stream state\n * @param maxDurationMs - Maximum duration in milliseconds\n * @returns True if the stream should be closed\n */\nexport function isStreamExpired(state: SSEStreamState, maxDurationMs: number): boolean {\n  return (Date.now() - state.startTime) > maxDurationMs;\n}\n\n// ============================================================\n// EXTERNAL STUBS\n// ============================================================\n\n/**\n * Create an SSE stream response.\n * Requires Hono's streamSSE utility for actual implementation.\n *\n * @param _context - Hono request context\n * @param _generator - Async generator producing stream chunks\n * @param _options - SSE configuration options\n * @returns HTTP Response with SSE content type\n */\nexport function createSSEStream(\n  _context: unknown,\n  _generator: AsyncGenerator<unknown>,\n  _options?: SSEOptions,\n): Promise<Response> {\n  throw new Error('createSSEStream requires Hono framework implementation');\n}\n","/**\n * @module @nous/core/backend\n * @description Local development -- mock adapter configs, seed data, dev server setup\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-026\n * @storm Brainstorms/Infrastructure/storm-026-backend-infrastructure\n *\n * Defines configuration for local development mode.\n * Goal: `npm run dev` starts everything with zero external dependencies.\n *\n * - SQLite file for persistence (no Turso needed)\n * - Mock LLM adapter (no API keys needed)\n * - Mock embedding adapter (deterministic outputs)\n * - Local auth (any token accepted)\n * - In-memory job queue (process immediately)\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-026/spec/local-dev.ts} - Spec\n */\n\nimport type {\n  LocalDevConfig,\n  SeedUser,\n  SeedDataConfig,\n  MockLLMConfig,\n  MockEmbeddingConfig,\n  MockJobQueueConfig,\n  LocalAuthDevConfig,\n} from './types';\n\n// ============================================================\n// DEFAULT CONFIGURATION\n// ============================================================\n\n/** Default local development configuration */\nexport const DEFAULT_LOCAL_DEV_CONFIG: LocalDevConfig = {\n  port: 3000,\n  database_path: './data/dev.db',\n  auto_seed: true,\n  mock_llm_latency_ms: 100,\n  mock_embedding_deterministic: true,\n  accept_any_token: true,\n  process_jobs_immediately: true,\n} as const;\n\n/** Default development user */\nexport const DEV_USER: SeedUser = {\n  id: 'dev-user',\n  email: 'dev@localhost',\n  tier: 'pro',\n} as const;\n\n/** Default seed data configuration */\nexport const DEFAULT_SEED_DATA: SeedDataConfig = {\n  users: [DEV_USER],\n  node_count: 10,\n  edge_count: 5,\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Get default local development configuration.\n * Returns a shallow copy to prevent mutation of the default config.\n * @returns LocalDevConfig with sensible defaults\n */\nexport function getLocalDevConfig(): LocalDevConfig {\n  return { ...DEFAULT_LOCAL_DEV_CONFIG };\n}\n\n/**\n * Get default seed users.\n * Returns a new array with a shallow copy of the dev user.\n * @returns Array of seed users (currently just the dev user)\n */\nexport function getDefaultSeedUsers(): SeedUser[] {\n  return [{ ...DEV_USER }];\n}\n\n/**\n * Get default mock adapter configurations.\n * Returns configurations for all mock adapters used in local development:\n * LLM, embedding, job queue, and auth.\n * @returns Configurations for all mock adapters\n */\nexport function getMockAdapterConfigs(): {\n  llm: MockLLMConfig;\n  embedding: MockEmbeddingConfig;\n  jobs: MockJobQueueConfig;\n  auth: LocalAuthDevConfig;\n} {\n  return {\n    llm: {\n      latencyMs: 100,\n      mockResponses: true,\n      deterministicOutputs: true,\n    },\n    embedding: {\n      dimensions: 1536,\n      deterministic: true,\n    },\n    jobs: {\n      processImmediately: true,\n    },\n    auth: {\n      users: [{ ...DEV_USER }],\n      acceptAnyToken: true,\n    },\n  };\n}\n"]}