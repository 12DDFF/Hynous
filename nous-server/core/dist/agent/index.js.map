{"version":3,"sources":["../../src/constants.ts","../../src/agent-tools/constants.ts","../../src/agent/constants.ts","../../src/agent/types.ts","../../src/agent/index.ts"],"names":["z"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @module @nous/core/constants\n * @description All constants, enums, and configuration values\n * @version 0.1.0\n * @spec Brainstorms/Specs/storm-011/spec/constants.ts\n */\n\n// ============================================================\n// ID CONFIGURATION\n// ============================================================\n\n/** Length of nanoid for globally unique IDs */\nexport const NANOID_LENGTH = 12;\n\n/** Prefix for node IDs: \"n_\" + nanoid(12) */\nexport const NODE_ID_PREFIX = 'n_';\n\n/** Prefix for block IDs: \"b_\" + nanoid(12) */\nexport const BLOCK_ID_PREFIX = 'b_';\n\n/** Prefix for edge IDs: \"e_\" + nanoid(12) */\nexport const EDGE_ID_PREFIX = 'e_';\n\n/** Prefix for edit record IDs: \"edit_\" + nanoid(12) */\nexport const EDIT_ID_PREFIX = 'edit_';\n\n// ============================================================\n// NODE TYPES\n// ============================================================\n\nexport const NODE_TYPES = [\n  'concept',\n  'episode',\n  'document',\n  'section',\n  'chunk',\n  'note',\n  'raw',\n] as const;\n\nexport type NodeType = (typeof NODE_TYPES)[number];\n\nexport const SEMANTIC_LAYER_TYPES: NodeType[] = ['concept', 'note', 'chunk'];\nexport const EPISODE_LAYER_TYPES: NodeType[] = ['episode', 'document', 'section'];\nexport const ARCHIVE_LAYER_TYPES: NodeType[] = ['raw'];\n\n// ============================================================\n// SUBTYPES\n// ============================================================\n\nexport const CONCEPT_SUBTYPES = [\n  'fact',\n  'definition',\n  'relationship',\n  'preference',\n  'belief',\n  'procedure',\n  'entity',\n  'event',\n  'insight',\n] as const;\n\nexport type ConceptSubtype = (typeof CONCEPT_SUBTYPES)[number] | `custom:${string}`;\n\nexport const EPISODE_SUBTYPES = [\n  'lecture',\n  'meeting',\n  'conversation',\n  'note_session',\n  'document_read',\n  'thought',\n  'external_event',\n] as const;\n\nexport type EpisodeSubtype = (typeof EPISODE_SUBTYPES)[number] | `custom:${string}`;\n\nexport const RAW_SUBTYPES = [\n  'transcript',\n  'document',\n  'note',\n  'image',\n  'audio_recording',\n] as const;\n\nexport type RawSubtype = (typeof RAW_SUBTYPES)[number];\n\n// ============================================================\n// BLOCK TYPES\n// ============================================================\n\nexport const BLOCK_TYPES = [\n  'paragraph',\n  'heading',\n  'list',\n  'list_item',\n  'code',\n  'quote',\n  'callout',\n  'divider',\n  'table',\n  'image',\n] as const;\n\nexport type BlockType = (typeof BLOCK_TYPES)[number];\n\n// ============================================================\n// EDGE TYPES\n// ============================================================\n\nexport const EDGE_TYPES = [\n  'relates_to',\n  'part_of',\n  'mentioned_in',\n  'causes',\n  'precedes',\n  'contradicts',\n  'supersedes',\n  'derived_from',\n  'similar_to',\n] as const;\n\nexport type EdgeType = (typeof EDGE_TYPES)[number];\n\n// ============================================================\n// LIFECYCLE STATES\n// ============================================================\n\nexport const LIFECYCLE_STATES = [\n  'working',\n  'active',\n  'superseded',\n  'dormant',\n  'archived',\n] as const;\n\nexport type LifecycleState = (typeof LIFECYCLE_STATES)[number];\n\n// ============================================================\n// SOURCE TYPES\n// ============================================================\n\nexport const SOURCE_TYPES = [\n  'extraction',\n  'manual',\n  'inference',\n  'import',\n] as const;\n\nexport type SourceType = (typeof SOURCE_TYPES)[number];\n\n// ============================================================\n// CONTENT SOURCES\n// ============================================================\n\nexport const CONTENT_SOURCES = [\n  'import',\n  'user_note',\n  'chat_extraction',\n  'fact',\n  'document',\n  'transcript',\n] as const;\n\nexport type ContentSource = (typeof CONTENT_SOURCES)[number];\n\n// ============================================================\n// EDIT SYSTEM\n// ============================================================\n\nexport const EDIT_TARGET_METHODS = [\n  'block_id',\n  'heading',\n  'position',\n  'search',\n  'full',\n] as const;\n\nexport type EditTargetMethod = (typeof EDIT_TARGET_METHODS)[number];\n\nexport const EDIT_ACTIONS = ['replace', 'insert', 'append', 'delete'] as const;\n\nexport type EditAction = (typeof EDIT_ACTIONS)[number];\n\nexport const MODIFIERS = ['user', 'ai', 'system', 'sync'] as const;\n\nexport type Modifier = (typeof MODIFIERS)[number];\n\nexport const EDIT_HISTORY_RETENTION = {\n  maxEdits: 100,\n  maxAgeDays: 30,\n  undoWindowHours: 24,\n  pruneSchedule: 'daily',\n} as const;\n\n// ============================================================\n// TEMPORAL\n// ============================================================\n\nexport const TEMPORAL_GRANULARITIES = [\n  'minute',\n  'hour',\n  'day',\n  'week',\n  'month',\n  'year',\n] as const;\n\nexport type TemporalGranularity = (typeof TEMPORAL_GRANULARITIES)[number];\n\nexport const EVENT_TIME_SOURCES = ['explicit', 'inferred', 'user_stated'] as const;\n\nexport type EventTimeSource = (typeof EVENT_TIME_SOURCES)[number];\n\nexport const CONTENT_TIME_TYPES = ['historical', 'relative', 'approximate'] as const;\n\nexport type ContentTimeType = (typeof CONTENT_TIME_TYPES)[number];\n\n// ============================================================\n// PROCESSING PATHS\n// ============================================================\n\nexport const INPUT_TYPES = [\n  'DOCUMENT',\n  'TRANSCRIPT',\n  'CONVERSATION',\n  'NOTE',\n  'IMPORT',\n] as const;\n\nexport type InputType = (typeof INPUT_TYPES)[number];\n\nexport const INPUT_SIZES = ['tiny', 'small', 'medium', 'large', 'huge'] as const;\n\nexport type InputSize = (typeof INPUT_SIZES)[number];\n\nexport const PROCESSING_PATHS = [\n  'fast',\n  'standard',\n  'progressive',\n  'conversation',\n] as const;\n\nexport type ProcessingPath = (typeof PROCESSING_PATHS)[number];\n\nexport const SIZE_THRESHOLDS = {\n  tiny: { min: 0, max: 50 },\n  small: { min: 50, max: 500 },\n  medium: { min: 500, max: 5000 },\n  large: { min: 5000, max: 25000 },\n  huge: { min: 25000, max: Infinity },\n} as const;\n\n// ============================================================\n// BLOCK DECISION THRESHOLDS\n// ============================================================\n\nexport const BLOCK_LENGTH_THRESHOLD = 1000;\nexport const BLOCK_LIST_THRESHOLD = 3;\n\n// ============================================================\n// NEURAL DEFAULTS\n// ============================================================\n\nexport const NEURAL_DEFAULTS = {\n  stability: 0.5,\n  retrievability: 1.0,\n  accessCount: 0,\n} as const;\n\n// ============================================================\n// EXTRACTION DEPTH\n// ============================================================\n\nexport const EXTRACTION_DEPTHS = ['summary', 'section', 'full'] as const;\n\nexport type ExtractionDepth = (typeof EXTRACTION_DEPTHS)[number];\n\n// ============================================================\n// REGEX PATTERNS\n// ============================================================\n\nexport const HEADING_PATTERN = /^#{1,6}\\s/m;\nexport const LIST_ITEM_PATTERN = /^[-*]\\s/gm;\n","/**\n * @module @nous/core/agent-tools\n * @description All constants, enums, and configuration values for ATSS (Agent Tool Specification System)\n * @version 1.0.0\n * @spec Specs/Phase-9-Agent-Tools/storm-030\n * @storm Brainstorms/Infrastructure/storm-030-agent-tool-specs\n *\n * IMPORTANT: This is the SINGLE SOURCE OF TRUTH for storm-030 constants.\n * Uses ATSS_ prefix on all constants to avoid naming conflicts.\n */\n\nimport { z } from 'zod';\n\n// ============================================================\n// TOOL NAMES\n// ============================================================\n\n/**\n * All 9 agent tools in the system.\n * These are the operations an AI agent can perform on the knowledge graph.\n */\nexport const ATSS_TOOL_NAMES = [\n  'view_node',\n  'search',\n  'create_node',\n  'update_node',\n  'delete_node',\n  'create_edge',\n  'delete_edge',\n  'link_to_cluster',\n  'bulk_operations',\n] as const;\n\nexport type AtssToolName = (typeof ATSS_TOOL_NAMES)[number];\nexport const AtssToolNameSchema = z.enum(ATSS_TOOL_NAMES);\n\n// ============================================================\n// TOOL CATEGORIES\n// ============================================================\n\n/**\n * Tool operation categories.\n * - read: No state change, no confirmation needed\n * - write: Creates or modifies state, may need confirmation\n * - destructive: Deletes state, requires confirmation\n */\nexport const ATSS_TOOL_CATEGORIES = ['read', 'write', 'destructive'] as const;\n\nexport type AtssToolCategory = (typeof ATSS_TOOL_CATEGORIES)[number];\nexport const AtssToolCategorySchema = z.enum(ATSS_TOOL_CATEGORIES);\n\n/** Maps each tool to its category. */\nexport const ATSS_TOOL_TO_CATEGORY: Record<AtssToolName, AtssToolCategory> = {\n  view_node: 'read',\n  search: 'read',\n  create_node: 'write',\n  update_node: 'write',\n  delete_node: 'destructive',\n  create_edge: 'write',\n  delete_edge: 'write',\n  link_to_cluster: 'write',\n  bulk_operations: 'destructive',\n};\n\n// ============================================================\n// CONFIRMATION LEVELS\n// ============================================================\n\n/**\n * Confirmation levels for tool execution.\n * - none: Execute silently (read operations)\n * - inform: Tell user what happened (creates)\n * - confirm: Ask user before executing (modifies/deletes)\n */\nexport const ATSS_CONFIRMATION_LEVELS = ['none', 'inform', 'confirm'] as const;\n\nexport type AtssConfirmationLevel = (typeof ATSS_CONFIRMATION_LEVELS)[number];\nexport const AtssConfirmationLevelSchema = z.enum(ATSS_CONFIRMATION_LEVELS);\n\n/** Default confirmation level per tool. */\nexport const ATSS_TOOL_CONFIRMATION: Record<AtssToolName, AtssConfirmationLevel> = {\n  view_node: 'none',\n  search: 'none',\n  create_node: 'inform',\n  update_node: 'confirm',\n  delete_node: 'confirm',\n  create_edge: 'inform',\n  delete_edge: 'confirm',\n  link_to_cluster: 'inform',\n  bulk_operations: 'confirm',\n};\n\n// ============================================================\n// UNDO CONFIGURATION\n// ============================================================\n\n/**\n * Undo window TTL per tool (in seconds).\n * 0 means the tool is not undoable (read operations).\n */\nexport const ATSS_UNDO_TTL_SECONDS: Record<AtssToolName, number> = {\n  view_node: 0,\n  search: 0,\n  create_node: 86400,     // 24 hours\n  update_node: 3600,      // 1 hour\n  delete_node: 2592000,   // 30 days\n  create_edge: 86400,     // 24 hours\n  delete_edge: 86400,     // 24 hours\n  link_to_cluster: 3600,  // 1 hour\n  bulk_operations: 86400, // 24 hours\n};\n\n/** Quick undo UI highlight window (seconds). */\nexport const ATSS_QUICK_UNDO_SECONDS = 300; // 5 minutes\n\n// ============================================================\n// UNDO STATUSES\n// ============================================================\n\nexport const ATSS_UNDO_STATUSES = ['undoable', 'undone', 'expired', 'redone'] as const;\n\nexport type AtssUndoStatus = (typeof ATSS_UNDO_STATUSES)[number];\nexport const AtssUndoStatusSchema = z.enum(ATSS_UNDO_STATUSES);\n\n// ============================================================\n// CREDIT COSTS\n// ============================================================\n\n/**\n * Credit cost per tool execution.\n * Read operations are free. bulk_operations cost = sum of individual ops (0 base).\n *\n * @see Brainstorms/Infrastructure/storm-013-business-model (brainstorm only)\n */\nexport const ATSS_CREDIT_COSTS: Record<AtssToolName, number> = {\n  view_node: 0,\n  search: 0,\n  create_node: 3,\n  update_node: 3,\n  delete_node: 1,\n  create_edge: 1,\n  delete_edge: 1,\n  link_to_cluster: 1,\n  bulk_operations: 0,\n};\n\n// ============================================================\n// TIER SYSTEM\n// ============================================================\n\n/**\n * User subscription tiers.\n *\n * @see Brainstorms/Infrastructure/storm-013-business-model (brainstorm only)\n */\nexport const ATSS_TIERS = ['free', 'credits', 'pro'] as const;\n\nexport type AtssTier = (typeof ATSS_TIERS)[number];\nexport const AtssTierSchema = z.enum(ATSS_TIERS);\n\n// ============================================================\n// RATE LIMITS PER TOOL\n// ============================================================\n\n/** Per-tool rate limit: sustained per-second rate + burst allowance. */\nexport const ATSS_RATE_LIMITS: Record<AtssToolName, { perSecond: number; burst: number }> = {\n  view_node: { perSecond: 20, burst: 50 },\n  search: { perSecond: 5, burst: 10 },\n  create_node: { perSecond: 5, burst: 10 },\n  update_node: { perSecond: 5, burst: 10 },\n  delete_node: { perSecond: 2, burst: 5 },\n  create_edge: { perSecond: 10, burst: 20 },\n  delete_edge: { perSecond: 5, burst: 10 },\n  link_to_cluster: { perSecond: 5, burst: 10 },\n  bulk_operations: { perSecond: 1, burst: 3 },\n};\n\n// ============================================================\n// CIRCUIT BREAKER\n// ============================================================\n\n/** Maximum consecutive failures before the circuit breaker trips. */\nexport const ATSS_CIRCUIT_BREAKER_MAX_FAILURES = 3;\n\n/** Maximum time for a single tool execution (milliseconds). */\nexport const ATSS_TOOL_TIMEOUT_MS = 10000;\n\n/** Circuit breaker states. */\nexport const ATSS_CIRCUIT_BREAKER_STATES = ['closed', 'open', 'half_open'] as const;\n\nexport type AtssCircuitBreakerState = (typeof ATSS_CIRCUIT_BREAKER_STATES)[number];\nexport const AtssCircuitBreakerStateSchema = z.enum(ATSS_CIRCUIT_BREAKER_STATES);\n\n// ============================================================\n// BULK OPERATION MODES\n// ============================================================\n\nexport const ATSS_BULK_MODES = ['all_or_nothing', 'continue_on_error'] as const;\n\nexport type AtssBulkMode = (typeof ATSS_BULK_MODES)[number];\nexport const AtssBulkModeSchema = z.enum(ATSS_BULK_MODES);\n\n// ============================================================\n// ERROR CODE PREFIXES\n// ============================================================\n\nexport const ATSS_ERROR_PREFIXES = [\n  'E400', 'E403', 'E404', 'E409', 'E429', 'E500', 'E503', 'E504',\n] as const;\n\nexport type AtssErrorPrefix = (typeof ATSS_ERROR_PREFIXES)[number];\n\n// ============================================================\n// TOOL DESCRIPTIONS\n// ============================================================\n\n/** One-line description of each tool. Used by P-009 agent prompt. */\nexport const ATSS_TOOL_DESCRIPTIONS: Record<AtssToolName, string> = {\n  view_node: 'View one or more nodes by ID, including content, metadata, and connections',\n  search: 'Search the knowledge graph by query with optional filters',\n  create_node: 'Create a new node in the knowledge graph',\n  update_node: 'Update an existing node\\'s title, content, tags, or cluster',\n  delete_node: 'Delete a node (soft-delete with restore window)',\n  create_edge: 'Create a relationship edge between two nodes',\n  delete_edge: 'Delete a relationship edge',\n  link_to_cluster: 'Assign a node to a cluster (sets primary affinity)',\n  bulk_operations: 'Execute multiple tool operations in a single transaction',\n};\n\n// ============================================================\n// VALIDATION LIMITS\n// ============================================================\n\nexport const ATSS_MAX_NODE_IDS_PER_VIEW = 20;\nexport const ATSS_MAX_SEARCH_LIMIT = 50;\nexport const ATSS_DEFAULT_SEARCH_LIMIT = 10;\nexport const ATSS_MAX_CONTENT_LENGTH = 5000;\nexport const ATSS_DEFAULT_MAX_CONTENT_LENGTH = 2000;\nexport const ATSS_MAX_TAGS = 20;\nexport const ATSS_MAX_BULK_OPERATIONS = 50;\nexport const ATSS_MIN_SEARCH_SCORE = 0.0;\nexport const ATSS_DEFAULT_MIN_SEARCH_SCORE = 0.3;\nexport const ATSS_UPDATE_CONFIDENCE_THRESHOLD = 0.8;\n\n// ============================================================\n// ID CONFIGURATION\n// ============================================================\n\nexport const ATSS_TRANSACTION_ID_PREFIX = 'tx_';\nexport const ATSS_UNDO_ID_PREFIX = 'undo_';\n\n// ============================================================\n// BULK REFERENCE PATTERNS\n// ============================================================\n\n/** Reference syntax patterns for cross-referencing within bulk operations. */\nexport const ATSS_BULK_REFERENCE_PATTERNS = {\n  byIndex: /^\\{\\{(\\d+)\\.(\\w+)\\}\\}$/,\n  byId: /^\\{\\{([a-zA-Z_][a-zA-Z0-9_]*)\\.(\\w+)\\}\\}$/,\n  byLast: /^\\{\\{\\$last\\.(\\w+)\\}\\}$/,\n} as const;\n\n// ============================================================\n// INVERSE OPERATION MAPPING\n// ============================================================\n\n/**\n * Maps each tool to its inverse tool.\n * null means the tool is not undoable (read operations).\n */\nexport const ATSS_INVERSE_OPERATIONS: Record<AtssToolName, AtssToolName | null> = {\n  view_node: null,\n  search: null,\n  create_node: 'delete_node',\n  update_node: 'update_node',\n  delete_node: 'create_node',\n  create_edge: 'delete_edge',\n  delete_edge: 'create_edge',\n  link_to_cluster: 'link_to_cluster',\n  bulk_operations: 'bulk_operations',\n};\n\n// ============================================================\n// ERROR CODES\n// ============================================================\n\n/** Error code definition structure. */\nexport interface AtssErrorDefinition {\n  code: string;\n  http: number;\n  message: string;\n}\n\n/** All 26 ATSS error codes. */\nexport const ATSS_ERROR_CODES = {\n  // 400 Bad Request\n  E400_INVALID_PARAMS: { code: 'E400_INVALID_PARAMS', http: 400, message: 'Invalid parameters provided' },\n  E400_MISSING_REQUIRED: { code: 'E400_MISSING_REQUIRED', http: 400, message: 'Required parameter missing' },\n  E400_INVALID_NODE_TYPE: { code: 'E400_INVALID_NODE_TYPE', http: 400, message: 'Invalid node type' },\n  E400_INVALID_EDGE_TYPE: { code: 'E400_INVALID_EDGE_TYPE', http: 400, message: 'Invalid edge type' },\n  E400_CONTENT_TOO_LONG: { code: 'E400_CONTENT_TOO_LONG', http: 400, message: 'Content exceeds maximum length' },\n  E400_TOO_MANY_TAGS: { code: 'E400_TOO_MANY_TAGS', http: 400, message: 'Too many tags' },\n  E400_TOO_MANY_NODE_IDS: { code: 'E400_TOO_MANY_NODE_IDS', http: 400, message: 'Too many node IDs in single request' },\n  E400_TOO_MANY_BULK_OPS: { code: 'E400_TOO_MANY_BULK_OPS', http: 400, message: 'Too many operations in bulk request' },\n  E400_INVALID_BULK_REFERENCE: { code: 'E400_INVALID_BULK_REFERENCE', http: 400, message: 'Invalid bulk operation reference syntax' },\n  E400_SELF_EDGE: { code: 'E400_SELF_EDGE', http: 400, message: 'Cannot create edge from node to itself' },\n  // 403 Forbidden\n  E403_INSUFFICIENT_CREDITS: { code: 'E403_INSUFFICIENT_CREDITS', http: 403, message: 'Insufficient credits' },\n  E403_TIER_RESTRICTED: { code: 'E403_TIER_RESTRICTED', http: 403, message: 'Operation not available on current tier' },\n  E403_CONFIRMATION_DENIED: { code: 'E403_CONFIRMATION_DENIED', http: 403, message: 'User denied confirmation' },\n  E403_CIRCUIT_BREAKER_OPEN: { code: 'E403_CIRCUIT_BREAKER_OPEN', http: 403, message: 'Circuit breaker is open - too many failures' },\n  // 404 Not Found\n  E404_NODE_NOT_FOUND: { code: 'E404_NODE_NOT_FOUND', http: 404, message: 'Node not found' },\n  E404_EDGE_NOT_FOUND: { code: 'E404_EDGE_NOT_FOUND', http: 404, message: 'Edge not found' },\n  E404_CLUSTER_NOT_FOUND: { code: 'E404_CLUSTER_NOT_FOUND', http: 404, message: 'Cluster not found' },\n  E404_UNDO_ENTRY_NOT_FOUND: { code: 'E404_UNDO_ENTRY_NOT_FOUND', http: 404, message: 'Undo entry not found' },\n  // 409 Conflict\n  E409_DUPLICATE_EDGE: { code: 'E409_DUPLICATE_EDGE', http: 409, message: 'Edge already exists between these nodes' },\n  E409_UNDO_EXPIRED: { code: 'E409_UNDO_EXPIRED', http: 409, message: 'Undo window has expired' },\n  E409_UNDO_DEPENDENCY: { code: 'E409_UNDO_DEPENDENCY', http: 409, message: 'Cannot undo - dependent operations exist' },\n  E409_ALREADY_UNDONE: { code: 'E409_ALREADY_UNDONE', http: 409, message: 'Operation already undone' },\n  // 429 Rate Limited\n  E429_RATE_LIMITED: { code: 'E429_RATE_LIMITED', http: 429, message: 'Rate limit exceeded' },\n  // 500 Internal Server Error\n  E500_INTERNAL: { code: 'E500_INTERNAL', http: 500, message: 'Internal server error' },\n  // 503 Service Unavailable\n  E503_LLM_UNAVAILABLE: { code: 'E503_LLM_UNAVAILABLE', http: 503, message: 'LLM service unavailable' },\n  // 504 Timeout\n  E504_TOOL_TIMEOUT: { code: 'E504_TOOL_TIMEOUT', http: 504, message: 'Tool execution timed out' },\n} as const;\n\nexport type AtssErrorCode = keyof typeof ATSS_ERROR_CODES;\n\n/** All error code keys as an array. */\nexport const ATSS_ERROR_CODE_KEYS = Object.keys(ATSS_ERROR_CODES) as AtssErrorCode[];\n\n// ============================================================\n// TIER CONFIGURATIONS\n// ============================================================\n\n/** Default tier configurations. */\nexport const ATSS_TIER_CONFIGS: Record<AtssTier, { is_student: boolean; daily_credit_limit?: number; can_bulk: boolean; max_bulk_operations: number }> = {\n  free: { is_student: false, daily_credit_limit: 5, can_bulk: false, max_bulk_operations: 0 },\n  credits: { is_student: false, can_bulk: true, max_bulk_operations: ATSS_MAX_BULK_OPERATIONS },\n  pro: { is_student: false, can_bulk: true, max_bulk_operations: ATSS_MAX_BULK_OPERATIONS },\n};\n\n// ============================================================\n// RETRYABLE ERROR CODES\n// ============================================================\n\n/** Error codes that clients should retry. */\nexport const ATSS_RETRYABLE_ERROR_CODES: AtssErrorCode[] = [\n  'E429_RATE_LIMITED',\n  'E503_LLM_UNAVAILABLE',\n  'E504_TOOL_TIMEOUT',\n];\n\n// ============================================================\n// SYNTHESIZE FORMAT TEMPLATES\n// ============================================================\n\n/** Per-tool synthesize format templates for P-007 integration. */\nexport const ATSS_SYNTHESIZE_FORMATS: Record<AtssToolName, string> = {\n  view_node: 'Retrieved {count} node(s): {titles}',\n  search: 'Found {total_count} result(s) for \"{query}\". Top: {top_titles}',\n  create_node: 'Created {type} node \"{title}\" (ID: {node_id})',\n  update_node: 'Updated {updated_fields} on node \"{title}\" (ID: {node_id})',\n  delete_node: 'Deleted node \"{node_title}\" (ID: {node_id}). Restorable until {restore_deadline}. {edges_affected} edge(s) affected.',\n  create_edge: 'Created {relation_type} edge: \"{source_title}\" → \"{target_title}\"',\n  delete_edge: 'Deleted {relation_type} edge between \"{source_title}\" and \"{target_title}\"',\n  link_to_cluster: 'Moved node \"{node_title}\" to cluster \"{new_cluster}\"',\n  bulk_operations: 'Executed {success_count}/{total} operation(s). Credits: {total_credits}',\n};\n","/**\n * @module @nous/core/agent\n * @description All constants, enums, mappings, and configuration defaults for NEAS (Nous Embedded Agent System)\n * @version 1.0.0\n * @spec Specs/Phase-9-Agent-Tools/storm-019\n * @storm Brainstorms/Infrastructure/storm-019-embedded-ai-agent\n *\n * IMPORTANT: This is the SINGLE SOURCE OF TRUTH for storm-019 constants.\n * Uses NEAS_ prefix on all constants to avoid naming conflicts with ATSS.\n */\n\nimport { z } from 'zod';\nimport {\n  type AtssToolName,\n  ATSS_TOOL_NAMES,\n  ATSS_TOOL_TO_CATEGORY,\n  ATSS_TOOL_CONFIRMATION,\n  type AtssConfirmationLevel,\n} from '../agent-tools/constants';\n\n// ============================================================\n// SESSION ID CONFIGURATION\n// ============================================================\n\n/**\n * Prefix for agent session IDs.\n * Full format: \"ses_\" + nanoid(12)\n * Example: \"ses_a7f3c2x9k4m1\"\n *\n * @see storm-011 - ID prefix pattern (lowercase prefix + underscore + nanoid)\n */\nexport const NEAS_SESSION_ID_PREFIX = 'ses_';\n\n// ============================================================\n// ERROR TYPES\n// ============================================================\n\n/**\n * High-level agent error type classifications.\n * These map to groups of ATSS error codes (E4xx/E5xx).\n *\n * - NOT_FOUND: Target node/edge/cluster doesn't exist\n * - PERMISSION_DENIED: Insufficient credits, tier restriction, or denied confirmation\n * - LIMIT_EXCEEDED: Too many items or rate limit hit\n * - INVALID_INPUT: Bad parameters, content too long, etc.\n * - CONFLICT: Duplicate edge, undo expired, state conflict\n * - NETWORK: LLM unavailable, timeout, circuit breaker, internal error\n */\nexport const NEAS_ERROR_TYPES = [\n  'NOT_FOUND',\n  'PERMISSION_DENIED',\n  'LIMIT_EXCEEDED',\n  'INVALID_INPUT',\n  'CONFLICT',\n  'NETWORK',\n] as const;\n\nexport type NeasErrorType = (typeof NEAS_ERROR_TYPES)[number];\nexport const NeasErrorTypeSchema = z.enum(NEAS_ERROR_TYPES);\n\n// ============================================================\n// ATSS ERROR CODE → NEAS ERROR TYPE MAPPING\n// ============================================================\n\n/**\n * Exhaustive mapping of all 26 ATSS error codes to 6 NEAS error types.\n *\n * This enables the agent to classify tool-level errors into high-level\n * categories, each with a distinct fix strategy.\n */\nexport const NEAS_ATSS_ERROR_MAPPING: Record<string, NeasErrorType> = {\n  // 400 - Bad Request → mostly INVALID_INPUT, some LIMIT_EXCEEDED\n  E400_INVALID_PARAMS: 'INVALID_INPUT',\n  E400_MISSING_REQUIRED: 'INVALID_INPUT',\n  E400_INVALID_NODE_TYPE: 'INVALID_INPUT',\n  E400_INVALID_EDGE_TYPE: 'INVALID_INPUT',\n  E400_CONTENT_TOO_LONG: 'INVALID_INPUT',\n  E400_TOO_MANY_TAGS: 'INVALID_INPUT',\n  E400_TOO_MANY_NODE_IDS: 'LIMIT_EXCEEDED',\n  E400_TOO_MANY_BULK_OPS: 'LIMIT_EXCEEDED',\n  E400_INVALID_BULK_REFERENCE: 'INVALID_INPUT',\n  E400_SELF_EDGE: 'INVALID_INPUT',\n\n  // 403 - Forbidden → PERMISSION_DENIED, except circuit breaker → NETWORK\n  E403_INSUFFICIENT_CREDITS: 'PERMISSION_DENIED',\n  E403_TIER_RESTRICTED: 'PERMISSION_DENIED',\n  E403_CONFIRMATION_DENIED: 'PERMISSION_DENIED',\n  E403_CIRCUIT_BREAKER_OPEN: 'NETWORK',\n\n  // 404 - Not Found → NOT_FOUND\n  E404_NODE_NOT_FOUND: 'NOT_FOUND',\n  E404_EDGE_NOT_FOUND: 'NOT_FOUND',\n  E404_CLUSTER_NOT_FOUND: 'NOT_FOUND',\n  E404_UNDO_ENTRY_NOT_FOUND: 'NOT_FOUND',\n\n  // 409 - Conflict → CONFLICT\n  E409_DUPLICATE_EDGE: 'CONFLICT',\n  E409_UNDO_EXPIRED: 'CONFLICT',\n  E409_UNDO_DEPENDENCY: 'CONFLICT',\n  E409_ALREADY_UNDONE: 'CONFLICT',\n\n  // 429 - Rate Limited → LIMIT_EXCEEDED\n  E429_RATE_LIMITED: 'LIMIT_EXCEEDED',\n\n  // 500 - Internal → NETWORK (treat as infrastructure issue)\n  E500_INTERNAL: 'NETWORK',\n\n  // 503 - Service Unavailable → NETWORK\n  E503_LLM_UNAVAILABLE: 'NETWORK',\n\n  // 504 - Timeout → NETWORK\n  E504_TOOL_TIMEOUT: 'NETWORK',\n};\n\n// ============================================================\n// FIX STRATEGY CONFIGURATION\n// ============================================================\n\n/** Fix strategy config: whether to auto-retry and what the strategy is. */\nexport interface NeasFixStrategyConfig {\n  /** Whether the agent should automatically retry (one attempt) */\n  retry_automatically: boolean;\n  /** Human-readable description of the recovery strategy */\n  description: string;\n}\n\nexport const NeasFixStrategyConfigSchema = z.object({\n  retry_automatically: z.boolean(),\n  description: z.string(),\n});\n\n/**\n * Per-error-type fix strategies.\n * Part of the Interpret → Retry → Explain flow (Notion-inspired).\n */\nexport const NEAS_FIX_STRATEGIES: Record<NeasErrorType, NeasFixStrategyConfig> = {\n  NOT_FOUND: { retry_automatically: false, description: 'Search for similar items, suggest creation' },\n  PERMISSION_DENIED: { retry_automatically: false, description: 'Explain required permission or credits' },\n  LIMIT_EXCEEDED: { retry_automatically: false, description: 'Offer partial execution (first N items)' },\n  INVALID_INPUT: { retry_automatically: false, description: 'Ask user for clarification' },\n  CONFLICT: { retry_automatically: true, description: 'Re-fetch fresh data and retry once' },\n  NETWORK: { retry_automatically: true, description: 'Queue for later, inform user of degraded state' },\n};\n\n// ============================================================\n// ERROR EXPLANATION TEMPLATES\n// ============================================================\n\n/** User-facing error message templates. Placeholders replaced at runtime. */\nexport const NEAS_ERROR_EXPLANATIONS: Record<NeasErrorType, string> = {\n  NOT_FOUND: \"I couldn't find {target}. {suggestion}\",\n  PERMISSION_DENIED: \"I don't have permission to {action}. {suggestion}\",\n  LIMIT_EXCEEDED: 'That operation exceeds the {limit_type} limit of {limit_value}. {suggestion}',\n  INVALID_INPUT: \"The {field} provided isn't valid. {suggestion}\",\n  CONFLICT: 'The {target} was modified since I last viewed it. {suggestion}',\n  NETWORK: \"I'm having trouble reaching {service}. {suggestion}\",\n};\n\n/** Recovery suggestion templates. Placeholders replaced at runtime. */\nexport const NEAS_RECOVERY_SUGGESTIONS: Record<NeasErrorType, string> = {\n  NOT_FOUND: 'Would you like to search for something similar, or create it?',\n  PERMISSION_DENIED: 'You can enable this in Settings > Agent > Safety.',\n  LIMIT_EXCEEDED: 'Would you like me to do the first {max} instead?',\n  INVALID_INPUT: 'Could you provide a valid {field}?',\n  CONFLICT: \"I'll re-read the latest version and try again.\",\n  NETWORK: \"I'll queue this action and retry when the connection is restored.\",\n};\n\n// ============================================================\n// CERTAINTY LEVELS\n// ============================================================\n\n/**\n * How certain the agent is about the user's intent.\n *\n * - high: Clear target + clear action (\"delete this note\")\n * - medium: Matches prior pattern or unambiguous scope\n * - low: Vague request (\"fix my notes\")\n */\nexport const NEAS_CERTAINTY_LEVELS = ['high', 'medium', 'low'] as const;\n\nexport type NeasCertaintyLevel = (typeof NEAS_CERTAINTY_LEVELS)[number];\nexport const NeasCertaintyLevelSchema = z.enum(NEAS_CERTAINTY_LEVELS);\n\n// ============================================================\n// IMPACT LEVELS\n// ============================================================\n\n/**\n * How much impact the requested action will have.\n *\n * - low: Single read or small write, low cost\n * - medium: Moderate cost or scope\n * - high: Destructive, affects many items, or expensive\n */\nexport const NEAS_IMPACT_LEVELS = ['low', 'medium', 'high'] as const;\n\nexport type NeasImpactLevel = (typeof NEAS_IMPACT_LEVELS)[number];\nexport const NeasImpactLevelSchema = z.enum(NEAS_IMPACT_LEVELS);\n\n// ============================================================\n// CLARIFICATION ACTIONS\n// ============================================================\n\n/**\n * What the agent should do based on certainty × impact assessment.\n *\n * - act: Execute immediately (may still require ATSS tool-level confirmation)\n * - act_then_clarify: Execute best effort, then ask if result is correct\n * - clarify_first: Ask user for more information before acting\n */\nexport const NEAS_CLARIFICATION_ACTIONS = ['act', 'act_then_clarify', 'clarify_first'] as const;\n\nexport type NeasClarificationAction = (typeof NEAS_CLARIFICATION_ACTIONS)[number];\nexport const NeasClarificationActionSchema = z.enum(NEAS_CLARIFICATION_ACTIONS);\n\n// ============================================================\n// CLARIFICATION DECISION MATRIX\n// ============================================================\n\n/**\n * The core decision matrix: certainty × impact → action.\n *\n * ```\n *            Low Impact       Medium Impact     High Impact\n *            ─────────────    ─────────────     ─────────────\n * High       act              act               act\n * Medium     act              act_then_clarify  clarify_first\n * Low        act_then_clarify clarify_first     clarify_first\n * ```\n */\nexport const NEAS_CLARIFICATION_MATRIX: Record<NeasCertaintyLevel, Record<NeasImpactLevel, NeasClarificationAction>> = {\n  high: {\n    low: 'act',\n    medium: 'act',\n    high: 'act',\n  },\n  medium: {\n    low: 'act',\n    medium: 'act_then_clarify',\n    high: 'clarify_first',\n  },\n  low: {\n    low: 'act_then_clarify',\n    medium: 'clarify_first',\n    high: 'clarify_first',\n  },\n};\n\n// ============================================================\n// RESPONSE VERBOSITY\n// ============================================================\n\n/**\n * How verbose the agent's responses should be.\n *\n * - terse: Minimal output (\"Done. 3 links created.\")\n * - balanced: Standard detail level (default)\n * - detailed: Full explanation with reasoning\n */\nexport const NEAS_RESPONSE_VERBOSITY_LEVELS = ['terse', 'balanced', 'detailed'] as const;\n\nexport type NeasResponseVerbosity = (typeof NEAS_RESPONSE_VERBOSITY_LEVELS)[number];\nexport const NeasResponseVerbositySchema = z.enum(NEAS_RESPONSE_VERBOSITY_LEVELS);\n\n// ============================================================\n// UNCERTAINTY RESPONSE MODES\n// ============================================================\n\n/**\n * What the agent does when uncertain about user intent.\n *\n * - ask: Ask user for clarification (default)\n * - best_guess: Make best effort and show result\n * - refuse: Explain uncertainty and wait for clearer instructions\n */\nexport const NEAS_UNCERTAINTY_RESPONSES = ['ask', 'best_guess', 'refuse'] as const;\n\nexport type NeasUncertaintyResponse = (typeof NEAS_UNCERTAINTY_RESPONSES)[number];\nexport const NeasUncertaintyResponseSchema = z.enum(NEAS_UNCERTAINTY_RESPONSES);\n\n// ============================================================\n// SEARCH SCOPE\n// ============================================================\n\n/**\n * Default scope for search operations.\n *\n * - all: Search entire graph (default)\n * - recent: Only recent nodes (within default_time_range_days)\n * - current_cluster: Only nodes in the user's current cluster context\n */\nexport const NEAS_SEARCH_SCOPES = ['all', 'recent', 'current_cluster'] as const;\n\nexport type NeasSearchScope = (typeof NEAS_SEARCH_SCOPES)[number];\nexport const NeasSearchScopeSchema = z.enum(NEAS_SEARCH_SCOPES);\n\n// ============================================================\n// SUGGESTION MODES\n// ============================================================\n\n/**\n * Proactive suggestion configuration modes.\n *\n * - off: No proactive suggestions (default)\n * - important_only: Only high-confidence suggestions (>= min_confidence)\n * - all: All suggestions (may be noisy)\n */\nexport const NEAS_SUGGESTION_MODES = ['off', 'important_only', 'all'] as const;\n\nexport type NeasSuggestionMode = (typeof NEAS_SUGGESTION_MODES)[number];\nexport const NeasSuggestionModeSchema = z.enum(NEAS_SUGGESTION_MODES);\n\n// ============================================================\n// PERMISSION TIERS\n// ============================================================\n\n/**\n * Permission tier levels for agent tool access.\n *\n * - always_on: Cannot be disabled (read operations)\n * - on_by_default: Enabled by default, user can disable (write operations)\n * - off_by_default: Disabled by default, user must enable (delete, bulk)\n */\nexport const NEAS_PERMISSION_TIERS = ['always_on', 'on_by_default', 'off_by_default'] as const;\n\nexport type NeasPermissionTier = (typeof NEAS_PERMISSION_TIERS)[number];\nexport const NeasPermissionTierSchema = z.enum(NEAS_PERMISSION_TIERS);\n\n// ============================================================\n// TOOL → PERMISSION TIER MAPPING\n// ============================================================\n\n/**\n * Maps each ATSS tool to its NEAS permission tier.\n *\n * - always_on: view_node, search (read-only, always available)\n * - on_by_default: create_node, update_node, create_edge, delete_edge, link_to_cluster\n * - off_by_default: delete_node, bulk_operations (dangerous, must enable)\n */\nexport const NEAS_TOOL_PERMISSION_TIER: Record<AtssToolName, NeasPermissionTier> = {\n  view_node: 'always_on',\n  search: 'always_on',\n  create_node: 'on_by_default',\n  update_node: 'on_by_default',\n  create_edge: 'on_by_default',\n  delete_edge: 'on_by_default',\n  link_to_cluster: 'on_by_default',\n  delete_node: 'off_by_default',\n  bulk_operations: 'off_by_default',\n};\n\n// ============================================================\n// OFFLINE TOOL AVAILABILITY\n// ============================================================\n\n/** Tools available when the device is offline. Only read operations. */\nexport const NEAS_OFFLINE_AVAILABLE_TOOLS: readonly AtssToolName[] = [\n  'view_node',\n  'search',\n];\n\n/** Tools that require online connectivity. All write and destructive operations. */\nexport const NEAS_ONLINE_ONLY_TOOLS: readonly AtssToolName[] = [\n  'create_node',\n  'update_node',\n  'delete_node',\n  'create_edge',\n  'delete_edge',\n  'link_to_cluster',\n  'bulk_operations',\n];\n\n// ============================================================\n// DEFAULT AGENT CONFIGURATION\n// ============================================================\n\n/** Default agent behavior settings. Users can override any of these. */\nexport const NEAS_DEFAULT_AGENT_DEFAULTS = {\n  response_verbosity: 'balanced' as NeasResponseVerbosity,\n  show_reasoning: false,\n  auto_search_before_action: true,\n  auto_show_related: true,\n  auto_suggest_links: false,\n  confirm_threshold_items: 10,\n  confirm_threshold_credits: 15,\n  confirm_destructive: true,\n  uncertainty_response: 'ask' as NeasUncertaintyResponse,\n  default_search_scope: 'all' as NeasSearchScope,\n  default_time_range_days: 30,\n} as const;\n\n/** Default agent permissions. Safe-by-default: read+write on, delete+bulk off. */\nexport const NEAS_DEFAULT_AGENT_PERMISSIONS = {\n  can_read: true as const,\n  can_write: true,\n  can_auto_operations: true,\n  can_delete: false,\n  can_bulk_operations: false,\n} as const;\n\n/** Default request-level agent limits. Per-request caps complementing ATSS per-tool rate limits. */\nexport const NEAS_DEFAULT_AGENT_LIMITS = {\n  max_operations_per_request: 100,\n  max_credits_per_request: 30,\n  preview_threshold: 10,\n  context_batch_size: 50,\n} as const;\n\n/** Default proactive suggestion config. Suggestions OFF by default. */\nexport const NEAS_DEFAULT_SUGGESTION_CONFIG = {\n  mode: 'off' as NeasSuggestionMode,\n  max_per_day: 1,\n  min_confidence: 0.9,\n  quiet_hours_start: 22,\n  quiet_hours_end: 8,\n} as const;\n\n// ============================================================\n// IMPACT COST THRESHOLD\n// ============================================================\n\n/**\n * Credit cost threshold above which an operation is considered \"high impact\"\n * in the impact assessment. Default: 10 credits.\n */\nexport const NEAS_HIGH_IMPACT_CREDIT_THRESHOLD = 10;\n\n// ============================================================\n// RE-EXPORTED ATSS REFERENCES (for NEAS internal use)\n// ============================================================\n\n/** Re-export ATSS tool names for NEAS functions that reference the full tool list. */\nexport { ATSS_TOOL_NAMES, ATSS_TOOL_TO_CATEGORY, ATSS_TOOL_CONFIRMATION };\nexport type { AtssToolName, AtssConfirmationLevel };\n\n// ============================================================\n// TYPE GUARDS\n// ============================================================\n\n/** Type guard for NEAS error types. */\nexport function isNeasErrorType(value: string): value is NeasErrorType {\n  return (NEAS_ERROR_TYPES as readonly string[]).includes(value);\n}\n\n/** Type guard for certainty levels. */\nexport function isNeasCertaintyLevel(value: string): value is NeasCertaintyLevel {\n  return (NEAS_CERTAINTY_LEVELS as readonly string[]).includes(value);\n}\n\n/** Type guard for impact levels. */\nexport function isNeasImpactLevel(value: string): value is NeasImpactLevel {\n  return (NEAS_IMPACT_LEVELS as readonly string[]).includes(value);\n}\n\n/** Type guard for clarification actions. */\nexport function isNeasClarificationAction(value: string): value is NeasClarificationAction {\n  return (NEAS_CLARIFICATION_ACTIONS as readonly string[]).includes(value);\n}\n\n/** Type guard for response verbosity levels. */\nexport function isNeasResponseVerbosity(value: string): value is NeasResponseVerbosity {\n  return (NEAS_RESPONSE_VERBOSITY_LEVELS as readonly string[]).includes(value);\n}\n\n/** Type guard for suggestion modes. */\nexport function isNeasSuggestionMode(value: string): value is NeasSuggestionMode {\n  return (NEAS_SUGGESTION_MODES as readonly string[]).includes(value);\n}\n\n/** Type guard for permission tiers. */\nexport function isNeasPermissionTier(value: string): value is NeasPermissionTier {\n  return (NEAS_PERMISSION_TIERS as readonly string[]).includes(value);\n}\n","/**\n * @module @nous/core/agent\n * @description All interfaces and Zod schemas for NEAS (Nous Embedded Agent System)\n * @version 1.0.0\n * @spec Specs/Phase-9-Agent-Tools/storm-019\n * @storm Brainstorms/Infrastructure/storm-019-embedded-ai-agent\n *\n * Defines types for: agent errors, intent assessment, configuration,\n * permissions, sessions, offline behavior, and proactive suggestions.\n */\n\nimport { z } from 'zod';\nimport {\n  NeasErrorTypeSchema,\n  NeasCertaintyLevelSchema,\n  NeasImpactLevelSchema,\n  NeasClarificationActionSchema,\n  NeasResponseVerbositySchema,\n  NeasUncertaintyResponseSchema,\n  NeasSearchScopeSchema,\n  NeasSuggestionModeSchema,\n  NeasPermissionTierSchema,\n  type NeasErrorType,\n  type NeasCertaintyLevel,\n  type NeasImpactLevel,\n  type NeasClarificationAction,\n  type NeasResponseVerbosity,\n  type NeasUncertaintyResponse,\n  type NeasSearchScope,\n  type NeasSuggestionMode,\n  type NeasPermissionTier,\n  type AtssToolName,\n  type AtssConfirmationLevel,\n} from './constants';\nimport { AtssToolNameSchema, AtssConfirmationLevelSchema } from '../agent-tools/constants';\n\n// ============================================================\n// ERROR TYPES\n// ============================================================\n\n/** Represents a single agent tool invocation. Used in error tracking and session logging. */\nexport interface NeasToolCall {\n  /** ATSS tool name (e.g., 'create_node', 'search') */\n  tool: AtssToolName;\n  /** Tool parameters as passed to ATSS */\n  params: Record<string, unknown>;\n}\n\nexport const NeasToolCallSchema = z.object({\n  tool: AtssToolNameSchema,\n  params: z.record(z.unknown()),\n});\n\n/** Structured error from agent error handling flow. */\nexport interface NeasAgentError {\n  /** High-level error classification */\n  type: NeasErrorType;\n  /** Human-readable error message */\n  message: string;\n  /** The tool call that caused the error */\n  original_action: NeasToolCall;\n  /** Original ATSS error code (e.g., 'E404_NODE_NOT_FOUND') */\n  atss_error_code: string;\n  /** Whether automatic recovery was attempted */\n  recovery_attempted: boolean;\n  /** Result of recovery attempt (if attempted) */\n  recovery_result?: 'success' | 'failed';\n}\n\nexport const NeasAgentErrorSchema = z.object({\n  type: NeasErrorTypeSchema,\n  message: z.string(),\n  original_action: NeasToolCallSchema,\n  atss_error_code: z.string(),\n  recovery_attempted: z.boolean(),\n  recovery_result: z.enum(['success', 'failed']).optional(),\n});\n\n/** User-facing error explanation with recovery suggestion. */\nexport interface NeasErrorExplanation {\n  /** User-friendly error message */\n  user_message: string;\n  /** Recovery suggestion for the user */\n  suggestion: string;\n  /** The original agent error */\n  original_error: NeasAgentError;\n}\n\nexport const NeasErrorExplanationSchema = z.object({\n  user_message: z.string(),\n  suggestion: z.string(),\n  original_error: NeasAgentErrorSchema,\n});\n\n// ============================================================\n// INTENT ASSESSMENT TYPES\n// ============================================================\n\n/** Inputs to certainty assessment. Used to determine confidence about user intent. */\nexport interface NeasCertaintyFactors {\n  /** User specified a specific target (\"this note\" vs \"my notes\") */\n  has_specific_target: boolean;\n  /** User specified a clear action (\"delete\" vs \"help with\") */\n  has_clear_action: boolean;\n  /** Request matches a pattern the user has done before */\n  matches_prior_pattern: boolean;\n  /** Scope is unambiguous (\"these 3\" vs \"some\") */\n  unambiguous_scope: boolean;\n}\n\nexport const NeasCertaintyFactorsSchema = z.object({\n  has_specific_target: z.boolean(),\n  has_clear_action: z.boolean(),\n  matches_prior_pattern: z.boolean(),\n  unambiguous_scope: z.boolean(),\n});\n\n/** Inputs to impact assessment. Used to determine operation impact level. */\nexport interface NeasImpactFactors {\n  /** Operation is destructive (delete, remove, merge) */\n  is_destructive: boolean;\n  /** Operation affects many items (\"all my notes\") */\n  affects_many: boolean;\n  /** Operation is reversible (can undo) */\n  is_reversible: boolean;\n  /** Estimated credit cost of the operation */\n  estimated_cost: number;\n}\n\nexport const NeasImpactFactorsSchema = z.object({\n  is_destructive: z.boolean(),\n  affects_many: z.boolean(),\n  is_reversible: z.boolean(),\n  estimated_cost: z.number().min(0),\n});\n\n/** Result of certainty × impact assessment. */\nexport interface NeasIntentAssessment {\n  /** How certain the agent is about user intent */\n  certainty: NeasCertaintyLevel;\n  /** How much impact the action will have */\n  impact: NeasImpactLevel;\n  /** What the agent should do */\n  action: NeasClarificationAction;\n}\n\nexport const NeasIntentAssessmentSchema = z.object({\n  certainty: NeasCertaintyLevelSchema,\n  impact: NeasImpactLevelSchema,\n  action: NeasClarificationActionSchema,\n});\n\n// ============================================================\n// AGENT DEFAULTS (PERSISTED — _schemaVersion required)\n// ============================================================\n\n/** User-configurable agent behavior settings. Persisted, requires _schemaVersion. */\nexport interface NeasAgentDefaults {\n  /** Schema version for migration safety */\n  _schemaVersion: number;\n  /** How verbose responses should be */\n  response_verbosity: NeasResponseVerbosity;\n  /** Whether to show reasoning steps */\n  show_reasoning: boolean;\n  /** Search for existing content before creating new */\n  auto_search_before_action: boolean;\n  /** Show related nodes alongside results */\n  auto_show_related: boolean;\n  /** Suggest new links proactively */\n  auto_suggest_links: boolean;\n  /** Require confirmation when more than N items are affected */\n  confirm_threshold_items: number;\n  /** Require confirmation when cost exceeds N credits */\n  confirm_threshold_credits: number;\n  /** Always require confirmation for destructive operations */\n  confirm_destructive: boolean;\n  /** What to do when uncertain about user intent */\n  uncertainty_response: NeasUncertaintyResponse;\n  /** Default search scope */\n  default_search_scope: NeasSearchScope;\n  /** Default time range for recency queries (days) */\n  default_time_range_days: number;\n}\n\nexport const NeasAgentDefaultsSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  response_verbosity: NeasResponseVerbositySchema,\n  show_reasoning: z.boolean(),\n  auto_search_before_action: z.boolean(),\n  auto_show_related: z.boolean(),\n  auto_suggest_links: z.boolean(),\n  confirm_threshold_items: z.number().int().min(1),\n  confirm_threshold_credits: z.number().int().min(1),\n  confirm_destructive: z.boolean(),\n  uncertainty_response: NeasUncertaintyResponseSchema,\n  default_search_scope: NeasSearchScopeSchema,\n  default_time_range_days: z.number().int().min(1).max(365),\n});\n\n// ============================================================\n// PERMISSION TYPES (PERSISTED — _schemaVersion required)\n// ============================================================\n\n/**\n * 3-tier permission model for agent capabilities.\n * Tier 1: Always on (read) — cannot be disabled.\n * Tier 2: On by default (write, auto-operations) — user can disable.\n * Tier 3: Off by default (delete, bulk) — user must enable.\n */\nexport interface NeasAgentPermissions {\n  /** Schema version for migration safety */\n  _schemaVersion: number;\n  /** Tier 1: Always on — cannot be disabled */\n  can_read: true;\n  /** Tier 2: On by default — user can disable */\n  can_write: boolean;\n  /** Tier 2: On by default — user can disable */\n  can_auto_operations: boolean;\n  /** Tier 3: Off by default — user must enable */\n  can_delete: boolean;\n  /** Tier 3: Off by default — user must enable */\n  can_bulk_operations: boolean;\n}\n\nexport const NeasAgentPermissionsSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  can_read: z.literal(true),\n  can_write: z.boolean(),\n  can_auto_operations: z.boolean(),\n  can_delete: z.boolean(),\n  can_bulk_operations: z.boolean(),\n});\n\n// ============================================================\n// AGENT LIMITS\n// ============================================================\n\n/** Request-level operation caps. Prevents runaway operations and excessive credit spending. */\nexport interface NeasAgentLimits {\n  /** Maximum tool calls per user request */\n  max_operations_per_request: number;\n  /** Maximum credits per user request */\n  max_credits_per_request: number;\n  /** Show preview if more than N items affected */\n  preview_threshold: number;\n  /** Process large operations in batches of N */\n  context_batch_size: number;\n}\n\nexport const NeasAgentLimitsSchema = z.object({\n  max_operations_per_request: z.number().int().min(1),\n  max_credits_per_request: z.number().int().min(1),\n  preview_threshold: z.number().int().min(1),\n  context_batch_size: z.number().int().min(1),\n});\n\n// ============================================================\n// SESSION TYPES (PERSISTED — _schemaVersion required)\n// ============================================================\n\n/** Single tracked action in a session. */\nexport interface NeasSessionAction {\n  /** ATSS tool that was executed */\n  tool: AtssToolName;\n  /** Reference to ATSS undo entry (null for read operations) */\n  atss_undo_entry_id: string | null;\n  /** When the action was performed (ISO 8601) */\n  timestamp: string;\n  /** Credit cost of this action */\n  credit_cost: number;\n}\n\nexport const NeasSessionActionSchema = z.object({\n  tool: AtssToolNameSchema,\n  atss_undo_entry_id: z.string().nullable(),\n  timestamp: z.string(),\n  credit_cost: z.number().min(0),\n});\n\n/** Per-request session tracking. Tracks all operations during a single user request. */\nexport interface NeasAgentSession {\n  /** Schema version for migration safety */\n  _schemaVersion: number;\n  /** Unique session ID (ses_ + nanoid(12)) */\n  id: string;\n  /** User who owns this session */\n  user_id: string;\n  /** When the session started (ISO 8601) */\n  started_at: string;\n  /** Total number of tool operations performed */\n  operations_count: number;\n  /** Total credits spent in this session */\n  credits_spent: number;\n  /** Ordered log of all actions in this session */\n  action_log: NeasSessionAction[];\n}\n\nexport const NeasAgentSessionSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  id: z.string(),\n  user_id: z.string(),\n  started_at: z.string(),\n  operations_count: z.number().int().min(0),\n  credits_spent: z.number().min(0),\n  action_log: z.array(NeasSessionActionSchema),\n});\n\n/** Result of checking whether an operation can proceed. */\nexport interface NeasOperationCheck {\n  /** Whether the operation is allowed */\n  allowed: boolean;\n  /** Reason for denial (if not allowed) */\n  reason?: string;\n  /** How many more operations can be performed this request */\n  remaining_operations: number;\n  /** How many more credits can be spent this request */\n  remaining_credits: number;\n}\n\nexport const NeasOperationCheckSchema = z.object({\n  allowed: z.boolean(),\n  reason: z.string().optional(),\n  remaining_operations: z.number().int(),\n  remaining_credits: z.number(),\n});\n\n/** Summary stats for a completed session. */\nexport interface NeasSessionSummary {\n  /** Total operations performed */\n  total_operations: number;\n  /** Total credits spent */\n  total_credits: number;\n  /** Session duration in milliseconds */\n  duration_ms: number;\n  /** Count of each tool used (tool name -> count) */\n  tools_used: Record<string, number>;\n}\n\nexport const NeasSessionSummarySchema = z.object({\n  total_operations: z.number().int().min(0),\n  total_credits: z.number().min(0),\n  duration_ms: z.number().min(0),\n  tools_used: z.record(z.number().int().min(0)),\n});\n\n// ============================================================\n// OFFLINE TYPES\n// ============================================================\n\n/** Agent capabilities when offline. */\nexport interface NeasOfflineCapabilities {\n  /** Tools that work offline (read-only ATSS tools) */\n  available_tools: readonly AtssToolName[];\n  /** Whether the agent is in read-only mode */\n  read_only: boolean;\n  /** Whether previously cached suggestions are accessible */\n  cached_suggestions_available: boolean;\n}\n\nexport const NeasOfflineCapabilitiesSchema = z.object({\n  available_tools: z.array(AtssToolNameSchema).readonly(),\n  read_only: z.boolean(),\n  cached_suggestions_available: z.boolean(),\n});\n\n// ============================================================\n// SUGGESTION TYPES (PERSISTED — _schemaVersion required)\n// ============================================================\n\n/** Proactive suggestion configuration. Controls when and how the agent suggests improvements. */\nexport interface NeasSuggestionConfig {\n  /** Schema version for migration safety */\n  _schemaVersion: number;\n  /** Suggestion display mode */\n  mode: NeasSuggestionMode;\n  /** Maximum suggestions per day */\n  max_per_day: number;\n  /** Minimum confidence threshold (0.0-1.0) */\n  min_confidence: number;\n  /** Quiet hours start (0-23, hour of day) */\n  quiet_hours_start: number;\n  /** Quiet hours end (0-23, hour of day) */\n  quiet_hours_end: number;\n}\n\nexport const NeasSuggestionConfigSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  mode: NeasSuggestionModeSchema,\n  max_per_day: z.number().int().min(0),\n  min_confidence: z.number().min(0).max(1),\n  quiet_hours_start: z.number().int().min(0).max(23),\n  quiet_hours_end: z.number().int().min(0).max(23),\n});\n\n// ============================================================\n// COMBINED PERMISSION CHECK RESULT\n// ============================================================\n\n/** Result of combined NEAS + ATSS permission check. */\nexport interface NeasPermissionCheckResult {\n  /** Whether the tool call is allowed */\n  allowed: boolean;\n  /** Reason for denial (if not allowed) */\n  denied_reason?: string;\n  /** Effective confirmation level after combining NEAS + ATSS rules */\n  effective_confirmation: AtssConfirmationLevel;\n  /** Which permission tier this tool belongs to */\n  permission_tier: NeasPermissionTier;\n}\n\nexport const NeasPermissionCheckResultSchema = z.object({\n  allowed: z.boolean(),\n  denied_reason: z.string().optional(),\n  effective_confirmation: AtssConfirmationLevelSchema,\n  permission_tier: NeasPermissionTierSchema,\n});\n","/**\n * @module @nous/core/agent\n * @description Nous Embedded Agent System (NEAS) - Behavioral intelligence layer above ATSS\n * @version 1.0.0\n * @spec Specs/Phase-9-Agent-Tools/storm-019\n * @storm Brainstorms/Infrastructure/storm-019-embedded-ai-agent\n *\n * Provides:\n * - Error classification and fix strategies (6 agent error types → 26 ATSS codes)\n * - Intent assessment (certainty × impact → clarification action)\n * - Agent configuration, permissions, and session management\n * - Offline behavior and proactive suggestion throttling\n */\n\nimport { nanoid } from 'nanoid';\nimport { NANOID_LENGTH } from '../constants';\n\n// Re-export all constants and types\nexport * from './constants';\nexport * from './types';\n\n// Import needed for function implementations\nimport {\n  NEAS_SESSION_ID_PREFIX,\n  NEAS_ATSS_ERROR_MAPPING,\n  NEAS_FIX_STRATEGIES,\n  NEAS_ERROR_EXPLANATIONS,\n  NEAS_RECOVERY_SUGGESTIONS,\n  NEAS_HIGH_IMPACT_CREDIT_THRESHOLD,\n  NEAS_CLARIFICATION_MATRIX,\n  NEAS_TOOL_PERMISSION_TIER,\n  NEAS_DEFAULT_AGENT_DEFAULTS,\n  NEAS_DEFAULT_AGENT_PERMISSIONS,\n  NEAS_DEFAULT_AGENT_LIMITS,\n  NEAS_DEFAULT_SUGGESTION_CONFIG,\n  NEAS_OFFLINE_AVAILABLE_TOOLS,\n  ATSS_TOOL_NAMES,\n  ATSS_TOOL_TO_CATEGORY,\n  ATSS_TOOL_CONFIRMATION,\n  type NeasErrorType,\n  type NeasCertaintyLevel,\n  type NeasImpactLevel,\n  type NeasClarificationAction,\n  type NeasPermissionTier,\n  type NeasFixStrategyConfig,\n  type AtssToolName,\n  type AtssConfirmationLevel,\n} from './constants';\n\nimport type {\n  NeasToolCall,\n  NeasAgentError,\n  NeasErrorExplanation,\n  NeasCertaintyFactors,\n  NeasImpactFactors,\n  NeasIntentAssessment,\n  NeasAgentDefaults,\n  NeasAgentPermissions,\n  NeasAgentLimits,\n  NeasAgentSession,\n  NeasSessionAction,\n  NeasOperationCheck,\n  NeasSessionSummary,\n  NeasOfflineCapabilities,\n  NeasSuggestionConfig,\n  NeasPermissionCheckResult,\n} from './types';\n\n// ============================================================\n// SESSION ID GENERATION\n// ============================================================\n\n/**\n * Generates a globally unique agent session ID.\n * Format: \"ses_\" + 12-character nanoid\n *\n * @returns Session ID string (16 characters total)\n */\nexport function generateSessionId(): string {\n  return NEAS_SESSION_ID_PREFIX + nanoid(NANOID_LENGTH);\n}\n\n// ============================================================\n// ERROR CLASSIFICATION\n// ============================================================\n\n/**\n * Classifies an ATSS error code into a high-level agent error type.\n *\n * Maps all 26 ATSS error codes to one of 6 agent error types.\n * Returns 'NETWORK' as fallback for unknown/unmapped codes.\n *\n * @param atssErrorCode - ATSS error code string (e.g., 'E404_NODE_NOT_FOUND')\n * @returns The agent-level error type classification\n */\nexport function classifyAgentError(atssErrorCode: string): NeasErrorType {\n  return NEAS_ATSS_ERROR_MAPPING[atssErrorCode] ?? 'NETWORK';\n}\n\n// ============================================================\n// ERROR CREATION\n// ============================================================\n\n/**\n * Creates a structured agent error from an ATSS error response.\n *\n * Combines the ATSS error code with agent-level classification.\n * Sets recovery_attempted = false (recovery happens later).\n *\n * @param atssErrorCode - Original ATSS error code\n * @param message - Human-readable error message from ATSS\n * @param originalAction - The tool call that triggered the error\n * @returns A structured NeasAgentError\n */\nexport function mapAtssErrorToAgentError(\n  atssErrorCode: string,\n  message: string,\n  originalAction: NeasToolCall,\n): NeasAgentError {\n  return {\n    type: classifyAgentError(atssErrorCode),\n    message,\n    original_action: originalAction,\n    atss_error_code: atssErrorCode,\n    recovery_attempted: false,\n  };\n}\n\n// ============================================================\n// FIX STRATEGY\n// ============================================================\n\n/**\n * Returns the fix strategy configuration for a given error type.\n *\n * @param errorType - The agent-level error type\n * @returns Fix strategy configuration\n */\nexport function getFixStrategy(errorType: NeasErrorType): NeasFixStrategyConfig {\n  return NEAS_FIX_STRATEGIES[errorType] ?? {\n    retry_automatically: false,\n    description: 'Unknown error type',\n  };\n}\n\n/**\n * Checks whether the given error type supports automatic retry.\n * Only CONFLICT and NETWORK are auto-retryable.\n *\n * @param errorType - The agent-level error type\n * @returns true if auto-retry is appropriate\n */\nexport function isAutoRetryable(errorType: NeasErrorType): boolean {\n  return NEAS_FIX_STRATEGIES[errorType]?.retry_automatically ?? false;\n}\n\n// ============================================================\n// USER-FACING EXPLANATIONS\n// ============================================================\n\n/**\n * Generates a user-friendly error explanation message.\n *\n * Uses template from NEAS_ERROR_EXPLANATIONS, replacing {placeholders}\n * with context values. Falls back to error.message if no template.\n *\n * @param error - The agent error to explain\n * @param context - Optional placeholder values for the template\n * @returns User-friendly error message string\n */\nexport function generateUserExplanation(\n  error: NeasAgentError,\n  context?: Record<string, string>,\n): string {\n  const template = NEAS_ERROR_EXPLANATIONS[error.type];\n  if (!template) {\n    return error.message;\n  }\n\n  let result = template;\n  if (context) {\n    for (const [key, value] of Object.entries(context)) {\n      result = result.replace(`{${key}}`, value);\n    }\n  }\n  // Replace {suggestion} placeholder with recovery suggestion\n  const suggestion = generateRecoverySuggestion(error, context);\n  result = result.replace('{suggestion}', suggestion);\n  return result;\n}\n\n/**\n * Generates a recovery suggestion for the user.\n *\n * Uses template from NEAS_RECOVERY_SUGGESTIONS, replacing {placeholders}\n * with context values.\n *\n * @param error - The agent error to suggest recovery for\n * @param context - Optional placeholder values\n * @returns Recovery suggestion string\n */\nexport function generateRecoverySuggestion(\n  error: NeasAgentError,\n  context?: Record<string, string>,\n): string {\n  const template = NEAS_RECOVERY_SUGGESTIONS[error.type];\n  if (!template) {\n    return 'Please try again or rephrase your request.';\n  }\n\n  let result = template;\n  if (context) {\n    for (const [key, value] of Object.entries(context)) {\n      result = result.replace(`{${key}}`, value);\n    }\n  }\n  return result;\n}\n\n/**\n * Creates a complete error explanation combining message and suggestion.\n * Final step of the Interpret → Retry → Explain flow.\n *\n * @param error - The agent error to explain\n * @param context - Optional placeholder values for templates\n * @returns Complete error explanation with message + suggestion\n */\nexport function createErrorExplanation(\n  error: NeasAgentError,\n  context?: Record<string, string>,\n): NeasErrorExplanation {\n  return {\n    user_message: generateUserExplanation(error, context),\n    suggestion: generateRecoverySuggestion(error, context),\n    original_error: error,\n  };\n}\n\n// ============================================================\n// CERTAINTY ASSESSMENT\n// ============================================================\n\n/**\n * Evaluates how certain the agent is about the user's intent.\n *\n * - high: has_specific_target AND has_clear_action\n * - medium: matches_prior_pattern OR unambiguous_scope\n * - low: otherwise\n *\n * @param factors - The certainty assessment inputs\n * @returns Certainty level: 'high', 'medium', or 'low'\n */\nexport function assessCertainty(factors: NeasCertaintyFactors): NeasCertaintyLevel {\n  if (factors.has_specific_target && factors.has_clear_action) {\n    return 'high';\n  }\n  if (factors.matches_prior_pattern || factors.unambiguous_scope) {\n    return 'medium';\n  }\n  return 'low';\n}\n\n// ============================================================\n// IMPACT ASSESSMENT\n// ============================================================\n\n/**\n * Evaluates how much impact the requested action will have.\n *\n * - high: is_destructive OR affects_many\n * - medium: estimated_cost > creditThreshold\n * - low: otherwise\n *\n * @param factors - The impact assessment inputs\n * @param creditThreshold - Cost threshold for medium impact (default: NEAS_HIGH_IMPACT_CREDIT_THRESHOLD)\n * @returns Impact level: 'low', 'medium', or 'high'\n */\nexport function assessImpact(\n  factors: NeasImpactFactors,\n  creditThreshold?: number,\n): NeasImpactLevel {\n  const threshold = creditThreshold ?? NEAS_HIGH_IMPACT_CREDIT_THRESHOLD;\n\n  if (factors.is_destructive || factors.affects_many) {\n    return 'high';\n  }\n  if (factors.estimated_cost > threshold) {\n    return 'medium';\n  }\n  return 'low';\n}\n\n// ============================================================\n// DECISION MATRIX\n// ============================================================\n\n/**\n * Looks up the clarification action from the certainty × impact matrix.\n *\n * @param certainty - How certain the agent is about intent\n * @param impact - How much impact the action will have\n * @returns The clarification action to take\n */\nexport function determineAction(\n  certainty: NeasCertaintyLevel,\n  impact: NeasImpactLevel,\n): NeasClarificationAction {\n  const certaintyRow = NEAS_CLARIFICATION_MATRIX[certainty];\n  if (!certaintyRow) {\n    return 'clarify_first'; // Safe fallback for unknown certainty\n  }\n  return certaintyRow[impact] ?? 'clarify_first';\n}\n\n// ============================================================\n// FULL ASSESSMENT\n// ============================================================\n\n/**\n * Performs a complete intent assessment combining certainty, impact, and action.\n *\n * @param certaintyFactors - Inputs for certainty evaluation\n * @param impactFactors - Inputs for impact evaluation\n * @returns Complete intent assessment with certainty, impact, and action\n */\nexport function assessIntent(\n  certaintyFactors: NeasCertaintyFactors,\n  impactFactors: NeasImpactFactors,\n): NeasIntentAssessment {\n  const certainty = assessCertainty(certaintyFactors);\n  const impact = assessImpact(impactFactors);\n  const action = determineAction(certainty, impact);\n  return { certainty, impact, action };\n}\n\n// ============================================================\n// QUICK CHECKS\n// ============================================================\n\n/** Returns true if the agent should ask for clarification BEFORE acting. */\nexport function shouldClarifyFirst(assessment: NeasIntentAssessment): boolean {\n  return assessment.action === 'clarify_first';\n}\n\n/** Returns true if the agent should act first, then ask if the result is correct. */\nexport function shouldActThenClarify(assessment: NeasIntentAssessment): boolean {\n  return assessment.action === 'act_then_clarify';\n}\n\n// ============================================================\n// DEFAULT FACTORIES\n// ============================================================\n\n/**\n * Creates a new NeasAgentDefaults with all default values.\n * Returns a deep copy. Sets _schemaVersion to 1.\n */\nexport function createDefaultAgentDefaults(): NeasAgentDefaults {\n  return {\n    _schemaVersion: 1,\n    ...NEAS_DEFAULT_AGENT_DEFAULTS,\n  };\n}\n\n/**\n * Creates a new NeasAgentPermissions with safe defaults.\n * Returns a deep copy. Sets _schemaVersion to 1.\n */\nexport function createDefaultAgentPermissions(): NeasAgentPermissions {\n  return {\n    _schemaVersion: 1,\n    ...NEAS_DEFAULT_AGENT_PERMISSIONS,\n  };\n}\n\n/**\n * Creates a new NeasAgentLimits with default request-level caps.\n */\nexport function createDefaultAgentLimits(): NeasAgentLimits {\n  return { ...NEAS_DEFAULT_AGENT_LIMITS };\n}\n\n// ============================================================\n// CONFIGURATION MERGE\n// ============================================================\n\n/**\n * Merges user overrides into base agent defaults.\n * Preserves base _schemaVersion.\n *\n * @param base - Current agent defaults\n * @param overrides - Partial overrides to apply\n * @returns New agent defaults with overrides applied\n */\nexport function mergeAgentDefaults(\n  base: NeasAgentDefaults,\n  overrides: Partial<Omit<NeasAgentDefaults, '_schemaVersion'>>,\n): NeasAgentDefaults {\n  return {\n    ...base,\n    ...overrides,\n    _schemaVersion: base._schemaVersion,\n  };\n}\n\n// ============================================================\n// PERMISSION CHECKS\n// ============================================================\n\n/**\n * Checks whether a tool is allowed by the user's agent permissions.\n *\n * - always_on: always true (view_node, search)\n * - on_by_default: checks can_write\n * - off_by_default: checks can_delete or can_bulk_operations\n *\n * @param tool - ATSS tool name to check\n * @param permissions - User's current agent permissions\n * @returns true if the tool is allowed\n */\nexport function isToolAllowedByPermissions(\n  tool: AtssToolName,\n  permissions: NeasAgentPermissions,\n): boolean {\n  const tier = NEAS_TOOL_PERMISSION_TIER[tool];\n\n  if (!tier || tier === 'always_on') {\n    return true;\n  }\n\n  if (tier === 'on_by_default') {\n    return permissions.can_write;\n  }\n\n  // off_by_default — check specific permission\n  if (tool === 'delete_node') {\n    return permissions.can_delete;\n  }\n  if (tool === 'bulk_operations') {\n    return permissions.can_bulk_operations;\n  }\n\n  return false;\n}\n\n/**\n * Gets the effective confirmation level by combining NEAS permissions with ATSS confirmation.\n *\n * Two-layer check:\n * 1. NEAS: Is this category of operation allowed?\n * 2. ATSS: What confirmation level does the specific tool require?\n *\n * If confirm_destructive is true and the tool is destructive, upgrades to 'confirm'.\n *\n * @param tool - ATSS tool name\n * @param permissions - User's agent permissions\n * @param defaults - User's agent defaults\n * @param _params - Tool parameters (reserved for future confirmation upgrades)\n * @returns Combined permission check result\n */\nexport function getEffectiveConfirmationLevel(\n  tool: AtssToolName,\n  permissions: NeasAgentPermissions,\n  defaults: NeasAgentDefaults,\n  _params: Record<string, unknown>,\n): NeasPermissionCheckResult {\n  const tier = NEAS_TOOL_PERMISSION_TIER[tool] ?? ('always_on' as NeasPermissionTier);\n\n  // Layer 1: Check NEAS permissions\n  if (!isToolAllowedByPermissions(tool, permissions)) {\n    return {\n      allowed: false,\n      denied_reason: `${tool} is not enabled in your agent permissions. Enable it in Settings > Agent > Safety.`,\n      effective_confirmation: 'confirm' as AtssConfirmationLevel,\n      permission_tier: tier,\n    };\n  }\n\n  // Layer 2: Get ATSS tool-level confirmation\n  let confirmation: AtssConfirmationLevel = ATSS_TOOL_CONFIRMATION[tool] ?? 'confirm';\n\n  // Upgrade to 'confirm' for destructive tools when confirm_destructive is true\n  if (defaults.confirm_destructive && ATSS_TOOL_TO_CATEGORY[tool] === 'destructive') {\n    confirmation = 'confirm';\n  }\n\n  return {\n    allowed: true,\n    effective_confirmation: confirmation,\n    permission_tier: tier,\n  };\n}\n\n// ============================================================\n// SESSION MANAGEMENT\n// ============================================================\n\n/**\n * Creates a new agent session for tracking operations within a request.\n * Session ID format: \"ses_\" + nanoid(12)\n *\n * @param userId - ID of the user making the request\n * @returns Fresh agent session\n */\nexport function createAgentSession(userId: string): NeasAgentSession {\n  return {\n    _schemaVersion: 1,\n    id: NEAS_SESSION_ID_PREFIX + nanoid(NANOID_LENGTH),\n    user_id: userId,\n    started_at: new Date().toISOString(),\n    operations_count: 0,\n    credits_spent: 0,\n    action_log: [],\n  };\n}\n\n/**\n * Records a tool operation in the session (immutable — returns new session).\n *\n * @param session - Current session state\n * @param tool - ATSS tool that was executed\n * @param creditCost - Credit cost of the operation\n * @param undoEntryId - ATSS undo entry ID (null for read operations)\n * @returns New session with the operation recorded\n */\nexport function recordSessionOperation(\n  session: NeasAgentSession,\n  tool: AtssToolName,\n  creditCost: number,\n  undoEntryId: string | null,\n): NeasAgentSession {\n  const action: NeasSessionAction = {\n    tool,\n    atss_undo_entry_id: undoEntryId,\n    timestamp: new Date().toISOString(),\n    credit_cost: creditCost,\n  };\n\n  return {\n    ...session,\n    operations_count: session.operations_count + 1,\n    credits_spent: session.credits_spent + creditCost,\n    action_log: [...session.action_log, action],\n  };\n}\n\n/**\n * Checks whether an operation can proceed within the session's limits.\n *\n * @param session - Current session state\n * @param limits - Agent limits configuration\n * @param creditCost - Credit cost of the proposed operation\n * @returns Whether the operation is allowed + remaining capacity\n */\nexport function canPerformOperation(\n  session: NeasAgentSession,\n  limits: NeasAgentLimits,\n  creditCost: number,\n): NeasOperationCheck {\n  const remainingOps = limits.max_operations_per_request - session.operations_count;\n  const remainingCredits = limits.max_credits_per_request - session.credits_spent;\n\n  if (remainingOps <= 0) {\n    return {\n      allowed: false,\n      reason: `Operation limit reached (${session.operations_count}/${limits.max_operations_per_request})`,\n      remaining_operations: 0,\n      remaining_credits: remainingCredits,\n    };\n  }\n\n  if (creditCost > remainingCredits) {\n    return {\n      allowed: false,\n      reason: `Credit limit would be exceeded (${session.credits_spent + creditCost}/${limits.max_credits_per_request})`,\n      remaining_operations: remainingOps,\n      remaining_credits: remainingCredits,\n    };\n  }\n\n  return {\n    allowed: true,\n    remaining_operations: remainingOps - 1,\n    remaining_credits: remainingCredits - creditCost,\n  };\n}\n\n/**\n * Generates a summary of a completed session.\n *\n * @param session - The session to summarize\n * @returns Session summary statistics\n */\nexport function getSessionSummary(session: NeasAgentSession): NeasSessionSummary {\n  const toolCounts: Record<string, number> = {};\n\n  for (const action of session.action_log) {\n    toolCounts[action.tool] = (toolCounts[action.tool] ?? 0) + 1;\n  }\n\n  const startTime = new Date(session.started_at).getTime();\n  const duration = Date.now() - startTime;\n\n  return {\n    total_operations: session.operations_count,\n    total_credits: session.credits_spent,\n    duration_ms: Math.max(0, duration),\n    tools_used: toolCounts,\n  };\n}\n\n// ============================================================\n// OFFLINE TOOL AVAILABILITY\n// ============================================================\n\n/**\n * Returns the list of tools available based on online/offline state.\n *\n * @param isOnline - Whether the device has network connectivity\n * @returns Array of available tool names\n */\nexport function getAvailableTools(isOnline: boolean): readonly AtssToolName[] {\n  if (isOnline) {\n    return ATSS_TOOL_NAMES;\n  }\n  return NEAS_OFFLINE_AVAILABLE_TOOLS;\n}\n\n/**\n * Checks whether a specific tool is available offline.\n *\n * @param tool - ATSS tool name to check\n * @returns true if the tool works offline\n */\nexport function isToolAvailableOffline(tool: AtssToolName): boolean {\n  return (NEAS_OFFLINE_AVAILABLE_TOOLS as readonly string[]).includes(tool);\n}\n\n/**\n * Returns the full offline capabilities description.\n */\nexport function getOfflineCapabilities(): NeasOfflineCapabilities {\n  return {\n    available_tools: NEAS_OFFLINE_AVAILABLE_TOOLS,\n    read_only: true,\n    cached_suggestions_available: true,\n  };\n}\n\n// ============================================================\n// PROACTIVE SUGGESTIONS\n// ============================================================\n\n/**\n * Creates a new suggestion configuration with defaults.\n * Default: suggestions OFF, max 1/day, 90% confidence, quiet 22:00-08:00.\n */\nexport function createDefaultSuggestionConfig(): NeasSuggestionConfig {\n  return {\n    _schemaVersion: 1,\n    ...NEAS_DEFAULT_SUGGESTION_CONFIG,\n  };\n}\n\n/**\n * Determines whether a proactive suggestion should be shown.\n *\n * All conditions must pass:\n * 1. Mode is not 'off'\n * 2. Confidence meets threshold (for 'important_only' mode)\n * 3. Not in quiet hours\n * 4. Daily limit not reached\n *\n * @param config - Suggestion configuration\n * @param lastSuggestionAt - ISO 8601 timestamp of last suggestion (null if never)\n * @param confidence - Confidence score (0.0-1.0)\n * @param currentHour - Current hour of day (0-23)\n * @returns true if the suggestion should be displayed\n */\nexport function shouldShowSuggestion(\n  config: NeasSuggestionConfig,\n  lastSuggestionAt: string | null,\n  confidence: number,\n  currentHour: number,\n): boolean {\n  // Condition 1: Mode is not 'off'\n  if (config.mode === 'off') {\n    return false;\n  }\n\n  // Condition 2: Confidence threshold (only for 'important_only' mode)\n  if (config.mode === 'important_only' && confidence < config.min_confidence) {\n    return false;\n  }\n\n  // Condition 3: Not in quiet hours\n  if (isInQuietHours(currentHour, config.quiet_hours_start, config.quiet_hours_end)) {\n    return false;\n  }\n\n  // Condition 4: Daily limit not reached\n  const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD\n  if (!canSuggestToday(lastSuggestionAt, config.max_per_day, today)) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the current time falls within quiet hours.\n * Handles wraparound (e.g., 22:00-08:00 wraps past midnight).\n *\n * @param currentHour - Current hour (0-23)\n * @param quietStart - Start of quiet period (0-23)\n * @param quietEnd - End of quiet period (0-23)\n * @returns true if the current hour is within quiet hours\n */\nexport function isInQuietHours(\n  currentHour: number,\n  quietStart: number,\n  quietEnd: number,\n): boolean {\n  if (quietStart === quietEnd) {\n    return false; // No quiet hours when start === end\n  }\n\n  if (quietStart < quietEnd) {\n    // Normal range (e.g., 9-17)\n    return currentHour >= quietStart && currentHour < quietEnd;\n  }\n\n  // Wraparound range (e.g., 22-8)\n  return currentHour >= quietStart || currentHour < quietEnd;\n}\n\n/**\n * Checks whether more suggestions can be shown today.\n *\n * @param lastSuggestionAt - ISO 8601 timestamp of last suggestion (null if never)\n * @param maxPerDay - Maximum suggestions allowed per day\n * @param today - Today's date string (YYYY-MM-DD)\n * @returns true if more suggestions are allowed today\n */\nexport function canSuggestToday(\n  lastSuggestionAt: string | null,\n  maxPerDay: number,\n  today: string,\n): boolean {\n  if (maxPerDay <= 0) {\n    return false;\n  }\n\n  if (lastSuggestionAt === null) {\n    return true;\n  }\n\n  // Extract date portion (YYYY-MM-DD) from ISO 8601 timestamp\n  const lastDate = lastSuggestionAt.slice(0, 10);\n  if (lastDate !== today) {\n    return true; // Last suggestion was on a different day\n  }\n\n  // Last suggestion was today — deny (conservative for simplified single-value tracking)\n  return false;\n}\n"]}