{"version":3,"sources":["../../src/api/constants.ts","../../src/api/types.ts","../../src/api/error-handling.ts","../../src/api/pagination.ts","../../src/api/rate-limiting.ts","../../src/api/auth-middleware.ts","../../src/api/sse-chat.ts","../../src/api/validators.ts","../../src/api/data-flows.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @module @nous/core/api\n * @description API constants — tiers, rate limits, SSE events, error codes, timeouts, content limits\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * All constants for the Nous REST API module.\n * Organized by domain: tiers, rate limits, burst, Redis, SSE, content, errors, timeouts, monitoring.\n *\n * NOTE: Base server constants (API_VERSION, ROUTE_PREFIXES, ERROR_CODES, SSE_MAX_DURATION_MS,\n * DEFAULT_RATE_LIMIT_RPM, RATE_LIMIT_WINDOW_MS) are defined in storm-026's @nous/core/backend.\n * This file EXTENDS those with API-layer specifics.\n */\n\n// ============================================================\n// USER TIERS\n// ============================================================\n\n/**\n * User tier levels that determine rate limits and feature access.\n *\n * - free: Default tier, basic access\n * - credits: Pay-as-you-go with purchased credits\n * - pro: Subscription tier with highest limits\n * - api_key: API key access (scripts/automation), separate rate bucket\n */\nexport const USER_TIERS = ['free', 'credits', 'pro', 'api_key'] as const;\nexport type UserTier = typeof USER_TIERS[number];\n\nexport function isUserTier(value: unknown): value is UserTier {\n  return typeof value === 'string' && (USER_TIERS as readonly string[]).includes(value);\n}\n\n// ============================================================\n// TIER RATE LIMITS\n// ============================================================\n\n/**\n * Rate limits per user tier.\n *\n * Source: storm-023 v2 brainstorm, \"Limits by Tier\" table.\n *\n * ```\n * Tier      Req/min  Req/day   Concurrent  Batch\n * Free      60       1,000     5           20\n * Credits   120      5,000     10          50\n * Pro       300      50,000    25          100\n * API Key   60       10,000    5           50\n * ```\n */\nexport const TIER_LIMITS = {\n  free:    { requests_per_min: 60,  requests_per_day: 1_000,  concurrent: 5,  batch_size: 20 },\n  credits: { requests_per_min: 120, requests_per_day: 5_000,  concurrent: 10, batch_size: 50 },\n  pro:     { requests_per_min: 300, requests_per_day: 50_000, concurrent: 25, batch_size: 100 },\n  api_key: { requests_per_min: 60,  requests_per_day: 10_000, concurrent: 5,  batch_size: 50 },\n} as const;\n\nexport type TierLimitConfig = typeof TIER_LIMITS[UserTier];\n\n// ============================================================\n// PER-ENDPOINT RATE LIMITS\n// ============================================================\n\n/**\n * Endpoint-specific rate limits (stricter than tier base).\n * Only 6 expensive endpoints have per-endpoint limits.\n * All other endpoints use the tier's base `requests_per_min`.\n *\n * Source: storm-023 v2 brainstorm, \"Per-Endpoint Limits\" section.\n */\nexport const ENDPOINT_RATE_LIMITS = {\n  'POST /v1/chat':          { free: 20, credits: 60,  pro: 120, reason: 'LLM cost' },\n  'POST /v1/ingest':        { free: 10, credits: 30,  pro: 60,  reason: 'Processing cost' },\n  'POST /v1/ingest/file':   { free: 5,  credits: 15,  pro: 30,  reason: 'Heavy processing' },\n  'POST /v1/search':        { free: 30, credits: 90,  pro: 180, reason: 'Embedding cost' },\n  'POST /v1/agent/actions': { free: 10, credits: 30,  pro: 60,  reason: 'LLM + write cost' },\n  'POST /v1/sync/push':     { free: 30, credits: 60,  pro: 120, reason: 'DB write cost' },\n} as const;\n\nexport type RateLimitedEndpoint = keyof typeof ENDPOINT_RATE_LIMITS;\n\nexport function isRateLimitedEndpoint(value: unknown): value is RateLimitedEndpoint {\n  return typeof value === 'string' && value in ENDPOINT_RATE_LIMITS;\n}\n\n// ============================================================\n// BURST CONFIGURATION\n// ============================================================\n\n/**\n * Burst allowance: 10% above tier limit.\n * Token bucket max capacity = tier_limit * (1 + BURST_ALLOWANCE_PERCENT).\n */\nexport const BURST_ALLOWANCE_PERCENT = 0.1;\n\nexport const BURST_LIMITS = {\n  free:    66,\n  credits: 132,\n  pro:     330,\n  api_key: 66,\n} as const;\n\n// ============================================================\n// REDIS KEY PATTERNS\n// ============================================================\n\n/**\n * Redis key patterns for rate limiting storage.\n * `{user_id}` and `{endpoint}` are template placeholders.\n */\nexport const REDIS_KEY_PATTERNS = {\n  api: 'ratelimit:api:{user_id}',\n  llm: 'ratelimit:llm:{user_id}',\n  endpoint: 'ratelimit:endpoint:{user_id}:{endpoint}',\n  concurrent: 'ratelimit:concurrent:{user_id}',\n} as const;\n\nexport type RedisKeyType = keyof typeof REDIS_KEY_PATTERNS;\n\n/** Redis key TTLs in milliseconds */\nexport const REDIS_TTL_API_MS = 70_000;\nexport const REDIS_TTL_LLM_MS = 70_000;\nexport const REDIS_TTL_ENDPOINT_MS = 70_000;\nexport const REDIS_TTL_CONCURRENT_MS = 300_000;\n\n/** Percentage of tier limit applied during Redis fallback (in-memory mode) */\nexport const REDIS_FALLBACK_LIMIT_PERCENT = 0.5;\n\n// ============================================================\n// CHAT SSE EVENT TYPES\n// ============================================================\n\n/**\n * SSE event types for the chat streaming endpoint (POST /v1/chat).\n *\n * Event sequence:\n * session_start -> retrieval_start -> retrieval_node (xN) -> retrieval_complete\n *   -> response_start -> response_chunk (xN) -> response_complete -> done\n */\nexport const CHAT_SSE_EVENT_TYPES = [\n  'session_start',\n  'retrieval_start',\n  'retrieval_node',\n  'retrieval_complete',\n  'response_start',\n  'response_chunk',\n  'response_complete',\n  'done',\n  'ping',\n  'session_expired',\n  'error',\n] as const;\n\nexport type ChatSSEEventType = typeof CHAT_SSE_EVENT_TYPES[number];\n\nexport function isChatSSEEventType(value: unknown): value is ChatSSEEventType {\n  return typeof value === 'string' && (CHAT_SSE_EVENT_TYPES as readonly string[]).includes(value);\n}\n\n// ============================================================\n// SSE CONFIGURATION (CHAT-SPECIFIC)\n// ============================================================\n\n/** Chat SSE keepalive interval (15 seconds) */\nexport const CHAT_SSE_KEEPALIVE_INTERVAL_MS = 15_000;\n/** Chat SSE max duration (120 seconds — regional container, not edge) */\nexport const CHAT_SSE_MAX_DURATION_MS = 120_000;\n/** Chat SSE reconnection window (5 minutes) */\nexport const CHAT_SSE_RECONNECT_WINDOW_MS = 300_000;\n\n// ============================================================\n// CONTENT LIMITS\n// ============================================================\n\n/**\n * Content size limits for node creation/update.\n * Source: storm-011 (Node Structure) content architecture.\n */\nexport const CONTENT_LIMITS = {\n  title: 100,\n  body_soft: 500,\n  body_hard: 2_000,\n  summary: 200,\n  batch_max_size: 100,\n} as const;\n\n// ============================================================\n// EXTENDED ERROR CODES\n// ============================================================\n\n/**\n * API-layer error codes, extending storm-026's 9 base ERROR_CODES.\n * Storm-023 adds 8 more for a total of 17 error codes.\n */\nexport const API_ERROR_CODES = {\n  // From storm-026 (included for completeness)\n  UNAUTHORIZED:          { status: 401, message: 'Authentication required' },\n  TOKEN_EXPIRED:         { status: 401, message: 'JWT expired, refresh needed' },\n  FORBIDDEN:             { status: 403, message: 'Insufficient permissions' },\n  NOT_FOUND:             { status: 404, message: 'Resource not found' },\n  CONFLICT:              { status: 409, message: 'Version conflict' },\n  RATE_LIMITED:          { status: 429, message: 'Too many requests' },\n  VALIDATION_ERROR:      { status: 400, message: 'Invalid request data' },\n  INTERNAL_ERROR:        { status: 500, message: 'Internal server error' },\n  SERVICE_UNAVAILABLE:   { status: 503, message: 'Service temporarily unavailable' },\n\n  // New in storm-023\n  INVALID_REQUEST:          { status: 400, message: 'Malformed request' },\n  CONTENT_LIMIT_EXCEEDED:   { status: 400, message: 'Content exceeds size limits' },\n  BATCH_SIZE_EXCEEDED:      { status: 400, message: 'Too many items in batch' },\n  TIER_REQUIRED:            { status: 403, message: 'Higher tier required' },\n  PRIVACY_TIER_REQUIRED:    { status: 403, message: 'Private tier required for this operation' },\n  DUPLICATE:                { status: 409, message: 'Resource already exists' },\n  IDEMPOTENCY_MISMATCH:    { status: 409, message: 'Same key with different request body' },\n  UNPROCESSABLE:            { status: 422, message: 'Valid syntax but semantic error' },\n  UPSTREAM_ERROR:           { status: 502, message: 'Upstream service failed' },\n} as const;\n\nexport type ApiErrorCode = keyof typeof API_ERROR_CODES;\n\nexport function isApiErrorCode(value: unknown): value is ApiErrorCode {\n  return typeof value === 'string' && value in API_ERROR_CODES;\n}\n\n// ============================================================\n// ENDPOINT TIMEOUTS\n// ============================================================\n\n/**\n * Expected latency and client timeout per endpoint type.\n * `expected_ms: null` means variable/streaming.\n */\nexport const ENDPOINT_TIMEOUTS = {\n  health:      { expected_ms: 50,    client_timeout_ms: 5_000 },\n  node_crud:   { expected_ms: 100,   client_timeout_ms: 10_000 },\n  list:        { expected_ms: 200,   client_timeout_ms: 15_000 },\n  search:      { expected_ms: 500,   client_timeout_ms: 30_000 },\n  ingest_text: { expected_ms: 2_000, client_timeout_ms: 30_000 },\n  ingest_file: { expected_ms: null,  client_timeout_ms: 60_000 },\n  chat_sse:    { expected_ms: null,  client_timeout_ms: 120_000 },\n  sync:        { expected_ms: 500,   client_timeout_ms: 30_000 },\n  agent:       { expected_ms: 5_000, client_timeout_ms: 60_000 },\n} as const;\n\nexport type EndpointTimeoutType = keyof typeof ENDPOINT_TIMEOUTS;\n\n// ============================================================\n// RATE LIMIT MONITORING\n// ============================================================\n\n/** Alerting thresholds for rate limiting monitoring */\nexport const RATE_LIMIT_ALERT_THRESHOLDS = {\n  redis_failure_rate_percent: 1,\n  redis_failure_window_ms: 60_000,\n  user_limit_hits_per_min: 10,\n  tier_utilization_percent: 90,\n  tier_utilization_window_ms: 300_000,\n  fallback_active_max_ms: 30_000,\n} as const;\n\n// ============================================================\n// PAGINATION DEFAULTS\n// ============================================================\n\nexport const CURSOR_PAGINATION_DEFAULT_LIMIT = 50;\nexport const CURSOR_PAGINATION_MAX_LIMIT = 100;\nexport const OFFSET_PAGINATION_DEFAULT_LIMIT = 20;\nexport const OFFSET_PAGINATION_MAX_LIMIT = 100;\n\n// ============================================================\n// IDEMPOTENCY\n// ============================================================\n\n/** Idempotency key cache duration (24 hours) */\nexport const IDEMPOTENCY_TTL_MS = 86_400_000;\n\n// ============================================================\n// RATE LIMIT ALGORITHMS\n// ============================================================\n\nexport const RATE_LIMIT_ALGORITHMS = ['sliding_window', 'token_bucket'] as const;\nexport type RateLimitAlgorithm = typeof RATE_LIMIT_ALGORITHMS[number];\n\n// ============================================================\n// RATE LIMIT TYPES\n// ============================================================\n\n/**\n * Categories of rate limits checked per request.\n * Check order: endpoint-specific -> global tier -> daily -> concurrent.\n */\nexport const RATE_LIMIT_TYPES = ['api', 'endpoint', 'daily', 'concurrent', 'llm'] as const;\nexport type RateLimitType = typeof RATE_LIMIT_TYPES[number];\n\nexport function isRateLimitType(value: unknown): value is RateLimitType {\n  return typeof value === 'string' && (RATE_LIMIT_TYPES as readonly string[]).includes(value);\n}\n\n// ============================================================\n// AUTH METHODS\n// ============================================================\n\nexport const AUTH_METHODS = ['jwt', 'api_key'] as const;\nexport type AuthMethod = typeof AUTH_METHODS[number];\n\n// ============================================================\n// API KEY PREFIXES & SCOPES\n// ============================================================\n\nexport const API_KEY_PREFIX_LIVE = 'sk_live_';\nexport const API_KEY_PREFIX_TEST = 'sk_test_';\n\nexport const API_KEY_SCOPES = ['full', 'read_only'] as const;\nexport type ApiKeyScope = typeof API_KEY_SCOPES[number];\n\nexport function isApiKeyScope(value: unknown): value is ApiKeyScope {\n  return typeof value === 'string' && (API_KEY_SCOPES as readonly string[]).includes(value);\n}\n\n// ============================================================\n// EMBEDDING STATUS\n// ============================================================\n\nexport const EMBEDDING_STATUSES = ['pending', 'processing', 'complete', 'failed'] as const;\nexport type EmbeddingStatus = typeof EMBEDDING_STATUSES[number];\n\nexport function isEmbeddingStatus(value: unknown): value is EmbeddingStatus {\n  return typeof value === 'string' && (EMBEDDING_STATUSES as readonly string[]).includes(value);\n}\n\n// ============================================================\n// PRIVACY TIERS (API-LEVEL REFERENCE)\n// ============================================================\n\nexport const PRIVACY_TIERS = ['standard', 'private'] as const;\nexport type PrivacyTier = typeof PRIVACY_TIERS[number];\n\n// ============================================================\n// LIFECYCLE STATES\n// ============================================================\n\nexport const LIFECYCLE_STATES = ['active', 'weak', 'dormant', 'summarized', 'archived'] as const;\nexport type LifecycleState = typeof LIFECYCLE_STATES[number];\n\n// ============================================================\n// EDGE DIRECTIONS\n// ============================================================\n\nexport const EDGE_DIRECTIONS = ['in', 'out', 'both'] as const;\nexport type EdgeDirection = typeof EDGE_DIRECTIONS[number];\n\nexport function isEdgeDirection(value: unknown): value is EdgeDirection {\n  return typeof value === 'string' && (EDGE_DIRECTIONS as readonly string[]).includes(value);\n}\n\n// ============================================================\n// INGESTION CONSTANTS\n// ============================================================\n\nexport const INGEST_SOURCES = ['chat', 'file', 'voice', 'api'] as const;\nexport type IngestSource = typeof INGEST_SOURCES[number];\n\nexport function isIngestSource(value: unknown): value is IngestSource {\n  return typeof value === 'string' && (INGEST_SOURCES as readonly string[]).includes(value);\n}\n\nexport const INGEST_MODES = ['normal', 'incognito'] as const;\nexport type IngestMode = typeof INGEST_MODES[number];\n\nexport const INGEST_PRIORITIES = ['normal', 'high', 'low'] as const;\nexport type IngestPriority = typeof INGEST_PRIORITIES[number];\n\nexport const INGEST_ACTIONS = ['saved', 'ignored', 'accumulated', 'prompted'] as const;\nexport type IngestAction = typeof INGEST_ACTIONS[number];\n\nexport function isIngestAction(value: unknown): value is IngestAction {\n  return typeof value === 'string' && (INGEST_ACTIONS as readonly string[]).includes(value);\n}\n\n// ============================================================\n// JOB STATUSES\n// ============================================================\n\nexport const JOB_STATUSES = ['processing', 'complete', 'failed'] as const;\nexport type JobStatus = typeof JOB_STATUSES[number];\n\nexport function isJobStatus(value: unknown): value is JobStatus {\n  return typeof value === 'string' && (JOB_STATUSES as readonly string[]).includes(value);\n}\n\n// ============================================================\n// SYNC CONSTANTS\n// ============================================================\n\nexport const SYNC_OPERATIONS = ['create', 'update', 'delete'] as const;\nexport type SyncOperation = typeof SYNC_OPERATIONS[number];\n\nexport function isSyncOperation(value: unknown): value is SyncOperation {\n  return typeof value === 'string' && (SYNC_OPERATIONS as readonly string[]).includes(value);\n}\n\nexport const SYNC_TABLES = ['nodes', 'edges'] as const;\nexport type SyncTable = typeof SYNC_TABLES[number];\n\nexport const SYNC_CONFLICT_TYPES = ['VERSION_MISMATCH', 'DELETED', 'CONSTRAINT'] as const;\nexport type SyncConflictType = typeof SYNC_CONFLICT_TYPES[number];\n\nexport function isSyncConflictType(value: unknown): value is SyncConflictType {\n  return typeof value === 'string' && (SYNC_CONFLICT_TYPES as readonly string[]).includes(value);\n}\n\nexport const SYNC_RESOLUTIONS = ['keep_local', 'keep_server', 'merge'] as const;\nexport type SyncResolution = typeof SYNC_RESOLUTIONS[number];\n\nexport function isSyncResolution(value: unknown): value is SyncResolution {\n  return typeof value === 'string' && (SYNC_RESOLUTIONS as readonly string[]).includes(value);\n}\n\nexport const FULL_SYNC_REASONS = ['corruption', 'reset', 'new_device'] as const;\nexport type FullSyncReason = typeof FULL_SYNC_REASONS[number];\n\n// ============================================================\n// AGENT CONSTANTS\n// ============================================================\n\nexport const AGENT_TOOL_CATEGORIES = ['read', 'write', 'destructive'] as const;\nexport type AgentToolCategory = typeof AGENT_TOOL_CATEGORIES[number];\n\nexport const ACTION_STATUSES = ['completed', 'failed', 'undone'] as const;\nexport type ActionStatus = typeof ACTION_STATUSES[number];\n\n// ============================================================\n// SETTINGS CONSTANTS\n// ============================================================\n\nexport const THEME_OPTIONS = ['system', 'light', 'dark'] as const;\nexport type ThemeOption = typeof THEME_OPTIONS[number];\n\nexport const AGENT_SUGGESTION_LEVELS = ['all', 'important_only', 'none'] as const;\nexport type AgentSuggestionLevel = typeof AGENT_SUGGESTION_LEVELS[number];\n\n// ============================================================\n// CREDIT CONSTANTS\n// ============================================================\n\nexport const CREDIT_OPERATIONS = ['chat_quick', 'chat_standard', 'chat_deep', 'extraction', 'agent', 'embedding'] as const;\nexport type CreditOperation = typeof CREDIT_OPERATIONS[number];\n\nexport const USAGE_GROUP_BY = ['day', 'operation'] as const;\nexport type UsageGroupBy = typeof USAGE_GROUP_BY[number];\n\n// ============================================================\n// FLOW TYPES\n// ============================================================\n\nexport const FLOW_TYPES = ['chat', 'sync', 'ingestion'] as const;\nexport type FlowType = typeof FLOW_TYPES[number];\n\n// ============================================================\n// CORS CONFIGURATION\n// ============================================================\n\nexport const CORS_ALLOWED_ORIGINS = [\n  'https://app.nous.app',\n  'https://nous.app',\n] as const;\n\nexport const CORS_ALLOWED_METHODS = ['GET', 'POST', 'PATCH', 'DELETE', 'OPTIONS'] as const;\nexport const CORS_ALLOWED_HEADERS = ['Authorization', 'Content-Type', 'X-Request-ID', 'Idempotency-Key'] as const;\nexport const CORS_MAX_AGE_SECONDS = 86_400;\n","/**\n * @module @nous/core/api\n * @description All interfaces and Zod schemas for the Nous API Layer (NAL)\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Consolidated from spec files: types, error-handling, rate-limiting, auth-middleware,\n * sse-chat, resource-endpoints, action-endpoints, system-endpoints, data-flows.\n *\n * Naming convention: InterfaceName + InterfaceNameSchema\n */\n\nimport { z } from 'zod';\n\nimport type {\n  UserTier,\n  EmbeddingStatus,\n  LifecycleState,\n  EdgeDirection,\n  AuthMethod,\n  PrivacyTier,\n  ApiKeyScope,\n  RateLimitType,\n  IngestSource,\n  IngestMode,\n  IngestPriority,\n  IngestAction,\n  JobStatus,\n  ActionStatus,\n  SyncOperation,\n  SyncTable,\n  SyncConflictType,\n  SyncResolution,\n  FullSyncReason,\n  AgentSuggestionLevel,\n  ThemeOption,\n  CreditOperation,\n  FlowType,\n} from './constants';\n\nimport {\n  USER_TIERS,\n  EMBEDDING_STATUSES,\n  LIFECYCLE_STATES,\n  EDGE_DIRECTIONS,\n  API_KEY_SCOPES,\n  INGEST_SOURCES,\n  INGEST_MODES,\n  INGEST_PRIORITIES,\n  ACTION_STATUSES,\n  SYNC_OPERATIONS,\n  SYNC_TABLES,\n  SYNC_CONFLICT_TYPES,\n  SYNC_RESOLUTIONS,\n  FULL_SYNC_REASONS,\n  AGENT_SUGGESTION_LEVELS,\n  THEME_OPTIONS,\n  PRIVACY_TIERS,\n  FLOW_TYPES,\n  CURSOR_PAGINATION_DEFAULT_LIMIT,\n  CURSOR_PAGINATION_MAX_LIMIT,\n  OFFSET_PAGINATION_DEFAULT_LIMIT,\n  OFFSET_PAGINATION_MAX_LIMIT,\n} from './constants';\n\n// ============================================================\n// HELPER SCHEMAS (reused throughout)\n// ============================================================\n\nexport const UserTierSchema = z.enum(USER_TIERS);\n\n// ============================================================\n// PAGINATION: CURSOR-BASED\n// ============================================================\n\n/**\n * Cursor-based pagination request parameters.\n * Used for: node lists, conversation lists, sync pull, action history.\n */\nexport interface CursorPaginationRequest {\n  cursor?: string;\n  limit?: number;\n}\n\nexport const CursorPaginationRequestSchema = z.object({\n  cursor: z.string().optional(),\n  limit: z.number().int().min(1).max(CURSOR_PAGINATION_MAX_LIMIT).default(CURSOR_PAGINATION_DEFAULT_LIMIT).optional(),\n});\n\n/**\n * Cursor-based pagination response metadata.\n */\nexport interface CursorPaginationResponse {\n  cursor: string | null;\n  next_cursor: string | null;\n  has_more: boolean;\n  limit: number;\n  total?: number;\n}\n\nexport const CursorPaginationResponseSchema = z.object({\n  cursor: z.string().nullable(),\n  next_cursor: z.string().nullable(),\n  has_more: z.boolean(),\n  limit: z.number().int(),\n  total: z.number().int().optional(),\n});\n\n// ============================================================\n// PAGINATION: OFFSET-BASED\n// ============================================================\n\n/**\n * Offset-based pagination request parameters.\n * Used for: search results.\n */\nexport interface OffsetPaginationRequest {\n  offset?: number;\n  limit?: number;\n}\n\nexport const OffsetPaginationRequestSchema = z.object({\n  offset: z.number().int().min(0).default(0).optional(),\n  limit: z.number().int().min(1).max(OFFSET_PAGINATION_MAX_LIMIT).default(OFFSET_PAGINATION_DEFAULT_LIMIT).optional(),\n});\n\n/**\n * Offset-based pagination response metadata.\n */\nexport interface OffsetPaginationResponse {\n  offset: number;\n  limit: number;\n  total: number;\n  has_more: boolean;\n}\n\nexport const OffsetPaginationResponseSchema = z.object({\n  offset: z.number().int(),\n  limit: z.number().int(),\n  total: z.number().int(),\n  has_more: z.boolean(),\n});\n\n// ============================================================\n// API RESPONSE WRAPPERS\n// ============================================================\n\n/** Standard API response wrapper for single-item endpoints. */\nexport interface ApiResponse<T> {\n  data: T;\n  meta?: Record<string, unknown>;\n  pagination?: CursorPaginationResponse | OffsetPaginationResponse;\n}\n\n/** Standard API response wrapper for list endpoints. */\nexport interface ApiListResponse<T> {\n  data: T[];\n  pagination: CursorPaginationResponse | OffsetPaginationResponse;\n  meta?: Record<string, unknown>;\n}\n\n// ============================================================\n// ERROR RESPONSES\n// ============================================================\n\n/**\n * Extended API error response.\n * Extends storm-026's ApiErrorResponse with retry_after, docs_url, request tracing.\n */\nexport interface ApiErrorResponseExtended {\n  code: string;\n  message: string;\n  details?: Record<string, unknown>;\n  request_id: string;\n  retry_after?: number;\n  docs_url?: string;\n}\n\nexport const ApiErrorResponseExtendedSchema = z.object({\n  code: z.string(),\n  message: z.string(),\n  details: z.record(z.unknown()).optional(),\n  request_id: z.string(),\n  retry_after: z.number().optional(),\n  docs_url: z.string().url().optional(),\n});\n\n/**\n * Field-level validation error detail.\n * Returned in the `details.fields` array of VALIDATION_ERROR responses.\n */\nexport interface ValidationFieldError {\n  path: string;\n  message: string;\n  limit?: number;\n  actual?: number;\n  soft_limit?: number;\n  hard_limit?: number;\n}\n\nexport const ValidationFieldErrorSchema = z.object({\n  path: z.string(),\n  message: z.string(),\n  limit: z.number().optional(),\n  actual: z.number().optional(),\n  soft_limit: z.number().optional(),\n  hard_limit: z.number().optional(),\n});\n\n/**\n * Content limits reference returned in VALIDATION_ERROR responses.\n */\nexport interface ContentLimitsInfo {\n  title: number;\n  body_soft: number;\n  body_hard: number;\n  summary: number;\n}\n\nexport const ContentLimitsInfoSchema = z.object({\n  title: z.number().int().positive(),\n  body_soft: z.number().int().positive(),\n  body_hard: z.number().int().positive(),\n  summary: z.number().int().positive(),\n});\n\n// ============================================================\n// RATE LIMIT HEADERS\n// ============================================================\n\n/**\n * Rate limit response headers included on every API response.\n * `Retry-After` is only included on 429 responses.\n */\nexport interface RateLimitHeaders {\n  'X-RateLimit-Limit': number;\n  'X-RateLimit-Remaining': number;\n  'X-RateLimit-Reset': number;\n  'X-RateLimit-Window': number;\n  'Retry-After'?: number;\n}\n\n// ============================================================\n// AUTH CONTEXT\n// ============================================================\n\n/**\n * Authenticated request context extracted from JWT or API key.\n * Available to all route handlers after auth middleware.\n */\nexport interface AuthContext {\n  user_id: string;\n  tier: UserTier;\n  privacy_tier: PrivacyTier;\n  auth_method: AuthMethod;\n}\n\nexport const AuthContextSchema = z.object({\n  user_id: z.string(),\n  tier: UserTierSchema,\n  privacy_tier: z.enum(PRIVACY_TIERS),\n  auth_method: z.enum(['jwt', 'api_key']),\n});\n\n// ============================================================\n// IDEMPOTENCY\n// ============================================================\n\n/**\n * Server-side record of an idempotent request.\n * Cached for 24 hours (IDEMPOTENCY_TTL_MS).\n *\n * @persisted\n */\nexport interface IdempotencyRecord {\n  _schemaVersion: number;\n  key: string;\n  request_hash: string;\n  response: unknown;\n  status_code: number;\n  created_at: string;\n  expires_at: string;\n}\n\nexport const IdempotencyRecordSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  key: z.string(),\n  request_hash: z.string(),\n  response: z.unknown(),\n  status_code: z.number().int(),\n  created_at: z.string().datetime(),\n  expires_at: z.string().datetime(),\n});\n\n// ============================================================\n// EMBEDDING INFO\n// ============================================================\n\n/**\n * Embedding status information returned in node API responses.\n * The actual embedding vector is NOT returned (security, per storm-022).\n */\nexport interface EmbeddingInfo {\n  model: string;\n  dimensions: number;\n  status: EmbeddingStatus;\n  estimated_completion?: string;\n}\n\nexport const EmbeddingInfoSchema = z.object({\n  model: z.string(),\n  dimensions: z.number().int().positive(),\n  status: z.enum(EMBEDDING_STATUSES),\n  estimated_completion: z.string().datetime().optional(),\n});\n\n// ============================================================\n// WEBHOOK CALLBACK\n// ============================================================\n\n/** Webhook callback payload sent by the server to a user-provided URL. */\nexport interface WebhookCallback {\n  event: string;\n  job_id: string;\n  status: string;\n  results: Record<string, unknown>;\n  timestamp: string;\n}\n\nexport const WebhookCallbackSchema = z.object({\n  event: z.string(),\n  job_id: z.string(),\n  status: z.string(),\n  results: z.record(z.unknown()),\n  timestamp: z.string().datetime(),\n});\n\n// ============================================================\n// RATE LIMIT RESULT\n// ============================================================\n\n/** Result of a rate limit check. */\nexport interface RateLimitResult {\n  allowed: boolean;\n  limit: number;\n  remaining: number;\n  reset_at: string;\n  retry_after?: number;\n  limit_type: RateLimitType;\n}\n\nexport const RateLimitResultSchema = z.object({\n  allowed: z.boolean(),\n  limit: z.number().int(),\n  remaining: z.number().int().min(0),\n  reset_at: z.string().datetime(),\n  retry_after: z.number().optional(),\n  limit_type: z.enum(['api', 'endpoint', 'daily', 'concurrent', 'llm']),\n});\n\n// ============================================================\n// RATE LIMITING: SLIDING WINDOW STATE\n// ============================================================\n\n/**\n * Internal state of a sliding window rate limiter.\n * Redis implementation: Sorted Set with timestamp scores.\n */\nexport interface SlidingWindowState {\n  key: string;\n  count: number;\n  window_start_ms: number;\n  window_end_ms: number;\n}\n\nexport const SlidingWindowStateSchema = z.object({\n  key: z.string(),\n  count: z.number().int().min(0),\n  window_start_ms: z.number().int(),\n  window_end_ms: z.number().int(),\n});\n\n// ============================================================\n// RATE LIMITING: TOKEN BUCKET STATE\n// ============================================================\n\n/**\n * Internal state of a token bucket rate limiter.\n * Redis implementation: Hash with tokens and last_refill fields.\n */\nexport interface TokenBucketState {\n  key: string;\n  tokens: number;\n  last_refill_ms: number;\n  max_tokens: number;\n  refill_rate: number;\n}\n\nexport const TokenBucketStateSchema = z.object({\n  key: z.string(),\n  tokens: z.number().min(0),\n  last_refill_ms: z.number().int(),\n  max_tokens: z.number().positive(),\n  refill_rate: z.number().positive(),\n});\n\n// ============================================================\n// RATE LIMITING: 429 ERROR RESPONSE\n// ============================================================\n\n/** Detailed 429 error response for rate limit exceeded. */\nexport interface RateLimitErrorResponse {\n  code: 'RATE_LIMITED';\n  message: string;\n  retry_after: number;\n  limit: number;\n  remaining: 0;\n  window: number;\n  reset_at: string;\n  limit_type: RateLimitType;\n  endpoint?: string;\n  active_requests?: number;\n  upgrade_url?: string;\n  request_id: string;\n  docs_url: string;\n}\n\nexport const RateLimitErrorResponseSchema = z.object({\n  code: z.literal('RATE_LIMITED'),\n  message: z.string(),\n  retry_after: z.number().int().min(0),\n  limit: z.number().int().positive(),\n  remaining: z.literal(0),\n  window: z.number().int().positive(),\n  reset_at: z.string().datetime(),\n  limit_type: z.enum(['api', 'endpoint', 'daily', 'concurrent', 'llm']),\n  endpoint: z.string().optional(),\n  active_requests: z.number().int().optional(),\n  upgrade_url: z.string().url().optional(),\n  request_id: z.string(),\n  docs_url: z.string().url(),\n});\n\n// ============================================================\n// RATE LIMITING: REDIS OPERATIONS INTERFACE\n// ============================================================\n\n/** Rate limiting Redis operations interface (external stubs). */\nexport interface RateLimitRedisOps {\n  slidingWindowCheck(key: string, windowMs: number, limit: number): Promise<RateLimitResult>;\n  tokenBucketCheck(key: string, refillRate: number, maxTokens: number): Promise<RateLimitResult>;\n  concurrentAdd(key: string, requestId: string, limit: number): Promise<RateLimitResult>;\n  concurrentRemove(key: string, requestId: string): Promise<void>;\n}\n\n// ============================================================\n// RATE LIMITING: METRICS\n// ============================================================\n\n/** Rate limiting metrics snapshot for monitoring/observability. */\nexport interface RateLimitMetrics {\n  check_count: number;\n  exceeded_count: number;\n  bucket_utilization: number;\n  redis_latency_ms: number;\n  redis_failure_count: number;\n  fallback_count: number;\n}\n\nexport const RateLimitMetricsSchema = z.object({\n  check_count: z.number().int().min(0),\n  exceeded_count: z.number().int().min(0),\n  bucket_utilization: z.number().min(0).max(1),\n  redis_latency_ms: z.number().min(0),\n  redis_failure_count: z.number().int().min(0),\n  fallback_count: z.number().int().min(0),\n});\n\n// ============================================================\n// AUTH: JWT CLAIMS\n// ============================================================\n\n/**\n * JWT claims structure issued by Clerk.\n * Extracted from the Authorization header after validation.\n */\nexport interface JWTClaims {\n  sub: string;\n  exp: number;\n  iat: number;\n  metadata: {\n    tier: UserTier;\n    privacy: PrivacyTier;\n  };\n}\n\nexport const JWTClaimsSchema = z.object({\n  sub: z.string(),\n  exp: z.number().int(),\n  iat: z.number().int(),\n  metadata: z.object({\n    tier: z.enum(USER_TIERS),\n    privacy: z.enum(PRIVACY_TIERS),\n  }),\n});\n\n// ============================================================\n// AUTH: API KEY DISPLAY INFO\n// ============================================================\n\n/**\n * API key information for the Settings UI display.\n * The actual key value is NEVER stored or returned after creation.\n */\nexport interface APIKeyDisplayInfo {\n  id: string;\n  name: string;\n  prefix: string;\n  scope: ApiKeyScope;\n  created_at: string;\n  last_used?: string;\n}\n\nexport const APIKeyDisplayInfoSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  prefix: z.string(),\n  scope: z.enum(API_KEY_SCOPES),\n  created_at: z.string().datetime(),\n  last_used: z.string().datetime().optional(),\n});\n\n// ============================================================\n// AUTH: REFRESH TOKEN\n// ============================================================\n\n/** Refresh token request body. POST /v1/auth/refresh */\nexport interface RefreshTokenRequest {\n  refresh_token: string;\n}\n\nexport const RefreshTokenRequestSchema = z.object({\n  refresh_token: z.string(),\n});\n\n/** Refresh token response. */\nexport interface RefreshTokenResponse {\n  access_token: string;\n  expires_in: number;\n}\n\nexport const RefreshTokenResponseSchema = z.object({\n  access_token: z.string(),\n  expires_in: z.number().int().positive(),\n});\n\n// ============================================================\n// CHAT SSE: EVENT DATA TYPES\n// ============================================================\n\n/** session_start — First event, confirms session creation. */\nexport interface ChatSessionStartEvent {\n  session_id: string;\n  conversation_id?: string;\n}\n\nexport const ChatSessionStartEventSchema = z.object({\n  session_id: z.string(),\n  conversation_id: z.string().optional(),\n});\n\n/** retrieval_start — Signals beginning of retrieval phase. */\nexport interface ChatRetrievalStartEvent {\n  phase: string;\n  query_processed: string;\n}\n\nexport const ChatRetrievalStartEventSchema = z.object({\n  phase: z.string(),\n  query_processed: z.string(),\n});\n\n/** retrieval_node — Emitted for each relevant node found during retrieval. */\nexport interface ChatRetrievalNodeEvent {\n  node_id: string;\n  score: number;\n  title: string;\n}\n\nexport const ChatRetrievalNodeEventSchema = z.object({\n  node_id: z.string(),\n  score: z.number(),\n  title: z.string(),\n});\n\n/** retrieval_complete — Signals end of retrieval phase with summary. */\nexport interface ChatRetrievalCompleteEvent {\n  nodes_retrieved: number;\n  time_ms: number;\n}\n\nexport const ChatRetrievalCompleteEventSchema = z.object({\n  nodes_retrieved: z.number().int().min(0),\n  time_ms: z.number().min(0),\n});\n\n/** response_start — Signals beginning of LLM response generation. */\nexport interface ChatResponseStartEvent {\n  model: string;\n  estimated_cost: number;\n}\n\nexport const ChatResponseStartEventSchema = z.object({\n  model: z.string(),\n  estimated_cost: z.number().min(0),\n});\n\n/** response_chunk — Streamed text chunk from LLM response. */\nexport interface ChatResponseChunkEvent {\n  content: string;\n  index: number;\n}\n\nexport const ChatResponseChunkEventSchema = z.object({\n  content: z.string(),\n  index: z.number().int().min(0),\n});\n\n/** Source node referenced in a chat response. */\nexport interface ChatSource {\n  node_id: string;\n  title: string;\n  relevance: number;\n}\n\nexport const ChatSourceSchema = z.object({\n  node_id: z.string(),\n  title: z.string(),\n  relevance: z.number().min(0).max(1),\n});\n\n/** response_complete — Signals end of LLM response with cost and metadata. */\nexport interface ChatResponseCompleteEvent {\n  total_tokens: number;\n  actual_cost: number;\n  thought_path?: string[];\n  sources: ChatSource[];\n}\n\nexport const ChatResponseCompleteEventSchema = z.object({\n  total_tokens: z.number().int().min(0),\n  actual_cost: z.number().min(0),\n  thought_path: z.array(z.string()).optional(),\n  sources: z.array(ChatSourceSchema),\n});\n\n/** done — Signals end of stream. Empty data payload. */\nexport interface ChatDoneEvent {\n  // Empty — signals end of stream\n}\n\nexport const ChatDoneEventSchema = z.object({});\n\n/** session_expired — Sent when reconnection is outside the 5-minute window. */\nexport interface ChatSessionExpiredEvent {\n  message: string;\n}\n\nexport const ChatSessionExpiredEventSchema = z.object({\n  message: z.string(),\n});\n\n// ============================================================\n// CHAT SSE: DISCRIMINATED UNION\n// ============================================================\n\n/** Union type of all chat SSE event data payloads. Discriminated on `type`. */\nexport type ChatSSEEventData =\n  | { type: 'session_start'; data: ChatSessionStartEvent }\n  | { type: 'retrieval_start'; data: ChatRetrievalStartEvent }\n  | { type: 'retrieval_node'; data: ChatRetrievalNodeEvent }\n  | { type: 'retrieval_complete'; data: ChatRetrievalCompleteEvent }\n  | { type: 'response_start'; data: ChatResponseStartEvent }\n  | { type: 'response_chunk'; data: ChatResponseChunkEvent }\n  | { type: 'response_complete'; data: ChatResponseCompleteEvent }\n  | { type: 'done'; data: ChatDoneEvent }\n  | { type: 'session_expired'; data: ChatSessionExpiredEvent }\n  | { type: 'ping'; data: Record<string, never> };\n\n// ============================================================\n// NODE ENDPOINTS\n// ============================================================\n\n/**\n * API representation of a memory node.\n * NOT NousNode from storm-011 — a flattened, safe representation.\n * Embedding vector is NEVER included (security per storm-022).\n */\nexport interface NodeResponse {\n  id: string;\n  type: string;\n  subtype?: string;\n  content: {\n    title: string;\n    body: string;\n    summary?: string;\n  };\n  embedding?: EmbeddingInfo;\n  neural: {\n    stability: number;\n    retrievability: number;\n    importance: number;\n  };\n  temporal: {\n    created_at: string;\n    updated_at: string;\n    last_accessed: string;\n    access_count: number;\n  };\n  organization: {\n    cluster_id?: string;\n    tags: string[];\n  };\n  state: {\n    lifecycle: LifecycleState;\n    flags: string[];\n  };\n  version: number;\n}\n\nexport const NodeResponseSchema = z.object({\n  id: z.string(),\n  type: z.string(),\n  subtype: z.string().optional(),\n  content: z.object({\n    title: z.string(),\n    body: z.string(),\n    summary: z.string().optional(),\n  }),\n  embedding: z.object({\n    model: z.string(),\n    dimensions: z.number().int().positive(),\n    status: z.enum(EMBEDDING_STATUSES),\n    estimated_completion: z.string().datetime().optional(),\n  }).optional(),\n  neural: z.object({\n    stability: z.number().min(0).max(1),\n    retrievability: z.number().min(0).max(1),\n    importance: z.number().min(0).max(1),\n  }),\n  temporal: z.object({\n    created_at: z.string().datetime(),\n    updated_at: z.string().datetime(),\n    last_accessed: z.string().datetime(),\n    access_count: z.number().int().min(0),\n  }),\n  organization: z.object({\n    cluster_id: z.string().optional(),\n    tags: z.array(z.string()),\n  }),\n  state: z.object({\n    lifecycle: z.enum(LIFECYCLE_STATES),\n    flags: z.array(z.string()),\n  }),\n  version: z.number().int().min(1),\n});\n\n/** List nodes query parameters. GET /v1/nodes */\nexport interface ListNodesParams extends CursorPaginationRequest {\n  type?: string;\n  updated_after?: string;\n  include?: string;\n}\n\nexport const ListNodesParamsSchema = z.object({\n  cursor: z.string().optional(),\n  limit: z.number().int().min(1).max(100).optional(),\n  type: z.string().optional(),\n  updated_after: z.string().datetime().optional(),\n  include: z.string().optional(),\n});\n\n/** List nodes response. */\nexport interface ListNodesResponse {\n  data: NodeResponse[];\n  pagination: CursorPaginationResponse;\n}\n\n/** Get node query parameters. GET /v1/nodes/:id */\nexport interface GetNodeParams {\n  include?: string;\n}\n\nexport const GetNodeParamsSchema = z.object({\n  include: z.string().optional(),\n});\n\n/** Get node response. */\nexport interface GetNodeResponse {\n  data: NodeResponse;\n}\n\n/**\n * Create node request body. POST /v1/nodes\n * Content limits: title 100, body soft 500/hard 2000, summary 200.\n */\nexport interface CreateNodeRequest {\n  type: string;\n  subtype?: string;\n  content: {\n    title: string;\n    body: string;\n    summary?: string;\n  };\n  organization?: {\n    tags?: string[];\n  };\n}\n\nexport const CreateNodeRequestSchema = z.object({\n  type: z.string(),\n  subtype: z.string().optional(),\n  content: z.object({\n    title: z.string().max(100),\n    body: z.string().max(2000),\n    summary: z.string().max(200).optional(),\n  }),\n  organization: z.object({\n    tags: z.array(z.string()).optional(),\n  }).optional(),\n});\n\n/** Create node response (201). */\nexport interface CreateNodeResponse {\n  data: NodeResponse;\n  meta: {\n    edges_created: number;\n    auto_linked: boolean;\n  };\n}\n\n/** Update node request body. PATCH /v1/nodes/:id */\nexport interface UpdateNodeRequest {\n  content?: Partial<{\n    title: string;\n    body: string;\n    summary: string;\n  }>;\n  expected_version?: number;\n}\n\nexport const UpdateNodeRequestSchema = z.object({\n  content: z.object({\n    title: z.string().max(100).optional(),\n    body: z.string().max(2000).optional(),\n    summary: z.string().max(200).optional(),\n  }).optional(),\n  expected_version: z.number().int().min(1).optional(),\n});\n\n/** Batch create nodes request body. POST /v1/nodes/batch */\nexport interface BatchCreateNodesRequest {\n  nodes: CreateNodeRequest[];\n  link_to_episode?: string;\n}\n\nexport const BatchCreateNodesRequestSchema = z.object({\n  nodes: z.array(CreateNodeRequestSchema).min(1).max(100),\n  link_to_episode: z.string().optional(),\n});\n\n/** A single failure item in a batch response. */\nexport interface BatchFailureItem {\n  index: number;\n  error: {\n    code: string;\n    message: string;\n  };\n}\n\nexport const BatchFailureItemSchema = z.object({\n  index: z.number().int().min(0),\n  error: z.object({\n    code: z.string(),\n    message: z.string(),\n  }),\n});\n\n/** Batch create nodes response (201). Partial success is possible. */\nexport interface BatchCreateNodesResponse {\n  data: {\n    created: NodeResponse[];\n    failed: BatchFailureItem[];\n  };\n  meta: {\n    total: number;\n    created_count: number;\n    failed_count: number;\n    batch_id: string;\n  };\n}\n\n// ============================================================\n// EDGE ENDPOINTS\n// ============================================================\n\n/** API representation of an edge between two nodes. */\nexport interface EdgeResponse {\n  id: string;\n  source: string;\n  target: string;\n  type: string;\n  strength: number;\n  confidence: number;\n  neural: {\n    co_activation_count: number;\n    last_co_activation: string;\n  };\n  created_at: string;\n}\n\nexport const EdgeResponseSchema = z.object({\n  id: z.string(),\n  source: z.string(),\n  target: z.string(),\n  type: z.string(),\n  strength: z.number().min(0).max(1),\n  confidence: z.number().min(0).max(1),\n  neural: z.object({\n    co_activation_count: z.number().int().min(0),\n    last_co_activation: z.string().datetime(),\n  }),\n  created_at: z.string().datetime(),\n});\n\n/** List edges for a node query parameters. GET /v1/nodes/:id/edges */\nexport interface ListEdgesParams extends CursorPaginationRequest {\n  direction?: EdgeDirection;\n  type?: string;\n}\n\nexport const ListEdgesParamsSchema = z.object({\n  cursor: z.string().optional(),\n  limit: z.number().int().min(1).max(100).optional(),\n  direction: z.enum(EDGE_DIRECTIONS).optional(),\n  type: z.string().optional(),\n});\n\n/** List edges response. */\nexport interface ListEdgesResponse {\n  data: EdgeResponse[];\n  pagination: CursorPaginationResponse;\n}\n\n/** Create edge request body. POST /v1/edges */\nexport interface CreateEdgeRequest {\n  source: string;\n  target: string;\n  type: string;\n  strength?: number;\n}\n\nexport const CreateEdgeRequestSchema = z.object({\n  source: z.string(),\n  target: z.string(),\n  type: z.string(),\n  strength: z.number().min(0).max(1).default(0.5).optional(),\n});\n\n/** Update edge request body. PATCH /v1/edges/:id */\nexport interface UpdateEdgeRequest {\n  strength: number;\n}\n\nexport const UpdateEdgeRequestSchema = z.object({\n  strength: z.number().min(0).max(1),\n});\n\n// ============================================================\n// SEARCH ENDPOINTS\n// ============================================================\n\n/** Search result item containing a node and its relevance score. */\nexport interface SearchResultItem {\n  node: NodeResponse;\n  score: number;\n  score_breakdown?: {\n    vector: number;\n    bm25: number;\n    combined: number;\n  };\n}\n\nexport const SearchResultItemSchema = z.object({\n  node: NodeResponseSchema,\n  score: z.number(),\n  score_breakdown: z.object({\n    vector: z.number(),\n    bm25: z.number(),\n    combined: z.number(),\n  }).optional(),\n});\n\n/** Simple search query parameters. GET /v1/search */\nexport interface SimpleSearchParams {\n  q: string;\n  type?: string;\n  offset?: number;\n  limit?: number;\n}\n\nexport const SimpleSearchParamsSchema = z.object({\n  q: z.string().min(1),\n  type: z.string().optional(),\n  offset: z.number().int().min(0).optional(),\n  limit: z.number().int().min(1).max(100).optional(),\n});\n\n/** Advanced search request body. POST /v1/search */\nexport interface AdvancedSearchRequest {\n  query: string;\n  filters?: {\n    types?: string[];\n    date_range?: {\n      start: string;\n      end: string;\n    };\n    clusters?: string[];\n    tags?: string[];\n    lifecycle?: LifecycleState[];\n  };\n  options?: {\n    include_scores?: boolean;\n    score_breakdown?: boolean;\n  };\n  limit?: number;\n  offset?: number;\n}\n\nexport const AdvancedSearchRequestSchema = z.object({\n  query: z.string().min(1),\n  filters: z.object({\n    types: z.array(z.string()).optional(),\n    date_range: z.object({\n      start: z.string(),\n      end: z.string(),\n    }).optional(),\n    clusters: z.array(z.string()).optional(),\n    tags: z.array(z.string()).optional(),\n    lifecycle: z.array(z.enum(LIFECYCLE_STATES)).optional(),\n  }).optional(),\n  options: z.object({\n    include_scores: z.boolean().optional(),\n    score_breakdown: z.boolean().optional(),\n  }).optional(),\n  limit: z.number().int().min(1).max(100).optional(),\n  offset: z.number().int().min(0).optional(),\n});\n\n/** Search response (used by both simple and advanced search). */\nexport interface SearchResponse {\n  data: SearchResultItem[];\n  pagination: OffsetPaginationResponse;\n  meta: {\n    query_time_ms: number;\n    embedding_model?: string;\n    retrieval_method?: string;\n  };\n}\n\n// ============================================================\n// CLUSTER ENDPOINTS\n// ============================================================\n\n/** Cluster list item for GET /v1/clusters. */\nexport interface ClusterListItem {\n  id: string;\n  name: string;\n  description: string;\n  node_count: number;\n  keywords: string[];\n  color: string;\n  created_at: string;\n}\n\nexport const ClusterListItemSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  node_count: z.number().int().min(0),\n  keywords: z.array(z.string()),\n  color: z.string(),\n  created_at: z.string().datetime(),\n});\n\n/** Cluster detail response for GET /v1/clusters/:id. */\nexport interface ClusterDetailResponse {\n  data: ClusterListItem & {\n    top_nodes: { id: string; title: string; importance: number }[];\n    related_clusters: { id: string; name: string; strength: number }[];\n  };\n}\n\n/** Update cluster request body. PATCH /v1/clusters/:id */\nexport interface UpdateClusterRequest {\n  name?: string;\n  color?: string;\n}\n\nexport const UpdateClusterRequestSchema = z.object({\n  name: z.string().optional(),\n  color: z.string().optional(),\n});\n\n/** List clusters response. No pagination — cluster count is typically small. */\nexport interface ListClustersResponse {\n  data: ClusterListItem[];\n}\n\n// ============================================================\n// CHAT ENDPOINTS\n// ============================================================\n\n/**\n * Chat request body. POST /v1/chat (with Accept: text/event-stream for SSE).\n * The response is an SSE stream — see ChatSSEEventData.\n */\nexport interface ChatRequest {\n  message: string;\n  conversation_id?: string;\n  options?: {\n    include_retrieval?: boolean;\n    include_thought_path?: boolean;\n    max_tokens?: number;\n    model_preference?: string | null;\n  };\n}\n\nexport const ChatRequestSchema = z.object({\n  message: z.string().min(1),\n  conversation_id: z.string().optional(),\n  options: z.object({\n    include_retrieval: z.boolean().optional(),\n    include_thought_path: z.boolean().optional(),\n    max_tokens: z.number().int().positive().optional(),\n    model_preference: z.string().nullable().optional(),\n  }).optional(),\n});\n\n/** A single message in a conversation. */\nexport interface ConversationMessage {\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: string;\n  sources?: ChatSource[];\n  cost?: number;\n}\n\nexport const ConversationMessageSchema = z.object({\n  role: z.enum(['user', 'assistant']),\n  content: z.string(),\n  timestamp: z.string().datetime(),\n  sources: z.array(ChatSourceSchema).optional(),\n  cost: z.number().min(0).optional(),\n});\n\n/** Conversation detail response. GET /v1/chat/conversations/:id */\nexport interface ConversationDetailResponse {\n  data: {\n    id: string;\n    messages: ConversationMessage[];\n    total_cost: number;\n    created_at: string;\n    updated_at: string;\n  };\n}\n\n/** Conversation summary for list view. */\nexport interface ConversationSummary {\n  id: string;\n  preview: string;\n  message_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport const ConversationSummarySchema = z.object({\n  id: z.string(),\n  preview: z.string(),\n  message_count: z.number().int().min(0),\n  created_at: z.string().datetime(),\n  updated_at: z.string().datetime(),\n});\n\n/** List conversations response. GET /v1/chat/conversations */\nexport interface ListConversationsResponse {\n  data: ConversationSummary[];\n  pagination: CursorPaginationResponse;\n}\n\n// ============================================================\n// AGENT ENDPOINTS\n// ============================================================\n\n/** Agent tool information. Returned in GET /v1/agent/tools. */\nexport interface AgentToolInfo {\n  name: string;\n  description?: string;\n  params?: unknown[];\n  available_offline: boolean;\n  credits: number;\n  requires_confirmation?: boolean;\n  preview_threshold?: number;\n}\n\nexport const AgentToolInfoSchema = z.object({\n  name: z.string(),\n  description: z.string().optional(),\n  params: z.array(z.unknown()).optional(),\n  available_offline: z.boolean(),\n  credits: z.number().min(0),\n  requires_confirmation: z.boolean().optional(),\n  preview_threshold: z.number().int().positive().optional(),\n});\n\n/** Agent tools list response, categorized by type. GET /v1/agent/tools */\nexport interface AgentToolsResponse {\n  data: {\n    read: AgentToolInfo[];\n    write: AgentToolInfo[];\n    destructive: AgentToolInfo[];\n  };\n}\n\n/** Execute agent action request body. POST /v1/agent/actions */\nexport interface ExecuteActionRequest {\n  tool: string;\n  params: Record<string, unknown>;\n  dry_run?: boolean;\n}\n\nexport const ExecuteActionRequestSchema = z.object({\n  tool: z.string(),\n  params: z.record(z.unknown()),\n  dry_run: z.boolean().optional(),\n});\n\n/** Action result (returned when dry_run = false). */\nexport interface ActionResult {\n  action_id: string;\n  tool: string;\n  status: ActionStatus;\n  results: Record<string, unknown>;\n  credits_used: number;\n  undoable: boolean;\n  undo_expires?: string;\n}\n\nexport const ActionResultSchema = z.object({\n  action_id: z.string(),\n  tool: z.string(),\n  status: z.enum(ACTION_STATUSES),\n  results: z.record(z.unknown()),\n  credits_used: z.number().min(0),\n  undoable: z.boolean(),\n  undo_expires: z.string().datetime().optional(),\n});\n\n/** Preview result (returned when dry_run = true). */\nexport interface PreviewResult {\n  preview: true;\n  affected_count: number;\n  affected_nodes: { id: string; title: string }[];\n  estimated_credits: number;\n  requires_confirmation: boolean;\n}\n\nexport const PreviewResultSchema = z.object({\n  preview: z.literal(true),\n  affected_count: z.number().int().min(0),\n  affected_nodes: z.array(z.object({\n    id: z.string(),\n    title: z.string(),\n  })),\n  estimated_credits: z.number().min(0),\n  requires_confirmation: z.boolean(),\n});\n\n/** Execute action response. */\nexport interface ExecuteActionResponse {\n  data: ActionResult | PreviewResult;\n}\n\n/** Agent view response — node with full context. GET /v1/agent/view/:node_id */\nexport interface AgentViewResponse {\n  data: {\n    node: Record<string, unknown>;\n    context: {\n      incoming_edges: Record<string, unknown>[];\n      outgoing_edges: Record<string, unknown>[];\n      cluster: Record<string, unknown>;\n      related_nodes: Record<string, unknown>[];\n    };\n  };\n}\n\n/** Undo action response. POST /v1/agent/actions/:id/undo */\nexport interface UndoActionResponse {\n  data: {\n    action_id: string;\n    status: 'undone';\n    restored: Record<string, unknown>;\n    dependent_actions?: {\n      id: string;\n      status: 'also_undone';\n      reason: string;\n    }[];\n  };\n}\n\n/** Action history item. */\nexport interface ActionHistoryItem {\n  id: string;\n  tool: string;\n  status: ActionStatus;\n  timestamp: string;\n  undoable: boolean;\n  credits_used: number;\n}\n\nexport const ActionHistoryItemSchema = z.object({\n  id: z.string(),\n  tool: z.string(),\n  status: z.enum(ACTION_STATUSES),\n  timestamp: z.string().datetime(),\n  undoable: z.boolean(),\n  credits_used: z.number().min(0),\n});\n\n/** Action history list response. GET /v1/agent/actions */\nexport interface ActionHistoryResponse {\n  data: ActionHistoryItem[];\n  pagination: CursorPaginationResponse;\n}\n\n// ============================================================\n// INGESTION ENDPOINTS\n// ============================================================\n\n/** Ingest text content request body. POST /v1/ingest (synchronous — returns 200). */\nexport interface IngestTextRequest {\n  content: string;\n  source: IngestSource;\n  mode?: IngestMode;\n  options?: {\n    auto_save?: boolean;\n    force_save?: boolean;\n    priority?: IngestPriority;\n  };\n}\n\nexport const IngestTextRequestSchema = z.object({\n  content: z.string().min(1),\n  source: z.enum(INGEST_SOURCES),\n  mode: z.enum(INGEST_MODES).optional(),\n  options: z.object({\n    auto_save: z.boolean().optional(),\n    force_save: z.boolean().optional(),\n    priority: z.enum(INGEST_PRIORITIES).optional(),\n  }).optional(),\n});\n\n/** Ingestion classification result from storm-014's pipeline. */\nexport interface IngestClassificationResponse {\n  intent: string;\n  save_signal: string;\n  content_type: string;\n  confidence: number;\n  action_verb: string;\n}\n\nexport const IngestClassificationResponseSchema = z.object({\n  intent: z.string(),\n  save_signal: z.string(),\n  content_type: z.string(),\n  confidence: z.number().min(0).max(1),\n  action_verb: z.string(),\n});\n\n/** Summary of a created node (used in ingestion responses). */\nexport interface CreatedNodeSummary {\n  id: string;\n  type: string;\n  title: string;\n  embedding_status: EmbeddingStatus;\n}\n\nexport const CreatedNodeSummarySchema = z.object({\n  id: z.string(),\n  type: z.string(),\n  title: z.string(),\n  embedding_status: z.enum(EMBEDDING_STATUSES),\n});\n\n/** Ingest text response (200 — synchronous). */\nexport interface IngestTextResponse {\n  data: {\n    ingest_id: string;\n    classification: IngestClassificationResponse;\n    action: IngestAction;\n    nodes_created: CreatedNodeSummary[];\n    edges_created: number;\n    thought_path?: string[];\n  };\n}\n\n/** Ingest file response (202 — asynchronous). POST /v1/ingest/file */\nexport interface IngestFileResponse {\n  data: {\n    job_id: string;\n    status: 'processing';\n    estimated_time_seconds: number;\n    webhook_configured: boolean;\n  };\n}\n\n/** Ingestion job stage for progress tracking. */\nexport interface IngestJobStage {\n  name: string;\n  status: 'pending' | 'processing' | 'complete';\n  progress?: number;\n}\n\nexport const IngestJobStageSchema = z.object({\n  name: z.string(),\n  status: z.enum(['pending', 'processing', 'complete']),\n  progress: z.number().min(0).max(100).optional(),\n});\n\n/** Ingestion job status response. GET /v1/ingest/jobs/:id */\nexport interface IngestJobStatusResponse {\n  data: {\n    job_id: string;\n    status: JobStatus;\n    progress: number;\n    current_stage?: string;\n    stages?: IngestJobStage[];\n    results?: {\n      document_node?: string;\n      chunks_created: number;\n      concepts_extracted: number;\n      edges_created: number;\n      cost: number;\n    };\n  };\n}\n\n// ============================================================\n// SYNC ENDPOINTS\n// ============================================================\n\n/** Sync status response. GET /v1/sync/status */\nexport interface SyncStatusResponse {\n  data: {\n    last_sync: string;\n    pending_changes: number;\n    conflicts: number;\n    db_version: number;\n    client_behind_by: number;\n  };\n}\n\n/** A single change in a sync push request. */\nexport interface SyncChange {\n  operation: SyncOperation;\n  table: SyncTable;\n  id?: string;\n  local_id?: string;\n  data?: Record<string, unknown>;\n  expected_version?: number;\n  client_timestamp: string;\n}\n\nexport const SyncChangeSchema = z.object({\n  operation: z.enum(SYNC_OPERATIONS),\n  table: z.enum(SYNC_TABLES),\n  id: z.string().optional(),\n  local_id: z.string().optional(),\n  data: z.record(z.unknown()).optional(),\n  expected_version: z.number().int().min(1).optional(),\n  client_timestamp: z.string().datetime(),\n});\n\n/** Sync push request body. POST /v1/sync/push */\nexport interface SyncPushRequest {\n  changes: SyncChange[];\n  client_db_version: number;\n}\n\nexport const SyncPushRequestSchema = z.object({\n  changes: z.array(SyncChangeSchema),\n  client_db_version: z.number().int().min(0),\n});\n\n/** A successfully applied change in a sync push response. */\nexport interface SyncAppliedItem {\n  local_id?: string;\n  server_id: string;\n  version: number;\n}\n\nexport const SyncAppliedItemSchema = z.object({\n  local_id: z.string().optional(),\n  server_id: z.string(),\n  version: z.number().int().min(1),\n});\n\n/** A conflict detected during sync push. */\nexport interface SyncConflictItem {\n  id: string;\n  conflict_id: string;\n  type: SyncConflictType;\n  client_version: number;\n  server_version: number;\n  server_data: Record<string, unknown>;\n  resolution_options: SyncResolution[];\n}\n\nexport const SyncConflictItemSchema = z.object({\n  id: z.string(),\n  conflict_id: z.string(),\n  type: z.enum(SYNC_CONFLICT_TYPES),\n  client_version: z.number().int().min(1),\n  server_version: z.number().int().min(1),\n  server_data: z.record(z.unknown()),\n  resolution_options: z.array(z.enum(SYNC_RESOLUTIONS)),\n});\n\n/** Sync push response. */\nexport interface SyncPushResponse {\n  data: {\n    applied: SyncAppliedItem[];\n    conflicts: SyncConflictItem[];\n    server_db_version: number;\n  };\n}\n\n/** Sync pull query parameters. GET /v1/sync/pull */\nexport interface SyncPullParams {\n  since_version: number;\n  limit?: number;\n}\n\nexport const SyncPullParamsSchema = z.object({\n  since_version: z.number().int().min(0),\n  limit: z.number().int().min(1).max(200).optional(),\n});\n\n/** A change pulled from the server. */\nexport interface PulledChange {\n  table: SyncTable;\n  id: string;\n  operation: SyncOperation;\n  data: Record<string, unknown>;\n  version: number;\n  timestamp: string;\n}\n\nexport const PulledChangeSchema = z.object({\n  table: z.enum(SYNC_TABLES),\n  id: z.string(),\n  operation: z.enum(SYNC_OPERATIONS),\n  data: z.record(z.unknown()),\n  version: z.number().int().min(1),\n  timestamp: z.string().datetime(),\n});\n\n/** Sync pull response. */\nexport interface SyncPullResponse {\n  data: {\n    changes: PulledChange[];\n    current_version: number;\n    has_more: boolean;\n  };\n}\n\n/** Resolve conflict request body. POST /v1/sync/conflicts/:id/resolve */\nexport interface ResolveConflictRequest {\n  resolution: SyncResolution;\n  merged_data?: Record<string, unknown>;\n}\n\nexport const ResolveConflictRequestSchema = z.object({\n  resolution: z.enum(SYNC_RESOLUTIONS),\n  merged_data: z.record(z.unknown()).optional(),\n});\n\n/** Resolve conflict response. */\nexport interface ResolveConflictResponse {\n  data: {\n    resolved: boolean;\n    final_version: number;\n    final_data: Record<string, unknown>;\n  };\n}\n\n/** Full sync request body (recovery). POST /v1/sync/full */\nexport interface FullSyncRequest {\n  reason: FullSyncReason;\n}\n\nexport const FullSyncRequestSchema = z.object({\n  reason: z.enum(FULL_SYNC_REASONS),\n});\n\n/** Full sync response (initiates async full sync job). */\nexport interface FullSyncResponse {\n  data: {\n    job_id: string;\n    status: 'initiated';\n    estimated_time_seconds: number;\n  };\n}\n\n// ============================================================\n// SETTINGS ENDPOINTS\n// ============================================================\n\n/** Agent permissions configuration. */\nexport interface AgentPermissions {\n  can_write: boolean;\n  can_auto_operations: boolean;\n  can_delete: boolean;\n  can_bulk_operations: boolean;\n}\n\nexport const AgentPermissionsSchema = z.object({\n  can_write: z.boolean(),\n  can_auto_operations: z.boolean(),\n  can_delete: z.boolean(),\n  can_bulk_operations: z.boolean(),\n});\n\n/** Notification settings. */\nexport interface NotificationSettings {\n  daily_summary: boolean;\n  sync_alerts: boolean;\n  agent_suggestions: AgentSuggestionLevel;\n}\n\nexport const NotificationSettingsSchema = z.object({\n  daily_summary: z.boolean(),\n  sync_alerts: z.boolean(),\n  agent_suggestions: z.enum(AGENT_SUGGESTION_LEVELS),\n});\n\n/** User preferences. */\nexport interface UserPreferences {\n  theme: ThemeOption;\n  language: string;\n  working_memory_hours: number;\n}\n\nexport const UserPreferencesSchema = z.object({\n  theme: z.enum(THEME_OPTIONS),\n  language: z.string(),\n  working_memory_hours: z.number().int().positive(),\n});\n\n/** User settings response. GET /v1/settings */\nexport interface UserSettingsResponse {\n  data: {\n    tier: UserTier;\n    privacy_tier: PrivacyTier;\n    agent_permissions: AgentPermissions;\n    notifications: NotificationSettings;\n    preferences: UserPreferences;\n    api_keys: APIKeyDisplayInfo[];\n  };\n}\n\n/** Update settings request body. PATCH /v1/settings */\nexport interface UpdateSettingsRequest {\n  agent_permissions?: Partial<AgentPermissions>;\n  notifications?: Partial<NotificationSettings>;\n  preferences?: Partial<UserPreferences>;\n}\n\nexport const UpdateSettingsRequestSchema = z.object({\n  agent_permissions: z.object({\n    can_write: z.boolean().optional(),\n    can_auto_operations: z.boolean().optional(),\n    can_delete: z.boolean().optional(),\n    can_bulk_operations: z.boolean().optional(),\n  }).optional(),\n  notifications: z.object({\n    daily_summary: z.boolean().optional(),\n    sync_alerts: z.boolean().optional(),\n    agent_suggestions: z.enum(AGENT_SUGGESTION_LEVELS).optional(),\n  }).optional(),\n  preferences: z.object({\n    theme: z.enum(THEME_OPTIONS).optional(),\n    language: z.string().optional(),\n    working_memory_hours: z.number().int().positive().optional(),\n  }).optional(),\n});\n\n/** Create API key request body. POST /v1/settings/api-keys */\nexport interface CreateAPIKeyRequest {\n  name: string;\n  scope: ApiKeyScope;\n}\n\nexport const CreateAPIKeyRequestSchema = z.object({\n  name: z.string().min(1),\n  scope: z.enum(API_KEY_SCOPES),\n});\n\n/**\n * Create API key response (201).\n * The `key` field contains the full API key and is shown ONLY ONCE.\n */\nexport interface CreateAPIKeyResponse {\n  data: {\n    id: string;\n    name: string;\n    key: string;\n    scope: ApiKeyScope;\n    created_at: string;\n  };\n}\n\n// ============================================================\n// CREDITS ENDPOINTS\n// ============================================================\n\n/** Credit balance response. GET /v1/credits */\nexport interface CreditBalanceResponse {\n  data: {\n    balance: number;\n    tier: UserTier;\n    daily_budget: number | null;\n    daily_usage: number;\n    free_credits_remaining: number;\n    last_purchase?: string;\n  };\n}\n\n/** Usage by day entry. */\nexport interface UsageByDay {\n  date: string;\n  amount: number;\n}\n\nexport const UsageByDaySchema = z.object({\n  date: z.string(),\n  amount: z.number().min(0),\n});\n\n/** Credit usage response. GET /v1/credits/usage */\nexport interface CreditUsageResponse {\n  data: {\n    total: number;\n    by_operation: Record<CreditOperation, number>;\n    by_day: UsageByDay[];\n  };\n}\n\n/** Cost estimate request body. POST /v1/credits/estimate */\nexport interface CostEstimateRequest {\n  operation: string;\n  params: {\n    message_length?: number;\n    expected_retrieval?: number;\n    complexity?: string;\n  };\n}\n\nexport const CostEstimateRequestSchema = z.object({\n  operation: z.string(),\n  params: z.object({\n    message_length: z.number().int().positive().optional(),\n    expected_retrieval: z.number().int().min(0).optional(),\n    complexity: z.string().optional(),\n  }),\n});\n\n/** Cost estimate response. */\nexport interface CostEstimateResponse {\n  data: {\n    estimated_cost: {\n      min: number;\n      expected: number;\n      max: number;\n    };\n    breakdown: {\n      embedding: number;\n      retrieval: number;\n      llm_input: number;\n      llm_output: number;\n    };\n    sufficient_balance: boolean;\n  };\n}\n\n// ============================================================\n// DATA FLOW TYPES\n// ============================================================\n\n/** A single step in a data flow pipeline. */\nexport interface FlowStep {\n  name: string;\n  service: string;\n  description: string;\n}\n\nexport const FlowStepSchema = z.object({\n  name: z.string(),\n  service: z.string(),\n  description: z.string(),\n});\n\n/** Represents a running data flow instance for observability. */\nexport interface FlowExecution {\n  flow_type: FlowType;\n  request_id: string;\n  current_step: string;\n  started_at: number;\n  steps_completed: string[];\n  error?: string;\n}\n\nexport const FlowExecutionSchema = z.object({\n  flow_type: z.enum(FLOW_TYPES),\n  request_id: z.string(),\n  current_step: z.string(),\n  started_at: z.number().int(),\n  steps_completed: z.array(z.string()),\n  error: z.string().optional(),\n});\n","/**\n * @module @nous/core/api\n * @description Error creation and formatting — extended API errors, validation errors, content limit errors\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Pure functions for creating structured error responses.\n * Extends storm-026's base ApiErrorResponse with retry_after, docs_url, and field-level validation.\n *\n * Error response variants:\n * 1. Standard error — code, message, request_id, docs_url\n * 2. Rate limit 429 — adds retry_after, limit, remaining, window, reset_at\n * 3. Validation error — adds details.fields[] with per-field errors\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/error-handling.ts} - Spec\n */\n\nimport type { ApiErrorCode } from './constants';\nimport type {\n  ApiErrorResponseExtended,\n  ValidationFieldError,\n  ContentLimitsInfo,\n} from './types';\n\nimport { API_ERROR_CODES, CONTENT_LIMITS } from './constants';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Get the HTTP status code for an API error code.\n *\n * @param code - One of the 17 API error codes\n * @returns HTTP status code (400, 401, 403, 404, 409, 422, 429, 500, 502, 503)\n */\nexport function getHttpStatusForErrorCode(code: ApiErrorCode): number {\n  return API_ERROR_CODES[code].status;\n}\n\n/**\n * Get the documentation URL for an error code.\n *\n * @param code - API error code\n * @returns URL to the error documentation page\n */\nexport function getDocsUrl(code: ApiErrorCode): string {\n  return `https://docs.nous.app/errors/${code}`;\n}\n\n/**\n * Get the content size limits for node creation/update validation.\n *\n * @returns Content limits reference with title, body_soft, body_hard, summary\n */\nexport function getContentLimits(): ContentLimitsInfo {\n  return {\n    title: CONTENT_LIMITS.title,\n    body_soft: CONTENT_LIMITS.body_soft,\n    body_hard: CONTENT_LIMITS.body_hard,\n    summary: CONTENT_LIMITS.summary,\n  };\n}\n\n/**\n * Create an extended API error response with optional rate-limit and retry fields.\n *\n * @param code - API error code\n * @param message - Human-readable error message\n * @param options - Optional fields: request_id, retry_after, docs_url override\n * @returns Structured error response\n */\nexport function createExtendedApiError(\n  code: ApiErrorCode,\n  message: string,\n  options?: {\n    request_id?: string;\n    retry_after?: number;\n    details?: Record<string, unknown>;\n    docs_url?: string;\n  },\n): ApiErrorResponseExtended {\n  return {\n    code,\n    message,\n    request_id: options?.request_id ?? '',\n    retry_after: options?.retry_after,\n    details: options?.details,\n    docs_url: options?.docs_url ?? getDocsUrl(code),\n  };\n}\n\n/**\n * Create a VALIDATION_ERROR response with field-level error details.\n *\n * @param fields - Array of field validation errors\n * @param requestId - Optional request ID for tracing\n * @returns Structured validation error response\n */\nexport function createValidationError(\n  fields: ValidationFieldError[],\n  requestId?: string,\n): ApiErrorResponseExtended {\n  return createExtendedApiError('VALIDATION_ERROR', API_ERROR_CODES.VALIDATION_ERROR.message, {\n    request_id: requestId,\n    details: { fields },\n  });\n}\n\n/**\n * Create a CONTENT_LIMIT_EXCEEDED error for a specific field.\n *\n * @param field - Field name that exceeded the limit (e.g., 'content.title')\n * @param limit - The limit that was exceeded\n * @param actual - The actual size of the content\n * @param requestId - Optional request ID for tracing\n * @returns Structured content limit error response\n */\nexport function createContentLimitError(\n  field: string,\n  limit: number,\n  actual: number,\n  requestId?: string,\n): ApiErrorResponseExtended {\n  return createExtendedApiError(\n    'CONTENT_LIMIT_EXCEEDED',\n    API_ERROR_CODES.CONTENT_LIMIT_EXCEEDED.message,\n    {\n      request_id: requestId,\n      details: {\n        field,\n        limit,\n        actual,\n        limits: getContentLimits(),\n      },\n    },\n  );\n}\n\n/**\n * Create a BATCH_SIZE_EXCEEDED error.\n *\n * @param maxSize - Maximum allowed batch size\n * @param actualSize - Actual batch size submitted\n * @param requestId - Optional request ID for tracing\n * @returns Structured batch size error response\n */\nexport function createBatchSizeError(\n  maxSize: number,\n  actualSize: number,\n  requestId?: string,\n): ApiErrorResponseExtended {\n  return createExtendedApiError(\n    'BATCH_SIZE_EXCEEDED',\n    API_ERROR_CODES.BATCH_SIZE_EXCEEDED.message,\n    {\n      request_id: requestId,\n      details: {\n        max_size: maxSize,\n        actual_size: actualSize,\n      },\n    },\n  );\n}\n","/**\n * @module @nous/core/api\n * @description Pagination helpers — cursor and offset normalization, result creation\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Pure functions for normalizing pagination parameters and creating pagination results.\n *\n * Two pagination strategies:\n * - Cursor-based: For sync/lists (consistent during concurrent writes)\n * - Offset-based: For search results (familiar jump-to-page UX)\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/pagination.ts} - Spec\n */\n\nimport type {\n  CursorPaginationRequest,\n  CursorPaginationResponse,\n  OffsetPaginationRequest,\n  OffsetPaginationResponse,\n} from './types';\n\nimport {\n  CURSOR_PAGINATION_DEFAULT_LIMIT,\n  CURSOR_PAGINATION_MAX_LIMIT,\n  OFFSET_PAGINATION_DEFAULT_LIMIT,\n  OFFSET_PAGINATION_MAX_LIMIT,\n} from './constants';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Normalize and clamp cursor pagination parameters.\n * Applies defaults and enforces max limits.\n *\n * @param params - Raw pagination params from request\n * @returns Normalized params with valid limit\n */\nexport function normalizeCursorParams(params: Partial<CursorPaginationRequest>): CursorPaginationRequest {\n  const limit = params.limit !== undefined\n    ? Math.min(Math.max(1, params.limit), CURSOR_PAGINATION_MAX_LIMIT)\n    : CURSOR_PAGINATION_DEFAULT_LIMIT;\n\n  return {\n    cursor: params.cursor,\n    limit,\n  };\n}\n\n/**\n * Normalize and clamp offset pagination parameters.\n * Applies defaults and enforces max limits.\n *\n * @param params - Raw pagination params from request\n * @returns Normalized params with valid offset and limit\n */\nexport function normalizeOffsetParams(params: Partial<OffsetPaginationRequest>): OffsetPaginationRequest {\n  const offset = params.offset !== undefined\n    ? Math.max(0, params.offset)\n    : 0;\n\n  const limit = params.limit !== undefined\n    ? Math.min(Math.max(1, params.limit), OFFSET_PAGINATION_MAX_LIMIT)\n    : OFFSET_PAGINATION_DEFAULT_LIMIT;\n\n  return {\n    offset,\n    limit,\n  };\n}\n\n/**\n * Create a cursor pagination response from a list of items.\n *\n * The cursor is opaque to the client (base64-encoded).\n * `has_more` is true when items.length === limit (more items may exist).\n *\n * @param items - Items returned from the query\n * @param limit - The limit that was applied\n * @param currentCursor - The cursor from the request (null for first page)\n * @param total - Optional total count (expensive to compute, omit if not needed)\n * @returns Cursor pagination metadata\n */\nexport function createCursorPaginationResponse(\n  items: unknown[],\n  limit: number,\n  currentCursor: string | null,\n  total?: number,\n): CursorPaginationResponse {\n  const hasMore = items.length >= limit;\n\n  return {\n    cursor: currentCursor,\n    next_cursor: hasMore && items.length > 0 ? encodeCursor(items.length) : null,\n    has_more: hasMore,\n    limit,\n    total,\n  };\n}\n\n/**\n * Create an offset pagination response.\n *\n * @param offset - The offset that was applied\n * @param limit - The limit that was applied\n * @param total - Total count of matching items\n * @returns Offset pagination metadata\n */\nexport function createOffsetPaginationResponse(\n  offset: number,\n  limit: number,\n  total: number,\n): OffsetPaginationResponse {\n  return {\n    offset,\n    limit,\n    total,\n    has_more: offset + limit < total,\n  };\n}\n\n// ============================================================\n// INTERNAL HELPERS\n// ============================================================\n\n/**\n * Encode a cursor position as base64 (opaque to the client).\n */\nfunction encodeCursor(position: number): string {\n  return btoa(String(position));\n}\n","/**\n * @module @nous/core/api\n * @description Rate limiting pure functions and data — tier ranking, Redis key building, retry calculation\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Pure functions for the rate limiting system. These operate on data structures\n * defined in types.ts. Actual Redis I/O happens in the application layer via\n * the RateLimitRedisOps interface.\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/rate-limiting.ts} - Spec\n */\n\nimport type { UserTier } from './constants';\nimport type { RateLimitResult, RateLimitHeaders } from './types';\n\n// ============================================================\n// TIER TRANSITION\n// ============================================================\n\n/**\n * Tier rank mapping for upgrade/downgrade detection.\n * Higher rank = higher tier. Used to determine tier transition behavior:\n * - Upgrade (rank increases): Apply new higher limits immediately\n * - Downgrade (rank decreases): Wait for current window to reset\n */\nexport const TIER_RANKS: Record<UserTier, number> = {\n  free: 0,\n  api_key: 1,\n  credits: 2,\n  pro: 3,\n};\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Get the numeric rank for a user tier.\n * Used for upgrade/downgrade comparison.\n *\n * @param tier - User tier\n * @returns Numeric rank (0 = lowest, 3 = highest)\n *\n * @example\n * ```typescript\n * tierRank('pro')     // 3\n * tierRank('free')    // 0\n * tierRank('pro') > tierRank('free') // true (upgrade)\n * ```\n */\nexport function tierRank(tier: UserTier): number {\n  return TIER_RANKS[tier];\n}\n\n/**\n * Build a Redis key from a pattern by substituting placeholders.\n *\n * @param pattern - Key pattern with `{placeholder}` syntax\n * @param params - Values to substitute\n * @returns Fully resolved Redis key\n *\n * @example\n * ```typescript\n * buildRedisKey('ratelimit:api:{user_id}', { user_id: 'user_123' })\n * // => 'ratelimit:api:user_123'\n * ```\n */\nexport function buildRedisKey(pattern: string, params: Record<string, string>): string {\n  let key = pattern;\n  for (const [name, value] of Object.entries(params)) {\n    key = key.replace(`{${name}}`, value);\n  }\n  return key;\n}\n\n/**\n * Calculate retry_after for a sliding window that is full.\n * Returns the number of seconds until the oldest request in the window expires.\n *\n * @param windowMs - Window duration in milliseconds\n * @param oldestTimestamp - Oldest request timestamp in the window (ms since epoch)\n * @returns Seconds to wait before retrying\n */\nexport function calculateRetryAfter(windowMs: number, oldestTimestamp: number): number {\n  const now = Date.now();\n  const expiresAt = oldestTimestamp + windowMs;\n  const retryMs = Math.max(0, expiresAt - now);\n  return Math.ceil(retryMs / 1000);\n}\n\n/**\n * Calculate retry_after for a token bucket that is empty.\n * Returns the number of seconds until enough tokens are refilled.\n *\n * @param tokensNeeded - Number of tokens needed\n * @param refillRate - Tokens per second\n * @returns Seconds to wait before retrying\n */\nexport function calculateTokenBucketRetryAfter(tokensNeeded: number, refillRate: number): number {\n  if (refillRate <= 0) return 60; // Safety fallback\n  return Math.ceil(tokensNeeded / refillRate);\n}\n\n/**\n * Format rate limit response headers from a check result.\n *\n * @param result - Rate limit check result\n * @param windowSeconds - Window duration in seconds (default 60)\n * @returns Headers object to merge into HTTP response\n */\nexport function formatRateLimitHeaders(result: RateLimitResult, windowSeconds: number = 60): RateLimitHeaders {\n  const headers: RateLimitHeaders = {\n    'X-RateLimit-Limit': result.limit,\n    'X-RateLimit-Remaining': result.remaining,\n    'X-RateLimit-Reset': Math.floor(new Date(result.reset_at).getTime() / 1000),\n    'X-RateLimit-Window': windowSeconds,\n  };\n\n  if (!result.allowed && result.retry_after !== undefined) {\n    headers['Retry-After'] = result.retry_after;\n  }\n\n  return headers;\n}\n\n// ============================================================\n// EXTERNAL STUBS (I/O-BOUND)\n// ============================================================\n\n/**\n * Check rate limit for a request (orchestrates all limit checks).\n *\n * **EXTERNAL STUB** — requires Redis client and database access.\n *\n * @param _userId - User ID\n * @param _tier - User tier from JWT/API key\n * @param _endpoint - Request endpoint (e.g. 'POST /v1/chat')\n * @returns Most restrictive rate limit result\n */\nexport function checkRateLimit(\n  _userId: string,\n  _tier: UserTier,\n  _endpoint: string\n): Promise<RateLimitResult> {\n  throw new Error('checkRateLimit: External stub — implement in application layer');\n}\n\n/**\n * Get user tier with caching for tier transition detection.\n *\n * **EXTERNAL STUB** — requires database access.\n *\n * @param _userId - User ID\n * @param _cacheTtlSeconds - Cache TTL (default 60s)\n * @returns Current user tier from database\n */\nexport function getTierWithCache(\n  _userId: string,\n  _cacheTtlSeconds: number = 60\n): Promise<UserTier> {\n  throw new Error('getTierWithCache: External stub — implement in application layer');\n}\n","/**\n * @module @nous/core/api\n * @description Auth context extraction — JWT claims parsing, API key detection, token expiry check\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Pure functions for extracting authentication context from JWT tokens and API keys.\n *\n * Dual auth modes:\n * - JWT (Clerk): 15-minute access token, 30-day refresh. Contains tier + privacy in metadata.\n * - API Key: Prefixed with `sk_live_` or `sk_test_`. Separate rate bucket (api_key tier).\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/auth-middleware.ts} - Spec\n */\n\nimport type { AuthContext, JWTClaims } from './types';\nimport { API_KEY_PREFIX_LIVE, API_KEY_PREFIX_TEST } from './constants';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Extract an AuthContext from validated JWT claims.\n *\n * Called after the JWT has been validated by Clerk. Extracts\n * user ID, tier, and privacy tier from the token claims.\n *\n * @param claims - Validated JWT claims from Clerk\n * @returns AuthContext for route handlers\n */\nexport function extractAuthContextFromJWT(claims: JWTClaims): AuthContext {\n  return {\n    user_id: claims.sub,\n    tier: claims.metadata.tier,\n    privacy_tier: claims.metadata.privacy,\n    auth_method: 'jwt',\n  };\n}\n\n/**\n * Check if a token string is an API key (starts with sk_live_ or sk_test_).\n *\n * @param token - Raw token from the Authorization header\n * @returns true if the token is an API key\n */\nexport function isApiKeyToken(token: string): boolean {\n  return token.startsWith(API_KEY_PREFIX_LIVE) || token.startsWith(API_KEY_PREFIX_TEST);\n}\n\n/**\n * Check if a JWT token has expired.\n *\n * @param claims - JWT claims (only needs `exp` field)\n * @returns true if the token's exp timestamp is in the past\n */\nexport function isTokenExpired(claims: Pick<JWTClaims, 'exp'>): boolean {\n  return claims.exp * 1000 < Date.now();\n}\n\n// ============================================================\n// EXTERNAL STUBS (I/O-BOUND)\n// ============================================================\n\n/**\n * Validate an auth token (JWT or API key) and return the AuthContext.\n *\n * **EXTERNAL STUB** — requires Clerk SDK or database access for API key validation.\n *\n * @param _token - Raw token from the Authorization header\n * @returns AuthContext extracted from the validated token\n */\nexport function validateAuthToken(_token: string): Promise<AuthContext> {\n  throw new Error('validateAuthToken: External stub — implement in application layer');\n}\n","/**\n * @module @nous/core/api\n * @description Chat SSE event formatting — event serialization, reconnection validation, event IDs\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Pure functions for Server-Sent Events (SSE) in the chat endpoint.\n *\n * SSE event types (10):\n * session_start -> retrieval_start -> retrieval_node (xN) -> retrieval_complete\n *   -> response_start -> response_chunk (xN) -> response_complete -> done\n * Plus: ping (keepalive every 15s), session_expired (reconnection too late)\n *\n * Reconnection: Client sends Last-Event-ID header. Server resumes if within 5-minute window.\n *\n * Chat SSE runs on regional containers (120s max), NOT edge workers (25s max from storm-026).\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/sse-chat.ts} - Spec\n */\n\nimport type { ChatSSEEventType } from './constants';\nimport { CHAT_SSE_RECONNECT_WINDOW_MS } from './constants';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Format a chat SSE event for transmission over the wire.\n *\n * SSE wire format:\n * ```\n * event: <type>\n * id: <eventId>\n * data: <JSON>\n *\n * ```\n *\n * @param eventType - One of the 10 chat SSE event types\n * @param data - Event payload (will be JSON.stringify'd)\n * @param eventId - Unique event ID for reconnection support\n * @returns SSE-formatted string ready to write to response stream\n */\nexport function formatChatSSEEvent(\n  eventType: ChatSSEEventType,\n  data: unknown,\n  eventId: string,\n): string {\n  return `event: ${eventType}\\nid: ${eventId}\\ndata: ${JSON.stringify(data)}\\n\\n`;\n}\n\n/**\n * Check if a reconnection attempt is within the allowed time window.\n *\n * When a client reconnects with a Last-Event-ID, the server checks if the\n * original session is still within the reconnection window (default 5 minutes).\n *\n * @param lastEventTimestamp - Timestamp (ms since epoch) of the last event sent\n * @param windowMs - Reconnection window in milliseconds (default: CHAT_SSE_RECONNECT_WINDOW_MS = 300,000)\n * @returns true if the reconnection is within the allowed window\n */\nexport function isReconnectionValid(\n  lastEventTimestamp: number,\n  windowMs: number = CHAT_SSE_RECONNECT_WINDOW_MS,\n): boolean {\n  return Date.now() - lastEventTimestamp < windowMs;\n}\n\n/**\n * Generate a sequential event ID for SSE events.\n *\n * Format: `{prefix}_{sequence}` where sequence is zero-padded to 3 digits.\n *\n * @param prefix - Session prefix (e.g., session ID)\n * @param sequence - Sequential event number (0-indexed)\n * @returns Event ID string (e.g., \"sess_abc_001\")\n */\nexport function generateEventId(prefix: string, sequence: number): string {\n  return `${prefix}_${sequence.toString().padStart(3, '0')}`;\n}\n","/**\n * @module @nous/core/api\n * @description Request body validation — Zod-based validators for API endpoint request bodies\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Validation functions that parse request bodies using Zod schemas from types.ts.\n * Returns typed, validated data or throws a ZodError.\n *\n * These are thin wrappers around Zod's `.parse()` — the schemas do the real work.\n * The validators provide a clean API surface and can be used in route handlers.\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/types.ts} - Schema definitions\n */\n\nimport type {\n  CreateNodeRequest,\n  UpdateNodeRequest,\n  BatchCreateNodesRequest,\n  CreateEdgeRequest,\n  UpdateEdgeRequest,\n  ChatRequest,\n  ExecuteActionRequest,\n  IngestTextRequest,\n  SyncPushRequest,\n  ResolveConflictRequest,\n  FullSyncRequest,\n  UpdateSettingsRequest,\n  CreateAPIKeyRequest,\n  CostEstimateRequest,\n  AdvancedSearchRequest,\n} from './types';\n\nimport {\n  CreateNodeRequestSchema,\n  UpdateNodeRequestSchema,\n  BatchCreateNodesRequestSchema,\n  CreateEdgeRequestSchema,\n  UpdateEdgeRequestSchema,\n  ChatRequestSchema,\n  ExecuteActionRequestSchema,\n  IngestTextRequestSchema,\n  SyncPushRequestSchema,\n  ResolveConflictRequestSchema,\n  FullSyncRequestSchema,\n  UpdateSettingsRequestSchema,\n  CreateAPIKeyRequestSchema,\n  CostEstimateRequestSchema,\n  AdvancedSearchRequestSchema,\n} from './types';\n\n// ============================================================\n// NODE VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/nodes request body. */\nexport function validateCreateNodeRequest(data: unknown): CreateNodeRequest {\n  return CreateNodeRequestSchema.parse(data);\n}\n\n/** Validate a PATCH /v1/nodes/:id request body. */\nexport function validateUpdateNodeRequest(data: unknown): UpdateNodeRequest {\n  return UpdateNodeRequestSchema.parse(data);\n}\n\n/** Validate a POST /v1/nodes/batch request body. */\nexport function validateBatchCreateNodesRequest(data: unknown): BatchCreateNodesRequest {\n  return BatchCreateNodesRequestSchema.parse(data);\n}\n\n// ============================================================\n// EDGE VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/edges request body. */\nexport function validateCreateEdgeRequest(data: unknown): CreateEdgeRequest {\n  return CreateEdgeRequestSchema.parse(data);\n}\n\n/** Validate a PATCH /v1/edges/:id request body. */\nexport function validateUpdateEdgeRequest(data: unknown): UpdateEdgeRequest {\n  return UpdateEdgeRequestSchema.parse(data);\n}\n\n// ============================================================\n// SEARCH VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/search request body. */\nexport function validateAdvancedSearchRequest(data: unknown): AdvancedSearchRequest {\n  return AdvancedSearchRequestSchema.parse(data);\n}\n\n// ============================================================\n// CHAT VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/chat request body. */\nexport function validateChatRequest(data: unknown): ChatRequest {\n  return ChatRequestSchema.parse(data);\n}\n\n// ============================================================\n// AGENT VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/agent/actions request body. */\nexport function validateExecuteActionRequest(data: unknown): ExecuteActionRequest {\n  return ExecuteActionRequestSchema.parse(data);\n}\n\n// ============================================================\n// INGESTION VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/ingest request body. */\nexport function validateIngestTextRequest(data: unknown): IngestTextRequest {\n  return IngestTextRequestSchema.parse(data);\n}\n\n// ============================================================\n// SYNC VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/sync/push request body. */\nexport function validateSyncPushRequest(data: unknown): SyncPushRequest {\n  return SyncPushRequestSchema.parse(data);\n}\n\n/** Validate a POST /v1/sync/conflicts/:id/resolve request body. */\nexport function validateResolveConflictRequest(data: unknown): ResolveConflictRequest {\n  return ResolveConflictRequestSchema.parse(data);\n}\n\n/** Validate a POST /v1/sync/full request body. */\nexport function validateFullSyncRequest(data: unknown): FullSyncRequest {\n  return FullSyncRequestSchema.parse(data);\n}\n\n// ============================================================\n// SETTINGS VALIDATORS\n// ============================================================\n\n/** Validate a PATCH /v1/settings request body. */\nexport function validateUpdateSettingsRequest(data: unknown): UpdateSettingsRequest {\n  return UpdateSettingsRequestSchema.parse(data);\n}\n\n/** Validate a POST /v1/settings/api-keys request body. */\nexport function validateCreateAPIKeyRequest(data: unknown): CreateAPIKeyRequest {\n  return CreateAPIKeyRequestSchema.parse(data);\n}\n\n// ============================================================\n// CREDITS VALIDATORS\n// ============================================================\n\n/** Validate a POST /v1/credits/estimate request body. */\nexport function validateCostEstimateRequest(data: unknown): CostEstimateRequest {\n  return CostEstimateRequestSchema.parse(data);\n}\n","/**\n * @module @nous/core/api\n * @description Data flow pipeline definitions — Chat, Sync, Ingestion flow steps\n * @version 1.0.0\n * @spec Specs/Phase-7-Backend-API/storm-023\n * @storm Brainstorms/Infrastructure/storm-023-api-data-flow\n *\n * Defines the three main data flow pipelines documented in the brainstorm:\n * 1. Chat/Query Flow: Auth -> Credits -> Classify -> Embed -> Search -> SSA -> LLM -> Store\n * 2. Sync Flow: Status -> Push -> Conflict Detection -> Apply -> Resolve -> Pull\n * 3. Ingestion Flow: Receive -> Classify -> Route -> Process -> Embed -> Dedup -> Commit\n *\n * Source: storm-023 v2 brainstorm, \"Data Flow Diagrams\" section.\n *\n * @see {@link Specs/Phase-7-Backend-API/storm-023/spec/data-flows.ts} - Spec\n */\n\nimport type { FlowStep, FlowExecution } from './types';\nimport type { FlowType } from './constants';\n\n// ============================================================\n// CHAT FLOW STEPS\n// ============================================================\n\n/**\n * Complete Chat/Query Flow pipeline (9 steps).\n *\n * ```\n * Mobile App -> API Gateway -> Services\n * 1. Validate JWT              (Auth)\n * 2. Check credits             (Credits)\n * 3. Classify query            (Classifier — storm-008)\n * 4. Embed query               (Embedding — storm-016)\n * 5. Hybrid search             (Turso — Vector + BM25)\n * 6. SSA expansion             (Graph — storm-005)\n * 7. LLM call (streaming)      (LLM Provider — storm-015)\n * 8. Deduct actual cost        (Credits)\n * 9. Store conversation        (Turso)\n * ```\n */\nexport const CHAT_FLOW_STEPS: readonly FlowStep[] = [\n  { name: 'validate_auth', service: 'Auth', description: 'Validate JWT/API key' },\n  { name: 'check_credits', service: 'Credits', description: 'Verify sufficient balance' },\n  { name: 'classify_query', service: 'Classifier', description: 'Determine query type (storm-008)' },\n  { name: 'embed_query', service: 'Embedding', description: 'Generate query embedding (storm-016)' },\n  { name: 'hybrid_search', service: 'Turso', description: 'Vector + BM25 search (storm-016)' },\n  { name: 'ssa_expansion', service: 'Graph', description: 'Spreading activation (storm-005)' },\n  { name: 'llm_call', service: 'LLM Provider', description: 'Stream response (storm-015)' },\n  { name: 'deduct_cost', service: 'Credits', description: 'Deduct actual cost' },\n  { name: 'store_conversation', service: 'Turso', description: 'Persist conversation' },\n] as const;\n\n// ============================================================\n// SYNC FLOW STEPS\n// ============================================================\n\n/**\n * Complete Sync Flow pipeline (6 steps).\n *\n * ```\n * Mobile App -> API Gateway -> Turso Cloud\n * 1. Check status              (Turso)\n * 2. Push changes              (Turso)\n * 3. Detect conflicts          (NSE — storm-033)\n * 4. Apply non-conflicting     (Turso)\n * 5. Resolve conflicts         (NSE + User — storm-033)\n * 6. Pull changes              (Turso)\n * ```\n */\nexport const SYNC_FLOW_STEPS: readonly FlowStep[] = [\n  { name: 'check_status', service: 'Turso', description: 'Get current sync state' },\n  { name: 'push_changes', service: 'Turso', description: 'Send local changes to server' },\n  { name: 'detect_conflicts', service: 'NSE', description: 'Check for concurrent edits (storm-033)' },\n  { name: 'apply_nonconflicting', service: 'Turso', description: 'Apply clean changes' },\n  { name: 'resolve_conflicts', service: 'NSE + User', description: 'Auto-merge or user resolution' },\n  { name: 'pull_changes', service: 'Turso', description: 'Fetch remote changes since last sync' },\n] as const;\n\n// ============================================================\n// INGESTION FLOW STEPS\n// ============================================================\n\n/**\n * Complete Ingestion Flow pipeline (8 steps).\n *\n * ```\n * Mobile App -> API Gateway -> Services\n * 1. Receive                   (Adapter — storm-014 stage 1)\n * 2. Classify                  (Classifier — storm-014 stage 2)\n * 3. Route                     (Router — select handler)\n * 4. Process                   (Extractor — extract concepts)\n * 5. Stage: Embed              (Embedding — storm-016)\n * 6. Stage: Dedup              (Turso — check duplicates)\n * 7. Commit: Nodes             (Turso — create records)\n * 8. Commit: Edges             (Graph — create edges)\n * ```\n */\nexport const INGESTION_FLOW_STEPS: readonly FlowStep[] = [\n  { name: 'receive', service: 'Adapter', description: 'Normalize input (storm-014 stage 1)' },\n  { name: 'classify', service: 'Classifier', description: 'Intent + save signal (storm-014 stage 2)' },\n  { name: 'route', service: 'Router', description: 'Select handler based on classification' },\n  { name: 'process', service: 'Extractor', description: 'Extract concepts if content type' },\n  { name: 'stage_embed', service: 'Embedding', description: 'Generate embeddings (storm-016)' },\n  { name: 'stage_dedup', service: 'Turso', description: 'Check for duplicates' },\n  { name: 'commit_nodes', service: 'Turso', description: 'Create node records' },\n  { name: 'commit_edges', service: 'Graph', description: 'Create edge records' },\n] as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Get flow step definitions for a given flow type.\n *\n * @param flowType - One of 'chat', 'sync', 'ingestion'\n * @returns Array of flow steps for the specified flow\n */\nexport function getFlowSteps(flowType: FlowType): readonly FlowStep[] {\n  switch (flowType) {\n    case 'chat':\n      return CHAT_FLOW_STEPS;\n    case 'sync':\n      return SYNC_FLOW_STEPS;\n    case 'ingestion':\n      return INGESTION_FLOW_STEPS;\n  }\n}\n\n/**\n * Create a new flow execution tracker.\n *\n * @param flowType - Flow type to track\n * @param requestId - Unique request ID for this execution\n * @returns A new FlowExecution instance starting at step 0\n */\nexport function createFlowExecution(flowType: FlowType, requestId: string): FlowExecution {\n  const steps = getFlowSteps(flowType);\n  const firstStep = steps[0];\n  return {\n    flow_type: flowType,\n    request_id: requestId,\n    current_step: firstStep ? firstStep.name : '',\n    started_at: Date.now(),\n    steps_completed: [],\n  };\n}\n"]}