{"version":3,"sources":["../../src/security/constants.ts","../../src/security/types.ts","../../src/security/auth.ts","../../src/security/tiers.ts","../../src/security/encryption.ts","../../src/security/keys.ts","../../src/security/recovery.ts","../../src/security/consent.ts","../../src/security/api-keys.ts","../../src/security/compliance.ts","../../src/security/offline.ts"],"names":["z"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @module @nous/core/security\n * @description Constants for Nous Security Layer (NSL)\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * All security constants, enums, crypto parameters, thresholds, and configuration\n * defaults for the two-tier privacy model. These values come from storm-022 v2\n * revision and should not be changed without updating the brainstorm.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/Index} - Spec overview\n * @see {@link Brainstorms/Infrastructure/storm-022-security-auth/_SESSION} - Brainstorm\n */\n\nimport { z } from 'zod';\n\n// ============================================================\n// PRIVACY TIERS\n// ============================================================\n\n/**\n * Two-tier privacy model.\n *\n * - **standard:** Server-managed encryption (Turso AES-256 at-rest), full cloud search, seamless LLM\n * - **private:** Full E2E encryption (AES-256-GCM client-side), client-side HNSW search, explicit LLM consent\n *\n * @see storm-022 v1 revision Section 2 - Simplified from 3 tiers to 2\n */\nexport const PRIVACY_TIERS = ['standard', 'private'] as const;\n\nexport type PrivacyTier = (typeof PRIVACY_TIERS)[number];\n\nexport const PrivacyTierSchema = z.enum(PRIVACY_TIERS);\n\n/**\n * Type guard for PrivacyTier.\n */\nexport function isPrivacyTier(value: unknown): value is PrivacyTier {\n  return PRIVACY_TIERS.includes(value as PrivacyTier);\n}\n\n// ============================================================\n// AUTH PROVIDERS\n// ============================================================\n\n/**\n * Supported authentication providers.\n * Clerk recommended for DX, extensible for future providers.\n *\n * @see storm-022 research.md - Auth provider comparison\n */\nexport const AUTH_PROVIDERS = ['clerk'] as const;\n\nexport type AuthProvider = (typeof AUTH_PROVIDERS)[number];\n\nexport const AuthProviderSchema = z.enum(AUTH_PROVIDERS);\n\n/**\n * Supported authentication methods.\n * Sign in with Apple is REQUIRED for iOS if offering social login.\n *\n * @see storm-022 original-prompt.md - User requirements\n */\nexport const AUTH_METHODS = ['apple', 'google', 'email_password'] as const;\n\nexport type AuthMethod = (typeof AUTH_METHODS)[number];\n\nexport const AuthMethodSchema = z.enum(AUTH_METHODS);\n\n// ============================================================\n// PLATFORMS\n// ============================================================\n\n/**\n * Supported platforms.\n * iOS/Android use native Clerk SDKs.\n * macOS/Windows use system browser OAuth with deep links (Tauri).\n *\n * @see storm-022 v1 revision Section 1 - Platform-specific implementation\n */\nexport const PLATFORMS = ['ios', 'android', 'macos', 'windows'] as const;\n\nexport type Platform = (typeof PLATFORMS)[number];\n\nexport const PlatformSchema = z.enum(PLATFORMS);\n\n/**\n * Type guard for Platform.\n */\nexport function isPlatform(value: unknown): value is Platform {\n  return PLATFORMS.includes(value as Platform);\n}\n\n// ============================================================\n// OFFLINE STATES\n// ============================================================\n\n/**\n * Offline authentication states with graceful degradation.\n *\n * - **online:** Full functionality\n * - **short_offline:** <24h, JWT valid, full functionality\n * - **medium_offline:** <7d, JWT expired, read-only + queued writes\n * - **long_offline:** >7d, refresh expired, local only\n * - **reauth_required:** Must reconnect to continue\n *\n * @see storm-022 v1 revision Section 1 - Token Management & Offline States\n */\nexport const OFFLINE_STATES = [\n  'online',\n  'short_offline',\n  'medium_offline',\n  'long_offline',\n  'reauth_required',\n] as const;\n\nexport type OfflineState = (typeof OFFLINE_STATES)[number];\n\nexport const OfflineStateSchema = z.enum(OFFLINE_STATES);\n\n/**\n * Type guard for OfflineState.\n */\nexport function isOfflineState(value: unknown): value is OfflineState {\n  return OFFLINE_STATES.includes(value as OfflineState);\n}\n\n/**\n * Offline state transition thresholds (in hours).\n *\n * @see storm-022 v1 revision Section 1 - updateOfflineState()\n */\nexport const OFFLINE_THRESHOLDS = {\n  /** <24h since last online: JWT still valid, full functionality */\n  short_offline: 24,\n  /** <7d (168h) since last online: JWT expired, read-only + queued writes */\n  medium_offline: 168,\n  /** >7d: refresh token expired, local data only */\n  long_offline: Infinity,\n} as const;\n\n// ============================================================\n// CONSENT SCOPES\n// ============================================================\n\n/**\n * LLM consent scope options for Private tier users.\n *\n * - **per_message:** Every LLM query shows consent dialog (most secure)\n * - **per_conversation:** First query shows dialog; subsequent auto-approved (default)\n * - **time_based:** Consent valid for chosen duration (1h, 24h, 7d)\n * - **topic_based:** \"Remember for similar questions\" using embedding similarity\n *\n * @see storm-022 v2 Section 10.2 - Per-Message vs Per-Session Consent\n */\nexport const CONSENT_SCOPES = [\n  'per_message',\n  'per_conversation',\n  'time_based',\n  'topic_based',\n] as const;\n\nexport type ConsentScope = (typeof CONSENT_SCOPES)[number];\n\nexport const ConsentScopeSchema = z.enum(CONSENT_SCOPES);\n\n/**\n * Type guard for ConsentScope.\n */\nexport function isConsentScope(value: unknown): value is ConsentScope {\n  return CONSENT_SCOPES.includes(value as ConsentScope);\n}\n\n/**\n * Default consent scope for new Private tier users.\n * Per-conversation balances security and UX.\n *\n * @see storm-022 _SESSION.md - Decision: per-session consent default\n */\nexport const DEFAULT_CONSENT_SCOPE: ConsentScope = 'per_conversation';\n\n/**\n * Conversation idle timeout before consent resets (minutes).\n * After 30 min idle, per-conversation consent expires.\n *\n * @see storm-022 v2 Section 10.2 - \"Conversation\" = continuous session, resets after 30 min idle\n */\nexport const CONVERSATION_TIMEOUT_MINUTES = 30;\n\n/**\n * Cosine similarity threshold for topic-based consent matching.\n * Queries with >0.85 similarity to remembered topic are auto-approved.\n *\n * @see storm-022 v2 Section 10.2 - Similarity threshold: 0.85 cosine similarity\n */\nexport const TOPIC_SIMILARITY_THRESHOLD = 0.85;\n\n/**\n * Time-based consent duration options.\n *\n * @see storm-022 v2 Section 10.2 - Time-Based (Convenience)\n */\nexport const CONSENT_DURATIONS = ['1h', '24h', '7d'] as const;\n\nexport type ConsentDuration = (typeof CONSENT_DURATIONS)[number];\n\nexport const ConsentDurationSchema = z.enum(CONSENT_DURATIONS);\n\n// ============================================================\n// CONSENT REVOCATION SCOPES\n// ============================================================\n\n/**\n * Consent revocation granularity options.\n *\n * @see storm-022 v2 Section 10.5 - Consent Revocation Flow\n */\nexport const CONSENT_REVOCATION_SCOPES = [\n  'this_conversation',\n  'all_active',\n  'everything',\n] as const;\n\nexport type ConsentRevocationScope = (typeof CONSENT_REVOCATION_SCOPES)[number];\n\nexport const ConsentRevocationScopeSchema = z.enum(CONSENT_REVOCATION_SCOPES);\n\n// ============================================================\n// ENCRYPTION CONSTANTS\n// ============================================================\n\n/**\n * Encryption algorithm for all E2E operations.\n * AES-256-GCM provides authenticated encryption with associated data.\n *\n * @see storm-022 v1 revision Section 2 - E2E Encryption Design\n */\nexport const ENCRYPTION_ALGORITHM = 'AES-256-GCM';\n\n/**\n * Key derivation function used throughout.\n *\n * @see storm-022 v1 revision Section 3 - Key Hierarchy\n */\nexport const KEY_DERIVATION_FUNCTION = 'HKDF-SHA256';\n\n/**\n * Master key length in bits. Standard for AES-256.\n */\nexport const MASTER_KEY_LENGTH_BITS = 256;\n\n/**\n * AES-GCM nonce length in bytes (96 bits).\n * CRITICAL: Every encryption MUST use a unique nonce. Nonce reuse with same key\n * is catastrophic for AES-GCM security.\n */\nexport const NONCE_LENGTH_BYTES = 12;\n\n/**\n * Derived key purpose strings for HKDF.\n * Each derived key uses a unique purpose string to produce\n * cryptographically independent keys from the same master key.\n *\n * @see storm-022 v1 revision Section 3 - HKDF with purpose strings\n */\nexport const KEY_PURPOSES = ['content', 'embedding', 'metadata'] as const;\n\nexport type KeyPurpose = (typeof KEY_PURPOSES)[number];\n\nexport const KeyPurposeSchema = z.enum(KEY_PURPOSES);\n\n/**\n * HKDF info strings for key derivation.\n * Format: 'nous-{purpose}'\n *\n * @see storm-022 v1 revision Section 3 - HKDF(\"content\"), HKDF(\"embedding\"), HKDF(\"metadata\")\n */\nexport const DERIVATION_INFO_STRINGS: Record<KeyPurpose, string> = {\n  content: 'nous-content',\n  embedding: 'nous-embedding',\n  metadata: 'nous-metadata',\n} as const;\n\n// ============================================================\n// KEY ROTATION CONSTANTS\n// ============================================================\n\n/**\n * Number of nodes processed per re-encryption batch.\n *\n * @see storm-022 v2 Section 9.7 - Batch Re-encryption Strategy\n */\nexport const ROTATION_BATCH_SIZE = 100;\n\n/**\n * Pause between batches to prevent UI jank (milliseconds).\n *\n * @see storm-022 v2 Section 9.7 - RotationConfig\n */\nexport const ROTATION_PAUSE_BETWEEN_BATCHES_MS = 500;\n\n/**\n * Maximum batches per minute (rate limit).\n *\n * @see storm-022 v2 Section 9.7 - RotationConfig\n */\nexport const ROTATION_MAX_BATCHES_PER_MINUTE = 60;\n\n/**\n * Minimum battery level to continue rotation (percentage).\n * Rotation pauses if battery drops below this threshold.\n *\n * @see storm-022 v2 Section 9.7 - RotationConfig\n */\nexport const ROTATION_MIN_BATTERY_LEVEL = 20;\n\n/**\n * Days to retain deprecated key version after rotation.\n * Handles devices that haven't synced yet.\n *\n * @see storm-022 v2 Section 9.3 - \"status: 'deprecated' for old key (kept 30 days for sync lag)\"\n */\nexport const DEPRECATED_KEY_RETENTION_DAYS = 30;\n\n/**\n * Percentage of nodes to sample for post-rotation verification.\n *\n * @see storm-022 v2 Section 9.3 - \"Sample 5% of nodes\"\n */\nexport const ROTATION_VERIFICATION_SAMPLE_PERCENT = 5;\n\n/**\n * Key version lifecycle statuses.\n *\n * @see storm-022 v2 Section 9.2 - KeyVersion interface\n */\nexport const KEY_VERSION_STATUSES = ['active', 'rotating', 'deprecated', 'expired'] as const;\n\nexport type KeyVersionStatus = (typeof KEY_VERSION_STATUSES)[number];\n\nexport const KeyVersionStatusSchema = z.enum(KEY_VERSION_STATUSES);\n\n/**\n * Type guard for KeyVersionStatus.\n */\nexport function isKeyVersionStatus(value: unknown): value is KeyVersionStatus {\n  return KEY_VERSION_STATUSES.includes(value as KeyVersionStatus);\n}\n\n/**\n * Key rotation triggers.\n *\n * @see storm-022 v2 Section 9.1 - When Key Rotation Occurs\n */\nexport const KEY_ROTATION_TRIGGERS = [\n  'passkey_change',\n  'scheduled',\n  'security_incident',\n  'recovery_used',\n] as const;\n\nexport type KeyRotationTrigger = (typeof KEY_ROTATION_TRIGGERS)[number];\n\nexport const KeyRotationTriggerSchema = z.enum(KEY_ROTATION_TRIGGERS);\n\n/**\n * Scheduled rotation interval in months.\n *\n * @see storm-022 v2 Section 9.1 - \"Scheduled rotation: Every 12 months\"\n */\nexport const SCHEDULED_ROTATION_MONTHS = 12;\n\n/**\n * Rotation re-encryption timing estimates (throttled, Wi-Fi + charging).\n *\n * @see storm-022 v2 Section 9.3 - Timing Estimates table\n */\nexport const ROTATION_TIMING_ESTIMATES = {\n  '1k': { reencrypt_seconds: 30, background_minutes: 2 },\n  '10k': { reencrypt_seconds: 300, background_minutes: 15 },\n  '50k': { reencrypt_seconds: 1500, background_minutes: 60 },\n} as const;\n\n// ============================================================\n// ROTATION PHASES\n// ============================================================\n\n/**\n * Phases of the key rotation process.\n *\n * @see storm-022 v2 Section 9.3 - 3-phase rotation flow\n */\nexport const ROTATION_PHASES = ['generating', 'reencrypting', 'verifying', 'completing'] as const;\n\nexport type RotationPhase = (typeof ROTATION_PHASES)[number];\n\nexport const RotationPhaseSchema = z.enum(ROTATION_PHASES);\n\n// ============================================================\n// ROTATION EVENTS\n// ============================================================\n\n/**\n * Rotation event types for UI updates.\n *\n * @see storm-022 v2 Section 9.4 - Migration UX Flow\n */\nexport const ROTATION_EVENT_TYPES = [\n  'rotation:started',\n  'rotation:progress',\n  'rotation:paused',\n  'rotation:resumed',\n  'rotation:completed',\n  'rotation:failed',\n] as const;\n\nexport type RotationEventType = (typeof ROTATION_EVENT_TYPES)[number];\n\nexport const RotationEventTypeSchema = z.enum(ROTATION_EVENT_TYPES);\n\n// ============================================================\n// RECOVERY CONSTANTS\n// ============================================================\n\n/**\n * BIP39 mnemonic word count for recovery code.\n *\n * @see storm-022 v1 revision Section 3 - \"24-word BIP39 mnemonic\"\n */\nexport const RECOVERY_WORD_COUNT = 24;\n\n/**\n * Number of random words user must enter during forced verification.\n *\n * @see storm-022 v1 revision Section 3 - \"Enter words 3, 8, and 17\"\n */\nexport const RECOVERY_VERIFICATION_WORD_COUNT = 3;\n\n/**\n * Maximum verification attempts before requiring code regeneration.\n */\nexport const RECOVERY_VERIFICATION_ATTEMPT_LIMIT = 3;\n\n/**\n * Grace period duration in days.\n * During this time, email recovery is available as a fallback.\n * After expiry, true E2E promise is honored (no backdoor).\n *\n * @see storm-022 v1 revision Section 3 - \"7-DAY GRACE PERIOD\"\n */\nexport const GRACE_PERIOD_DAYS = 7;\n\n/**\n * Recovery reminder schedule (days after Private tier setup).\n *\n * @see storm-022 v1 revision Section 3 - Periodic Reminders\n */\nexport const RECOVERY_REMINDER_DAYS = [30, 180] as const;\n\n/**\n * Recovery methods available to users.\n *\n * @see storm-022 v1 revision Section 3 - Recovery Options\n */\nexport const RECOVERY_METHODS = [\n  'multi_device',\n  'recovery_code',\n  'grace_period',\n] as const;\n\nexport type RecoveryMethod = (typeof RECOVERY_METHODS)[number];\n\nexport const RecoveryMethodSchema = z.enum(RECOVERY_METHODS);\n\n/**\n * Recovery reminder types.\n */\nexport const RECOVERY_REMINDER_TYPES = ['initial', 'periodic', 'new_device'] as const;\n\nexport type RecoveryReminderType = (typeof RECOVERY_REMINDER_TYPES)[number];\n\nexport const RecoveryReminderTypeSchema = z.enum(RECOVERY_REMINDER_TYPES);\n\n// ============================================================\n// TOKEN CONFIGURATION\n// ============================================================\n\n/**\n * JWT access token lifetime in minutes.\n *\n * @see storm-022 v1 revision Section 1 - \"Short-lived (15 min)\"\n */\nexport const ACCESS_TOKEN_EXPIRY_MINUTES = 15;\n\n/**\n * Refresh token lifetime in days.\n *\n * @see storm-022 v1 revision Section 1 - \"Long-lived (30 days)\"\n */\nexport const REFRESH_TOKEN_EXPIRY_DAYS = 30;\n\n// ============================================================\n// BYOK RATE LIMITING\n// ============================================================\n\n/**\n * Maximum BYOK key decryption attempts per minute.\n * Prevents brute force attacks on encrypted API keys.\n *\n * @see storm-022 v1 revision Section 6 - \"Max 5 key decryptions per minute\"\n */\nexport const BYOK_MAX_DECRYPTIONS_PER_MINUTE = 5;\n\n/**\n * Number of BYOK decryption failures before lockout.\n */\nexport const BYOK_LOCKOUT_AFTER_FAILURES = 10;\n\n/**\n * BYOK lockout duration in minutes after exceeding failure limit.\n */\nexport const BYOK_LOCKOUT_DURATION_MINUTES = 30;\n\n// ============================================================\n// CLIENT-SIDE SEARCH LIMITS (Private tier)\n// ============================================================\n\n/**\n * Maximum recommended node counts for Private tier client-side search.\n *\n * @see storm-022 v1 revision Section 2 - \"Private tier practical limit ~50K nodes on mobile\"\n */\nexport const PRIVATE_TIER_NODE_LIMITS = {\n  mobile: 50_000,\n  desktop: 100_000,\n} as const;\n\n/**\n * Client-side search performance estimates.\n *\n * @see storm-022 v1 revision Section 2 - Performance Limits table\n */\nexport const CLIENT_SEARCH_PERFORMANCE = {\n  /** Time to decrypt per 1K nodes (milliseconds) */\n  decrypt_time_ms_per_1k: 100,\n  /** Time to build HNSW index per 1K nodes (milliseconds) */\n  index_build_time_ms_per_1k: 200,\n  /** Search latency by node count (milliseconds) */\n  search_latency_ms: {\n    '10k': 20,\n    '50k': 40,\n    '100k': 60,\n  },\n  /** Memory usage per 10K nodes (megabytes) */\n  memory_mb_per_10k: 130,\n} as const;\n\n// ============================================================\n// AUTH SECURITY DEFAULTS\n// ============================================================\n\n/**\n * Brute force lockout threshold (login attempts).\n *\n * @see storm-022 v1 revision Section 1 - Security Measures via Clerk\n */\nexport const BRUTE_FORCE_LOCKOUT_ATTEMPTS = 5;\n\n/**\n * Brute force lockout duration (minutes).\n */\nexport const BRUTE_FORCE_LOCKOUT_MINUTES = 15;\n\n/**\n * CAPTCHA trigger threshold (failed attempts).\n */\nexport const CAPTCHA_AFTER_FAILURES = 3;\n\n// ============================================================\n// EXPORT COMPLIANCE\n// ============================================================\n\n/**\n * Export Control Classification Number for Private tier encryption.\n *\n * @see storm-022 v1 revision Section 7 - \"Self-classification under ECCN 5D992\"\n */\nexport const ECCN_CLASSIFICATION = '5D992';\n\n/**\n * Export compliance status levels.\n *\n * @see storm-022 v1 revision Section 7 - Export Compliance\n */\nexport const EXPORT_COMPLIANCE_STATUSES = [\n  'exempt',\n  'requires_documentation',\n  'excluded',\n] as const;\n\nexport type ExportComplianceStatus = (typeof EXPORT_COMPLIANCE_STATUSES)[number];\n\nexport const ExportComplianceStatusSchema = z.enum(EXPORT_COMPLIANCE_STATUSES);\n\n// ============================================================\n// DESKTOP AUTH FLOW STEPS\n// ============================================================\n\n/**\n * Desktop (Tauri) auth flow steps.\n *\n * @see storm-022 v1 revision Section 1 - Desktop Auth Flow\n */\nexport const DESKTOP_AUTH_STEPS = [\n  'idle',\n  'browser_opened',\n  'waiting_callback',\n  'processing_token',\n  'complete',\n  'error',\n] as const;\n\nexport type DesktopAuthStep = (typeof DESKTOP_AUTH_STEPS)[number];\n\nexport const DesktopAuthStepSchema = z.enum(DESKTOP_AUTH_STEPS);\n\n// ============================================================\n// TIER MIGRATION STATUSES\n// ============================================================\n\n/**\n * Tier migration process statuses.\n *\n * @see storm-022 v1 revision Section 4 - Tier Migration\n */\nexport const TIER_MIGRATION_STATUSES = [\n  'pending',\n  'key_setup',\n  'migrating',\n  'verifying',\n  'complete',\n  'failed',\n] as const;\n\nexport type TierMigrationStatus = (typeof TIER_MIGRATION_STATUSES)[number];\n\nexport const TierMigrationStatusSchema = z.enum(TIER_MIGRATION_STATUSES);\n\n/**\n * Tier migration rate: milliseconds per 1K nodes.\n * ~1 minute per 1K nodes.\n *\n * @see storm-022 v1 revision Section 4 - \"Duration: ~1 minute per 1K nodes\"\n */\nexport const MIGRATION_RATE_MS_PER_1K_NODES = 60_000;\n\n// ============================================================\n// CONSENT EVENT TYPES\n// ============================================================\n\n/**\n * Consent event types for logging and analytics.\n *\n * @see storm-022 v2 Section 10 - LLM Consent UX\n */\nexport const CONSENT_EVENT_TYPES = [\n  'consent:requested',\n  'consent:granted',\n  'consent:declined',\n  'consent:revoked',\n  'consent:expired',\n] as const;\n\nexport type ConsentEventType = (typeof CONSENT_EVENT_TYPES)[number];\n\nexport const ConsentEventTypeSchema = z.enum(CONSENT_EVENT_TYPES);\n\n// ============================================================\n// PASSKEY PLATFORMS\n// ============================================================\n\n/**\n * Passkey sync platforms (for multi-device key management).\n *\n * @see storm-022 v1 revision Section 3 - Key Hierarchy\n */\nexport const PASSKEY_PLATFORMS = ['apple', 'google', 'microsoft'] as const;\n\nexport type PasskeyPlatform = (typeof PASSKEY_PLATFORMS)[number];\n\nexport const PasskeyPlatformSchema = z.enum(PASSKEY_PLATFORMS);\n\n/**\n * Passkey sync mechanisms by platform.\n */\nexport const PASSKEY_SYNC_MECHANISMS: Record<PasskeyPlatform, string> = {\n  apple: 'icloud_keychain',\n  google: 'google_password_manager',\n  microsoft: 'microsoft_entra',\n} as const;\n\n// ============================================================\n// RECOVERY SETUP STEPS\n// ============================================================\n\n/**\n * Steps in the recovery code setup flow.\n *\n * @see storm-022 v1 revision Section 3 - Forced Verification setup flow\n */\nexport const RECOVERY_SETUP_STEPS = [\n  'generating',\n  'displaying',\n  'verifying',\n  'complete',\n] as const;\n\nexport type RecoverySetupStep = (typeof RECOVERY_SETUP_STEPS)[number];\n\nexport const RecoverySetupStepSchema = z.enum(RECOVERY_SETUP_STEPS);\n\n// ============================================================\n// API KEY TYPES\n// ============================================================\n\n/**\n * API key ownership types.\n *\n * @see storm-022 v1 revision Section 6 - API Key Security\n */\nexport const API_KEY_TYPES = ['platform', 'byok'] as const;\n\nexport type ApiKeyType = (typeof API_KEY_TYPES)[number];\n\nexport const ApiKeyTypeSchema = z.enum(API_KEY_TYPES);\n\n/**\n * API call flow modes.\n *\n * - **proxied:** Platform keys - calls go through Nous API proxy\n * - **direct:** BYOK - calls go directly from client to LLM provider\n *\n * @see storm-022 v1 revision Section 6 - API Call Flow diagrams\n */\nexport const API_CALL_FLOWS = ['proxied', 'direct'] as const;\n\nexport type ApiCallFlow = (typeof API_CALL_FLOWS)[number];\n\nexport const ApiCallFlowSchema = z.enum(API_CALL_FLOWS);\n\n// ============================================================\n// BYOK ENCRYPTION METHODS\n// ============================================================\n\n/**\n * BYOK key encryption methods by tier.\n *\n * - **server_side:** Standard tier - Nous API decrypts\n * - **user_key:** Private tier - only user's device can decrypt\n *\n * @see storm-022 v1 revision Section 6 - BYOK Key Storage\n */\nexport const BYOK_ENCRYPTION_METHODS = ['server_side', 'user_key'] as const;\n\nexport type BYOKEncryptionMethod = (typeof BYOK_ENCRYPTION_METHODS)[number];\n\nexport const BYOKEncryptionMethodSchema = z.enum(BYOK_ENCRYPTION_METHODS);\n\n// ============================================================\n// MFA OPTIONS\n// ============================================================\n\n/**\n * Multi-factor authentication options (via Clerk).\n *\n * @see storm-022 v1 revision Section 1 - Security Measures\n */\nexport const MFA_OPTIONS = ['totp', 'sms', 'passkey'] as const;\n\nexport type MfaOption = (typeof MFA_OPTIONS)[number];\n\nexport const MfaOptionSchema = z.enum(MFA_OPTIONS);\n\n// ============================================================\n// SIGN-IN METHOD IMPLEMENTATIONS\n// ============================================================\n\n/**\n * Sign-in method implementation approaches by platform.\n *\n * @see storm-022 v1 revision Section 1 - Platform-Specific Implementation table\n */\nexport const SIGN_IN_IMPLEMENTATIONS = ['native', 'rest_api', 'oauth', 'clerk_ui', 'clerk_web'] as const;\n\nexport type SignInImplementation = (typeof SIGN_IN_IMPLEMENTATIONS)[number];\n\nexport const SignInImplementationSchema = z.enum(SIGN_IN_IMPLEMENTATIONS);\n\n// ============================================================\n// DEEP LINK SCHEME\n// ============================================================\n\n/**\n * Deep link scheme for desktop (Tauri) OAuth callback.\n *\n * @see storm-022 v1 revision Section 1 - \"nous://auth/callback?token=...\"\n */\nexport const DEEP_LINK_SCHEME = 'nous';\n\n/**\n * OAuth callback path.\n */\nexport const AUTH_CALLBACK_PATH = '/auth/callback';\n\n// ============================================================\n// OFFLINE FUNCTIONALITY LEVELS\n// ============================================================\n\n/**\n * Functionality levels available in offline states.\n *\n * @see storm-022 v1 revision Section 1 - Offline States table\n */\nexport const OFFLINE_FUNCTIONALITY_LEVELS = [\n  'full',\n  'read_write_queued',\n  'read_only',\n  'local_only',\n] as const;\n\nexport type OfflineFunctionality = (typeof OFFLINE_FUNCTIONALITY_LEVELS)[number];\n\nexport const OfflineFunctionalitySchema = z.enum(OFFLINE_FUNCTIONALITY_LEVELS);\n\n// ============================================================\n// OFFLINE SYNC BEHAVIORS\n// ============================================================\n\n/**\n * Sync behaviors for each offline state.\n */\nexport const OFFLINE_SYNC_BEHAVIORS = [\n  'realtime',\n  'queued',\n  'paused',\n  'none',\n] as const;\n\nexport type OfflineSyncBehavior = (typeof OFFLINE_SYNC_BEHAVIORS)[number];\n\nexport const OfflineSyncBehaviorSchema = z.enum(OFFLINE_SYNC_BEHAVIORS);\n\n// ============================================================\n// QUEUEABLE TABLES\n// ============================================================\n\n/**\n * Tables that can have queued offline operations.\n */\nexport const QUEUEABLE_TABLES = ['nodes', 'edges', 'episodes'] as const;\n\nexport type QueueableTable = (typeof QUEUEABLE_TABLES)[number];\n\n/**\n * Operation types for the offline sync queue.\n */\nexport const QUEUE_OPERATION_TYPES = ['create', 'update', 'delete'] as const;\n\nexport type QueueOperationType = (typeof QUEUE_OPERATION_TYPES)[number];\n\n// ============================================================\n// DECLINE ACTIONS (Consent)\n// ============================================================\n\n/**\n * Actions available to the user after declining LLM memory access.\n *\n * @see storm-022 v2 Section 10.6 - Graceful Degradation Rules\n */\nexport const DECLINE_ACTIONS = [\n  'general_questions',\n  'writing_assistance',\n  'brainstorming',\n  'allow_this_question',\n  'end_conversation',\n] as const;\n\nexport type DeclineAction = (typeof DECLINE_ACTIONS)[number];\n\n// ============================================================\n// LLM PROVIDERS (API Key Management)\n// ============================================================\n\n/**\n * Supported LLM providers for API key management.\n *\n * @see storm-022 v1 revision Section 6 - API Key Security\n * @see storm-015 - LLM Integration provider pool\n */\nexport const LLM_PROVIDERS = ['openai', 'anthropic', 'google'] as const;\n\nexport type LLMProvider = (typeof LLM_PROVIDERS)[number];\n\nexport const LLMProviderSchema = z.enum(LLM_PROVIDERS);\n\n// ============================================================\n// RE-ENCRYPTION PRIORITY\n// ============================================================\n\n/**\n * Priority ordering for re-encryption during key rotation.\n *\n * @see storm-022 v2 Section 9.7 - Priority Ordering\n */\nexport const REENCRYPTION_PRIORITY_ORDER = [\n  'recently_accessed',\n  'frequently_accessed',\n  'oldest_first',\n] as const;\n\nexport type ReencryptionPriority = (typeof REENCRYPTION_PRIORITY_ORDER)[number];\n\n","/**\n * @module @nous/core/security\n * @description Types and Zod schemas for Nous Security Layer (NSL)\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * All interfaces, types, and Zod schemas for the security module.\n * Consolidated from spec files: auth-config, privacy-tiers, encryption,\n * key-hierarchy, key-rotation, recovery, consent-ux, api-security,\n * compliance, and offline-auth.\n */\n\nimport { z } from 'zod';\nimport {\n  type AuthMethod,\n  type Platform,\n  type OfflineState,\n  type PrivacyTier,\n  type DesktopAuthStep,\n  type MfaOption,\n  type SignInImplementation,\n  type PasskeyPlatform,\n  type KeyVersionStatus,\n  type RotationPhase,\n  type RotationEventType,\n  type RecoveryMethod,\n  type RecoveryReminderType,\n  type RecoverySetupStep,\n  type ConsentScope,\n  type ConsentDuration,\n  type ConsentRevocationScope,\n  type ConsentEventType,\n  type DeclineAction,\n  type ApiKeyType,\n  type ApiCallFlow,\n  type BYOKEncryptionMethod,\n  type LLMProvider,\n  type ExportComplianceStatus,\n  type OfflineFunctionality,\n  type OfflineSyncBehavior,\n  type QueueableTable,\n  type QueueOperationType,\n  AUTH_METHODS,\n  PLATFORMS,\n  OFFLINE_STATES,\n  PRIVACY_TIERS,\n  DESKTOP_AUTH_STEPS,\n  MFA_OPTIONS,\n  SIGN_IN_IMPLEMENTATIONS,\n  PASSKEY_PLATFORMS,\n  KEY_DERIVATION_FUNCTION,\n  MASTER_KEY_LENGTH_BITS,\n  KEY_VERSION_STATUSES,\n  ROTATION_PHASES,\n  ROTATION_EVENT_TYPES,\n  RECOVERY_METHODS,\n  RECOVERY_REMINDER_TYPES,\n  RECOVERY_SETUP_STEPS,\n  RECOVERY_WORD_COUNT,\n  RECOVERY_VERIFICATION_WORD_COUNT,\n  RECOVERY_VERIFICATION_ATTEMPT_LIMIT,\n  NONCE_LENGTH_BYTES,\n  CONSENT_SCOPES,\n  CONSENT_DURATIONS,\n  CONSENT_REVOCATION_SCOPES,\n  CONSENT_EVENT_TYPES,\n  DECLINE_ACTIONS,\n  API_KEY_TYPES,\n  API_CALL_FLOWS,\n  BYOK_ENCRYPTION_METHODS,\n  LLM_PROVIDERS,\n  EXPORT_COMPLIANCE_STATUSES,\n  OFFLINE_FUNCTIONALITY_LEVELS,\n  OFFLINE_SYNC_BEHAVIORS,\n  QUEUEABLE_TABLES,\n  QUEUE_OPERATION_TYPES,\n  TIER_MIGRATION_STATUSES,\n} from './constants';\n\n// ============================================================\n// AUTH CONFIGURATION\n// ============================================================\n\n/**\n * Clerk authentication provider configuration.\n *\n * @see storm-022 v1 revision Section 1 - Provider Recommendation: Clerk\n */\nexport interface ClerkConfig {\n  publishable_key: string;\n  secret_key: string;\n  sign_in_methods: AuthMethod[];\n  mfa_enabled: boolean;\n  session_lifetime_minutes: number;\n  ios: { native_sdk: boolean };\n  android: { native_sdk: boolean };\n  desktop: { oauth_redirect_uri: string; deep_link_scheme: string };\n}\n\nexport const ClerkConfigSchema = z.object({\n  publishable_key: z.string().min(1),\n  secret_key: z.string().min(1),\n  sign_in_methods: z.array(z.enum(AUTH_METHODS)),\n  mfa_enabled: z.boolean(),\n  session_lifetime_minutes: z.number().int().positive(),\n  ios: z.object({ native_sdk: z.boolean() }),\n  android: z.object({ native_sdk: z.boolean() }),\n  desktop: z.object({\n    oauth_redirect_uri: z.string().url(),\n    deep_link_scheme: z.string(),\n  }),\n});\n\n/**\n * Per-platform authentication method implementation.\n *\n * @see storm-022 v1 revision Section 1 - Platform-Specific Implementation table\n */\nexport interface PlatformAuthConfig {\n  platform: Platform;\n  apple_sign_in: SignInImplementation;\n  google_sign_in: SignInImplementation;\n  email_password: SignInImplementation;\n}\n\nexport const PlatformAuthConfigSchema = z.object({\n  platform: z.enum(PLATFORMS),\n  apple_sign_in: z.enum(SIGN_IN_IMPLEMENTATIONS),\n  google_sign_in: z.enum(SIGN_IN_IMPLEMENTATIONS),\n  email_password: z.enum(SIGN_IN_IMPLEMENTATIONS),\n});\n\n/**\n * JWT token pair for authentication state.\n *\n * @see storm-022 v1 revision Section 1 - Offline Token Handling\n */\nexport interface AuthTokens {\n  access_token: string;\n  refresh_token: string;\n  issued_at: string;\n  expires_at: string;\n}\n\nexport const AuthTokensSchema = z.object({\n  access_token: z.string().min(1),\n  refresh_token: z.string().min(1),\n  issued_at: z.string().datetime(),\n  expires_at: z.string().datetime(),\n});\n\n/**\n * Full authentication state stored on device.\n *\n * @see storm-022 v1 revision Section 1 - AuthState interface\n */\nexport interface AuthState {\n  user_id: string;\n  tokens: AuthTokens;\n  last_online: string;\n  offline_state: OfflineState;\n  privacy_tier: PrivacyTier;\n  device_id: string;\n}\n\nexport const AuthStateSchema = z.object({\n  user_id: z.string().min(1),\n  tokens: AuthTokensSchema,\n  last_online: z.string().datetime(),\n  offline_state: z.enum(OFFLINE_STATES),\n  privacy_tier: z.enum(PRIVACY_TIERS),\n  device_id: z.string().min(1),\n});\n\n/**\n * Desktop authentication flow state for Tauri apps.\n *\n * @see storm-022 v1 revision Section 1 - Desktop Auth Flow\n */\nexport interface DesktopAuthFlow {\n  step: DesktopAuthStep;\n  redirect_uri: string;\n  state_param: string;\n  code_verifier?: string;\n  error?: string;\n}\n\nexport const DesktopAuthFlowSchema = z.object({\n  step: z.enum(DESKTOP_AUTH_STEPS),\n  redirect_uri: z.string(),\n  state_param: z.string().min(1),\n  code_verifier: z.string().optional(),\n  error: z.string().optional(),\n});\n\n/**\n * Security measures configuration (managed by Clerk).\n *\n * @see storm-022 v1 revision Section 1 - Security Measures table\n */\nexport interface AuthSecurityConfig {\n  brute_force_lockout_attempts: number;\n  brute_force_lockout_minutes: number;\n  captcha_after_failures: number;\n  new_device_email_alert: boolean;\n  invalidate_sessions_on_password_change: boolean;\n  mfa_options: MfaOption[];\n}\n\nexport const AuthSecurityConfigSchema = z.object({\n  brute_force_lockout_attempts: z.number().int().positive(),\n  brute_force_lockout_minutes: z.number().int().positive(),\n  captcha_after_failures: z.number().int().positive(),\n  new_device_email_alert: z.boolean(),\n  invalidate_sessions_on_password_change: z.boolean(),\n  mfa_options: z.array(z.enum(MFA_OPTIONS)),\n});\n\n/**\n * Result of JWT token validation.\n */\nexport interface JWTValidationResult {\n  valid: boolean;\n  user_id?: string;\n  error?: 'expired' | 'invalid_signature' | 'malformed' | 'revoked';\n}\n\nexport const JWTValidationResultSchema = z.object({\n  valid: z.boolean(),\n  user_id: z.string().optional(),\n  error: z.enum(['expired', 'invalid_signature', 'malformed', 'revoked']).optional(),\n});\n\n// ============================================================\n// PRIVACY TIERS\n// ============================================================\n\n/**\n * Complete definition of a privacy tier.\n *\n * @see storm-022 v1 revision Section 2 - Simplified Two-Tier Privacy Model\n */\nexport interface TierDefinition {\n  tier: PrivacyTier;\n  name: string;\n  description: string;\n  target_user: string;\n  search: 'cloud' | 'client_only';\n  llm_access: 'direct' | 'explicit_consent';\n  key_management: 'none' | 'passkey_derived';\n  data_protection: string[];\n  data_exposure: string[];\n}\n\nexport const TierDefinitionSchema = z.object({\n  tier: z.enum(PRIVACY_TIERS),\n  name: z.string(),\n  description: z.string(),\n  target_user: z.string(),\n  search: z.enum(['cloud', 'client_only']),\n  llm_access: z.enum(['direct', 'explicit_consent']),\n  key_management: z.enum(['none', 'passkey_derived']),\n  data_protection: z.array(z.string()),\n  data_exposure: z.array(z.string()),\n});\n\n/**\n * Feature comparison between tiers (for UI display).\n *\n * @see storm-022 v1 revision Section 2 - Updated Architecture Overview table\n */\nexport interface TierComparison {\n  feature: string;\n  standard: string;\n  private_tier: string;\n}\n\nexport const TierComparisonSchema = z.object({\n  feature: z.string(),\n  standard: z.string(),\n  private_tier: z.string(),\n});\n\n/**\n * Request to migrate between privacy tiers.\n *\n * @see storm-022 v1 revision Section 4 - Tier Migration flows\n */\nexport interface TierMigrationRequest {\n  user_id: string;\n  from_tier: PrivacyTier;\n  to_tier: PrivacyTier;\n  initiated_at: string;\n}\n\nexport const TierMigrationRequestSchema = z.object({\n  user_id: z.string().min(1),\n  from_tier: z.enum(PRIVACY_TIERS),\n  to_tier: z.enum(PRIVACY_TIERS),\n  initiated_at: z.string().datetime(),\n});\n\n/**\n * Tier migration state tracking.\n *\n * @see storm-022 v1 revision Section 4 - Standard -> Private, Private -> Standard\n */\nexport interface TierMigrationState {\n  request: TierMigrationRequest;\n  status: typeof TIER_MIGRATION_STATUSES[number];\n  progress: number;\n  nodes_processed: number;\n  nodes_total: number;\n  estimated_time_remaining_ms: number;\n  started_at?: string;\n  completed_at?: string;\n  error?: string;\n}\n\nexport const TierMigrationStateSchema = z.object({\n  request: TierMigrationRequestSchema,\n  status: z.enum(TIER_MIGRATION_STATUSES),\n  progress: z.number().min(0).max(100),\n  nodes_processed: z.number().int().min(0),\n  nodes_total: z.number().int().min(0),\n  estimated_time_remaining_ms: z.number().min(0),\n  started_at: z.string().datetime().optional(),\n  completed_at: z.string().datetime().optional(),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// ENCRYPTION\n// ============================================================\n\n/**\n * Encrypted node structure for Private tier storage.\n *\n * @see storm-022 v1 revision Section 2 - Encryption Schema (Private Tier)\n */\nexport interface EncryptedNodeSchema {\n  id: string;\n  type: string;\n  encrypted_payload: Uint8Array;\n  encrypted_embedding?: Uint8Array;\n  encryption_version: number;\n  nonce: Uint8Array;\n  encryption_tier: PrivacyTier;\n  version: number;\n  updated_at: number;\n}\n\nexport const EncryptedNodeSchemaZ = z.object({\n  id: z.string().min(1),\n  type: z.string().min(1),\n  encrypted_payload: z.instanceof(Uint8Array),\n  encrypted_embedding: z.instanceof(Uint8Array).optional(),\n  encryption_version: z.number().int().min(1),\n  nonce: z.instanceof(Uint8Array).refine(\n    (val) => val.length === NONCE_LENGTH_BYTES,\n    { message: `Nonce must be exactly ${NONCE_LENGTH_BYTES} bytes` }\n  ),\n  encryption_tier: z.enum(PRIVACY_TIERS),\n  version: z.number().int().min(1),\n  updated_at: z.number().int(),\n});\n\n/**\n * Mapping of which node fields are encrypted vs. stay plaintext.\n *\n * @see storm-022 v1 revision Section 2 - Encrypted node SQL schema\n */\nexport interface EncryptionFieldMap {\n  plaintext: string[];\n  encrypted_content: string[];\n  encrypted_embedding: string[];\n  encrypted_metadata: string[];\n}\n\nexport const EncryptionFieldMapSchema = z.object({\n  plaintext: z.array(z.string()),\n  encrypted_content: z.array(z.string()),\n  encrypted_embedding: z.array(z.string()),\n  encrypted_metadata: z.array(z.string()),\n});\n\n/**\n * Result of encrypting a node.\n */\nexport interface EncryptionResult {\n  encrypted_payload: Uint8Array;\n  encrypted_embedding?: Uint8Array;\n  nonce: Uint8Array;\n  encryption_version: number;\n}\n\nexport const EncryptionResultSchema = z.object({\n  encrypted_payload: z.instanceof(Uint8Array),\n  encrypted_embedding: z.instanceof(Uint8Array).optional(),\n  nonce: z.instanceof(Uint8Array),\n  encryption_version: z.number().int().min(1),\n});\n\n/**\n * Result of decrypting a node.\n *\n * @see storm-011 spec/node-schema.ts - NousNode interface\n */\nexport interface DecryptionResult {\n  content: {\n    title: string;\n    body?: string;\n    summary?: string;\n    blocks?: unknown[];\n  };\n  embedding?: {\n    vector: Float32Array;\n    model: string;\n    created_at: string;\n  };\n  temporal: {\n    ingestion: { timestamp: string; timezone: string };\n    event?: unknown;\n    content_times?: unknown[];\n    reference_patterns?: string[];\n  };\n  neural: {\n    stability: number;\n    retrievability: number;\n    last_accessed: string;\n    access_count: number;\n  };\n  provenance: {\n    source: string;\n    parent_id?: string;\n    confidence: number;\n  };\n  state: {\n    extraction_depth: string;\n    lifecycle: string;\n  };\n}\n\nexport const DecryptionResultSchema = z.object({\n  content: z.object({\n    title: z.string(),\n    body: z.string().optional(),\n    summary: z.string().optional(),\n    blocks: z.array(z.unknown()).optional(),\n  }),\n  embedding: z.object({\n    vector: z.instanceof(Float32Array),\n    model: z.string(),\n    created_at: z.string(),\n  }).optional(),\n  temporal: z.object({\n    ingestion: z.object({ timestamp: z.string(), timezone: z.string() }),\n    event: z.unknown().optional(),\n    content_times: z.array(z.unknown()).optional(),\n    reference_patterns: z.array(z.string()).optional(),\n  }),\n  neural: z.object({\n    stability: z.number(),\n    retrievability: z.number(),\n    last_accessed: z.string(),\n    access_count: z.number(),\n  }),\n  provenance: z.object({\n    source: z.string(),\n    parent_id: z.string().optional(),\n    confidence: z.number(),\n  }),\n  state: z.object({\n    extraction_depth: z.string(),\n    lifecycle: z.string(),\n  }),\n});\n\n/**\n * HNSW index configuration for client-side search in Private tier.\n *\n * @see storm-022 v1 revision Section 2 - Client-Side Search\n */\nexport interface ClientSearchConfig {\n  hnsw_ef_construction: number;\n  hnsw_ef_search: number;\n  hnsw_m: number;\n  max_nodes: number;\n  index_in_memory: boolean;\n}\n\nexport const ClientSearchConfigSchema = z.object({\n  hnsw_ef_construction: z.number().int().positive(),\n  hnsw_ef_search: z.number().int().positive(),\n  hnsw_m: z.number().int().positive(),\n  max_nodes: z.number().int().positive(),\n  index_in_memory: z.boolean(),\n});\n\n/**\n * Result from local HNSW search.\n */\nexport interface LocalSearchResult {\n  node_id: string;\n  distance: number;\n  score: number;\n}\n\nexport const LocalSearchResultSchema = z.object({\n  node_id: z.string(),\n  distance: z.number().min(0),\n  score: z.number().min(0).max(1),\n});\n\n/**\n * Opaque type representing an in-memory HNSW index.\n */\nexport interface HNSWIndex {\n  size: number;\n  ready: boolean;\n  memory_bytes: number;\n}\n\nexport const HNSWIndexSchema = z.object({\n  size: z.number().int().min(0),\n  ready: z.boolean(),\n  memory_bytes: z.number().int().min(0),\n});\n\n// ============================================================\n// KEY HIERARCHY\n// ============================================================\n\n/**\n * Information about the user's passkey credential.\n *\n * @see storm-022 v1 revision Section 3 - Key Hierarchy\n */\nexport interface PasskeyInfo {\n  id: string;\n  created_at: string;\n  platform: PasskeyPlatform;\n  synced_via: string;\n  secure_enclave: boolean;\n}\n\nexport const PasskeyInfoSchema = z.object({\n  id: z.string().min(1),\n  created_at: z.string().datetime(),\n  platform: z.enum(PASSKEY_PLATFORMS),\n  synced_via: z.string().min(1),\n  secure_enclave: z.boolean(),\n});\n\n/**\n * Master key metadata. The actual CryptoKey is never serialized.\n *\n * CRITICAL: Master key is NEVER stored. Exists in memory only.\n *\n * @see storm-022 v1 revision Section 3\n */\nexport interface MasterKeyInfo {\n  algorithm: typeof KEY_DERIVATION_FUNCTION;\n  length_bits: typeof MASTER_KEY_LENGTH_BITS;\n  derivation_salt: Uint8Array;\n  exists_in_memory_only: true;\n}\n\nexport const MasterKeyInfoSchema = z.object({\n  algorithm: z.literal(KEY_DERIVATION_FUNCTION),\n  length_bits: z.literal(MASTER_KEY_LENGTH_BITS),\n  derivation_salt: z.instanceof(Uint8Array),\n  exists_in_memory_only: z.literal(true),\n});\n\n/**\n * Set of derived encryption keys, each for a specific purpose.\n *\n * @see storm-022 v1 revision Section 3 - HKDF with purpose strings\n */\nexport interface DerivedKeys {\n  content_key: CryptoKey;\n  embedding_key: CryptoKey;\n  metadata_key: CryptoKey;\n}\n\nexport const DerivedKeysSchema = z.object({\n  content_key: z.any().refine((val) => val != null, { message: 'content_key is required' }),\n  embedding_key: z.any().refine((val) => val != null, { message: 'embedding_key is required' }),\n  metadata_key: z.any().refine((val) => val != null, { message: 'metadata_key is required' }),\n});\n\n/**\n * The complete key hierarchy for a Private tier user.\n *\n * @see storm-022 v1 revision Section 3\n */\nexport interface KeyHierarchy {\n  passkey: PasskeyInfo;\n  master_key: MasterKeyInfo;\n  derived_keys: DerivedKeys;\n}\n\nexport const KeyHierarchySchema = z.object({\n  passkey: PasskeyInfoSchema,\n  master_key: MasterKeyInfoSchema,\n  derived_keys: DerivedKeysSchema,\n});\n\n/**\n * Parameters for a single HKDF key derivation operation.\n *\n * @see storm-022 v1 revision Section 3\n */\nexport interface KeyDerivationParams {\n  algorithm: 'HKDF';\n  hash: 'SHA-256';\n  salt: Uint8Array;\n  info: string;\n  key_length: typeof MASTER_KEY_LENGTH_BITS;\n}\n\nexport const KeyDerivationParamsSchema = z.object({\n  algorithm: z.literal('HKDF'),\n  hash: z.literal('SHA-256'),\n  salt: z.instanceof(Uint8Array),\n  info: z.string().min(1),\n  key_length: z.literal(MASTER_KEY_LENGTH_BITS),\n});\n\n/**\n * Multi-device key sync model.\n *\n * @see storm-022 v1 revision Section 3 - Multi-Device Sync\n */\nexport interface MultiDeviceKeySync {\n  method: 'passkey_platform_sync';\n  description: string;\n  sync_mechanisms: Record<PasskeyPlatform, string>;\n}\n\nexport const MultiDeviceKeySyncSchema = z.object({\n  method: z.literal('passkey_platform_sync'),\n  description: z.string(),\n  sync_mechanisms: z.record(z.enum(PASSKEY_PLATFORMS), z.string()),\n});\n\n// ============================================================\n// KEY ROTATION\n// ============================================================\n\n/**\n * Tracks a single key version in the user's key history.\n *\n * @see storm-022 v2 Section 9.2 - Key Versioning Scheme\n */\nexport interface KeyVersion {\n  version: number;\n  created_at: string;\n  derivation_salt: Uint8Array;\n  status: KeyVersionStatus;\n}\n\nexport const KeyVersionSchema = z.object({\n  version: z.number().int().min(1),\n  created_at: z.string().datetime(),\n  derivation_salt: z.instanceof(Uint8Array),\n  status: z.enum(KEY_VERSION_STATUSES),\n});\n\n/**\n * Key metadata stored in user's encrypted profile.\n *\n * @see storm-022 v2 Section 9.2\n */\nexport interface UserKeyMetadata {\n  current_version: number;\n  versions: KeyVersion[];\n  rotation_in_progress: boolean;\n  rotation_progress: number;\n  rotation_started_at: string | null;\n}\n\nexport const UserKeyMetadataSchema = z.object({\n  current_version: z.number().int().min(1),\n  versions: z.array(KeyVersionSchema),\n  rotation_in_progress: z.boolean(),\n  rotation_progress: z.number().min(0).max(100),\n  rotation_started_at: z.string().datetime().nullable(),\n});\n\n/**\n * Progress tracking for an active key rotation.\n *\n * @see storm-022 v2 Section 9.6 - Interrupted Rotation\n */\nexport interface RotationProgress {\n  processed_count: number;\n  total_count: number;\n  last_processed_id: string | null;\n  started_at: string;\n  phase: RotationPhase;\n}\n\nexport const RotationProgressSchema = z.object({\n  processed_count: z.number().int().min(0),\n  total_count: z.number().int().min(0),\n  last_processed_id: z.string().nullable(),\n  started_at: z.string().datetime(),\n  phase: z.enum(ROTATION_PHASES),\n});\n\n/**\n * Configuration for the background re-encryption job.\n *\n * @see storm-022 v2 Section 9.7 - Background Job Configuration\n */\nexport interface RotationConfig {\n  batch_size: number;\n  pause_between_batches_ms: number;\n  max_batches_per_minute: number;\n  require_wifi: boolean;\n  require_charging: boolean;\n  min_battery_level: number;\n  persist_progress: boolean;\n  auto_resume_on_launch: boolean;\n}\n\nexport const RotationConfigSchema = z.object({\n  batch_size: z.number().int().positive(),\n  pause_between_batches_ms: z.number().int().min(0),\n  max_batches_per_minute: z.number().int().positive(),\n  require_wifi: z.boolean(),\n  require_charging: z.boolean(),\n  min_battery_level: z.number().int().min(0).max(100),\n  persist_progress: z.boolean(),\n  auto_resume_on_launch: z.boolean(),\n});\n\n/**\n * Event emitted during rotation for UI updates.\n *\n * @see storm-022 v2 Section 9.4 - Migration UX Flow\n */\nexport interface RotationEvent {\n  type: RotationEventType;\n  progress?: number;\n  processed_count?: number;\n  total_count?: number;\n  estimated_remaining_ms?: number;\n  error?: string;\n}\n\nexport const RotationEventSchema = z.object({\n  type: z.enum(ROTATION_EVENT_TYPES),\n  progress: z.number().min(0).max(100).optional(),\n  processed_count: z.number().int().min(0).optional(),\n  total_count: z.number().int().min(0).optional(),\n  estimated_remaining_ms: z.number().min(0).optional(),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// RECOVERY\n// ============================================================\n\n/**\n * A generated BIP39 recovery code for key recovery.\n *\n * @see storm-022 v1 revision Section 3\n */\nexport interface RecoveryCode {\n  mnemonic: string[];\n  version: number;\n  created_at: string;\n  verified: boolean;\n}\n\nexport const RecoveryCodeSchema = z.object({\n  mnemonic: z.array(z.string()).length(RECOVERY_WORD_COUNT),\n  version: z.number().int().min(1),\n  created_at: z.string().datetime(),\n  verified: z.boolean(),\n});\n\n/**\n * Tracks the recovery code setup flow.\n *\n * @see storm-022 v1 revision Section 3 - FORCED VERIFICATION\n */\nexport interface RecoverySetupState {\n  step: RecoverySetupStep;\n  mnemonic: string[];\n  verification_indices: number[];\n  attempts_remaining: number;\n}\n\nexport const RecoverySetupStateSchema = z.object({\n  step: z.enum(RECOVERY_SETUP_STEPS),\n  mnemonic: z.array(z.string()).length(RECOVERY_WORD_COUNT),\n  verification_indices: z.array(z.number().int().min(0).max(RECOVERY_WORD_COUNT - 1))\n    .length(RECOVERY_VERIFICATION_WORD_COUNT),\n  attempts_remaining: z.number().int().min(0).max(RECOVERY_VERIFICATION_ATTEMPT_LIMIT),\n});\n\n/**\n * Record of a recovery attempt for audit logging.\n *\n * @see storm-022 v2 Section 9.5\n */\nexport interface RecoveryAttempt {\n  user_id: string;\n  method: RecoveryMethod;\n  attempted_at: string;\n  success: boolean;\n  error?: string;\n}\n\nexport const RecoveryAttemptSchema = z.object({\n  user_id: z.string().min(1),\n  method: z.enum(RECOVERY_METHODS),\n  attempted_at: z.string().datetime(),\n  success: z.boolean(),\n  error: z.string().optional(),\n});\n\n/**\n * Grace period state for newly activated Private tier users.\n *\n * @see storm-022 v1 revision Section 3 - 7-DAY GRACE PERIOD\n */\nexport interface GracePeriodState {\n  enabled: boolean;\n  expires_at: string;\n  email_recovery_available: boolean;\n}\n\nexport const GracePeriodStateSchema = z.object({\n  enabled: z.boolean(),\n  expires_at: z.string().datetime(),\n  email_recovery_available: z.boolean(),\n});\n\n/**\n * Result of regenerating a recovery code.\n *\n * @see storm-022 v2 Section 9.5\n */\nexport interface RecoveryRegenerationResult {\n  new_mnemonic: string[];\n  old_code_invalidated: boolean;\n  new_encrypted_master: Uint8Array;\n  verification_required: boolean;\n}\n\nexport const RecoveryRegenerationResultSchema = z.object({\n  new_mnemonic: z.array(z.string()).length(RECOVERY_WORD_COUNT),\n  old_code_invalidated: z.boolean(),\n  new_encrypted_master: z.instanceof(Uint8Array),\n  verification_required: z.boolean(),\n});\n\n/**\n * Periodic reminder to verify recovery code is safely stored.\n *\n * @see storm-022 v1 revision Section 3 - Periodic Reminders\n */\nexport interface RecoveryReminder {\n  type: RecoveryReminderType;\n  days_since_setup: number;\n  last_dismissed: string | null;\n  message: string;\n}\n\nexport const RecoveryReminderSchema = z.object({\n  type: z.enum(RECOVERY_REMINDER_TYPES),\n  days_since_setup: z.number().int().min(0),\n  last_dismissed: z.string().datetime().nullable(),\n  message: z.string().min(1),\n});\n\n// ============================================================\n// CONSENT UX\n// ============================================================\n\n/**\n * Current consent state for a user session.\n *\n * @see storm-022 v2 Section 10.3\n */\nexport interface ConsentState {\n  scope: ConsentScope;\n  granted: boolean;\n  granted_at?: string;\n  expires_at?: string;\n  provider?: string;\n  memories_shared_count: number;\n  memories_shared_ids: string[];\n}\n\nexport const ConsentStateSchema = z.object({\n  scope: z.enum(CONSENT_SCOPES),\n  granted: z.boolean(),\n  granted_at: z.string().datetime().optional(),\n  expires_at: z.string().datetime().optional(),\n  provider: z.string().optional(),\n  memories_shared_count: z.number().int().min(0),\n  memories_shared_ids: z.array(z.string()),\n});\n\n/**\n * A remembered topic-based consent record.\n *\n * @see storm-022 v2 Section 10.2\n */\nexport interface TopicConsent {\n  topic_embedding: number[];\n  label: string;\n  consented_at: string;\n  query_count: number;\n}\n\nexport const TopicConsentSchema = z.object({\n  topic_embedding: z.array(z.number()),\n  label: z.string().min(1),\n  consented_at: z.string().datetime(),\n  query_count: z.number().int().min(0),\n});\n\n/**\n * User preferences for LLM consent behavior.\n *\n * @see storm-022 v2 Section 10.2\n */\nexport interface ConsentSettings {\n  default_scope: ConsentScope;\n  time_based_duration: ConsentDuration;\n  topic_similarity_threshold: number;\n  remembered_topics: TopicConsent[];\n  conversation_timeout_minutes: number;\n  require_explicit_for_sensitive: boolean;\n}\n\nexport const ConsentSettingsSchema = z.object({\n  default_scope: z.enum(CONSENT_SCOPES),\n  time_based_duration: z.enum(CONSENT_DURATIONS),\n  topic_similarity_threshold: z.number().min(0.80).max(0.95),\n  remembered_topics: z.array(TopicConsentSchema),\n  conversation_timeout_minutes: z.number().int().positive(),\n  require_explicit_for_sensitive: z.boolean(),\n});\n\n/**\n * Data required to render the consent dialog.\n *\n * @see storm-022 v2 Section 10.1\n */\nexport interface ConsentDialogData {\n  memories: ConsentMemoryPreview[];\n  total_count: number;\n  provider_name: string;\n  provider_privacy_note: string;\n  provider_policy_url: string;\n}\n\nexport const ConsentDialogDataSchema = z.object({\n  memories: z.array(z.lazy(() => ConsentMemoryPreviewSchema)),\n  total_count: z.number().int().min(1),\n  provider_name: z.string().min(1),\n  provider_privacy_note: z.string(),\n  provider_policy_url: z.string().url(),\n});\n\n/**\n * Memory preview shown in the consent dialog.\n *\n * @see storm-022 v2 Section 10.1\n */\nexport interface ConsentMemoryPreview {\n  id: string;\n  title: string;\n  created_at: string;\n  type: string;\n  preview: string;\n  selected: boolean;\n}\n\nexport const ConsentMemoryPreviewSchema = z.object({\n  id: z.string().min(1),\n  title: z.string(),\n  created_at: z.string().datetime(),\n  type: z.string().min(1),\n  preview: z.string(),\n  selected: z.boolean(),\n});\n\n/**\n * Request to revoke LLM consent.\n *\n * @see storm-022 v2 Section 10.5\n */\nexport interface ConsentRevocationRequest {\n  scope: ConsentRevocationScope;\n}\n\nexport const ConsentRevocationRequestSchema = z.object({\n  scope: z.enum(CONSENT_REVOCATION_SCOPES),\n});\n\n/**\n * Result when a user declines LLM access to their memories.\n *\n * @see storm-022 v2 Section 10.6\n */\nexport interface DeclineResult {\n  declined: true;\n  available_actions: DeclineAction[];\n  previous_context_available: boolean;\n  message: string;\n}\n\nexport const DeclineResultSchema = z.object({\n  declined: z.literal(true),\n  available_actions: z.array(z.enum(DECLINE_ACTIONS)),\n  previous_context_available: z.boolean(),\n  message: z.string(),\n});\n\n/**\n * Consent event for logging and analytics.\n *\n * @see storm-022 v2 Section 10\n */\nexport interface ConsentEvent {\n  type: ConsentEventType;\n  user_id: string;\n  scope: ConsentScope;\n  memories_count: number;\n  provider: string;\n  timestamp: string;\n}\n\nexport const ConsentEventSchema = z.object({\n  type: z.enum(CONSENT_EVENT_TYPES),\n  user_id: z.string().min(1),\n  scope: z.enum(CONSENT_SCOPES),\n  memories_count: z.number().int().min(0),\n  provider: z.string(),\n  timestamp: z.string().datetime(),\n});\n\n/**\n * Visual indicator data during LLM transmission.\n *\n * @see storm-022 v2 Section 10.4\n */\nexport interface ConsentVisualIndicator {\n  memories_shared_count: number;\n  provider_name: string;\n  consent_scope_label: string;\n  time_remaining?: string;\n  transmitting: boolean;\n}\n\nexport const ConsentVisualIndicatorSchema = z.object({\n  memories_shared_count: z.number().int().min(0),\n  provider_name: z.string(),\n  consent_scope_label: z.string(),\n  time_remaining: z.string().optional(),\n  transmitting: z.boolean(),\n});\n\n/**\n * Detailed record of a memory shared with an LLM.\n *\n * @see storm-022 v2 Section 10.4\n */\nexport interface SharedMemoryDetail {\n  id: string;\n  title: string;\n  shared_at: string;\n}\n\nexport const SharedMemoryDetailSchema = z.object({\n  id: z.string().min(1),\n  title: z.string(),\n  shared_at: z.string().datetime(),\n});\n\n// ============================================================\n// API SECURITY\n// ============================================================\n\n/**\n * Platform-managed API key (credit system).\n *\n * @see storm-022 v1 revision Section 6\n */\nexport interface PlatformApiKey {\n  provider: LLMProvider;\n  encrypted_key: string;\n  created_at: string;\n  rotated_at: string;\n  rate_limit: { rpm: number; tpm: number };\n}\n\nexport const PlatformApiKeySchema = z.object({\n  provider: z.enum(LLM_PROVIDERS),\n  encrypted_key: z.string().min(1),\n  created_at: z.string().datetime(),\n  rotated_at: z.string().datetime(),\n  rate_limit: z.object({\n    rpm: z.number().int().positive(),\n    tpm: z.number().int().positive(),\n  }),\n});\n\n/**\n * BYOK (Bring Your Own Key) configuration per user.\n *\n * @see storm-022 v1 revision Section 6\n */\nexport interface BYOKConfig {\n  user_id: string;\n  provider: LLMProvider;\n  encrypted_key: Uint8Array;\n  encryption_method: BYOKEncryptionMethod;\n  created_at: string;\n  last_used?: string;\n}\n\nexport const BYOKConfigSchema = z.object({\n  user_id: z.string().min(1),\n  provider: z.enum(LLM_PROVIDERS),\n  encrypted_key: z.instanceof(Uint8Array),\n  encryption_method: z.enum(BYOK_ENCRYPTION_METHODS),\n  created_at: z.string().datetime(),\n  last_used: z.string().datetime().optional(),\n});\n\n/**\n * Routing configuration for an API call.\n *\n * @see storm-022 v1 revision Section 6\n */\nexport interface ApiCallRoute {\n  key_type: ApiKeyType;\n  flow: ApiCallFlow;\n  rate_limited: boolean;\n  usage_logged: boolean;\n}\n\nexport const ApiCallRouteSchema = z.object({\n  key_type: z.enum(API_KEY_TYPES),\n  flow: z.enum(API_CALL_FLOWS),\n  rate_limited: z.boolean(),\n  usage_logged: z.boolean(),\n});\n\n/**\n * Rate limiting configuration for BYOK key decryption.\n *\n * @see storm-022 v1 revision Section 6\n */\nexport interface BYOKRateLimitConfig {\n  max_decryptions_per_minute: number;\n  exponential_backoff: boolean;\n  lockout_after_failures: number;\n  lockout_duration_minutes: number;\n}\n\nexport const BYOKRateLimitConfigSchema = z.object({\n  max_decryptions_per_minute: z.number().int().positive(),\n  exponential_backoff: z.boolean(),\n  lockout_after_failures: z.number().int().positive(),\n  lockout_duration_minutes: z.number().int().positive(),\n});\n\n/**\n * Tracks BYOK decryption attempts for rate limiting.\n *\n * @see storm-022 v1 revision Section 6\n */\nexport interface BYOKDecryptionAttempt {\n  user_id: string;\n  attempted_at: string;\n  success: boolean;\n  consecutive_failures: number;\n  locked_out: boolean;\n  lockout_expires_at: string | null;\n}\n\nexport const BYOKDecryptionAttemptSchema = z.object({\n  user_id: z.string().min(1),\n  attempted_at: z.string().datetime(),\n  success: z.boolean(),\n  consecutive_failures: z.number().int().min(0),\n  locked_out: z.boolean(),\n  lockout_expires_at: z.string().datetime().nullable(),\n});\n\n// ============================================================\n// COMPLIANCE\n// ============================================================\n\n/**\n * Export compliance requirements per region and tier.\n *\n * @see storm-022 v1 revision Section 7\n */\nexport interface ExportComplianceConfig {\n  region: string;\n  standard_tier: ExportComplianceStatus;\n  private_tier: ExportComplianceStatus;\n  documentation_required: string[];\n  notes: string;\n}\n\nexport const ExportComplianceConfigSchema = z.object({\n  region: z.string().min(1),\n  standard_tier: z.enum(EXPORT_COMPLIANCE_STATUSES),\n  private_tier: z.enum(EXPORT_COMPLIANCE_STATUSES),\n  documentation_required: z.array(z.string()),\n  notes: z.string(),\n});\n\n/**\n * App store encryption declarations per platform.\n *\n * @see storm-022 v1 revision Section 7\n */\nexport interface AppStoreDeclaration {\n  platform: Platform;\n  uses_non_exempt_encryption: boolean;\n  eccn?: string;\n  mass_market_exemption?: boolean;\n  self_classification_filed: boolean;\n  annual_report_due?: string;\n}\n\nexport const AppStoreDeclarationSchema = z.object({\n  platform: z.enum(PLATFORMS),\n  uses_non_exempt_encryption: z.boolean(),\n  eccn: z.string().optional(),\n  mass_market_exemption: z.boolean().optional(),\n  self_classification_filed: z.boolean(),\n  annual_report_due: z.string().datetime().optional(),\n});\n\n/**\n * A single entry in the threat model.\n *\n * @see storm-022 v1 revision Section 8\n */\nexport interface ThreatModelEntry {\n  threat: string;\n  protected_by_standard: boolean;\n  protected_by_private: boolean;\n  description: string;\n}\n\nexport const ThreatModelEntrySchema = z.object({\n  threat: z.string().min(1),\n  protected_by_standard: z.boolean(),\n  protected_by_private: z.boolean(),\n  description: z.string().min(1),\n});\n\n/**\n * A single phase in the staged launch strategy.\n *\n * @see storm-022 v1 revision Section 7\n */\nexport interface LaunchPhase {\n  version: string;\n  features: string[];\n  markets: string[];\n  compliance_requirements: string[];\n}\n\nexport const LaunchPhaseSchema = z.object({\n  version: z.string().min(1),\n  features: z.array(z.string()),\n  markets: z.array(z.string()),\n  compliance_requirements: z.array(z.string()),\n});\n\n// ============================================================\n// OFFLINE AUTH\n// ============================================================\n\n/**\n * Configuration for a single offline state.\n *\n * @see storm-022 v1 revision Section 1\n */\nexport interface OfflineStateConfig {\n  state: OfflineState;\n  max_hours: number;\n  functionality: OfflineFunctionality;\n  sync_behavior: OfflineSyncBehavior;\n  auth_behavior: string;\n  private_tier_key_access: boolean;\n}\n\nexport const OfflineStateConfigSchema = z.object({\n  state: z.enum(OFFLINE_STATES),\n  max_hours: z.number().min(0),\n  functionality: z.enum(OFFLINE_FUNCTIONALITY_LEVELS),\n  sync_behavior: z.enum(OFFLINE_SYNC_BEHAVIORS),\n  auth_behavior: z.string().min(1),\n  private_tier_key_access: z.boolean(),\n});\n\n/**\n * Queue of operations pending sync when device comes back online.\n */\nexport interface OfflineSyncQueue {\n  operations: QueuedOperation[];\n  created_at: string;\n  last_attempted: string | null;\n}\n\nexport const OfflineSyncQueueSchema = z.object({\n  operations: z.array(z.lazy(() => QueuedOperationSchema)),\n  created_at: z.string().datetime(),\n  last_attempted: z.string().datetime().nullable(),\n});\n\n/**\n * A single queued operation waiting to sync.\n */\nexport interface QueuedOperation {\n  id: string;\n  type: QueueOperationType;\n  table: QueueableTable;\n  data: unknown;\n  queued_at: string;\n  priority: number;\n}\n\nexport const QueuedOperationSchema = z.object({\n  id: z.string().min(1),\n  type: z.enum(QUEUE_OPERATION_TYPES),\n  table: z.enum(QUEUEABLE_TABLES),\n  data: z.unknown(),\n  queued_at: z.string().datetime(),\n  priority: z.number().int().min(0),\n});\n\n/**\n * Result of checking what's available in the current offline state.\n *\n * @see storm-022 v1 revision Section 1\n */\nexport interface OfflineCapabilityCheck {\n  can_read: boolean;\n  can_write: boolean;\n  can_search: boolean;\n  can_sync: boolean;\n  can_use_llm: boolean;\n  reason: string;\n}\n\nexport const OfflineCapabilityCheckSchema = z.object({\n  can_read: z.boolean(),\n  can_write: z.boolean(),\n  can_search: z.boolean(),\n  can_sync: z.boolean(),\n  can_use_llm: z.boolean(),\n  reason: z.string().min(1),\n});\n\n/**\n * Result of processing the offline sync queue.\n */\nexport interface QueueSyncResult {\n  synced: number;\n  failed: number;\n  errors?: Array<{ operation_id: string; error: string }>;\n}\n\nexport const QueueSyncResultSchema = z.object({\n  synced: z.number().int().min(0),\n  failed: z.number().int().min(0),\n  errors: z.array(z.object({\n    operation_id: z.string(),\n    error: z.string(),\n  })).optional(),\n});\n","/**\n * @module @nous/core/security\n * @description Authentication configuration, token validation, offline state transitions\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Clerk configuration, platform-specific auth, token management,\n * desktop OAuth flow (Tauri), and security measures.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/auth-config.ts} - Spec\n */\n\nimport {\n  type Platform,\n  type OfflineState,\n  type SignInImplementation,\n  OFFLINE_THRESHOLDS,\n  ACCESS_TOKEN_EXPIRY_MINUTES,\n  BRUTE_FORCE_LOCKOUT_ATTEMPTS,\n  BRUTE_FORCE_LOCKOUT_MINUTES,\n  CAPTCHA_AFTER_FAILURES,\n  DEEP_LINK_SCHEME,\n  AUTH_CALLBACK_PATH,\n} from './constants';\n\nimport {\n  type AuthState,\n  type AuthTokens,\n  type PlatformAuthConfig,\n  type AuthSecurityConfig,\n  type JWTValidationResult,\n  type ClerkConfig,\n} from './types';\n\n// ============================================================\n// PLATFORM AUTH CONFIGURATIONS\n// ============================================================\n\n/**\n * Platform auth configurations from brainstorm.\n *\n * | Platform  | Sign in Apple | Google Sign-In | Email/Password |\n * |-----------|---------------|----------------|----------------|\n * | iOS       | native        | native         | clerk_ui       |\n * | Android   | rest_api      | native         | clerk_ui       |\n * | macOS     | native        | oauth          | clerk_web      |\n * | Windows   | oauth         | oauth          | clerk_web      |\n *\n * @see storm-022 v1 revision Section 1 - Platform-Specific Implementation table\n */\nexport const PLATFORM_AUTH_CONFIGS: Record<Platform, PlatformAuthConfig> = {\n  ios: {\n    platform: 'ios',\n    apple_sign_in: 'native',\n    google_sign_in: 'native',\n    email_password: 'clerk_ui',\n  },\n  android: {\n    platform: 'android',\n    apple_sign_in: 'rest_api',\n    google_sign_in: 'native',\n    email_password: 'clerk_ui',\n  },\n  macos: {\n    platform: 'macos',\n    apple_sign_in: 'native',\n    google_sign_in: 'oauth',\n    email_password: 'clerk_web',\n  },\n  windows: {\n    platform: 'windows',\n    apple_sign_in: 'oauth',\n    google_sign_in: 'oauth',\n    email_password: 'clerk_web',\n  },\n} as const;\n\n// ============================================================\n// DEFAULT SECURITY CONFIG\n// ============================================================\n\n/**\n * Default security configuration from brainstorm.\n *\n * @see storm-022 v1 revision Section 1 - Security Measures table\n */\nexport const DEFAULT_SECURITY_CONFIG: AuthSecurityConfig = {\n  brute_force_lockout_attempts: BRUTE_FORCE_LOCKOUT_ATTEMPTS,\n  brute_force_lockout_minutes: BRUTE_FORCE_LOCKOUT_MINUTES,\n  captcha_after_failures: CAPTCHA_AFTER_FAILURES,\n  new_device_email_alert: true,\n  invalidate_sessions_on_password_change: true,\n  mfa_options: ['totp', 'sms', 'passkey'],\n} as const;\n\n// ============================================================\n// DEFAULT DESKTOP CONFIG\n// ============================================================\n\n/**\n * Default desktop (Tauri) Clerk configuration.\n */\nexport const DEFAULT_DESKTOP_CONFIG = {\n  oauth_redirect_uri: `${DEEP_LINK_SCHEME}://${AUTH_CALLBACK_PATH}`,\n  deep_link_scheme: DEEP_LINK_SCHEME,\n} as const;\n\n// ============================================================\n// OFFLINE STATE TRANSITION REFERENCE\n// ============================================================\n\n/**\n * Reference descriptions for offline state transitions.\n *\n * @see storm-022 v1 revision Section 1 - State transitions\n */\nexport const OFFLINE_STATE_TRANSITION_REFERENCE = {\n  online: 'Full functionality',\n  short_offline: `<${OFFLINE_THRESHOLDS.short_offline}h, JWT valid, full functionality`,\n  medium_offline: `<${OFFLINE_THRESHOLDS.medium_offline}h, JWT expired, read-only + queued writes`,\n  long_offline: `>${OFFLINE_THRESHOLDS.medium_offline}h, refresh expired, local only`,\n  reauth_required: 'Must reconnect to continue',\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Checks if the access token is still valid (not expired).\n *\n * @param tokens - Current auth tokens\n * @returns True if access token has not expired\n */\nexport function isTokenValid(tokens: AuthTokens): boolean {\n  const expiresAt = new Date(tokens.expires_at).getTime();\n  return Date.now() < expiresAt;\n}\n\n/**\n * Determines if re-authentication is required.\n * True when refresh token has expired (>30 days).\n *\n * @param auth - Current auth state\n * @returns True if re-auth is needed\n */\nexport function shouldReauthenticate(auth: AuthState): boolean {\n  const lastOnline = new Date(auth.last_online).getTime();\n  const hoursSinceOnline = (Date.now() - lastOnline) / (1000 * 60 * 60);\n  return hoursSinceOnline >= OFFLINE_THRESHOLDS.medium_offline;\n}\n\n/**\n * Calculates the current offline state based on time since last online\n * and token validity.\n *\n * @param auth - Current auth state\n * @returns Updated offline state\n *\n * @see storm-022 v1 revision Section 1 - updateOfflineState() implementation\n */\nexport function updateOfflineState(auth: AuthState): OfflineState {\n  const lastOnline = new Date(auth.last_online).getTime();\n  const hoursSinceOnline = (Date.now() - lastOnline) / (1000 * 60 * 60);\n\n  // If very recently online (within margin), treat as online\n  if (hoursSinceOnline < 0.01) {\n    return 'online';\n  }\n\n  if (hoursSinceOnline < OFFLINE_THRESHOLDS.short_offline && isTokenValid(auth.tokens)) {\n    return 'short_offline';\n  }\n\n  if (hoursSinceOnline < OFFLINE_THRESHOLDS.medium_offline) {\n    return 'medium_offline';\n  }\n\n  return 'long_offline';\n}\n\n/**\n * Gets the platform auth configuration for a specific platform.\n *\n * @param platform - Target platform\n * @returns Platform auth config\n */\nexport function getPlatformAuthConfig(platform: Platform): PlatformAuthConfig {\n  return PLATFORM_AUTH_CONFIGS[platform];\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Gets the Clerk configuration for a specific platform.\n * Requires Clerk SDK integration.\n *\n * @param _platform - Target platform\n * @returns Clerk config for that platform\n */\nexport function getClerkConfig(_platform: Platform): ClerkConfig {\n  throw new Error('getClerkConfig requires Clerk SDK integration');\n}\n\n/**\n * Validates a JWT token against Clerk's public keys.\n * Requires Clerk SDK or JWKS endpoint.\n *\n * @param _token - JWT access token\n * @returns Validation result with user_id if valid\n */\nexport async function validateJWT(_token: string): Promise<JWTValidationResult> {\n  throw new Error('validateJWT requires Clerk SDK implementation');\n}\n","/**\n * @module @nous/core/security\n * @description Two-tier privacy model: definitions, comparison, tier migration\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Simplified two-tier privacy model (Standard vs Private).\n * Key insight: Don't offer \"partial\" encryption. Either data is\n * protected (Private) or it's convenient (Standard).\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/privacy-tiers.ts} - Spec\n */\n\nimport {\n  type PrivacyTier,\n  MIGRATION_RATE_MS_PER_1K_NODES,\n} from './constants';\n\nimport {\n  type TierDefinition,\n  type TierComparison,\n  type TierMigrationRequest,\n  type TierMigrationState,\n} from './types';\n\n// ============================================================\n// TIER DEFINITIONS\n// ============================================================\n\n/**\n * Complete tier definitions from brainstorm.\n *\n * @see storm-022 v1 revision Section 2 - Tier 1: Standard, Tier 2: Private\n */\nexport const TIER_DEFINITIONS: Record<PrivacyTier, TierDefinition> = {\n  standard: {\n    tier: 'standard',\n    name: 'Standard',\n    description: 'Server-managed security with full cloud features. Your data is encrypted at rest and in transit.',\n    target_user: 'Users who prioritize convenience over maximum privacy. Trust Nous with their data (but not random attackers).',\n    search: 'cloud',\n    llm_access: 'direct',\n    key_management: 'none',\n    data_protection: [\n      'Data in transit: TLS 1.3 + certificate pinning',\n      'Data at rest: Turso built-in encryption (AES-256)',\n      'Separation: Database-per-tenant (your data isolated)',\n    ],\n    data_exposure: [\n      'Nous can technically access your data (for support, debugging)',\n      'Subpoena could compel disclosure',\n      'Server-side breach could expose plaintext',\n    ],\n  },\n  private: {\n    tier: 'private',\n    name: 'Private',\n    description: 'Full end-to-end encryption. Content and embeddings encrypted client-side. Nous cannot access your data.',\n    target_user: 'Journalists, activists, privacy advocates. Users who don\\'t want ANYONE to access their data. Willing to accept feature limitations.',\n    search: 'client_only',\n    llm_access: 'explicit_consent',\n    key_management: 'passkey_derived',\n    data_protection: [\n      'Content: AES-256-GCM encrypted (client-side)',\n      'Embeddings: AES-256-GCM encrypted (client-side)',\n      'Metadata: Type/ID plaintext (for sync), everything else encrypted',\n      'Nous CANNOT access your data - we literally don\\'t have the keys',\n    ],\n    data_exposure: [\n      'All search is local (must decrypt to search)',\n      'LLM features require explicit consent per-query',\n      'Larger devices needed (100MB+ for index)',\n      'You can lose your data if you lose keys',\n    ],\n  },\n} as const;\n\n// ============================================================\n// TIER COMPARISON TABLE\n// ============================================================\n\n/**\n * Feature comparison between tiers (for UI display).\n *\n * @see storm-022 v1 revision Section 2 - Updated Architecture Overview table\n */\nexport const TIER_COMPARISON_TABLE: TierComparison[] = [\n  {\n    feature: 'Search',\n    standard: 'Full cloud (HNSW + BM25)',\n    private_tier: 'Client-side only',\n  },\n  {\n    feature: 'LLM Features',\n    standard: 'Direct, seamless',\n    private_tier: 'Explicit consent required',\n  },\n  {\n    feature: 'Key Management',\n    standard: 'None (server-managed)',\n    private_tier: 'Passkey-derived master key',\n  },\n  {\n    feature: 'Data Accessible To',\n    standard: 'Nous (for support), law enforcement (with subpoena)',\n    private_tier: 'Only you (with your keys)',\n  },\n  {\n    feature: 'Recovery Options',\n    standard: 'Email, password reset',\n    private_tier: 'Recovery code only (after 7-day grace)',\n  },\n  {\n    feature: 'Offline Experience',\n    standard: 'Read-only when offline, sync when back',\n    private_tier: 'Full offline (passkey unlock is local)',\n  },\n  {\n    feature: 'Device Requirements',\n    standard: 'Any',\n    private_tier: '100MB+ for search index',\n  },\n  {\n    feature: 'Export Compliance',\n    standard: 'HTTPS exempt, no extra docs',\n    private_tier: 'ECCN 5D992, requires documentation',\n  },\n] as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Gets the complete tier definition.\n *\n * @param tier - Privacy tier\n * @returns Complete tier definition\n */\nexport function getTierDefinition(tier: PrivacyTier): TierDefinition {\n  return TIER_DEFINITIONS[tier];\n}\n\n/**\n * Checks if migration between two tiers is possible.\n * Both directions are valid: standard -> private and private -> standard.\n * Migration from a tier to itself is not valid.\n *\n * @param from - Current tier\n * @param to - Target tier\n * @returns True if migration is possible\n */\nexport function canMigrateTier(from: PrivacyTier, to: PrivacyTier): boolean {\n  return from !== to;\n}\n\n/**\n * Estimates migration time in milliseconds based on node count.\n * Uses MIGRATION_RATE_MS_PER_1K_NODES (~60s per 1K nodes).\n *\n * @param node_count - Total number of nodes to migrate\n * @returns Estimated time in milliseconds\n *\n * @see storm-022 v1 revision Section 4 - \"Duration: ~1 minute per 1K nodes\"\n */\nexport function estimateMigrationTime(node_count: number): number {\n  return Math.ceil(node_count / 1000) * MIGRATION_RATE_MS_PER_1K_NODES;\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Initiates a tier migration. Creates the migration state\n * and begins the background process.\n * Requires server-side migration state tracking and encryption services.\n *\n * @param _request - Migration request\n * @returns Initial migration state\n */\nexport async function startTierMigration(\n  _request: TierMigrationRequest,\n): Promise<TierMigrationState> {\n  throw new Error('startTierMigration requires server-side migration state and encryption services');\n}\n\n/**\n * Gets current migration progress for a user.\n * Returns null if no migration is in progress.\n * Requires server-side migration state lookup.\n *\n * @param _user_id - User ID\n * @returns Current migration state or null\n */\nexport async function getTierMigrationProgress(\n  _user_id: string,\n): Promise<TierMigrationState | null> {\n  throw new Error('getTierMigrationProgress requires server-side migration state lookup');\n}\n","/**\n * @module @nous/core/security\n * @description E2E encryption schema, encrypted node structure, client-side search\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Encryption field mapping, client-side search configs, and encrypt/decrypt\n * operations for Private tier nodes.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/encryption.ts} - Spec\n */\n\nimport {\n  PRIVATE_TIER_NODE_LIMITS,\n} from './constants';\n\nimport {\n  type EncryptionFieldMap,\n  type EncryptionResult,\n  type DecryptionResult,\n  type ClientSearchConfig,\n  type LocalSearchResult,\n  type HNSWIndex,\n  type EncryptedNodeSchema,\n  type DerivedKeys,\n} from './types';\n\n// ============================================================\n// ENCRYPTION FIELD MAP\n// ============================================================\n\n/**\n * Concrete field mapping for Private tier encryption.\n * Defines which node fields are encrypted vs. stay plaintext.\n *\n * Design principle: Minimal plaintext. Only fields absolutely required\n * for sync and basic filtering remain unencrypted.\n *\n * @see storm-022 v1 revision Section 2 - SQL schema comments\n * @see storm-011 spec/node-schema.ts - NousNode interface fields\n */\nexport const ENCRYPTION_FIELD_MAP: EncryptionFieldMap = {\n  plaintext: [\n    'id',\n    'type',\n    'version',\n    'updated_at',\n    'encryption_version',\n    'nonce',\n    'encryption_tier',\n  ],\n  encrypted_content: [\n    'content.title',\n    'content.body',\n    'content.summary',\n    'content.blocks',\n  ],\n  encrypted_embedding: [\n    'embedding.vector',\n  ],\n  encrypted_metadata: [\n    'temporal.ingestion',\n    'temporal.event',\n    'temporal.content_times',\n    'temporal.reference_patterns',\n    'neural.stability',\n    'neural.retrievability',\n    'neural.last_accessed',\n    'neural.access_count',\n    'provenance.source',\n    'provenance.parent_id',\n    'provenance.confidence',\n    'state.extraction_depth',\n    'state.lifecycle',\n    'versioning.lastModified',\n    'versioning.lastModifier',\n    'versioning.checksum',\n  ],\n} as const;\n\n// ============================================================\n// EXTENDED SQL SCHEMA\n// ============================================================\n\n/**\n * Additional SQL columns for encrypted nodes.\n * These extend the storm-017 nodes table which already has\n * encrypted_payload and encryption_tier.\n *\n * @see storm-017 spec/schema.ts - Existing NODES_TABLE\n */\nexport const ENCRYPTED_NODES_ADDITIONAL_SQL = `\n-- Additional columns for storm-022 Private tier encryption\n-- (encrypted_payload and encryption_tier already exist from storm-017)\n\nALTER TABLE nodes ADD COLUMN encrypted_embedding BLOB;\nALTER TABLE nodes ADD COLUMN encryption_version INTEGER DEFAULT 1;\nALTER TABLE nodes ADD COLUMN nonce BLOB;\n\n-- Index on encryption version for key rotation queries\nCREATE INDEX IF NOT EXISTS idx_nodes_encryption_version ON nodes(encryption_version)\n  WHERE encryption_tier = 'private';\n`;\n\n// ============================================================\n// CLIENT SEARCH CONFIGS\n// ============================================================\n\n/**\n * Default client search configuration for mobile devices.\n */\nexport const DEFAULT_CLIENT_SEARCH_CONFIG_MOBILE: ClientSearchConfig = {\n  hnsw_ef_construction: 200,\n  hnsw_ef_search: 50,\n  hnsw_m: 16,\n  max_nodes: PRIVATE_TIER_NODE_LIMITS.mobile,\n  index_in_memory: true,\n} as const;\n\n/**\n * Default client search configuration for desktop devices.\n */\nexport const DEFAULT_CLIENT_SEARCH_CONFIG_DESKTOP: ClientSearchConfig = {\n  hnsw_ef_construction: 200,\n  hnsw_ef_search: 50,\n  hnsw_m: 16,\n  max_nodes: PRIVATE_TIER_NODE_LIMITS.desktop,\n  index_in_memory: true,\n} as const;\n\n// ============================================================\n// PERFORMANCE REFERENCE\n// ============================================================\n\n/**\n * Client-side search performance reference table.\n *\n * | Node Count | Memory   | Index Build  | Search Latency |\n * |------------|----------|--------------|----------------|\n * | 10K        | ~130 MB  | ~2 seconds   | ~20ms          |\n * | 50K        | ~650 MB  | ~10 seconds  | ~40ms          |\n * | 100K       | ~1.3 GB  | ~20 seconds  | ~60ms          |\n *\n * @see storm-022 v1 revision Section 2 - Performance Limits table\n */\nexport const PERFORMANCE_REFERENCE = {\n  '10k': {\n    memory_mb: 130,\n    index_build_seconds: 2,\n    search_latency_ms: 20,\n  },\n  '50k': {\n    memory_mb: 650,\n    index_build_seconds: 10,\n    search_latency_ms: 40,\n  },\n  '100k': {\n    memory_mb: 1300,\n    index_build_seconds: 20,\n    search_latency_ms: 60,\n  },\n} as const;\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Encrypts a full node for Private tier storage.\n * Separates content into encrypted_payload and encrypted_embedding.\n * Requires Web Crypto API.\n *\n * @param _node - The plaintext NousNode to encrypt\n * @param _keys - Derived encryption keys (content, embedding, metadata)\n * @returns Encryption result with payload, embedding, nonce, and version\n */\nexport async function encryptNode(\n  _node: unknown,\n  _keys: DerivedKeys,\n): Promise<EncryptionResult> {\n  throw new Error('encryptNode requires Web Crypto API implementation');\n}\n\n/**\n * Decrypts an encrypted node back to its component fields.\n * Requires Web Crypto API.\n *\n * @param _encrypted - The encrypted node schema\n * @param _keys - Derived decryption keys\n * @returns Decrypted node fields\n */\nexport async function decryptNode(\n  _encrypted: EncryptedNodeSchema,\n  _keys: DerivedKeys,\n): Promise<DecryptionResult> {\n  throw new Error('decryptNode requires Web Crypto API implementation');\n}\n\n/**\n * Encrypts an embedding vector with the embedding key.\n * Requires Web Crypto API.\n *\n * @param _vector - Float32Array embedding\n * @param _key - Embedding encryption key\n * @returns Encrypted embedding bytes\n */\nexport async function encryptEmbedding(\n  _vector: Float32Array,\n  _key: CryptoKey,\n): Promise<Uint8Array> {\n  throw new Error('encryptEmbedding requires Web Crypto API implementation');\n}\n\n/**\n * Decrypts an encrypted embedding back to Float32Array.\n * Requires Web Crypto API.\n *\n * @param _encrypted - Encrypted embedding bytes\n * @param _key - Embedding decryption key\n * @returns Decrypted Float32Array\n */\nexport async function decryptEmbedding(\n  _encrypted: Uint8Array,\n  _key: CryptoKey,\n): Promise<Float32Array> {\n  throw new Error('decryptEmbedding requires Web Crypto API implementation');\n}\n\n/**\n * Builds an in-memory HNSW index from decrypted embeddings.\n * Requires HNSW library (e.g., hnswlib-node).\n *\n * @param _decryptedEmbeddings - Map of node_id to decrypted Float32Array\n * @param _config - HNSW configuration\n * @returns In-memory HNSW index\n */\nexport async function buildLocalSearchIndex(\n  _decryptedEmbeddings: Map<string, Float32Array>,\n  _config: ClientSearchConfig,\n): Promise<HNSWIndex> {\n  throw new Error('buildLocalSearchIndex requires HNSW library implementation');\n}\n\n/**\n * Searches the local HNSW index.\n * Requires HNSW library.\n *\n * @param _index - In-memory HNSW index\n * @param _query - Query embedding vector\n * @param _topK - Number of results to return\n * @returns Search results ordered by similarity\n */\nexport async function searchLocalIndex(\n  _index: HNSWIndex,\n  _query: Float32Array,\n  _topK: number,\n): Promise<LocalSearchResult[]> {\n  throw new Error('searchLocalIndex requires HNSW library implementation');\n}\n","/**\n * @module @nous/core/security\n * @description Key hierarchy, derivation, master key, derived keys, multi-device sync, key rotation\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Key hierarchy for Private tier: Passkey -> HKDF-SHA256 -> Master Key -> Derived Keys\n * Key rotation: incremental background re-encryption (100 nodes/batch, throttled).\n *\n * CRITICAL: Master key is NEVER stored. It exists in memory only.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/key-hierarchy.ts} - Spec\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/key-rotation.ts} - Spec\n */\n\nimport {\n  type KeyPurpose,\n  type KeyRotationTrigger,\n  DERIVATION_INFO_STRINGS,\n  MASTER_KEY_LENGTH_BITS,\n  PASSKEY_SYNC_MECHANISMS,\n  ROTATION_BATCH_SIZE,\n  ROTATION_PAUSE_BETWEEN_BATCHES_MS,\n  ROTATION_MAX_BATCHES_PER_MINUTE,\n  ROTATION_MIN_BATTERY_LEVEL,\n  ROTATION_TIMING_ESTIMATES,\n} from './constants';\n\nimport {\n  type KeyDerivationParams,\n  type DerivedKeys,\n  type MultiDeviceKeySync,\n  type RotationConfig,\n  type RotationProgress,\n  type UserKeyMetadata,\n  type EncryptedNodeSchema,\n} from './types';\n\n// ============================================================\n// MULTI-DEVICE KEY SYNC CONFIG\n// ============================================================\n\n/**\n * Default multi-device sync configuration.\n * Passkey syncs via platform credential manager.\n * No key transmission needed  derivation is deterministic.\n *\n * @see storm-022 v1 revision Section 3 - Multi-Device Sync\n */\nexport const DEFAULT_MULTI_DEVICE_SYNC: MultiDeviceKeySync = {\n  method: 'passkey_platform_sync',\n  description: 'Passkey syncs via platform credential manager. On new device: authenticate  derive keys. No key transmission needed  derivation is deterministic.',\n  sync_mechanisms: PASSKEY_SYNC_MECHANISMS,\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Creates KeyDerivationParams for a specific purpose.\n *\n * @param purpose - Key purpose ('content', 'embedding', 'metadata')\n * @param salt - Per-version unique salt\n * @returns Params for HKDF derivation\n */\nexport function createDerivationParams(\n  purpose: KeyPurpose,\n  salt: Uint8Array,\n): KeyDerivationParams {\n  return {\n    algorithm: 'HKDF',\n    hash: 'SHA-256',\n    salt,\n    info: DERIVATION_INFO_STRINGS[purpose],\n    key_length: MASTER_KEY_LENGTH_BITS,\n  };\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Derives a master key from a passkey secret and salt.\n * Uses HKDF-SHA256 to produce a 256-bit AES key.\n * Requires Web Crypto API.\n *\n * @param _passkeySecret - Raw secret from passkey authentication\n * @param _salt - Per-version derivation salt (stored server-side)\n * @returns Master CryptoKey (in-memory only, never persist)\n */\nexport async function deriveMasterKey(\n  _passkeySecret: Uint8Array,\n  _salt: Uint8Array,\n): Promise<CryptoKey> {\n  throw new Error('deriveMasterKey requires Web Crypto API implementation');\n}\n\n/**\n * Derives the content encryption key from the master key.\n * Uses HKDF with info string 'nous-content'.\n * Requires Web Crypto API.\n *\n * @param _masterKey - Master CryptoKey\n * @returns Content encryption CryptoKey (AES-256-GCM)\n */\nexport async function deriveContentKey(_masterKey: CryptoKey): Promise<CryptoKey> {\n  throw new Error('deriveContentKey requires Web Crypto API implementation');\n}\n\n/**\n * Derives the embedding encryption key from the master key.\n * Uses HKDF with info string 'nous-embedding'.\n * Requires Web Crypto API.\n *\n * @param _masterKey - Master CryptoKey\n * @returns Embedding encryption CryptoKey (AES-256-GCM)\n */\nexport async function deriveEmbeddingKey(_masterKey: CryptoKey): Promise<CryptoKey> {\n  throw new Error('deriveEmbeddingKey requires Web Crypto API implementation');\n}\n\n/**\n * Derives the metadata encryption key from the master key.\n * Uses HKDF with info string 'nous-metadata'.\n * Requires Web Crypto API.\n *\n * @param _masterKey - Master CryptoKey\n * @returns Metadata encryption CryptoKey (AES-256-GCM)\n */\nexport async function deriveMetadataKey(_masterKey: CryptoKey): Promise<CryptoKey> {\n  throw new Error('deriveMetadataKey requires Web Crypto API implementation');\n}\n\n/**\n * Derives all three sub-keys from the master key in one operation.\n * Requires Web Crypto API.\n *\n * @param _masterKey - Master CryptoKey\n * @returns All derived keys (content, embedding, metadata)\n */\nexport async function deriveAllKeys(_masterKey: CryptoKey): Promise<DerivedKeys> {\n  throw new Error('deriveAllKeys requires Web Crypto API implementation');\n}\n\n/**\n * Generates a cryptographically random salt for key derivation.\n * Requires Web Crypto API (crypto.getRandomValues).\n *\n * @returns Random salt bytes (32 bytes)\n */\nexport function generateSalt(): Uint8Array {\n  throw new Error('generateSalt requires Web Crypto API implementation');\n}\n\n// ============================================================\n// KEY ROTATION CONFIGURATION\n// ============================================================\n\n/**\n * Default rotation configuration from brainstorm.\n *\n * Design principles:\n * - Battery-aware: Only runs on Wi-Fi + charging (mobile)\n * - Resumable: Progress persisted after each batch\n * - Throttled: 500ms pause between batches prevents UI jank\n * - Non-blocking: User can continue using app during rotation\n *\n * @see storm-022 v2 Section 9.7 - RotationConfig\n */\nexport const DEFAULT_ROTATION_CONFIG: RotationConfig = {\n  batch_size: ROTATION_BATCH_SIZE,\n  pause_between_batches_ms: ROTATION_PAUSE_BETWEEN_BATCHES_MS,\n  max_batches_per_minute: ROTATION_MAX_BATCHES_PER_MINUTE,\n  require_wifi: true,\n  require_charging: true,\n  min_battery_level: ROTATION_MIN_BATTERY_LEVEL,\n  persist_progress: true,\n  auto_resume_on_launch: true,\n} as const;\n\n/**\n * Re-encryption timing estimates (throttled, Wi-Fi + charging).\n *\n * | Node Count | Re-encryption Time | Background (throttled) |\n * |------------|--------------------|-----------------------|\n * | 1,000      | ~30 seconds        | ~2 minutes            |\n * | 10,000     | ~5 minutes         | ~15 minutes           |\n * | 50,000     | ~25 minutes        | ~1 hour               |\n *\n * @see storm-022 v2 Section 9.3 - Timing Estimates table\n */\nexport const ROTATION_TIMING_REFERENCE = ROTATION_TIMING_ESTIMATES;\n\n// ============================================================\n// KEY ROTATION EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Initiates key rotation for a user.\n * Creates new key version, starts background re-encryption.\n * Requires Web Crypto API and server-side key metadata storage.\n *\n * @param _user_id - User initiating rotation\n * @param _trigger - What triggered this rotation\n * @returns Initial rotation progress\n *\n * @see storm-022 v2 Section 9.3 - Phase 1: New Key Generation\n */\nexport async function initiateKeyRotation(\n  _user_id: string,\n  _trigger: KeyRotationTrigger,\n): Promise<RotationProgress> {\n  throw new Error('initiateKeyRotation requires Web Crypto API and server-side key metadata');\n}\n\n/**\n * Background re-encryption of nodes from old key to new key.\n * Processes in batches, respects battery/Wi-Fi conditions,\n * persists progress for resumption.\n *\n * IMPORTANT: New writes during rotation always use the new key (N+1).\n * Old reads check encryption_version and use the appropriate key.\n * Requires Web Crypto API and database adapter.\n *\n * @param _old_key - Previous version CryptoKey\n * @param _new_key - New version CryptoKey\n * @param _progress - Current rotation progress (for resumption)\n *\n * @see storm-022 v2 Section 9.7 - backgroundReencrypt()\n */\nexport async function backgroundReencrypt(\n  _old_key: CryptoKey,\n  _new_key: CryptoKey,\n  _progress: RotationProgress,\n): Promise<void> {\n  throw new Error('backgroundReencrypt requires Web Crypto API and database adapter');\n}\n\n/**\n * Gets nodes that still need re-encryption.\n * Returns batch of nodes with old encryption_version.\n * Requires database adapter.\n *\n * @param _last_processed_id - Resume from this node ID (null for start)\n * @returns Array of encrypted nodes needing rotation\n */\nexport async function getNodesNeedingRotation(\n  _last_processed_id: string | null,\n): Promise<EncryptedNodeSchema[]> {\n  throw new Error('getNodesNeedingRotation requires database adapter');\n}\n\n/**\n * Checks whether rotation can continue based on device conditions.\n * Returns false if: no Wi-Fi, not charging, battery low.\n * Requires platform-specific battery/network APIs.\n *\n * @returns True if conditions allow rotation to continue\n *\n * @see storm-022 v2 Section 9.7 - Conditions for background execution\n */\nexport async function canContinueRotation(): Promise<boolean> {\n  throw new Error('canContinueRotation requires platform battery/network APIs');\n}\n\n/**\n * Saves rotation progress to persistent storage.\n * Called after each batch so rotation can resume after interruption.\n * Requires server-side progress storage.\n *\n * @param _progress - Current rotation state\n *\n * @see storm-022 v2 Section 9.6 - \"Progress saved after each batch\"\n */\nexport async function saveRotationProgress(\n  _progress: RotationProgress,\n): Promise<void> {\n  throw new Error('saveRotationProgress requires server-side progress storage');\n}\n\n/**\n * Resumes an interrupted rotation.\n * Returns null if no rotation was in progress.\n * Requires server-side progress lookup.\n *\n * @param _user_id - User ID\n * @returns Saved progress or null\n *\n * @see storm-022 v2 Section 9.6 - \"Rotation continues from last successful batch\"\n */\nexport async function resumeRotation(\n  _user_id: string,\n): Promise<RotationProgress | null> {\n  throw new Error('resumeRotation requires server-side progress lookup');\n}\n\n/**\n * Verifies rotation integrity by sampling nodes.\n * Decrypts a percentage of nodes with the new key and\n * verifies content integrity via hash check.\n * Requires Web Crypto API and database adapter.\n *\n * @param _new_key - New CryptoKey to verify with\n * @param _sample_percent - Percentage of nodes to sample (default: 5%)\n * @returns True if all sampled nodes decrypt correctly\n *\n * @see storm-022 v2 Section 9.3 - \"Sample 5% of nodes\"\n */\nexport async function verifyRotation(\n  _new_key: CryptoKey,\n  _sample_percent: number,\n): Promise<boolean> {\n  throw new Error('verifyRotation requires Web Crypto API and database adapter');\n}\n\n/**\n * Completes rotation: marks new key active, old key deprecated.\n * Old key retained for 30 days to handle devices that haven't synced yet.\n * Requires server-side key metadata update.\n *\n * @param _user_id - User ID\n *\n * @see storm-022 v2 Section 9.3 - Phase 3: Cleanup\n */\nexport async function completeRotation(\n  _user_id: string,\n): Promise<void> {\n  throw new Error('completeRotation requires server-side key metadata update');\n}\n\n/**\n * Gets the appropriate CryptoKey for decrypting a specific node.\n * Checks the node's encryption_version against available key versions.\n * Requires key derivation from stored salts.\n *\n * @param _node - Encrypted node with encryption_version field\n * @param _metadata - User's key metadata with all versions\n * @returns The correct CryptoKey for this node's version\n *\n * @see storm-022 v2 Section 9.6 - READ OPERATION during rotation\n */\nexport function getKeyVersionForNode(\n  _node: EncryptedNodeSchema,\n  _metadata: UserKeyMetadata,\n): CryptoKey {\n  throw new Error('getKeyVersionForNode requires key derivation from stored salts');\n}\n","/**\n * @module @nous/core/security\n * @description Recovery system: BIP39 codes, forced verification, grace period\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * 24-word BIP39 recovery, forced verification, 7-day grace period,\n * recovery code regeneration, and periodic reminders.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/recovery.ts} - Spec\n */\n\nimport {\n  type RecoveryReminderType,\n  RECOVERY_WORD_COUNT,\n  RECOVERY_VERIFICATION_WORD_COUNT,\n} from './constants';\n\nimport {\n  type RecoveryRegenerationResult,\n  type RecoveryReminder,\n} from './types';\n\n// ============================================================\n// RECOVERY CONSTANTS\n// ============================================================\n\n/**\n * HKDF info string for deriving recovery key from BIP39 entropy.\n *\n * @see storm-022 v2 Section 9.5\n */\nexport const RECOVERY_DERIVATION_INFO = 'nous-recovery';\n\n/**\n * Recovery key length in bytes (32 bytes = 256 bits).\n */\nexport const RECOVERY_KEY_LENGTH_BYTES = 32;\n\n// ============================================================\n// RECOVERY REMINDER MESSAGES\n// ============================================================\n\n/**\n * Default reminder messages for each recovery reminder type.\n *\n * @see storm-022 v1 revision Section 3 - Periodic Reminders\n */\nexport const RECOVERY_REMINDER_MESSAGES: Record<RecoveryReminderType, string> = {\n  initial: 'Have you stored your recovery code safely? Without it, your data cannot be recovered if you lose all your devices.',\n  periodic: 'Recovery code reminder: Make sure your recovery code is still accessible. If you\\'ve lost it, regenerate a new one in Settings > Security.',\n  new_device: 'Welcome to your new device. Remember, your recovery code is the ultimate backup if you lose access to all your devices.',\n} as const;\n\n// ============================================================\n// OLD CODE ERROR MESSAGE\n// ============================================================\n\n/**\n * Error message shown when user attempts to use an invalidated recovery code.\n *\n * @see storm-022 v2 Section 9.5 - Old Code Behavior\n */\nexport const OLD_CODE_ERROR_MESSAGE =\n  'This recovery code is no longer valid. It was replaced on {date}. If you didn\\'t change your passkey, contact support immediately.';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Selects random word indices for forced verification.\n * Returns RECOVERY_VERIFICATION_WORD_COUNT (3) random indices\n * from the 24-word mnemonic.\n *\n * @returns Array of 3 unique random indices (0 to 23)\n */\nexport function getVerificationIndices(): number[] {\n  const indices: number[] = [];\n  while (indices.length < RECOVERY_VERIFICATION_WORD_COUNT) {\n    const idx = Math.floor(Math.random() * RECOVERY_WORD_COUNT);\n    if (!indices.includes(idx)) {\n      indices.push(idx);\n    }\n  }\n  return indices.sort((a, b) => a - b);\n}\n\n/**\n * Verifies the user's answers during forced verification.\n * Checks that the words at the specified indices match.\n *\n * @param mnemonic - The full 24-word recovery code\n * @param indices - The 3 indices being verified\n * @param answers - The user's 3 answers\n * @returns True if all answers match (case-insensitive)\n */\nexport function verifyRecoveryWords(\n  mnemonic: string[],\n  indices: number[],\n  answers: string[],\n): boolean {\n  if (indices.length !== answers.length) {\n    return false;\n  }\n\n  return indices.every((index, i) => {\n    const expected = mnemonic[index];\n    const answer = answers[i];\n    if (expected === undefined || answer === undefined) {\n      return false;\n    }\n    return expected.toLowerCase() === answer.toLowerCase();\n  });\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Generates a new 24-word BIP39 recovery mnemonic.\n * Requires BIP39 library and crypto.getRandomValues.\n *\n * @returns Array of 24 BIP39-compliant words\n */\nexport function generateRecoveryCode(): string[] {\n  throw new Error('generateRecoveryCode requires BIP39 library implementation');\n}\n\n/**\n * Derives a CryptoKey from a BIP39 mnemonic for recovery purposes.\n * Requires BIP39 library and Web Crypto API.\n *\n * @param _mnemonic - The 24-word BIP39 mnemonic\n * @returns Recovery CryptoKey (AES-256-GCM)\n */\nexport async function deriveRecoveryKey(\n  _mnemonic: string[],\n): Promise<CryptoKey> {\n  throw new Error('deriveRecoveryKey requires BIP39 library and Web Crypto API implementation');\n}\n\n/**\n * Encrypts the user's master key with the recovery key.\n * Requires Web Crypto API.\n *\n * @param _master_key - The user's master CryptoKey\n * @param _recovery_key - CryptoKey derived from recovery mnemonic\n * @returns Encrypted master key blob\n */\nexport async function encryptMasterKeyForRecovery(\n  _master_key: CryptoKey,\n  _recovery_key: CryptoKey,\n): Promise<Uint8Array> {\n  throw new Error('encryptMasterKeyForRecovery requires Web Crypto API implementation');\n}\n\n/**\n * Recovers the master key using a recovery mnemonic.\n * Requires BIP39 library and Web Crypto API.\n *\n * @param _mnemonic - The 24-word BIP39 mnemonic\n * @param _encrypted_master - Encrypted master key blob from server\n * @returns Recovered master CryptoKey\n */\nexport async function recoverMasterKey(\n  _mnemonic: string[],\n  _encrypted_master: Uint8Array,\n): Promise<CryptoKey> {\n  throw new Error('recoverMasterKey requires BIP39 library and Web Crypto API implementation');\n}\n\n/**\n * Regenerates the recovery code, invalidating the old one.\n * Requires BIP39 library, Web Crypto API, and server-side storage.\n *\n * @param _user_id - User whose recovery code is being regenerated\n * @param _master_key - Current master CryptoKey\n * @returns Regeneration result with new mnemonic\n */\nexport async function regenerateRecoveryCode(\n  _user_id: string,\n  _master_key: CryptoKey,\n): Promise<RecoveryRegenerationResult> {\n  throw new Error('regenerateRecoveryCode requires BIP39 library and server integration');\n}\n\n/**\n * Checks whether the grace period is still active for a user.\n * Requires server-side grace period state lookup.\n *\n * @param _user_id - User ID\n * @returns True if grace period is active\n */\nexport async function isGracePeriodActive(\n  _user_id: string,\n): Promise<boolean> {\n  throw new Error('isGracePeriodActive requires server-side state lookup');\n}\n\n/**\n * Recovers the master key via email during the grace period.\n * Requires server-side email verification.\n *\n * @param _user_id - User ID\n * @param _email_token - Email verification token\n * @returns Recovered master CryptoKey\n */\nexport async function recoverViaEmail(\n  _user_id: string,\n  _email_token: string,\n): Promise<CryptoKey> {\n  throw new Error('recoverViaEmail requires server-side email verification implementation');\n}\n\n/**\n * Gets the current recovery reminder for a user, if any.\n * Requires server-side reminder state lookup.\n *\n * @param _user_id - User ID\n * @returns Recovery reminder or null if none due\n */\nexport function getRecoveryReminder(\n  _user_id: string,\n): RecoveryReminder | null {\n  throw new Error('getRecoveryReminder requires server-side state lookup');\n}\n\n/**\n * Dismisses a recovery reminder for a user.\n * Requires server-side state update.\n *\n * @param _user_id - User ID\n * @param _reminder_type - Type of reminder being dismissed\n */\nexport async function dismissRecoveryReminder(\n  _user_id: string,\n  _reminder_type: RecoveryReminderType,\n): Promise<void> {\n  throw new Error('dismissRecoveryReminder requires server-side state update');\n}\n","/**\n * @module @nous/core/security\n * @description LLM consent UX: scopes, dialog types, visual indicators, revocation\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Consent state management, topic matching, decline handling,\n * and revocation for Private tier LLM access.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/consent-ux.ts} - Spec\n */\n\nimport {\n  type ConsentScope,\n  type ConsentRevocationScope,\n  DECLINE_ACTIONS,\n  DEFAULT_CONSENT_SCOPE,\n  CONVERSATION_TIMEOUT_MINUTES,\n  TOPIC_SIMILARITY_THRESHOLD,\n} from './constants';\n\nimport {\n  type ConsentState,\n  type ConsentSettings,\n  type ConsentDialogData,\n  type TopicConsent,\n  type ConsentRevocationRequest,\n  type DeclineResult,\n  type SharedMemoryDetail,\n} from './types';\n\n// ============================================================\n// DEFAULT CONSENT SETTINGS\n// ============================================================\n\n/**\n * Default consent settings for new Private tier users.\n *\n * @see storm-022 v2 Section 10.2 - Defaults\n */\nexport const DEFAULT_CONSENT_SETTINGS: ConsentSettings = {\n  default_scope: DEFAULT_CONSENT_SCOPE,\n  time_based_duration: '24h',\n  topic_similarity_threshold: TOPIC_SIMILARITY_THRESHOLD,\n  remembered_topics: [],\n  conversation_timeout_minutes: CONVERSATION_TIMEOUT_MINUTES,\n  require_explicit_for_sensitive: true,\n} as const;\n\n// ============================================================\n// DECLINE MESSAGE\n// ============================================================\n\n/**\n * Default message shown when user declines LLM memory access.\n *\n * @see storm-022 v2 Section 10.6 - Decline dialog copy\n */\nexport const DECLINE_MESSAGE =\n  'I can\\'t access your memories for this question. Without access, I can still help with general questions, writing assistance, and brainstorming ideas.';\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Checks if a consent state is still active (not expired).\n *\n * @param state - Consent state to check\n * @returns True if consent is still active\n */\nexport function isConsentActive(state: ConsentState): boolean {\n  if (!state.granted) {\n    return false;\n  }\n\n  if (state.expires_at) {\n    return Date.now() < new Date(state.expires_at).getTime();\n  }\n\n  // per_message scope: always requires new consent\n  if (state.scope === 'per_message') {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Handles user declining LLM access to memories.\n * Returns available fallback actions.\n *\n * @param _user_id - User declining access (unused in pure computation)\n * @returns Decline result with available actions\n */\nexport function handleDecline(_user_id: string): DeclineResult {\n  return {\n    declined: true,\n    available_actions: [...DECLINE_ACTIONS],\n    previous_context_available: false,\n    message: DECLINE_MESSAGE,\n  };\n}\n\n/**\n * Computes cosine similarity between two vectors.\n *\n * @param a - First vector\n * @param b - Second vector\n * @returns Cosine similarity (0 to 1)\n */\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  if (a.length !== b.length || a.length === 0) {\n    return 0;\n  }\n\n  let dotProduct = 0;\n  let normA = 0;\n  let normB = 0;\n\n  for (let i = 0; i < a.length; i++) {\n    const valA = a[i]!;\n    const valB = b[i]!;\n    dotProduct += valA * valB;\n    normA += valA * valA;\n    normB += valB * valB;\n  }\n\n  const denominator = Math.sqrt(normA) * Math.sqrt(normB);\n  if (denominator === 0) {\n    return 0;\n  }\n\n  return dotProduct / denominator;\n}\n\n/**\n * Checks if a query embedding matches any remembered topic.\n * Uses cosine similarity against stored topic embeddings.\n *\n * @param query_embedding - Embedding of the current query\n * @param remembered_topics - User's remembered topic consents\n * @param threshold - Cosine similarity threshold (default: 0.85)\n * @returns Matching topic consent, or null if no match\n *\n * @see storm-022 v2 Section 10.2 - \"Similarity threshold: 0.85 cosine similarity\"\n */\nexport function checkTopicMatch(\n  query_embedding: number[],\n  remembered_topics: TopicConsent[],\n  threshold: number = TOPIC_SIMILARITY_THRESHOLD,\n): TopicConsent | null {\n  let bestMatch: TopicConsent | null = null;\n  let bestSimilarity = 0;\n\n  for (const topic of remembered_topics) {\n    const similarity = cosineSimilarity(query_embedding, topic.topic_embedding);\n    if (similarity >= threshold && similarity > bestSimilarity) {\n      bestMatch = topic;\n      bestSimilarity = similarity;\n    }\n  }\n\n  return bestMatch;\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Prepares consent dialog data for a set of memories and LLM provider.\n * Requires server-side memory lookup.\n *\n * @param _user_id - User requesting LLM access\n * @param _memory_ids - IDs of memories that would be shared\n * @param _provider - LLM provider identifier\n * @returns Data to render the consent dialog\n */\nexport async function requestConsent(\n  _user_id: string,\n  _memory_ids: string[],\n  _provider: string,\n): Promise<ConsentDialogData> {\n  throw new Error('requestConsent requires server-side memory lookup implementation');\n}\n\n/**\n * Records that the user has granted consent.\n * Requires server-side consent state persistence.\n *\n * @param _user_id - User granting consent\n * @param _scope - Chosen consent scope\n * @param _memory_ids - IDs of memories being shared\n * @returns Updated consent state\n */\nexport async function grantConsent(\n  _user_id: string,\n  _scope: ConsentScope,\n  _memory_ids: string[],\n): Promise<ConsentState> {\n  throw new Error('grantConsent requires consent state persistence implementation');\n}\n\n/**\n * Checks if the user has active consent for a given query.\n * Requires server-side consent state lookup.\n *\n * @param _user_id - User ID\n * @param _query_embedding - Embedding of the current query\n * @returns Active consent state, or null if no active consent\n */\nexport async function checkConsent(\n  _user_id: string,\n  _query_embedding: number[],\n): Promise<ConsentState | null> {\n  throw new Error('checkConsent requires consent state lookup implementation');\n}\n\n/**\n * Revokes consent at the specified granularity.\n * Requires server-side consent state update.\n *\n * @param _user_id - User revoking consent\n * @param _request - Revocation scope\n */\nexport async function revokeConsent(\n  _user_id: string,\n  _request: ConsentRevocationRequest,\n): Promise<void> {\n  throw new Error('revokeConsent requires consent state update implementation');\n}\n\n/**\n * Gets all memories shared in a specific conversation.\n * Requires server-side shared memory tracking.\n *\n * @param _user_id - User ID\n * @param _conversation_id - Conversation ID\n * @returns Array of shared memory details\n */\nexport async function getSharedMemories(\n  _user_id: string,\n  _conversation_id: string,\n): Promise<SharedMemoryDetail[]> {\n  throw new Error('getSharedMemories requires shared memory tracking implementation');\n}\n\n/**\n * Updates consent settings for a user.\n * Requires server-side settings persistence.\n *\n * @param _user_id - User ID\n * @param _settings - Partial settings to update\n */\nexport async function updateConsentSettings(\n  _user_id: string,\n  _settings: Partial<ConsentSettings>,\n): Promise<void> {\n  throw new Error('updateConsentSettings requires settings persistence implementation');\n}\n","/**\n * @module @nous/core/security\n * @description API key security: platform keys, BYOK encryption, rate limiting\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Two API key models: Platform Keys (credit system) and BYOK (Bring Your Own Key).\n * Rate limiting, call routing, and BYOK encryption management.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/api-security.ts} - Spec\n */\n\nimport {\n  type ApiKeyType,\n  type LLMProvider,\n  type PrivacyTier,\n  BYOK_MAX_DECRYPTIONS_PER_MINUTE,\n  BYOK_LOCKOUT_AFTER_FAILURES,\n  BYOK_LOCKOUT_DURATION_MINUTES,\n} from './constants';\n\nimport {\n  type ApiCallRoute,\n  type BYOKConfig,\n  type BYOKRateLimitConfig,\n} from './types';\n\n// ============================================================\n// API CALL ROUTES\n// ============================================================\n\n/**\n * Predefined API call routes for each key type.\n *\n * @see storm-022 v1 revision Section 6 - API Call Flow diagrams\n */\nexport const API_CALL_ROUTES: Record<ApiKeyType, ApiCallRoute> = {\n  platform: {\n    key_type: 'platform',\n    flow: 'proxied',\n    rate_limited: true,\n    usage_logged: true,\n  },\n  byok: {\n    key_type: 'byok',\n    flow: 'direct',\n    rate_limited: true,\n    usage_logged: false,\n  },\n} as const;\n\n// ============================================================\n// BYOK RATE LIMIT CONFIG\n// ============================================================\n\n/**\n * Default BYOK rate limit configuration from brainstorm.\n *\n * @see storm-022 v1 revision Section 6 - Rate Limiting (BYOK)\n */\nexport const DEFAULT_BYOK_RATE_LIMIT: BYOKRateLimitConfig = {\n  max_decryptions_per_minute: BYOK_MAX_DECRYPTIONS_PER_MINUTE,\n  exponential_backoff: true,\n  lockout_after_failures: BYOK_LOCKOUT_AFTER_FAILURES,\n  lockout_duration_minutes: BYOK_LOCKOUT_DURATION_MINUTES,\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Gets the API call route for a given key type.\n *\n * @param keyType - 'platform' or 'byok'\n * @returns Routing configuration\n */\nexport function getApiCallRouteForKeyType(keyType: ApiKeyType): ApiCallRoute {\n  return API_CALL_ROUTES[keyType];\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Encrypts a BYOK API key for storage.\n * Requires Web Crypto API.\n *\n * @param _api_key - Plaintext API key string\n * @param _encryption_key - CryptoKey to encrypt with\n * @returns Encrypted key bytes\n */\nexport async function encryptBYOKKey(\n  _api_key: string,\n  _encryption_key: CryptoKey,\n): Promise<Uint8Array> {\n  throw new Error('encryptBYOKKey requires Web Crypto API implementation');\n}\n\n/**\n * Decrypts a BYOK API key from storage.\n * Requires Web Crypto API.\n *\n * @param _encrypted - Encrypted key bytes\n * @param _encryption_key - CryptoKey to decrypt with\n * @returns Plaintext API key string\n */\nexport async function decryptBYOKKey(\n  _encrypted: Uint8Array,\n  _encryption_key: CryptoKey,\n): Promise<string> {\n  throw new Error('decryptBYOKKey requires Web Crypto API implementation');\n}\n\n/**\n * Determines the API call route for a user and provider.\n * Requires server-side BYOK config lookup.\n *\n * @param _user_id - User making the call\n * @param _provider - LLM provider\n * @returns Routing configuration\n */\nexport async function getApiCallRoute(\n  _user_id: string,\n  _provider: LLMProvider,\n): Promise<ApiCallRoute> {\n  throw new Error('getApiCallRoute requires server-side BYOK config lookup');\n}\n\n/**\n * Checks if a BYOK decryption attempt is allowed (rate limit check).\n * Requires rate limit state tracking.\n *\n * @param _user_id - User attempting decryption\n * @returns True if decryption is allowed\n */\nexport async function checkBYOKRateLimit(\n  _user_id: string,\n): Promise<boolean> {\n  throw new Error('checkBYOKRateLimit requires rate limit state tracking');\n}\n\n/**\n * Records a BYOK decryption attempt for rate limiting.\n * Requires rate limit state tracking.\n *\n * @param _user_id - User who attempted decryption\n * @param _success - Whether decryption succeeded\n */\nexport function trackBYOKDecryption(\n  _user_id: string,\n  _success: boolean,\n): void {\n  throw new Error('trackBYOKDecryption requires rate limit state tracking');\n}\n\n/**\n * Rotates a platform API key for a provider.\n * Requires server-side key management.\n *\n * @param _provider - LLM provider to rotate key for\n */\nexport async function rotatePlatformKey(\n  _provider: LLMProvider,\n): Promise<void> {\n  throw new Error('rotatePlatformKey requires server-side key management');\n}\n\n/**\n * Gets the BYOK configuration for a user and provider.\n * Requires server-side BYOK storage.\n *\n * @param _user_id - User to check\n * @param _provider - LLM provider\n * @returns BYOK config or null\n */\nexport async function getBYOKConfig(\n  _user_id: string,\n  _provider: LLMProvider,\n): Promise<BYOKConfig | null> {\n  throw new Error('getBYOKConfig requires server-side BYOK storage');\n}\n\n/**\n * Stores a new BYOK key for a user.\n * Requires Web Crypto API and server-side storage.\n *\n * @param _user_id - User storing the key\n * @param _provider - LLM provider\n * @param _api_key - Plaintext API key\n * @param _tier - User's privacy tier (determines encryption method)\n * @returns BYOK configuration\n */\nexport async function storeBYOKKey(\n  _user_id: string,\n  _provider: LLMProvider,\n  _api_key: string,\n  _tier: PrivacyTier,\n): Promise<BYOKConfig> {\n  throw new Error('storeBYOKKey requires Web Crypto API and server-side storage');\n}\n\n/**\n * Removes a BYOK key for a user.\n * Requires server-side key deletion.\n *\n * @param _user_id - User revoking the key\n * @param _provider - LLM provider\n */\nexport async function revokeBYOKKey(\n  _user_id: string,\n  _provider: LLMProvider,\n): Promise<void> {\n  throw new Error('revokeBYOKKey requires server-side key deletion');\n}\n","/**\n * @module @nous/core/security\n * @description Export compliance, threat model, app store declarations, launch strategy\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Export compliance by region, threat model, app store encryption\n * declarations, and phased launch strategy. All functions are pure.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/compliance.ts} - Spec\n */\n\nimport {\n  type PrivacyTier,\n  type Platform,\n  ECCN_CLASSIFICATION,\n} from './constants';\n\nimport {\n  type ExportComplianceConfig,\n  type ThreatModelEntry,\n  type LaunchPhase,\n  type AppStoreDeclaration,\n} from './types';\n\n// ============================================================\n// THREAT MODEL\n// ============================================================\n\n/**\n * Complete threat model from brainstorm Section 8.\n *\n * @see storm-022 v1 revision Section 8 - Threat Model\n */\nexport const THREAT_MODEL: ThreatModelEntry[] = [\n  // === THREATS WE PROTECT AGAINST ===\n  {\n    threat: 'random_hackers',\n    protected_by_standard: true,\n    protected_by_private: true,\n    description:\n      'TLS prevents MITM attacks. Server-side encryption (Standard) protects at rest. E2E (Private) protects even if servers breached.',\n  },\n  {\n    threat: 'curious_employees',\n    protected_by_standard: false,\n    protected_by_private: true,\n    description:\n      'Standard: Employees could technically access data. Private: Employees CANNOT access (no keys).',\n  },\n  {\n    threat: 'data_breaches',\n    protected_by_standard: true,\n    protected_by_private: true,\n    description:\n      'Standard: Attacker gets encrypted data (Turso encryption). Private: Attacker gets doubly-encrypted data (useless).',\n  },\n  {\n    threat: 'legal_subpoenas',\n    protected_by_standard: false,\n    protected_by_private: true,\n    description:\n      'Standard: We must comply if legally compelled. Private: We literally cannot comply (no keys).',\n  },\n\n  // === THREATS WE DO NOT PROTECT AGAINST ===\n  {\n    threat: 'device_malware',\n    protected_by_standard: false,\n    protected_by_private: false,\n    description:\n      'If attacker controls your device, game over. We cannot protect against keyloggers, screen capture.',\n  },\n  {\n    threat: 'user_error',\n    protected_by_standard: false,\n    protected_by_private: false,\n    description:\n      'Sharing recovery code, weak device passcode, etc. We provide warnings but cannot prevent.',\n  },\n  {\n    threat: 'state_level_actors',\n    protected_by_standard: false,\n    protected_by_private: false,\n    description:\n      'Rubber-hose cryptanalysis (coercion), advanced forensics on device. Recommendation: Do not be a nation-state target.',\n  },\n  {\n    threat: 'llm_provider',\n    protected_by_standard: false,\n    protected_by_private: false,\n    description:\n      'When you send data to Claude/GPT, that provider sees it. We show consent dialog, but cannot control their servers.',\n  },\n] as const;\n\n// ============================================================\n// EXPORT COMPLIANCE BY REGION\n// ============================================================\n\n/**\n * Export compliance requirements by region.\n *\n * @see storm-022 v1 revision Section 7 - Export Compliance\n */\nexport const EXPORT_COMPLIANCE_BY_REGION: ExportComplianceConfig[] = [\n  {\n    region: 'us',\n    standard_tier: 'exempt',\n    private_tier: 'requires_documentation',\n    documentation_required: [\n      'ECCN 5D992 self-classification',\n      'Mass market exemption (License Exception ENC 740.17)',\n      'Annual self-classification report to BIS',\n    ],\n    notes: 'Private tier uses AES-256-GCM (proprietary encryption). ~2 business days Apple review.',\n  },\n  {\n    region: 'general',\n    standard_tier: 'exempt',\n    private_tier: 'requires_documentation',\n    documentation_required: [\n      'ECCN 5D992 self-classification',\n      'Mass market exemption (License Exception ENC 740.17)',\n      'Annual self-classification report to BIS',\n    ],\n    notes:\n      'Most markets follow US export rules. Standard tier uses TLS/HTTPS only (OS-provided), ITSAppUsesNonExemptEncryption = NO.',\n  },\n  {\n    region: 'france',\n    standard_tier: 'exempt',\n    private_tier: 'excluded',\n    documentation_required: [\n      'ECCN 5D992 self-classification',\n      'French encryption declaration (ANSSI)',\n      'Additional 1-month review period',\n    ],\n    notes:\n      'France requires additional encryption declaration with ~1 month review. Recommendation: Exclude France at launch, add after approval.',\n  },\n] as const;\n\n// ============================================================\n// LAUNCH STRATEGY\n// ============================================================\n\n/**\n * Three-phase launch strategy for compliance rollout.\n *\n * @see storm-022 v1 revision Section 7 - Launch Strategy\n */\nexport const LAUNCH_STRATEGY: LaunchPhase[] = [\n  {\n    version: 'v1.0',\n    features: ['Standard tier only', 'Clerk auth', 'Cloud search', 'Seamless LLM'],\n    markets: ['All markets'],\n    compliance_requirements: ['No encryption documentation required', 'ITSAppUsesNonExemptEncryption = NO'],\n  },\n  {\n    version: 'v1.1',\n    features: [\n      'Add Private tier',\n      'E2E encryption (AES-256-GCM)',\n      'Client-side HNSW search',\n      'LLM consent dialogs',\n      'Passkey-derived key hierarchy',\n      'Recovery codes (BIP39)',\n    ],\n    markets: ['US', 'Most international markets'],\n    compliance_requirements: [\n      'ECCN 5D992 self-classification filed',\n      'Mass market exemption (License Exception ENC 740.17)',\n      'Annual BIS self-classification report',\n      'ITSAppUsesNonExemptEncryption = YES',\n      'Google Play encryption declaration',\n    ],\n  },\n  {\n    version: 'v1.2',\n    features: ['Add France support for Private tier'],\n    markets: ['France (Private tier)'],\n    compliance_requirements: [\n      'French encryption declaration (ANSSI) approved',\n      'All v1.1 requirements maintained',\n    ],\n  },\n] as const;\n\n// ============================================================\n// APP STORE DECLARATIONS\n// ============================================================\n\n/**\n * App store encryption declarations for both launch phases.\n *\n * @see storm-022 v1 revision Section 7 - iOS/Google Play compliance\n */\nexport const APP_STORE_DECLARATIONS: {\n  standard_only: AppStoreDeclaration[];\n  with_private_tier: AppStoreDeclaration[];\n} = {\n  standard_only: [\n    { platform: 'ios', uses_non_exempt_encryption: false, self_classification_filed: false },\n    { platform: 'android', uses_non_exempt_encryption: false, self_classification_filed: false },\n    { platform: 'macos', uses_non_exempt_encryption: false, self_classification_filed: false },\n    { platform: 'windows', uses_non_exempt_encryption: false, self_classification_filed: false },\n  ],\n  with_private_tier: [\n    { platform: 'ios', uses_non_exempt_encryption: true, eccn: ECCN_CLASSIFICATION, mass_market_exemption: true, self_classification_filed: true },\n    { platform: 'android', uses_non_exempt_encryption: true, eccn: ECCN_CLASSIFICATION, mass_market_exemption: true, self_classification_filed: true },\n    { platform: 'macos', uses_non_exempt_encryption: true, eccn: ECCN_CLASSIFICATION, mass_market_exemption: true, self_classification_filed: true },\n    { platform: 'windows', uses_non_exempt_encryption: true, eccn: ECCN_CLASSIFICATION, mass_market_exemption: true, self_classification_filed: true },\n  ],\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Gets export compliance requirements for a tier in a region.\n *\n * @param tier - Privacy tier to check\n * @param region - Region identifier (e.g., 'us', 'france', 'general')\n * @returns Compliance config for the region, or general config if region not found\n */\nexport function getComplianceRequirements(\n  tier: PrivacyTier,\n  region: string,\n): ExportComplianceConfig {\n  const config = EXPORT_COMPLIANCE_BY_REGION.find((c) => c.region === region);\n  if (config) {\n    return config;\n  }\n  // Fall back to 'general' config\n  const general = EXPORT_COMPLIANCE_BY_REGION.find((c) => c.region === 'general');\n  return general!;\n}\n\n/**\n * Returns the complete threat model.\n *\n * @returns All threat model entries\n */\nexport function getThreatModel(): ThreatModelEntry[] {\n  return [...THREAT_MODEL];\n}\n\n/**\n * Returns the phased launch strategy.\n *\n * @returns All launch phases in order\n */\nexport function getLaunchStrategy(): LaunchPhase[] {\n  return [...LAUNCH_STRATEGY];\n}\n\n/**\n * Checks whether a region supports a given privacy tier.\n *\n * @param region - Region identifier\n * @param tier - Privacy tier to check\n * @returns True if the tier is available in the region (not 'excluded')\n */\nexport function isRegionSupported(region: string, tier: PrivacyTier): boolean {\n  const config = EXPORT_COMPLIANCE_BY_REGION.find((c) => c.region === region);\n  if (!config) {\n    // Unknown regions fall back to general rules\n    return true;\n  }\n\n  if (tier === 'standard') {\n    return config.standard_tier !== 'excluded';\n  }\n\n  return config.private_tier !== 'excluded';\n}\n\n/**\n * Gets app store declarations for a platform based on current launch phase.\n *\n * @param platform - Target platform\n * @param includes_private_tier - Whether Private tier is enabled\n * @returns App store declaration for the platform\n */\nexport function getAppStoreDeclaration(\n  platform: Platform,\n  includes_private_tier: boolean,\n): AppStoreDeclaration {\n  const declarations = includes_private_tier\n    ? APP_STORE_DECLARATIONS.with_private_tier\n    : APP_STORE_DECLARATIONS.standard_only;\n\n  const declaration = declarations.find((d) => d.platform === platform);\n  return declaration!;\n}\n\n/**\n * Gets threats that a specific tier protects against.\n *\n * @param tier - Privacy tier to check\n * @returns Threat entries where the tier provides protection\n */\nexport function getProtectedThreats(tier: PrivacyTier): ThreatModelEntry[] {\n  return THREAT_MODEL.filter((entry) =>\n    tier === 'standard' ? entry.protected_by_standard : entry.protected_by_private,\n  );\n}\n\n/**\n * Gets threats that a specific tier does NOT protect against.\n *\n * @param tier - Privacy tier to check\n * @returns Threat entries where the tier provides no protection\n */\nexport function getUnprotectedThreats(tier: PrivacyTier): ThreatModelEntry[] {\n  return THREAT_MODEL.filter((entry) =>\n    tier === 'standard' ? !entry.protected_by_standard : !entry.protected_by_private,\n  );\n}\n","/**\n * @module @nous/core/security\n * @description Offline auth states, token expiry, state transitions, sync queue\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-022\n * @storm Brainstorms/Infrastructure/storm-022-security-auth\n *\n * Five offline states with graceful degradation, offline sync queue,\n * and capability checks per state and tier.\n *\n * @see {@link Specs/Phase-6-Technical-Services/storm-022/spec/offline-auth.ts} - Spec\n */\n\nimport {\n  type OfflineState,\n  type PrivacyTier,\n  OFFLINE_THRESHOLDS,\n} from './constants';\n\nimport {\n  type OfflineStateConfig,\n  type OfflineCapabilityCheck,\n  type QueuedOperation,\n  type QueueSyncResult,\n  type AuthTokens,\n} from './types';\n\n// ============================================================\n// OFFLINE STATE CONFIGURATIONS\n// ============================================================\n\n/**\n * Configuration for each of the five offline states.\n *\n * Note: Private tier passkey unlock works in ALL states because\n * the Secure Enclave is local to the device.\n *\n * @see storm-022 v1 revision Section 1 - Token Management & Offline States\n */\nexport const OFFLINE_STATE_CONFIGS: Record<OfflineState, OfflineStateConfig> = {\n  online: {\n    state: 'online',\n    max_hours: Infinity,\n    functionality: 'full',\n    sync_behavior: 'realtime',\n    auth_behavior: 'JWT valid, full access, real-time sync',\n    private_tier_key_access: true,\n  },\n  short_offline: {\n    state: 'short_offline',\n    max_hours: OFFLINE_THRESHOLDS.short_offline,\n    functionality: 'full',\n    sync_behavior: 'queued',\n    auth_behavior: 'JWT still valid (<24h), full functionality, writes queued for sync',\n    private_tier_key_access: true,\n  },\n  medium_offline: {\n    state: 'medium_offline',\n    max_hours: OFFLINE_THRESHOLDS.medium_offline,\n    functionality: 'read_write_queued',\n    sync_behavior: 'paused',\n    auth_behavior: 'JWT expired, refresh token still valid (<7d), read + queued writes, sync paused',\n    private_tier_key_access: true,\n  },\n  long_offline: {\n    state: 'long_offline',\n    max_hours: Infinity,\n    functionality: 'local_only',\n    sync_behavior: 'none',\n    auth_behavior: 'Refresh token expired (>7d), local data only, no sync capability',\n    private_tier_key_access: true,\n  },\n  reauth_required: {\n    state: 'reauth_required',\n    max_hours: 0,\n    functionality: 'read_only',\n    sync_behavior: 'none',\n    auth_behavior: 'Must reconnect and re-authenticate to restore full functionality',\n    private_tier_key_access: true,\n  },\n} as const;\n\n// ============================================================\n// PURE FUNCTIONS\n// ============================================================\n\n/**\n * Gets the offline state configuration for a given state.\n *\n * @param state - The offline state to look up\n * @returns Configuration for that state\n */\nexport function getOfflineStateConfig(state: OfflineState): OfflineStateConfig {\n  return OFFLINE_STATE_CONFIGS[state];\n}\n\n/**\n * Calculates the current offline state based on last online time and token status.\n *\n * @param last_online - ISO 8601 timestamp of last known online state\n * @param tokens - Current auth tokens (for expiry checking)\n * @returns Calculated offline state\n *\n * @see storm-022 v1 revision Section 1 - updateOfflineState()\n */\nexport function calculateOfflineState(\n  last_online: string,\n  tokens: AuthTokens,\n): OfflineState {\n  const lastOnlineMs = new Date(last_online).getTime();\n  const hoursSinceOnline = (Date.now() - lastOnlineMs) / (1000 * 60 * 60);\n\n  // If very recently online\n  if (hoursSinceOnline < 0.01) {\n    return 'online';\n  }\n\n  // Check JWT validity\n  const tokenValid = Date.now() < new Date(tokens.expires_at).getTime();\n\n  if (hoursSinceOnline < OFFLINE_THRESHOLDS.short_offline && tokenValid) {\n    return 'short_offline';\n  }\n\n  if (hoursSinceOnline < OFFLINE_THRESHOLDS.medium_offline) {\n    return 'medium_offline';\n  }\n\n  return 'long_offline';\n}\n\n/**\n * Gets capabilities available in a given offline state and tier.\n *\n * Note: Private tier has local search (client-side HNSW) available\n * in all offline states. Standard tier search requires network.\n *\n * @param state - Current offline state\n * @param tier - User's privacy tier\n * @returns Capability check result\n */\nexport function getOfflineCapabilities(\n  state: OfflineState,\n  tier: PrivacyTier,\n): OfflineCapabilityCheck {\n  const config = OFFLINE_STATE_CONFIGS[state];\n\n  switch (state) {\n    case 'online':\n      return {\n        can_read: true,\n        can_write: true,\n        can_search: true,\n        can_sync: true,\n        can_use_llm: true,\n        reason: 'Full connectivity - all features available',\n      };\n\n    case 'short_offline':\n      return {\n        can_read: true,\n        can_write: true,\n        can_search: tier === 'private', // Private has local search; Standard needs cloud\n        can_sync: false, // Writes are queued\n        can_use_llm: false,\n        reason: `Offline <${OFFLINE_THRESHOLDS.short_offline}h - JWT valid, writes queued for sync`,\n      };\n\n    case 'medium_offline':\n      return {\n        can_read: true,\n        can_write: true, // Writes are queued\n        can_search: tier === 'private',\n        can_sync: false,\n        can_use_llm: false,\n        reason: `Offline <${OFFLINE_THRESHOLDS.medium_offline}h - JWT expired, read + queued writes`,\n      };\n\n    case 'long_offline':\n      return {\n        can_read: true,\n        can_write: false,\n        can_search: tier === 'private',\n        can_sync: false,\n        can_use_llm: false,\n        reason: `Offline >${OFFLINE_THRESHOLDS.medium_offline}h - local data only`,\n      };\n\n    case 'reauth_required':\n      return {\n        can_read: true,\n        can_write: false,\n        can_search: tier === 'private',\n        can_sync: false,\n        can_use_llm: false,\n        reason: 'Re-authentication required to restore full functionality',\n      };\n  }\n}\n\n// ============================================================\n// EXTERNAL SERVICE FUNCTIONS\n// ============================================================\n\n/**\n * Queues an operation for sync when back online.\n * Requires persistent queue storage.\n *\n * @param _operation - The operation to queue\n */\nexport async function queueOfflineOperation(\n  _operation: QueuedOperation,\n): Promise<void> {\n  throw new Error('queueOfflineOperation requires persistent queue storage implementation');\n}\n\n/**\n * Processes the offline sync queue when connectivity is restored.\n * Requires network access and database adapter.\n *\n * @returns Sync result with counts of synced and failed operations\n */\nexport async function processOfflineQueue(): Promise<QueueSyncResult> {\n  throw new Error('processOfflineQueue requires network and database adapter implementation');\n}\n\n/**\n * Gets the current number of queued operations.\n * Requires persistent queue storage.\n *\n * @returns Number of pending operations in the queue\n */\nexport async function getQueueSize(): Promise<number> {\n  throw new Error('getQueueSize requires persistent queue storage implementation');\n}\n"]}