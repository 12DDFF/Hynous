{"version":3,"sources":["../../src/sync/sync-manager.ts","../../src/sync/conflict-resolution.ts","../../src/sync/health.ts","../../src/sync/nse-constants.ts","../../src/sync/nse-types.ts","../../src/sync/nse-engine.ts"],"names":["z"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @module @nous/core/sync/manager\n * @description Sync orchestration and status management\n * @version 1.0.0\n * @spec Brainstorms/Specs/storm-017\n * @storm Brainstorms/Infrastructure/storm-017-infrastructure-architecture\n *\n * Manages sync operations between local database and Turso cloud.\n * Coordinates with conflict resolver for handling version conflicts.\n *\n * @see storm-017 v1.1 - Sync architecture\n * @see storm-033 - Detailed sync engine specification\n */\n\nimport { z } from 'zod';\nimport type { SyncResult } from '../db/adapter';\n\n// Re-export SyncResult for convenience\nexport type { SyncResult };\n\n// ============================================================\n// SYNC STATUS\n// ============================================================\n\n/**\n * Sync status enumeration.\n */\nexport const SYNC_STATUSES = [\n  'idle',\n  'syncing',\n  'paused',\n  'error',\n  'offline',\n] as const;\n\nexport type SyncStatus = (typeof SYNC_STATUSES)[number];\n\n/**\n * Detailed sync state.\n */\nexport interface SyncState {\n  /** Current sync status */\n  status: SyncStatus;\n  /** Last successful sync timestamp (ISO 8601) */\n  lastSyncAt: string | null;\n  /** Last sync attempt timestamp */\n  lastAttemptAt: string | null;\n  /** Number of pending local changes */\n  pendingChanges: number;\n  /** Number of unresolved conflicts */\n  unresolvedConflicts: number;\n  /** Current sync progress (0-100) */\n  progress: number;\n  /** Error message (if status is 'error') */\n  errorMessage: string | null;\n  /** Number of failed attempts */\n  failedAttempts: number;\n  /** Next scheduled sync timestamp */\n  nextSyncAt: string | null;\n}\n\nexport const SyncStateSchema = z.object({\n  status: z.enum(SYNC_STATUSES),\n  lastSyncAt: z.string().datetime().nullable(),\n  lastAttemptAt: z.string().datetime().nullable(),\n  pendingChanges: z.number().int().min(0),\n  unresolvedConflicts: z.number().int().min(0),\n  progress: z.number().min(0).max(100),\n  errorMessage: z.string().nullable(),\n  failedAttempts: z.number().int().min(0),\n  nextSyncAt: z.string().datetime().nullable(),\n});\n\n/**\n * Creates initial sync state.\n */\nexport function createInitialSyncState(): SyncState {\n  return {\n    status: 'idle',\n    lastSyncAt: null,\n    lastAttemptAt: null,\n    pendingChanges: 0,\n    unresolvedConflicts: 0,\n    progress: 0,\n    errorMessage: null,\n    failedAttempts: 0,\n    nextSyncAt: null,\n  };\n}\n\n// ============================================================\n// SYNC EVENTS\n// ============================================================\n\n/**\n * Sync event types.\n */\nexport const SYNC_EVENT_TYPES = [\n  'sync_started',\n  'sync_progress',\n  'sync_completed',\n  'sync_failed',\n  'conflict_detected',\n  'conflict_resolved',\n  'offline',\n  'online',\n] as const;\n\nexport type SyncEventType = (typeof SYNC_EVENT_TYPES)[number];\n\n/**\n * Base sync event.\n */\nexport interface SyncEvent {\n  type: SyncEventType;\n  timestamp: string;\n}\n\n/**\n * Sync started event.\n */\nexport interface SyncStartedEvent extends SyncEvent {\n  type: 'sync_started';\n  triggeredBy: 'auto' | 'manual' | 'conflict_resolution';\n}\n\n/**\n * Sync progress event.\n */\nexport interface SyncProgressEvent extends SyncEvent {\n  type: 'sync_progress';\n  progress: number;\n  currentStep: string;\n}\n\n/**\n * Sync completed event.\n */\nexport interface SyncCompletedEvent extends SyncEvent {\n  type: 'sync_completed';\n  durationMs: number;\n  changesSynced: number;\n  conflictsResolved: number;\n}\n\n/**\n * Sync failed event.\n */\nexport interface SyncFailedEvent extends SyncEvent {\n  type: 'sync_failed';\n  error: string;\n  retryable: boolean;\n  nextRetryAt: string | null;\n}\n\n/**\n * Conflict detected event.\n */\nexport interface ConflictDetectedEvent extends SyncEvent {\n  type: 'conflict_detected';\n  nodeId: string;\n  conflictType: 'weak' | 'strong';\n  autoResolved: boolean;\n}\n\n/**\n * Union of all sync events.\n */\nexport type AnySyncEvent =\n  | SyncStartedEvent\n  | SyncProgressEvent\n  | SyncCompletedEvent\n  | SyncFailedEvent\n  | ConflictDetectedEvent\n  | SyncEvent;\n\n// ============================================================\n// CONFLICT TYPES\n// ============================================================\n\n/**\n * Conflict information.\n */\nexport interface ConflictInfo {\n  nodeId: string;\n  conflictType: 'weak' | 'strong';\n  localVersion: number;\n  cloudVersion: number;\n  localModifiedAt: string;\n  cloudModifiedAt: string;\n  fieldsInConflict: string[];\n  localContent?: string;\n  cloudContent?: string;\n}\n\n/**\n * Conflict resolution choices.\n */\nexport const CONFLICT_RESOLUTION_CHOICES = [\n  'keep_local',\n  'keep_cloud',\n  'keep_both',\n  'merge',\n] as const;\n\nexport type ConflictResolutionChoice =\n  (typeof CONFLICT_RESOLUTION_CHOICES)[number];\n\n// ============================================================\n// SYNC MANAGER OPTIONS\n// ============================================================\n\n/**\n * Sync manager configuration options.\n */\nexport interface SyncManagerOptions {\n  /** Minimum interval between syncs (ms) */\n  minIntervalMs: number;\n  /** Maximum retry attempts */\n  maxRetries: number;\n  /** Base retry delay (ms) - uses exponential backoff */\n  retryDelayMs: number;\n  /** Batch size for sync operations */\n  batchSize: number;\n  /** Enable automatic sync */\n  autoSync: boolean;\n  /** WiFi-only sync */\n  wifiOnly: boolean;\n  /** Sync only when charging */\n  chargingOnly: boolean;\n  /** Enable background sync */\n  backgroundSync: boolean;\n}\n\nexport const SyncManagerOptionsSchema = z.object({\n  minIntervalMs: z.number().int().positive(),\n  maxRetries: z.number().int().min(0),\n  retryDelayMs: z.number().int().positive(),\n  batchSize: z.number().int().positive(),\n  autoSync: z.boolean(),\n  wifiOnly: z.boolean(),\n  chargingOnly: z.boolean(),\n  backgroundSync: z.boolean(),\n});\n\n/**\n * Creates default sync manager options.\n */\nexport function createDefaultSyncManagerOptions(): SyncManagerOptions {\n  return {\n    minIntervalMs: 60_000, // 1 minute\n    maxRetries: 3,\n    retryDelayMs: 1000,\n    batchSize: 100,\n    autoSync: true,\n    wifiOnly: false,\n    chargingOnly: false,\n    backgroundSync: true,\n  };\n}\n\n// ============================================================\n// SYNC LOCK\n// ============================================================\n\n/**\n * Sync lock state (prevents thundering herd).\n *\n * @see storm-033 - 30-second sync lock\n */\nexport interface SyncLock {\n  /** Device that holds the lock */\n  deviceId: string;\n  /** Lock acquired timestamp */\n  acquiredAt: string;\n  /** Lock expires timestamp */\n  expiresAt: string;\n}\n\nexport const SyncLockSchema = z.object({\n  deviceId: z.string().min(1),\n  acquiredAt: z.string().datetime(),\n  expiresAt: z.string().datetime(),\n});\n\n/**\n * Default lock duration in seconds.\n */\nexport const DEFAULT_LOCK_DURATION_SECONDS = 30;\n\n/**\n * Creates a sync lock.\n */\nexport function createSyncLock(\n  deviceId: string,\n  durationSeconds: number = DEFAULT_LOCK_DURATION_SECONDS\n): SyncLock {\n  const now = new Date();\n  const expires = new Date(now.getTime() + durationSeconds * 1000);\n\n  return {\n    deviceId,\n    acquiredAt: now.toISOString(),\n    expiresAt: expires.toISOString(),\n  };\n}\n\n/**\n * Checks if a sync lock is still valid.\n */\nexport function isSyncLockValid(lock: SyncLock): boolean {\n  return new Date(lock.expiresAt).getTime() > Date.now();\n}\n\n/**\n * Checks if a lock is expired.\n */\nexport function isSyncLockExpired(lock: SyncLock): boolean {\n  return !isSyncLockValid(lock);\n}\n\n// ============================================================\n// SYNC EVENT HANDLER\n// ============================================================\n\n/**\n * Sync event handler type.\n */\nexport type SyncEventHandler = (event: AnySyncEvent) => void;\n\n// ============================================================\n// SYNC MANAGER INTERFACE\n// ============================================================\n\n/**\n * Sync manager interface.\n *\n * Coordinates sync operations, handles scheduling, and\n * manages sync state.\n */\nexport interface SyncManager {\n  // ==================== STATE ====================\n\n  /**\n   * Gets current sync state.\n   */\n  getState(): SyncState;\n\n  /**\n   * Checks if currently syncing.\n   */\n  isSyncing(): boolean;\n\n  /**\n   * Checks if online (network available).\n   */\n  isOnline(): boolean;\n\n  // ==================== SYNC OPERATIONS ====================\n\n  /**\n   * Triggers a sync operation.\n   *\n   * @param force - Force sync even if recently synced\n   * @returns Promise that resolves when sync completes\n   */\n  sync(force?: boolean): Promise<SyncResult>;\n\n  /**\n   * Pauses automatic sync.\n   */\n  pause(): void;\n\n  /**\n   * Resumes automatic sync.\n   */\n  resume(): void;\n\n  // ==================== CONFLICT HANDLING ====================\n\n  /**\n   * Gets list of unresolved conflicts.\n   */\n  getUnresolvedConflicts(): Promise<ConflictInfo[]>;\n\n  /**\n   * Resolves a specific conflict.\n   *\n   * @param nodeId - Node with conflict\n   * @param resolution - How to resolve\n   */\n  resolveConflict(\n    nodeId: string,\n    resolution: ConflictResolutionChoice\n  ): Promise<void>;\n\n  // ==================== EVENT HANDLING ====================\n\n  /**\n   * Subscribes to sync events.\n   *\n   * @param handler - Event handler function\n   * @returns Unsubscribe function\n   */\n  subscribe(handler: SyncEventHandler): () => void;\n\n  // ==================== LIFECYCLE ====================\n\n  /**\n   * Starts the sync manager (begin scheduling).\n   */\n  start(): Promise<void>;\n\n  /**\n   * Stops the sync manager.\n   */\n  stop(): Promise<void>;\n}\n\n// ============================================================\n// VALIDATION\n// ============================================================\n\n/**\n * Validates a sync state.\n */\nexport function validateSyncState(state: unknown): state is SyncState {\n  return SyncStateSchema.safeParse(state).success;\n}\n\n/**\n * Validates sync manager options.\n */\nexport function validateSyncManagerOptions(\n  options: unknown\n): options is SyncManagerOptions {\n  return SyncManagerOptionsSchema.safeParse(options).success;\n}\n\n/**\n * Validates a sync lock.\n */\nexport function validateSyncLock(lock: unknown): lock is SyncLock {\n  return SyncLockSchema.safeParse(lock).success;\n}\n","/**\n * @module @nous/core/sync/conflict-resolution\n * @description Conflict detection and resolution for sync\n * @version 1.0.0\n * @spec Brainstorms/Specs/storm-017\n * @storm Brainstorms/Infrastructure/storm-017-infrastructure-architecture\n *\n * Implements smart conflict resolution:\n * - Weak conflicts (different fields changed) -> auto-merge\n * - Strong conflicts (same field changed) -> user resolution\n *\n * @see storm-017 v1.1 - Smart auto-merge conflicts\n * @see storm-033 - Detailed conflict resolution specification\n */\n\nimport { z } from 'zod';\n\n// ============================================================\n// CONFLICT TYPES\n// ============================================================\n\n/**\n * Conflict strength classification.\n */\nexport const CONFLICT_STRENGTHS = ['weak', 'strong'] as const;\nexport type ConflictStrength = (typeof CONFLICT_STRENGTHS)[number];\n\n/**\n * Field categories for conflict classification.\n *\n * Different field types have different merge strategies.\n */\nexport const FIELD_CATEGORIES = [\n  'content', // Main content (body, title)\n  'metadata', // Access counts, timestamps\n  'neural', // Neural properties\n  'structural', // Type, lifecycle\n  'versioning', // Version numbers\n] as const;\n\nexport type FieldCategory = (typeof FIELD_CATEGORIES)[number];\n\n/**\n * Maps field names to categories.\n */\nexport const FIELD_CATEGORY_MAP: Record<string, FieldCategory> = {\n  // Content fields - strong conflicts\n  content_title: 'content',\n  content_body: 'content',\n  content_summary: 'content',\n  content_blocks: 'content',\n\n  // Metadata fields - weak conflicts, merge additively\n  neural_access_count: 'metadata',\n  neural_last_accessed: 'metadata',\n\n  // Neural fields - weak conflicts, take max\n  neural_stability: 'neural',\n  neural_retrievability: 'neural',\n\n  // Structural fields - strong conflicts\n  type: 'structural',\n  subtype: 'structural',\n  state_lifecycle: 'structural',\n  state_extraction_depth: 'structural',\n\n  // Versioning - handled specially\n  version: 'versioning',\n  last_modified: 'versioning',\n  last_modifier: 'versioning',\n};\n\n// ============================================================\n// CONFLICT DETECTION\n// ============================================================\n\n/**\n * Detected conflict information.\n */\nexport interface DetectedConflict {\n  /** Node ID with conflict */\n  nodeId: string;\n  /** Conflict strength */\n  strength: ConflictStrength;\n  /** Local version number */\n  localVersion: number;\n  /** Cloud version number */\n  cloudVersion: number;\n  /** Base version (last common ancestor) */\n  baseVersion: number;\n  /** Local modification timestamp */\n  localModifiedAt: string;\n  /** Cloud modification timestamp */\n  cloudModifiedAt: string;\n  /** Fields that differ between local and cloud */\n  fieldsInConflict: string[];\n  /** Categories of conflicting fields */\n  conflictCategories: FieldCategory[];\n  /** Whether this can be auto-resolved */\n  canAutoResolve: boolean;\n  /** Suggested resolution (if auto-resolvable) */\n  suggestedResolution?: ConflictResolution;\n}\n\nexport const DetectedConflictSchema = z.object({\n  nodeId: z.string().min(1),\n  strength: z.enum(CONFLICT_STRENGTHS),\n  localVersion: z.number().int().positive(),\n  cloudVersion: z.number().int().positive(),\n  baseVersion: z.number().int().positive(),\n  localModifiedAt: z.string().datetime(),\n  cloudModifiedAt: z.string().datetime(),\n  fieldsInConflict: z.array(z.string()),\n  conflictCategories: z.array(z.enum(FIELD_CATEGORIES)),\n  canAutoResolve: z.boolean(),\n  suggestedResolution: z.any().optional(),\n});\n\n// ============================================================\n// CONFLICT CLASSIFICATION\n// ============================================================\n\n/**\n * Gets the category for a field name.\n */\nexport function getFieldCategory(fieldName: string): FieldCategory {\n  return FIELD_CATEGORY_MAP[fieldName] ?? 'content';\n}\n\n/**\n * Gets unique categories from a list of field names.\n */\nexport function getFieldCategories(fieldNames: string[]): FieldCategory[] {\n  const categories = new Set(fieldNames.map(getFieldCategory));\n  return Array.from(categories);\n}\n\n/**\n * Classifies conflict strength based on changed fields.\n *\n * WEAK CONFLICT (auto-merge):\n * - Metadata-only changes (access_count, last_accessed)\n * - Non-overlapping edits (different fields changed)\n * - Additive changes (both added content, no deletions)\n *\n * STRONG CONFLICT (user resolution):\n * - Same field edited with different values\n * - Content deleted on one side, modified on other\n * - Structural changes (node type changed)\n *\n * @param localChanges - Fields changed locally\n * @param cloudChanges - Fields changed in cloud\n * @returns Conflict strength\n */\nexport function classifyConflictStrength(\n  localChanges: string[],\n  cloudChanges: string[]\n): ConflictStrength {\n  // Find overlapping changes\n  const overlap = localChanges.filter((f) => cloudChanges.includes(f));\n\n  if (overlap.length === 0) {\n    // No overlapping changes - weak conflict\n    return 'weak';\n  }\n\n  // Check if all overlapping changes are in metadata category\n  const overlapCategories = overlap.map(getFieldCategory);\n  const hasNonMetadataOverlap = overlapCategories.some(\n    (cat) => cat !== 'metadata' && cat !== 'neural'\n  );\n\n  if (hasNonMetadataOverlap) {\n    // Content or structural overlap - strong conflict\n    return 'strong';\n  }\n\n  // Only metadata/neural overlap - weak conflict\n  return 'weak';\n}\n\n/**\n * Determines if a conflict can be auto-resolved.\n *\n * @param conflict - Detected conflict\n * @returns Whether conflict can be auto-resolved\n */\nexport function canAutoResolveConflict(conflict: DetectedConflict): boolean {\n  if (conflict.strength === 'strong') {\n    return false;\n  }\n\n  // Weak conflicts with only metadata/neural fields can be auto-resolved\n  const hasContentConflict = conflict.conflictCategories.some(\n    (cat) => cat === 'content' || cat === 'structural'\n  );\n\n  return !hasContentConflict;\n}\n\n// ============================================================\n// CONFLICT RESOLUTION\n// ============================================================\n\n/**\n * Resolution action types.\n */\nexport const RESOLUTION_ACTIONS = [\n  'keep_local',\n  'keep_cloud',\n  'keep_both',\n  'merge_fields',\n  'custom',\n] as const;\n\nexport type ResolutionAction = (typeof RESOLUTION_ACTIONS)[number];\n\n/**\n * Conflict resolution specification.\n */\nexport interface ConflictResolution {\n  /** Resolution action */\n  action: ResolutionAction;\n  /** For merge_fields: which field takes which value */\n  fieldResolutions?: Record<string, 'local' | 'cloud'>;\n  /** Resolved version number */\n  resolvedVersion: number;\n  /** Resolution timestamp */\n  resolvedAt: string;\n  /** Who resolved (user or auto) */\n  resolvedBy: 'user' | 'auto';\n  /** Notes about the resolution */\n  notes?: string;\n}\n\nexport const ConflictResolutionSchema = z.object({\n  action: z.enum(RESOLUTION_ACTIONS),\n  fieldResolutions: z.record(z.enum(['local', 'cloud'])).optional(),\n  resolvedVersion: z.number().int().positive(),\n  resolvedAt: z.string().datetime(),\n  resolvedBy: z.enum(['user', 'auto']),\n  notes: z.string().optional(),\n});\n\n// ============================================================\n// MERGE STRATEGIES\n// ============================================================\n\n/**\n * Field merge strategy types.\n */\nexport const MERGE_STRATEGIES = [\n  'take_local',\n  'take_cloud',\n  'take_latest',\n  'take_max',\n  'take_min',\n  'sum',\n  'concatenate',\n  'user_choice',\n] as const;\n\nexport type MergeStrategy = (typeof MERGE_STRATEGIES)[number];\n\n/**\n * Field-specific merge strategies.\n *\n * @see storm-033 - 13 field-level merge strategies\n */\nexport const FIELD_MERGE_STRATEGIES: Record<string, MergeStrategy> = {\n  // Content - user must choose\n  content_title: 'user_choice',\n  content_body: 'user_choice',\n  content_summary: 'user_choice',\n  content_blocks: 'user_choice',\n\n  // Metadata - automatic merge\n  neural_access_count: 'sum',\n  neural_last_accessed: 'take_latest',\n\n  // Neural - take max (higher stability/retrievability preserved)\n  neural_stability: 'take_max',\n  neural_retrievability: 'take_max',\n\n  // Structural - user must choose\n  type: 'user_choice',\n  subtype: 'user_choice',\n  state_lifecycle: 'take_latest',\n  state_extraction_depth: 'user_choice',\n\n  // Provenance\n  provenance_confidence: 'take_max',\n};\n\n/**\n * Gets the merge strategy for a field.\n */\nexport function getMergeStrategy(fieldName: string): MergeStrategy {\n  return FIELD_MERGE_STRATEGIES[fieldName] ?? 'user_choice';\n}\n\n// ============================================================\n// AUTO-MERGE IMPLEMENTATION\n// ============================================================\n\n/**\n * Auto-merge result for a single field.\n */\nexport interface FieldMergeResult {\n  fieldName: string;\n  strategy: MergeStrategy;\n  resolvedValue: unknown;\n  source: 'local' | 'cloud' | 'merged';\n}\n\n/**\n * Auto-merge result.\n */\nexport interface AutoMergeResult {\n  /** Whether merge succeeded */\n  success: boolean;\n  /** Merged field values */\n  mergedFields: FieldMergeResult[];\n  /** Fields that couldn't be merged */\n  unmergeableFields: string[];\n  /** Resulting version number */\n  resultVersion: number;\n}\n\n/**\n * Applies a merge strategy to merge two values.\n *\n * @param strategy - Merge strategy to use\n * @param localValue - Local value\n * @param cloudValue - Cloud value\n * @param localTimestamp - Local modification time\n * @param cloudTimestamp - Cloud modification time\n * @returns Merged value and source\n * @throws Error if strategy is 'user_choice'\n */\nexport function applyMergeStrategy(\n  strategy: MergeStrategy,\n  localValue: unknown,\n  cloudValue: unknown,\n  localTimestamp: string,\n  cloudTimestamp: string\n): { value: unknown; source: 'local' | 'cloud' | 'merged' } {\n  switch (strategy) {\n    case 'take_local':\n      return { value: localValue, source: 'local' };\n\n    case 'take_cloud':\n      return { value: cloudValue, source: 'cloud' };\n\n    case 'take_latest':\n      if (new Date(localTimestamp) >= new Date(cloudTimestamp)) {\n        return { value: localValue, source: 'local' };\n      }\n      return { value: cloudValue, source: 'cloud' };\n\n    case 'take_max':\n      if (typeof localValue === 'number' && typeof cloudValue === 'number') {\n        return localValue >= cloudValue\n          ? { value: localValue, source: 'local' }\n          : { value: cloudValue, source: 'cloud' };\n      }\n      return { value: localValue, source: 'local' };\n\n    case 'take_min':\n      if (typeof localValue === 'number' && typeof cloudValue === 'number') {\n        return localValue <= cloudValue\n          ? { value: localValue, source: 'local' }\n          : { value: cloudValue, source: 'cloud' };\n      }\n      return { value: localValue, source: 'local' };\n\n    case 'sum':\n      if (typeof localValue === 'number' && typeof cloudValue === 'number') {\n        // For counters, we need base value. Simplified: take max\n        return { value: Math.max(localValue, cloudValue), source: 'merged' };\n      }\n      return { value: localValue, source: 'local' };\n\n    case 'concatenate':\n      if (Array.isArray(localValue) && Array.isArray(cloudValue)) {\n        // Dedupe by ID if present\n        const merged = [...localValue];\n        for (const item of cloudValue) {\n          const itemWithId = item as { id?: string };\n          if (\n            !merged.some(\n              (m) => (m as { id?: string }).id === itemWithId.id\n            )\n          ) {\n            merged.push(item);\n          }\n        }\n        return { value: merged, source: 'merged' };\n      }\n      return { value: localValue, source: 'local' };\n\n    case 'user_choice':\n    default:\n      // Cannot auto-merge - return null to indicate user choice needed\n      throw new Error(`Field requires user choice: ${strategy}`);\n  }\n}\n\n/**\n * Attempts to auto-merge a weak conflict.\n */\nexport function attemptAutoMerge(\n  localData: Record<string, unknown>,\n  cloudData: Record<string, unknown>,\n  fieldsInConflict: string[],\n  localTimestamp: string,\n  cloudTimestamp: string,\n  baseVersion: number\n): AutoMergeResult {\n  const mergedFields: FieldMergeResult[] = [];\n  const unmergeableFields: string[] = [];\n\n  for (const field of fieldsInConflict) {\n    const strategy = getMergeStrategy(field);\n\n    if (strategy === 'user_choice') {\n      unmergeableFields.push(field);\n      continue;\n    }\n\n    try {\n      const result = applyMergeStrategy(\n        strategy,\n        localData[field],\n        cloudData[field],\n        localTimestamp,\n        cloudTimestamp\n      );\n\n      mergedFields.push({\n        fieldName: field,\n        strategy,\n        resolvedValue: result.value,\n        source: result.source,\n      });\n    } catch {\n      unmergeableFields.push(field);\n    }\n  }\n\n  return {\n    success: unmergeableFields.length === 0,\n    mergedFields,\n    unmergeableFields,\n    resultVersion: baseVersion + 1,\n  };\n}\n\n// ============================================================\n// CONFLICT RESOLVER INTERFACE\n// ============================================================\n\n/**\n * Conflict resolver interface.\n */\nexport interface ConflictResolver {\n  /**\n   * Detects conflicts between local and cloud versions.\n   *\n   * @param nodeId - Node to check\n   * @param localData - Local node data\n   * @param cloudData - Cloud node data\n   * @returns Detected conflict or null if no conflict\n   */\n  detectConflict(\n    nodeId: string,\n    localData: Record<string, unknown>,\n    cloudData: Record<string, unknown>\n  ): DetectedConflict | null;\n\n  /**\n   * Attempts auto-merge for a weak conflict.\n   *\n   * @param conflict - Detected conflict\n   * @param localData - Full local node data\n   * @param cloudData - Full cloud node data\n   * @returns Auto-merge result\n   */\n  attemptAutoMerge(\n    conflict: DetectedConflict,\n    localData: Record<string, unknown>,\n    cloudData: Record<string, unknown>\n  ): AutoMergeResult;\n\n  /**\n   * Resolves a conflict with user choice.\n   *\n   * @param conflict - Detected conflict\n   * @param resolution - User's resolution choice\n   * @returns Resolution result\n   */\n  resolveConflict(\n    conflict: DetectedConflict,\n    resolution: ConflictResolution\n  ): Promise<void>;\n}\n\n// ============================================================\n// VALIDATION\n// ============================================================\n\n/**\n * Validates a detected conflict.\n */\nexport function validateDetectedConflict(\n  conflict: unknown\n): conflict is DetectedConflict {\n  return DetectedConflictSchema.safeParse(conflict).success;\n}\n\n/**\n * Validates a conflict resolution.\n */\nexport function validateConflictResolution(\n  resolution: unknown\n): resolution is ConflictResolution {\n  return ConflictResolutionSchema.safeParse(resolution).success;\n}\n","/**\n * @module @nous/core/sync/health\n * @description Health monitoring for database and sync\n * @version 1.0.0\n * @spec Brainstorms/Specs/storm-017\n * @storm Brainstorms/Infrastructure/storm-017-infrastructure-architecture\n *\n * Implements health monitoring as defined in storm-017 MVP extension:\n * - Local health counters\n * - Three-state health status (healthy/warning/error)\n * - Debug report generation\n *\n * @see storm-017 v1.1 - Health Monitoring extension\n */\n\nimport { z } from 'zod';\n\n// ============================================================\n// HEALTH STATUS\n// ============================================================\n\n/**\n * Health status levels.\n */\nexport const HEALTH_STATUSES = ['healthy', 'warning', 'error'] as const;\nexport type HealthStatus = (typeof HEALTH_STATUSES)[number];\n\n/**\n * Health check thresholds.\n */\nexport const HEALTH_THRESHOLDS = {\n  /** Max time since last sync before warning (seconds) */\n  syncWarningSeconds: 3600, // 1 hour\n\n  /** Max time since last sync before error (seconds) */\n  syncErrorSeconds: 86400, // 24 hours\n\n  /** Max pending changes before warning */\n  pendingWarningCount: 10,\n\n  /** Max sync errors in 24h before error status */\n  errorThreshold24h: 5,\n\n  /** Max conflicts before warning */\n  conflictWarningCount: 1,\n} as const;\n\n// ============================================================\n// HEALTH METRICS\n// ============================================================\n\n/**\n * Health metrics collected locally.\n */\nexport interface HealthMetrics {\n  /** Last successful sync timestamp (Unix ms) */\n  lastSuccessfulSync: number | null;\n  /** Sync errors in rolling 24h window */\n  syncErrors24h: number;\n  /** Number of pending local changes */\n  pendingChanges: number;\n  /** Number of unresolved conflicts */\n  unresolvedConflicts: number;\n  /** Database size in bytes */\n  databaseSizeBytes: number;\n  /** Node count */\n  nodeCount: number;\n  /** Edge count */\n  edgeCount: number;\n  /** App version */\n  appVersion: string;\n  /** Last metrics update timestamp */\n  updatedAt: number;\n}\n\nexport const HealthMetricsSchema = z.object({\n  lastSuccessfulSync: z.number().nullable(),\n  syncErrors24h: z.number().int().min(0),\n  pendingChanges: z.number().int().min(0),\n  unresolvedConflicts: z.number().int().min(0),\n  databaseSizeBytes: z.number().int().min(0),\n  nodeCount: z.number().int().min(0),\n  edgeCount: z.number().int().min(0),\n  appVersion: z.string(),\n  updatedAt: z.number(),\n});\n\n/**\n * Creates empty health metrics.\n */\nexport function createEmptyHealthMetrics(appVersion: string): HealthMetrics {\n  return {\n    lastSuccessfulSync: null,\n    syncErrors24h: 0,\n    pendingChanges: 0,\n    unresolvedConflicts: 0,\n    databaseSizeBytes: 0,\n    nodeCount: 0,\n    edgeCount: 0,\n    appVersion,\n    updatedAt: Date.now(),\n  };\n}\n\n// ============================================================\n// HEALTH ASSESSMENT\n// ============================================================\n\n/**\n * Health assessment result.\n */\nexport interface HealthAssessment {\n  /** Overall health status */\n  status: HealthStatus;\n  /** Human-readable status label */\n  label: string;\n  /** Detailed status message */\n  message: string;\n  /** Individual check results */\n  checks: HealthCheck[];\n  /** Issues found */\n  issues: string[];\n  /** Recommendations */\n  recommendations: string[];\n  /** Assessment timestamp */\n  assessedAt: string;\n}\n\nexport const HealthAssessmentSchema = z.object({\n  status: z.enum(HEALTH_STATUSES),\n  label: z.string(),\n  message: z.string(),\n  checks: z.array(z.any()),\n  issues: z.array(z.string()),\n  recommendations: z.array(z.string()),\n  assessedAt: z.string().datetime(),\n});\n\n/**\n * Individual health check.\n */\nexport interface HealthCheck {\n  /** Check name */\n  name: string;\n  /** Check status */\n  status: HealthStatus;\n  /** Check message */\n  message: string;\n  /** Optional value being checked */\n  value?: unknown;\n  /** Optional threshold */\n  threshold?: unknown;\n}\n\n// ============================================================\n// HEALTH CHECK FUNCTIONS\n// ============================================================\n\n/**\n * Checks sync recency.\n */\nfunction checkSyncRecency(metrics: HealthMetrics): HealthCheck {\n  if (metrics.lastSuccessfulSync === null) {\n    return {\n      name: 'sync_recency',\n      status: 'warning',\n      message: 'Never synced',\n    };\n  }\n\n  const secondsSinceSync = (Date.now() - metrics.lastSuccessfulSync) / 1000;\n\n  if (secondsSinceSync > HEALTH_THRESHOLDS.syncErrorSeconds) {\n    return {\n      name: 'sync_recency',\n      status: 'error',\n      message: 'Last sync over 24 hours ago',\n      value: secondsSinceSync,\n      threshold: HEALTH_THRESHOLDS.syncErrorSeconds,\n    };\n  }\n\n  if (secondsSinceSync > HEALTH_THRESHOLDS.syncWarningSeconds) {\n    return {\n      name: 'sync_recency',\n      status: 'warning',\n      message: 'Last sync over 1 hour ago',\n      value: secondsSinceSync,\n      threshold: HEALTH_THRESHOLDS.syncWarningSeconds,\n    };\n  }\n\n  return {\n    name: 'sync_recency',\n    status: 'healthy',\n    message: 'Recently synced',\n    value: secondsSinceSync,\n  };\n}\n\n/**\n * Checks sync error count.\n */\nfunction checkSyncErrors(metrics: HealthMetrics): HealthCheck {\n  if (metrics.syncErrors24h >= HEALTH_THRESHOLDS.errorThreshold24h) {\n    return {\n      name: 'sync_errors',\n      status: 'error',\n      message: `${metrics.syncErrors24h} sync errors in 24h`,\n      value: metrics.syncErrors24h,\n      threshold: HEALTH_THRESHOLDS.errorThreshold24h,\n    };\n  }\n\n  if (metrics.syncErrors24h > 0) {\n    return {\n      name: 'sync_errors',\n      status: 'warning',\n      message: `${metrics.syncErrors24h} sync error${metrics.syncErrors24h > 1 ? 's' : ''} in 24h`,\n      value: metrics.syncErrors24h,\n    };\n  }\n\n  return {\n    name: 'sync_errors',\n    status: 'healthy',\n    message: 'No sync errors',\n    value: 0,\n  };\n}\n\n/**\n * Checks pending changes count.\n */\nfunction checkPendingChanges(metrics: HealthMetrics): HealthCheck {\n  if (metrics.pendingChanges > HEALTH_THRESHOLDS.pendingWarningCount) {\n    return {\n      name: 'pending_changes',\n      status: 'warning',\n      message: `${metrics.pendingChanges} changes pending sync`,\n      value: metrics.pendingChanges,\n      threshold: HEALTH_THRESHOLDS.pendingWarningCount,\n    };\n  }\n\n  return {\n    name: 'pending_changes',\n    status: 'healthy',\n    message:\n      metrics.pendingChanges > 0\n        ? `${metrics.pendingChanges} changes pending`\n        : 'All synced',\n    value: metrics.pendingChanges,\n  };\n}\n\n/**\n * Checks conflict count.\n */\nfunction checkConflicts(metrics: HealthMetrics): HealthCheck {\n  if (metrics.unresolvedConflicts >= HEALTH_THRESHOLDS.conflictWarningCount) {\n    return {\n      name: 'conflicts',\n      status: 'warning',\n      message: `${metrics.unresolvedConflicts} unresolved conflict${metrics.unresolvedConflicts > 1 ? 's' : ''}`,\n      value: metrics.unresolvedConflicts,\n      threshold: HEALTH_THRESHOLDS.conflictWarningCount,\n    };\n  }\n\n  return {\n    name: 'conflicts',\n    status: 'healthy',\n    message: 'No conflicts',\n    value: 0,\n  };\n}\n\n// ============================================================\n// HEALTH ASSESSMENT LOGIC\n// ============================================================\n\n/**\n * Assesses health status from metrics.\n *\n * @param metrics - Current health metrics\n * @returns Health assessment\n */\nexport function assessHealth(metrics: HealthMetrics): HealthAssessment {\n  const checks: HealthCheck[] = [];\n  const issues: string[] = [];\n  const recommendations: string[] = [];\n\n  // Check 1: Sync recency\n  const syncCheck = checkSyncRecency(metrics);\n  checks.push(syncCheck);\n  if (syncCheck.status !== 'healthy') {\n    issues.push(syncCheck.message);\n    recommendations.push(\n      'Check your internet connection and try syncing manually.'\n    );\n  }\n\n  // Check 2: Sync errors\n  const errorCheck = checkSyncErrors(metrics);\n  checks.push(errorCheck);\n  if (errorCheck.status !== 'healthy') {\n    issues.push(errorCheck.message);\n    recommendations.push(\n      'Review sync error logs. You may need to resolve conflicts.'\n    );\n  }\n\n  // Check 3: Pending changes\n  const pendingCheck = checkPendingChanges(metrics);\n  checks.push(pendingCheck);\n  if (pendingCheck.status !== 'healthy') {\n    issues.push(pendingCheck.message);\n    recommendations.push('Connect to sync your pending changes.');\n  }\n\n  // Check 4: Conflicts\n  const conflictCheck = checkConflicts(metrics);\n  checks.push(conflictCheck);\n  if (conflictCheck.status !== 'healthy') {\n    issues.push(conflictCheck.message);\n    recommendations.push('Review and resolve sync conflicts.');\n  }\n\n  // Determine overall status\n  const hasError = checks.some((c) => c.status === 'error');\n  const hasWarning = checks.some((c) => c.status === 'warning');\n\n  let status: HealthStatus;\n  let label: string;\n  let message: string;\n\n  if (hasError) {\n    status = 'error';\n    label = 'Sync issue';\n    message = `${issues.length} issue${issues.length > 1 ? 's' : ''} detected`;\n  } else if (hasWarning) {\n    status = 'warning';\n    label = 'Sync delayed';\n    message = 'Some items may not be synced';\n  } else {\n    status = 'healthy';\n    label = 'Everything OK';\n    message = 'All systems operational';\n  }\n\n  return {\n    status,\n    label,\n    message,\n    checks,\n    issues,\n    recommendations,\n    assessedAt: new Date().toISOString(),\n  };\n}\n\n// ============================================================\n// DEBUG REPORT\n// ============================================================\n\n/**\n * Sync log entry.\n */\nexport interface SyncLogEntry {\n  timestamp: string;\n  event: string;\n  success: boolean;\n  details?: string;\n}\n\n/**\n * Debug report for troubleshooting.\n */\nexport interface DebugReport {\n  /** Report generated timestamp */\n  generatedAt: string;\n  /** Health metrics */\n  metrics: HealthMetrics;\n  /** Health assessment */\n  assessment: HealthAssessment;\n  /** Device information */\n  device: {\n    platform: string;\n    osVersion: string;\n    appVersion: string;\n    deviceId: string;\n  };\n  /** Recent sync log entries */\n  recentSyncLogs: SyncLogEntry[];\n  /** Database statistics */\n  databaseStats: {\n    sizeBytes: number;\n    nodeCount: number;\n    edgeCount: number;\n    episodeCount: number;\n    schemaVersion: number;\n  };\n}\n\n/**\n * Generates a debug report.\n *\n * @param metrics - Current health metrics\n * @param deviceInfo - Device information\n * @param syncLogs - Recent sync logs (up to 20)\n * @param dbStats - Database statistics\n * @returns Debug report\n */\nexport function generateDebugReport(\n  metrics: HealthMetrics,\n  deviceInfo: DebugReport['device'],\n  syncLogs: SyncLogEntry[],\n  dbStats: DebugReport['databaseStats']\n): DebugReport {\n  return {\n    generatedAt: new Date().toISOString(),\n    metrics,\n    assessment: assessHealth(metrics),\n    device: deviceInfo,\n    recentSyncLogs: syncLogs.slice(0, 20), // Last 20 entries\n    databaseStats: dbStats,\n  };\n}\n\n// ============================================================\n// HEALTH MONITOR INTERFACE\n// ============================================================\n\n/**\n * Health monitor interface.\n */\nexport interface HealthMonitor {\n  /**\n   * Gets current health metrics.\n   */\n  getMetrics(): Promise<HealthMetrics>;\n\n  /**\n   * Gets current health assessment.\n   */\n  getAssessment(): Promise<HealthAssessment>;\n\n  /**\n   * Generates a debug report.\n   */\n  generateReport(): Promise<DebugReport>;\n\n  /**\n   * Records a sync success.\n   */\n  recordSyncSuccess(): Promise<void>;\n\n  /**\n   * Records a sync error.\n   */\n  recordSyncError(error: string): Promise<void>;\n\n  /**\n   * Updates pending change count.\n   */\n  updatePendingCount(count: number): Promise<void>;\n\n  /**\n   * Updates conflict count.\n   */\n  updateConflictCount(count: number): Promise<void>;\n}\n\n// ============================================================\n// VALIDATION\n// ============================================================\n\n/**\n * Validates health metrics.\n */\nexport function validateHealthMetrics(\n  metrics: unknown\n): metrics is HealthMetrics {\n  return HealthMetricsSchema.safeParse(metrics).success;\n}\n\n/**\n * Validates a health assessment.\n */\nexport function validateHealthAssessment(\n  assessment: unknown\n): assessment is HealthAssessment {\n  return HealthAssessmentSchema.safeParse(assessment).success;\n}\n","/**\n * @module @nous/core/sync/nse-constants\n * @description Constants for Nous Sync Engine (NSE) v1\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-033\n * @storm Brainstorms/Infrastructure/storm-033-sync-conflict-resolution\n *\n * All NSE-specific numeric thresholds, platform types, sync statuses,\n * merge strategies, and configuration defaults.\n *\n * @see storm-033 v1 revision\n */\n\nimport { z } from 'zod';\n\n// ============================================================\n// PLATFORM CONSTANTS\n// ============================================================\n\nexport const NSE_PLATFORMS = ['ios', 'android', 'mac', 'win', 'web'] as const;\nexport type NSEPlatform = (typeof NSE_PLATFORMS)[number];\nexport const NSEPlatformSchema = z.enum(NSE_PLATFORMS);\n\nexport function isNSEPlatform(value: unknown): value is NSEPlatform {\n  return NSE_PLATFORMS.includes(value as NSEPlatform);\n}\n\n// ============================================================\n// NODE SYNC STATUS CONSTANTS\n// ============================================================\n\nexport const NODE_SYNC_STATUSES = ['synced', 'pending', 'conflict'] as const;\nexport type NodeSyncStatus = (typeof NODE_SYNC_STATUSES)[number];\nexport const NodeSyncStatusSchema = z.enum(NODE_SYNC_STATUSES);\n\nexport function isNodeSyncStatus(value: unknown): value is NodeSyncStatus {\n  return NODE_SYNC_STATUSES.includes(value as NodeSyncStatus);\n}\n\n// ============================================================\n// VERSION VECTOR CONSTANTS\n// ============================================================\n\nexport const VERSION_VECTOR_INACTIVE_KEY = '_inactive';\nexport const VECTOR_COMPACTION_THRESHOLD = 10;\nexport const DEVICE_INACTIVE_DAYS = 90;\n\n// ============================================================\n// VERSION COMPARISON CONSTANTS\n// ============================================================\n\nexport const VERSION_COMPARISON_RESULTS = ['a_dominates', 'b_dominates', 'concurrent', 'equal'] as const;\nexport type VersionComparison = (typeof VERSION_COMPARISON_RESULTS)[number];\nexport const VersionComparisonSchema = z.enum(VERSION_COMPARISON_RESULTS);\n\nexport function isVersionComparison(value: unknown): value is VersionComparison {\n  return VERSION_COMPARISON_RESULTS.includes(value as VersionComparison);\n}\n\n// ============================================================\n// SYNC LOCK CONSTANTS\n// ============================================================\n\nexport const NSE_SYNC_LOCK_TIMEOUT_SECONDS = 30;\n\n// ============================================================\n// BATCH SYNC CONSTANTS\n// ============================================================\n\nexport const NSE_SYNC_BATCH_SIZE = 100;\nexport const UI_YIELD_DELAY_MS = 50;\n\n// ============================================================\n// CONFLICT HISTORY CONSTANTS\n// ============================================================\n\nexport const CONFLICT_HISTORY_RETENTION_DAYS = 30;\n\n// ============================================================\n// NOTIFICATION CONSTANTS\n// ============================================================\n\nexport const BANNER_DISMISS_COOLDOWN_MS = 86_400_000;\n\nexport const NOTIFICATION_TIERS = ['badge', 'banner', 'modal'] as const;\nexport type NotificationTier = (typeof NOTIFICATION_TIERS)[number];\nexport const NotificationTierSchema = z.enum(NOTIFICATION_TIERS);\n\n// ============================================================\n// CLOCK DRIFT CONSTANTS\n// ============================================================\n\nexport const CLOCK_DRIFT_EMA_WEIGHT = 0.2;\n\n// ============================================================\n// NSE MERGE STRATEGY CONSTANTS\n// ============================================================\n\nexport const NSE_MERGE_STRATEGIES = [\n  'conflict',\n  'latest_wins',\n  'max',\n  'min',\n  'sum',\n  'average',\n  'max_timestamp',\n  'union',\n  'merge_memberships',\n  'keep_original',\n  'keep_local',\n] as const;\n\nexport type NSEMergeStrategy = (typeof NSE_MERGE_STRATEGIES)[number];\nexport const NSEMergeStrategySchema = z.enum(NSE_MERGE_STRATEGIES);\n\nexport function isNSEMergeStrategy(value: unknown): value is NSEMergeStrategy {\n  return NSE_MERGE_STRATEGIES.includes(value as NSEMergeStrategy);\n}\n\n// ============================================================\n// SYNCABLE FIELDS\n// ============================================================\n\nexport const SYNCABLE_FIELDS = [\n  'content.title',\n  'content.body',\n  'content.summary',\n  'organization.tags',\n  'organization.cluster_memberships',\n  'neural.stability',\n  'neural.retrievability',\n  'neural.difficulty',\n  'neural.importance',\n  'temporal.last_accessed',\n  'temporal.access_count',\n  'state.lifecycle',\n  'state.flags',\n] as const;\n\nexport type SyncableField = (typeof SYNCABLE_FIELDS)[number];\nexport const SyncableFieldSchema = z.enum(SYNCABLE_FIELDS);\n\n// ============================================================\n// FIELD-TO-STRATEGY MAPPING\n// ============================================================\n\nexport const NSE_FIELD_MERGE_STRATEGIES: Record<string, NSEMergeStrategy> = {\n  'content.body': 'conflict',\n  'content.title': 'latest_wins',\n  'content.summary': 'latest_wins',\n  'organization.tags': 'union',\n  'organization.cluster_memberships': 'merge_memberships',\n  'neural.stability': 'max',\n  'neural.retrievability': 'max',\n  'neural.difficulty': 'average',\n  'neural.importance': 'max',\n  'temporal.last_accessed': 'max_timestamp',\n  'temporal.access_count': 'sum',\n  'state.lifecycle': 'latest_wins',\n  'state.flags': 'union',\n  '_default': 'latest_wins',\n};\n\n// ============================================================\n// SYNC PROTOCOL CONSTANTS\n// ============================================================\n\nexport const SYNC_HEADER_DEVICE_ID = 'X-Device-Id';\nexport const SYNC_HEADER_SCHEMA_VERSION = 'X-Schema-Version';\nexport const SYNC_HEADER_SERVER_TIME = 'X-Server-Time';\nexport const HTTP_UPGRADE_REQUIRED = 426;\n\n// ============================================================\n// SYNC LOG ENTRY TYPES\n// ============================================================\n\nexport const SYNC_LOG_ENTRY_TYPES = [\n  'resurrection',\n  'conflict_resolved',\n  'schema_mismatch',\n  'recovery',\n  'initial_sync',\n] as const;\n\nexport type SyncLogEntryType = (typeof SYNC_LOG_ENTRY_TYPES)[number];\nexport const SyncLogEntryTypeSchema = z.enum(SYNC_LOG_ENTRY_TYPES);\n\n// ============================================================\n// RE-EMBEDDING REASON CONSTANTS\n// ============================================================\n\nexport const REEMBEDDING_REASONS = ['model_mismatch', 'content_changed', 'manual'] as const;\nexport type ReembeddingReason = (typeof REEMBEDDING_REASONS)[number];\nexport const ReembeddingReasonSchema = z.enum(REEMBEDDING_REASONS);\n\n// ============================================================\n// USER RESOLUTION ACTION CONSTANTS\n// ============================================================\n\nexport const USER_RESOLUTION_ACTIONS = ['keep_local', 'keep_remote', 'manual_merge'] as const;\nexport type UserResolutionAction = (typeof USER_RESOLUTION_ACTIONS)[number];\nexport const UserResolutionActionSchema = z.enum(USER_RESOLUTION_ACTIONS);\n\n// ============================================================\n// MERGE RESULT STATUS CONSTANTS\n// ============================================================\n\nexport const MERGE_RESULT_STATUSES = ['merged', 'conflict'] as const;\nexport type MergeResultStatus = (typeof MERGE_RESULT_STATUSES)[number];\nexport const MergeResultStatusSchema = z.enum(MERGE_RESULT_STATUSES);\n\n// ============================================================\n// CONFLICT RESOLVER CONSTANTS\n// ============================================================\n\nexport const NSE_CONFLICT_RESOLVERS = ['user', 'auto'] as const;\nexport type NSEConflictResolver = (typeof NSE_CONFLICT_RESOLVERS)[number];\nexport const NSEConflictResolverSchema = z.enum(NSE_CONFLICT_RESOLVERS);\n","/**\n * @module @nous/core/sync/nse-types\n * @description Types and Zod schemas for Nous Sync Engine (NSE) v1\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-033\n * @storm Brainstorms/Infrastructure/storm-033-sync-conflict-resolution\n *\n * All interfaces, types, and Zod schemas for the NSE.\n */\n\nimport { z } from 'zod';\nimport {\n  type NSEPlatform,\n  type NodeSyncStatus,\n  type MergeResultStatus,\n  type UserResolutionAction,\n  type NSEConflictResolver,\n  type ReembeddingReason,\n  type SyncLogEntryType,\n  NSEPlatformSchema,\n  NodeSyncStatusSchema,\n  MergeResultStatusSchema,\n  UserResolutionActionSchema,\n  NSEConflictResolverSchema,\n  ReembeddingReasonSchema,\n  SyncLogEntryTypeSchema,\n} from './nse-constants';\n\n// ============================================================\n// VERSION VECTOR\n// ============================================================\n\n/**\n * Version vector mapping device IDs to Lamport counters.\n * The special key `_inactive` holds compacted sum of inactive devices.\n */\nexport interface VersionVector {\n  [device_id: string]: number;\n}\n\nexport const VersionVectorSchema = z.record(z.string(), z.number().int().min(0));\n\n// ============================================================\n// SYNC METADATA\n// ============================================================\n\nexport interface SyncMetadata {\n  _schemaVersion: number;\n  version: VersionVector;\n  last_modified_by: string;\n  last_modified_at: string;\n  sync_status: NodeSyncStatus;\n  last_synced_at: string;\n  content_checksum?: string;\n}\n\nexport const SyncMetadataSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  version: VersionVectorSchema,\n  last_modified_by: z.string().min(1),\n  last_modified_at: z.string().datetime(),\n  sync_status: NodeSyncStatusSchema,\n  last_synced_at: z.string().datetime(),\n  content_checksum: z.string().optional(),\n});\n\n// ============================================================\n// DEVICE INFO\n// ============================================================\n\nexport interface DeviceInfo {\n  _schemaVersion: number;\n  device_id: string;\n  platform: NSEPlatform;\n  display_name: string;\n  created_at: string;\n  last_active_at: string;\n  clock_drift_ms: number;\n  schema_version: string;\n}\n\nexport const DeviceInfoSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  device_id: z.string().min(1),\n  platform: NSEPlatformSchema,\n  display_name: z.string().min(1),\n  created_at: z.string().datetime(),\n  last_active_at: z.string().datetime(),\n  clock_drift_ms: z.number(),\n  schema_version: z.string().min(1),\n});\n\n// ============================================================\n// CLOCK SYNC\n// ============================================================\n\nexport interface ClockSync {\n  server_time: string;\n  local_time: string;\n  drift_ms: number;\n  last_sync: string;\n}\n\nexport const ClockSyncSchema = z.object({\n  server_time: z.string().datetime(),\n  local_time: z.string().datetime(),\n  drift_ms: z.number(),\n  last_sync: z.string().datetime(),\n});\n\n// ============================================================\n// FIELD CHANGE\n// ============================================================\n\nexport interface FieldChange {\n  field: string;\n  old_value: unknown;\n  new_value: unknown;\n}\n\nexport const FieldChangeSchema = z.object({\n  field: z.string().min(1),\n  old_value: z.unknown(),\n  new_value: z.unknown(),\n});\n\n// ============================================================\n// CHANGE SET\n// ============================================================\n\nexport interface ChangeSet {\n  node_id: string;\n  device_id: string;\n  timestamp: string;\n  changes: FieldChange[];\n}\n\nexport const ChangeSetSchema = z.object({\n  node_id: z.string().min(1),\n  device_id: z.string().min(1),\n  timestamp: z.string().datetime(),\n  changes: z.array(FieldChangeSchema),\n});\n\n// ============================================================\n// STRATEGY RESULT\n// ============================================================\n\nexport interface StrategyResult {\n  value: unknown;\n  isConflict: boolean;\n}\n\nexport const StrategyResultSchema = z.object({\n  value: z.unknown(),\n  isConflict: z.boolean(),\n});\n\n// ============================================================\n// CLUSTER MEMBERSHIP FOR MERGE\n// ============================================================\n\nexport interface ClusterMembershipForMerge {\n  cluster_id: string;\n  strength: number;\n  pinned: boolean;\n}\n\nexport const ClusterMembershipForMergeSchema = z.object({\n  cluster_id: z.string().min(1),\n  strength: z.number().min(0).max(1),\n  pinned: z.boolean(),\n});\n\n// ============================================================\n// CONFLICT INFO (NSE)\n// ============================================================\n\nexport interface NSEConflictInfo {\n  field: string;\n  localValue: unknown;\n  remoteValue: unknown;\n  localTimestamp: string;\n  remoteTimestamp: string;\n}\n\nexport const NSEConflictInfoSchema = z.object({\n  field: z.string().min(1),\n  localValue: z.unknown(),\n  remoteValue: z.unknown(),\n  localTimestamp: z.string().datetime(),\n  remoteTimestamp: z.string().datetime(),\n});\n\n// ============================================================\n// MERGE RESULT (NSE)\n// ============================================================\n\nexport interface NSEMergeResult {\n  status: MergeResultStatus;\n  mergedNode?: Record<string, unknown>;\n  conflicts?: NSEConflictInfo[];\n}\n\nexport const NSEMergeResultSchema = z.object({\n  status: MergeResultStatusSchema,\n  mergedNode: z.record(z.string(), z.unknown()).optional(),\n  conflicts: z.array(NSEConflictInfoSchema).optional(),\n});\n\n// ============================================================\n// STORED CONFLICT (NSE)\n// ============================================================\n\nexport interface NSEStoredConflict {\n  _schemaVersion: number;\n  node_id: string;\n  local_version: Record<string, unknown>;\n  remote_version: Record<string, unknown>;\n  conflicts: NSEConflictInfo[];\n  created_at: string;\n  expires_at: string;\n}\n\nexport const NSEStoredConflictSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  node_id: z.string().min(1),\n  local_version: z.record(z.string(), z.unknown()),\n  remote_version: z.record(z.string(), z.unknown()),\n  conflicts: z.array(NSEConflictInfoSchema),\n  created_at: z.string().datetime(),\n  expires_at: z.string().datetime(),\n});\n\n// ============================================================\n// USER RESOLUTION (NSE)\n// ============================================================\n\nexport interface NSEUserResolution {\n  node_id: string;\n  resolution: UserResolutionAction;\n  field_choices?: Record<string, 'local' | 'remote'>;\n  manual_values?: Record<string, unknown>;\n  apply_to_similar: boolean;\n}\n\nexport const NSEUserResolutionSchema = z.object({\n  node_id: z.string().min(1),\n  resolution: UserResolutionActionSchema,\n  field_choices: z.record(z.string(), z.enum(['local', 'remote'])).optional(),\n  manual_values: z.record(z.string(), z.unknown()).optional(),\n  apply_to_similar: z.boolean(),\n});\n\n// ============================================================\n// CONFLICT HISTORY ENTRY\n// ============================================================\n\nexport interface ConflictHistoryEntry {\n  _schemaVersion: number;\n  node_id: string;\n  rejected_version: Record<string, unknown>;\n  resolved_at: string;\n  resolved_by: NSEConflictResolver;\n  expires_at: string;\n}\n\nexport const ConflictHistoryEntrySchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  node_id: z.string().min(1),\n  rejected_version: z.record(z.string(), z.unknown()),\n  resolved_at: z.string().datetime(),\n  resolved_by: NSEConflictResolverSchema,\n  expires_at: z.string().datetime(),\n});\n\n// ============================================================\n// PUSH PAYLOAD\n// ============================================================\n\nexport interface PushPayload {\n  id: string;\n  version: VersionVector;\n  change_set: ChangeSet;\n  data: Record<string, unknown>;\n  content_checksum?: string;\n}\n\nexport const PushPayloadSchema = z.object({\n  id: z.string().min(1),\n  version: VersionVectorSchema,\n  change_set: ChangeSetSchema,\n  data: z.record(z.string(), z.unknown()),\n  content_checksum: z.string().optional(),\n});\n\n// ============================================================\n// PUSH RESULT\n// ============================================================\n\nexport interface PushResult {\n  applied: Array<{ id: string }>;\n  conflicts: Array<{ id: string; remoteVersion: VersionVector }>;\n  error?: string;\n}\n\nexport const PushResultSchema = z.object({\n  applied: z.array(z.object({ id: z.string().min(1) })),\n  conflicts: z.array(z.object({\n    id: z.string().min(1),\n    remoteVersion: VersionVectorSchema,\n  })),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// PULL RESULT\n// ============================================================\n\nexport interface PullResult {\n  applied: string[];\n  conflicts: string[];\n  error?: string;\n}\n\nexport const PullResultSchema = z.object({\n  applied: z.array(z.string()),\n  conflicts: z.array(z.string()),\n  error: z.string().optional(),\n});\n\n// ============================================================\n// BATCH SYNC RESPONSE\n// ============================================================\n\nexport interface BatchSyncResponse {\n  changes: PushPayload[];\n  next_cursor: string | null;\n  total_estimate: number;\n  batch_number: number;\n}\n\nexport const BatchSyncResponseSchema = z.object({\n  changes: z.array(PushPayloadSchema),\n  next_cursor: z.string().nullable(),\n  total_estimate: z.number().int().min(0),\n  batch_number: z.number().int().min(1),\n});\n\n// ============================================================\n// SYNC PROGRESS\n// ============================================================\n\nexport interface NSESyncProgress {\n  processed: number;\n  total: number;\n  percent: number;\n  batchNumber: number;\n}\n\nexport const NSESyncProgressSchema = z.object({\n  processed: z.number().int().min(0),\n  total: z.number().int().min(0),\n  percent: z.number().min(0).max(100),\n  batchNumber: z.number().int().min(1),\n});\n\n// ============================================================\n// LAST SYNCED VERSION\n// ============================================================\n\nexport interface LastSyncedVersion {\n  _schemaVersion: number;\n  node_id: string;\n  snapshot: Record<string, unknown>;\n  synced_at: string;\n}\n\nexport const LastSyncedVersionSchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  node_id: z.string().min(1),\n  snapshot: z.record(z.string(), z.unknown()),\n  synced_at: z.string().datetime(),\n});\n\n// ============================================================\n// PRIVATE TIER PAYLOAD\n// ============================================================\n\nexport interface PrivateTierPayload {\n  id: string;\n  version: VersionVector;\n  content_checksum: string;\n  encrypted_payload: string;\n  nonce: string;\n  last_modified_at: string;\n}\n\nexport const PrivateTierPayloadSchema = z.object({\n  id: z.string().min(1),\n  version: VersionVectorSchema,\n  content_checksum: z.string().min(1),\n  encrypted_payload: z.string().min(1),\n  nonce: z.string().min(1),\n  last_modified_at: z.string().datetime(),\n});\n\n// ============================================================\n// PRIVATE TIER CONFLICT\n// ============================================================\n\nexport interface PrivateTierConflict {\n  node_id: string;\n  local_checksum: string;\n  remote_checksum: string;\n  local_payload: string;\n  remote_payload: string;\n  detected_at: string;\n}\n\nexport const PrivateTierConflictSchema = z.object({\n  node_id: z.string().min(1),\n  local_checksum: z.string().min(1),\n  remote_checksum: z.string().min(1),\n  local_payload: z.string().min(1),\n  remote_payload: z.string().min(1),\n  detected_at: z.string().datetime(),\n});\n\n// ============================================================\n// CONFLICT NOTIFICATION\n// ============================================================\n\nexport interface ConflictNotification {\n  node_id: string;\n  conflict_count: number;\n  fields: string[];\n  created_at: string;\n}\n\nexport const ConflictNotificationSchema = z.object({\n  node_id: z.string().min(1),\n  conflict_count: z.number().int().min(1),\n  fields: z.array(z.string()),\n  created_at: z.string().datetime(),\n});\n\n// ============================================================\n// BANNER NOTIFICATION\n// ============================================================\n\nexport interface NotificationAction {\n  label: string;\n  onClick: string;\n}\n\nexport const NotificationActionSchema = z.object({\n  label: z.string().min(1),\n  onClick: z.string().min(1),\n});\n\nexport interface BannerNotification {\n  type: 'warning';\n  message: string;\n  actions: NotificationAction[];\n  dismissible: boolean;\n}\n\nexport const BannerNotificationSchema = z.object({\n  type: z.literal('warning'),\n  message: z.string().min(1),\n  actions: z.array(NotificationActionSchema),\n  dismissible: z.boolean(),\n});\n\n// ============================================================\n// BADGE STATE\n// ============================================================\n\nexport interface BadgeState {\n  conflict_count: number;\n  visible: boolean;\n}\n\nexport const BadgeStateSchema = z.object({\n  conflict_count: z.number().int().min(0),\n  visible: z.boolean(),\n});\n\n// ============================================================\n// BANNER DISMISS STATE\n// ============================================================\n\nexport interface BannerDismissState {\n  dismissed_at: string;\n  cooldown_expired: boolean;\n}\n\nexport const BannerDismissStateSchema = z.object({\n  dismissed_at: z.string().datetime(),\n  cooldown_expired: z.boolean(),\n});\n\n// ============================================================\n// EMBEDDING SYNC\n// ============================================================\n\nexport interface EmbeddingSync {\n  vector: number[];\n  model: string;\n  model_version: string;\n  generated_by: string;\n  generated_at: string;\n}\n\nexport const EmbeddingSyncSchema = z.object({\n  vector: z.array(z.number()),\n  model: z.string().min(1),\n  model_version: z.string().min(1),\n  generated_by: z.string().min(1),\n  generated_at: z.string().datetime(),\n});\n\n// ============================================================\n// RE-EMBEDDING QUEUE ENTRY\n// ============================================================\n\nexport interface ReembeddingQueueEntry {\n  _schemaVersion: number;\n  node_id: string;\n  reason: ReembeddingReason;\n  from_model: string;\n  to_model: string;\n  queued_at: string;\n}\n\nexport const ReembeddingQueueEntrySchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  node_id: z.string().min(1),\n  reason: ReembeddingReasonSchema,\n  from_model: z.string().min(1),\n  to_model: z.string().min(1),\n  queued_at: z.string().datetime(),\n});\n\n// ============================================================\n// SCHEMA VERSION ERROR\n// ============================================================\n\nexport interface SchemaVersionError {\n  min_version: string;\n  upgrade_url: string;\n  message: string;\n}\n\nexport const SchemaVersionErrorSchema = z.object({\n  min_version: z.string().min(1),\n  upgrade_url: z.string().url(),\n  message: z.string().min(1),\n});\n\n// ============================================================\n// SYNC LOG ENTRY\n// ============================================================\n\nexport interface NSESyncLogEntry {\n  _schemaVersion: number;\n  type: SyncLogEntryType;\n  node_id?: string;\n  timestamp: string;\n  message: string;\n  device_id: string;\n}\n\nexport const NSESyncLogEntrySchema = z.object({\n  _schemaVersion: z.number().int().min(1),\n  type: SyncLogEntryTypeSchema,\n  node_id: z.string().optional(),\n  timestamp: z.string().datetime(),\n  message: z.string().min(1),\n  device_id: z.string().min(1),\n});\n\n// ============================================================\n// SERVER SYNC STATE\n// ============================================================\n\nexport interface ServerSyncState {\n  current_vector: VersionVector;\n  node_count: number;\n  schema_version: string;\n}\n\nexport const ServerSyncStateSchema = z.object({\n  current_vector: VersionVectorSchema,\n  node_count: z.number().int().min(0),\n  schema_version: z.string().min(1),\n});\n\n// ============================================================\n// VALIDATION FUNCTIONS\n// ============================================================\n\nexport function validateVersionVector(v: unknown): v is VersionVector {\n  return VersionVectorSchema.safeParse(v).success;\n}\n\nexport function validateSyncMetadata(v: unknown): v is SyncMetadata {\n  return SyncMetadataSchema.safeParse(v).success;\n}\n\nexport function validateDeviceInfo(v: unknown): v is DeviceInfo {\n  return DeviceInfoSchema.safeParse(v).success;\n}\n\nexport function validateChangeSet(v: unknown): v is ChangeSet {\n  return ChangeSetSchema.safeParse(v).success;\n}\n\nexport function validateNSEMergeResult(v: unknown): v is NSEMergeResult {\n  return NSEMergeResultSchema.safeParse(v).success;\n}\n\nexport function validateNSEStoredConflict(v: unknown): v is NSEStoredConflict {\n  return NSEStoredConflictSchema.safeParse(v).success;\n}\n\nexport function validateNSEUserResolution(v: unknown): v is NSEUserResolution {\n  return NSEUserResolutionSchema.safeParse(v).success;\n}\n\nexport function validatePushPayload(v: unknown): v is PushPayload {\n  return PushPayloadSchema.safeParse(v).success;\n}\n\nexport function validatePrivateTierPayload(v: unknown): v is PrivateTierPayload {\n  return PrivateTierPayloadSchema.safeParse(v).success;\n}\n\nexport function validateNSESyncLogEntry(v: unknown): v is NSESyncLogEntry {\n  return NSESyncLogEntrySchema.safeParse(v).success;\n}\n","/**\n * @module @nous/core/sync/nse-engine\n * @description Nous Sync Engine (NSE) v1  Core functions\n * @version 1.0.0\n * @spec Specs/Phase-6-Technical-Services/storm-033\n * @storm Brainstorms/Infrastructure/storm-033-sync-conflict-resolution\n *\n * Pure function implementations for:\n * - Version vector operations (compare, merge, increment, compact)\n * - Change set computation\n * - Merge strategy application\n * - Auto-merge algorithm\n * - Private tier conflict detection\n * - Utility functions\n *\n * @see storm-033 v1 revision\n */\n\nimport { nanoid } from 'nanoid';\nimport {\n  VERSION_VECTOR_INACTIVE_KEY,\n  VECTOR_COMPACTION_THRESHOLD,\n  DEVICE_INACTIVE_DAYS,\n  CLOCK_DRIFT_EMA_WEIGHT,\n  NSE_FIELD_MERGE_STRATEGIES,\n  SYNCABLE_FIELDS,\n  CONFLICT_HISTORY_RETENTION_DAYS,\n  type VersionComparison,\n  type NSEMergeStrategy,\n  type NSEPlatform,\n} from './nse-constants';\n\nimport {\n  type VersionVector,\n  type ChangeSet,\n  type FieldChange,\n  type StrategyResult,\n  type ClusterMembershipForMerge,\n  type NSEConflictInfo,\n  type NSEMergeResult,\n  type SyncMetadata,\n  type DeviceInfo,\n  type PrivateTierPayload,\n  type BadgeState,\n  type NSEStoredConflict,\n  type ConflictHistoryEntry,\n} from './nse-types';\n\n// ============================================================\n// VERSION VECTOR OPERATIONS\n// ============================================================\n\n/**\n * Compare two version vectors for causality.\n * Excludes _inactive key from comparison.\n *\n * @see storm-033 v1 revision Section 1\n */\nexport function compareVectors(a: VersionVector, b: VersionVector): VersionComparison {\n  // Collect all device IDs from both vectors, excluding _inactive\n  const allDevices = new Set<string>();\n  for (const key of Object.keys(a)) {\n    if (key !== VERSION_VECTOR_INACTIVE_KEY) allDevices.add(key);\n  }\n  for (const key of Object.keys(b)) {\n    if (key !== VERSION_VECTOR_INACTIVE_KEY) allDevices.add(key);\n  }\n\n  let aGreater = false;\n  let bGreater = false;\n\n  for (const device of allDevices) {\n    const aVal = a[device] ?? 0;\n    const bVal = b[device] ?? 0;\n\n    if (aVal > bVal) aGreater = true;\n    if (bVal > aVal) bGreater = true;\n  }\n\n  if (aGreater && !bGreater) return 'a_dominates';\n  if (bGreater && !aGreater) return 'b_dominates';\n  if (!aGreater && !bGreater) return 'equal';\n  return 'concurrent';\n}\n\n/**\n * Merge two version vectors by taking component-wise maximum.\n */\nexport function mergeVectors(a: VersionVector, b: VersionVector): VersionVector {\n  const result: VersionVector = { ...a };\n\n  for (const [device, counter] of Object.entries(b)) {\n    result[device] = Math.max(result[device] ?? 0, counter);\n  }\n\n  return result;\n}\n\n/**\n * Increment the version vector for a local write.\n */\nexport function incrementVector(vector: VersionVector, deviceId: string): VersionVector {\n  return {\n    ...vector,\n    [deviceId]: (vector[deviceId] ?? 0) + 1,\n  };\n}\n\n/**\n * Compact a version vector by merging inactive device counters.\n */\nexport function compactVector(\n  vector: VersionVector,\n  deviceLastActive: Map<string, Date>\n): VersionVector {\n  const activeDevices = Object.keys(vector).filter(\n    (k) => k !== VERSION_VECTOR_INACTIVE_KEY\n  );\n\n  // Only compact if above threshold\n  if (activeDevices.length <= VECTOR_COMPACTION_THRESHOLD) {\n    return { ...vector };\n  }\n\n  const now = Date.now();\n  const inactiveDaysMs = DEVICE_INACTIVE_DAYS * 24 * 60 * 60 * 1000;\n  const result: VersionVector = {};\n  let inactiveSum = vector[VERSION_VECTOR_INACTIVE_KEY] ?? 0;\n\n  for (const device of activeDevices) {\n    const lastActive = deviceLastActive.get(device);\n    const isInactive = lastActive && (now - lastActive.getTime()) > inactiveDaysMs;\n\n    if (isInactive) {\n      inactiveSum += vector[device] ?? 0;\n    } else {\n      result[device] = vector[device] ?? 0;\n    }\n  }\n\n  if (inactiveSum > 0) {\n    result[VERSION_VECTOR_INACTIVE_KEY] = inactiveSum;\n  }\n\n  return result;\n}\n\n// ============================================================\n// DEVICE ID GENERATION\n// ============================================================\n\n/**\n * Generate a device ID with platform prefix.\n */\nexport function generateDeviceId(platform: NSEPlatform): string {\n  return `${platform}_${nanoid()}`;\n}\n\n// ============================================================\n// CLOCK DRIFT\n// ============================================================\n\n/**\n * Update clock drift using exponential moving average.\n */\nexport function updateClockDrift(currentDrift: number, newSample: number): number {\n  return (1 - CLOCK_DRIFT_EMA_WEIGHT) * currentDrift + CLOCK_DRIFT_EMA_WEIGHT * newSample;\n}\n\n/**\n * Adjust a local timestamp by the tracked clock drift.\n */\nexport function adjustedTimestamp(localTime: Date, driftMs: number): Date {\n  return new Date(localTime.getTime() - driftMs);\n}\n\n// ============================================================\n// NESTED VALUE UTILITIES\n// ============================================================\n\n/**\n * Get a nested value from an object using dot-path notation.\n */\nexport function getNestedValue(obj: Record<string, unknown>, fieldPath: string): unknown {\n  const parts = fieldPath.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined || typeof current !== 'object') {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n\n/**\n * Set a nested value on an object using dot-path notation.\n */\nexport function setNestedValue(obj: Record<string, unknown>, fieldPath: string, value: unknown): void {\n  const parts = fieldPath.split('.');\n  if (parts.length === 0) return;\n\n  let current: Record<string, unknown> = obj;\n\n  for (let i = 0; i < parts.length - 1; i++) {\n    const part = parts[i] as string;\n    if (current[part] === undefined || current[part] === null || typeof current[part] !== 'object') {\n      current[part] = {};\n    }\n    current = current[part] as Record<string, unknown>;\n  }\n\n  const lastPart = parts[parts.length - 1] as string;\n  current[lastPart] = value;\n}\n\n/**\n * Deep equality check for comparing field values.\n */\nexport function deepEqual(a: unknown, b: unknown): boolean {\n  if (a === b) return true;\n  if (a === null || b === null) return false;\n  if (a === undefined || b === undefined) return false;\n  if (typeof a !== typeof b) return false;\n\n  if (Array.isArray(a) !== Array.isArray(b)) return false;\n\n  if (Array.isArray(a) && Array.isArray(b)) {\n    if (a.length !== b.length) return false;\n    return a.every((item, index) => deepEqual(item, b[index]));\n  }\n\n  if (typeof a === 'object' && typeof b === 'object') {\n    const aObj = a as Record<string, unknown>;\n    const bObj = b as Record<string, unknown>;\n    const aKeys = Object.keys(aObj);\n    const bKeys = Object.keys(bObj);\n\n    if (aKeys.length !== bKeys.length) return false;\n    return aKeys.every((key) => deepEqual(aObj[key], bObj[key]));\n  }\n\n  return false;\n}\n\n// ============================================================\n// CHANGE SET COMPUTATION\n// ============================================================\n\n/**\n * Compute a change set by comparing base (last synced) to current.\n */\nexport function computeChangeSet(\n  base: Record<string, unknown> | null,\n  current: Record<string, unknown>,\n  deviceId: string\n): ChangeSet {\n  const changes: FieldChange[] = [];\n\n  for (const field of SYNCABLE_FIELDS) {\n    const oldValue = base ? getNestedValue(base, field) : undefined;\n    const newValue = getNestedValue(current, field);\n\n    if (!deepEqual(oldValue, newValue)) {\n      changes.push({ field, old_value: oldValue, new_value: newValue });\n    }\n  }\n\n  return {\n    node_id: (current['id'] as string) ?? '',\n    device_id: deviceId,\n    timestamp: new Date().toISOString(),\n    changes,\n  };\n}\n\n// ============================================================\n// MERGE STRATEGY FUNCTIONS\n// ============================================================\n\n/**\n * Get the merge strategy for a given field path.\n */\nexport function getFieldMergeStrategy(fieldPath: string): NSEMergeStrategy {\n  return NSE_FIELD_MERGE_STRATEGIES[fieldPath] ?? NSE_FIELD_MERGE_STRATEGIES['_default'] ?? 'latest_wins';\n}\n\n/**\n * Apply a merge strategy to two conflicting field values.\n *\n * @param localOldVal - Base value from local change set (needed for delta-based strategies like 'sum')\n * @param remoteOldVal - Base value from remote change set (needed for delta-based strategies like 'sum')\n *\n * @see storm-033 v1 revision Section 5 - Merge Strategy Table\n */\nexport function applyStrategy(\n  strategy: NSEMergeStrategy,\n  localVal: unknown,\n  remoteVal: unknown,\n  localTime: string,\n  remoteTime: string,\n  localOldVal?: unknown,\n  remoteOldVal?: unknown\n): StrategyResult {\n  switch (strategy) {\n    case 'conflict':\n      return { value: undefined, isConflict: true };\n\n    case 'latest_wins': {\n      const localMs = new Date(localTime).getTime();\n      const remoteMs = new Date(remoteTime).getTime();\n      return {\n        value: localMs >= remoteMs ? localVal : remoteVal,\n        isConflict: false,\n      };\n    }\n\n    case 'max': {\n      if (typeof localVal === 'number' && typeof remoteVal === 'number') {\n        return { value: Math.max(localVal, remoteVal), isConflict: false };\n      }\n      return { value: localVal, isConflict: false };\n    }\n\n    case 'min': {\n      if (typeof localVal === 'number' && typeof remoteVal === 'number') {\n        return { value: Math.min(localVal, remoteVal), isConflict: false };\n      }\n      return { value: localVal, isConflict: false };\n    }\n\n    case 'sum': {\n      // CRITICAL: Sum DELTAS from base, not absolute values.\n      // If base=10, local=15 (+5), remote=13 (+3), result = 10 + 5 + 3 = 18.\n      // @see planning-notes.md Critical Note #5\n      if (typeof localVal === 'number' && typeof remoteVal === 'number') {\n        if (typeof localOldVal === 'number' && typeof remoteOldVal === 'number') {\n          const localDelta = localVal - localOldVal;\n          const remoteDelta = remoteVal - remoteOldVal;\n          return { value: localOldVal + localDelta + remoteDelta, isConflict: false };\n        }\n        // Fallback when old values unavailable: sum absolute values\n        return { value: localVal + remoteVal, isConflict: false };\n      }\n      return { value: localVal, isConflict: false };\n    }\n\n    case 'average': {\n      if (typeof localVal === 'number' && typeof remoteVal === 'number') {\n        return { value: (localVal + remoteVal) / 2, isConflict: false };\n      }\n      return { value: localVal, isConflict: false };\n    }\n\n    case 'max_timestamp': {\n      const localStr = String(localVal ?? '');\n      const remoteStr = String(remoteVal ?? '');\n      return {\n        value: localStr >= remoteStr ? localVal : remoteVal,\n        isConflict: false,\n      };\n    }\n\n    case 'union': {\n      if (Array.isArray(localVal) && Array.isArray(remoteVal)) {\n        return {\n          value: [...new Set([...localVal, ...remoteVal])],\n          isConflict: false,\n        };\n      }\n      return { value: localVal, isConflict: false };\n    }\n\n    case 'merge_memberships': {\n      if (Array.isArray(localVal) && Array.isArray(remoteVal)) {\n        return {\n          value: mergeMemberships(\n            localVal as ClusterMembershipForMerge[],\n            remoteVal as ClusterMembershipForMerge[]\n          ),\n          isConflict: false,\n        };\n      }\n      return { value: localVal, isConflict: false };\n    }\n\n    case 'keep_original':\n    case 'keep_local':\n      return { value: localVal, isConflict: false };\n\n    default:\n      return { value: localVal, isConflict: false };\n  }\n}\n\n/**\n * Special handler for cluster membership merge.\n */\nexport function mergeMemberships(\n  local: ClusterMembershipForMerge[],\n  remote: ClusterMembershipForMerge[]\n): ClusterMembershipForMerge[] {\n  const map = new Map<string, ClusterMembershipForMerge>();\n\n  // Add all local memberships\n  for (const m of local) {\n    map.set(m.cluster_id, { ...m });\n  }\n\n  // Merge remote memberships\n  for (const m of remote) {\n    const existing = map.get(m.cluster_id);\n    if (existing) {\n      // Overlap: take max strength, preserve pinned from either\n      existing.strength = Math.max(existing.strength, m.strength);\n      existing.pinned = existing.pinned || m.pinned;\n    } else {\n      map.set(m.cluster_id, { ...m });\n    }\n  }\n\n  return Array.from(map.values());\n}\n\n// ============================================================\n// AUTO-MERGE ALGORITHM\n// ============================================================\n\n/**\n * Attempt auto-merge of two concurrent node versions.\n *\n * Algorithm:\n * 1. Build maps of local and remote changes\n * 2. For each remote change, check if local also changed that field\n * 3. If only remote changed  apply remote value\n * 4. If both changed  apply field-level merge strategy\n * 5. Collect any unresolvable conflicts\n * 6. Return merged node (with non-conflicting fields applied) + any conflicts\n *\n * When status is 'conflict', mergedNode contains the partially merged state\n * (all non-conflicting fields applied). The caller can store both versions\n * for user resolution of conflicting fields only.\n *\n * @see storm-033 v1 revision Section 6\n */\nexport function nseAutoMerge(\n  local: Record<string, unknown>,\n  _remote: Record<string, unknown>,\n  localChangeSet: ChangeSet,\n  remoteChangeSet: ChangeSet\n): NSEMergeResult {\n  // Build maps of changes\n  const localChanges = new Map<string, FieldChange>();\n  for (const change of localChangeSet.changes) {\n    localChanges.set(change.field, change);\n  }\n\n  const remoteChanges = new Map<string, FieldChange>();\n  for (const change of remoteChangeSet.changes) {\n    remoteChanges.set(change.field, change);\n  }\n\n  // Start with a deep copy of local\n  const merged: Record<string, unknown> = JSON.parse(JSON.stringify(local));\n  const conflicts: NSEConflictInfo[] = [];\n\n  // Process each remote change\n  for (const [field, remoteChange] of remoteChanges) {\n    const localChange = localChanges.get(field);\n\n    if (!localChange) {\n      // Local did NOT change this field  apply remote value\n      setNestedValue(merged, field, remoteChange.new_value);\n    } else {\n      // Both changed this field  apply merge strategy\n      const strategy = getFieldMergeStrategy(field);\n      const result = applyStrategy(\n        strategy,\n        localChange.new_value,\n        remoteChange.new_value,\n        localChangeSet.timestamp,\n        remoteChangeSet.timestamp,\n        localChange.old_value,\n        remoteChange.old_value\n      );\n\n      if (result.isConflict) {\n        conflicts.push({\n          field,\n          localValue: localChange.new_value,\n          remoteValue: remoteChange.new_value,\n          localTimestamp: localChangeSet.timestamp,\n          remoteTimestamp: remoteChangeSet.timestamp,\n        });\n      } else {\n        setNestedValue(merged, field, result.value);\n      }\n    }\n  }\n\n  if (conflicts.length === 0) {\n    return { status: 'merged', mergedNode: merged };\n  }\n\n  // Return partially merged node + conflicts for user resolution\n  return { status: 'conflict', mergedNode: merged, conflicts };\n}\n\n// ============================================================\n// PRIVATE TIER CONFLICT DETECTION\n// ============================================================\n\n/**\n * Detect conflict for Private tier using checksums.\n * Returns true if conflict detected (checksums differ).\n */\nexport function detectPrivateTierConflict(\n  local: PrivateTierPayload,\n  remote: PrivateTierPayload\n): boolean {\n  return local.content_checksum !== remote.content_checksum;\n}\n\n// ============================================================\n// SYNC METADATA CREATION\n// ============================================================\n\n/**\n * Creates initial sync metadata for a new node.\n */\nexport function createSyncMetadata(\n  deviceId: string,\n  status: 'synced' | 'pending' | 'conflict' = 'pending'\n): SyncMetadata {\n  const now = new Date().toISOString();\n  return {\n    _schemaVersion: 1,\n    version: { [deviceId]: 1 },\n    last_modified_by: deviceId,\n    last_modified_at: now,\n    sync_status: status,\n    last_synced_at: now,\n  };\n}\n\n/**\n * Creates initial device info.\n */\nexport function createDeviceInfo(\n  platform: NSEPlatform,\n  schemaVersion: string = '2'\n): DeviceInfo {\n  const deviceId = generateDeviceId(platform);\n  const now = new Date().toISOString();\n  return {\n    _schemaVersion: 1,\n    device_id: deviceId,\n    platform,\n    display_name: getDefaultDeviceName(platform),\n    created_at: now,\n    last_active_at: now,\n    clock_drift_ms: 0,\n    schema_version: schemaVersion,\n  };\n}\n\n/**\n * Get default display name for a device platform.\n */\nexport function getDefaultDeviceName(platform: NSEPlatform): string {\n  switch (platform) {\n    case 'ios': return 'iPhone';\n    case 'android': return 'Android Device';\n    case 'mac': return 'Mac';\n    case 'win': return 'Windows PC';\n    case 'web': return 'Web Browser';\n    default: return 'Device';\n  }\n}\n\n// ============================================================\n// BADGE STATE\n// ============================================================\n\n/**\n * Create badge state from conflict count.\n */\nexport function createBadgeState(conflictCount: number): BadgeState {\n  return {\n    conflict_count: conflictCount,\n    visible: conflictCount > 0,\n  };\n}\n\n// ============================================================\n// STORED CONFLICT CREATION\n// ============================================================\n\n/**\n * Creates a stored conflict record.\n */\nexport function createStoredConflict(\n  nodeId: string,\n  local: Record<string, unknown>,\n  remote: Record<string, unknown>,\n  conflicts: NSEConflictInfo[]\n): NSEStoredConflict {\n  const now = new Date();\n  const expires = new Date(now.getTime() + CONFLICT_HISTORY_RETENTION_DAYS * 24 * 60 * 60 * 1000);\n  return {\n    _schemaVersion: 1,\n    node_id: nodeId,\n    local_version: local,\n    remote_version: remote,\n    conflicts,\n    created_at: now.toISOString(),\n    expires_at: expires.toISOString(),\n  };\n}\n\n/**\n * Creates a conflict history entry for the rejected version.\n */\nexport function createConflictHistoryEntry(\n  nodeId: string,\n  rejectedVersion: Record<string, unknown>,\n  resolvedBy: 'user' | 'auto'\n): ConflictHistoryEntry {\n  const now = new Date();\n  const expires = new Date(now.getTime() + CONFLICT_HISTORY_RETENTION_DAYS * 24 * 60 * 60 * 1000);\n  return {\n    _schemaVersion: 1,\n    node_id: nodeId,\n    rejected_version: rejectedVersion,\n    resolved_at: now.toISOString(),\n    resolved_by: resolvedBy,\n    expires_at: expires.toISOString(),\n  };\n}\n\n// ============================================================\n// EMBEDDING COMPATIBILITY\n// ============================================================\n\n/**\n * Check if an embedding model matches the current model.\n */\nexport function isEmbeddingCompatible(nodeModel: string, currentModel: string): boolean {\n  return nodeModel === currentModel;\n}\n"]}