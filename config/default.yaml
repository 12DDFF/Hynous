# Hynous Configuration
# Edit this file to change behavior. Restart app after changes.

# Application metadata
app:
  name: "Hynous"
  version: "0.1.0"

# Execution settings
execution:
  mode: "paper"              # paper | testnet | live_confirm | live_auto
  paper_balance: 1000        # Starting balance for paper trading (USD)
  symbols:                   # Symbols to track
    - "BTC"
    - "ETH"
    - "SOL"

# Hyperliquid exchange settings
hyperliquid:
  default_leverage: 10         # Minimum 10x, always set per-trade
  max_position_usd: 10000     # Safety cap per position on testnet
  default_slippage: 0.05       # 5% slippage tolerance for market orders

# Agent settings
agent:
  model: "openrouter/anthropic/claude-sonnet-4-5-20250929"  # OpenRouter: 1 key, all models
  max_tokens: 2048           # Max response tokens (user chat default)
  temperature: 0.7           # Creativity (0-1)

# Coinglass settings (cross-exchange derivatives data)
coinglass:
  plan: "hobbyist"             # hobbyist | analyst | professional

# Daemon settings (background autonomous agent)
daemon:
  enabled: false                   # Master switch — enable autonomous mode
  price_poll_interval: 60          # Price polling from Hyperliquid (seconds)
  deriv_poll_interval: 300         # Derivatives/sentiment polling (seconds)
  periodic_interval: 3600          # Periodic market review wake (seconds, 60 min)
  curiosity_threshold: 1           # Pending curiosity items before learning session
  curiosity_check_interval: 900    # Curiosity queue check interval (seconds, 15 min)
  decay_interval: 21600              # FSRS batch decay cycle interval (seconds, 6 hours)
  conflict_check_interval: 1800      # Contradiction queue polling interval (seconds, 30 min)
  health_check_interval: 3600        # Nous health check interval (seconds, 1 hour)
  embedding_backfill_interval: 43200 # Embedding backfill interval (seconds, 12 hours)
  consolidation_interval: 86400      # Cross-episode generalization (seconds, 24 hours)
  max_daily_loss_usd: 100            # Circuit breaker: pause trading after this daily loss
  max_open_positions: 3              # Max simultaneous open positions
  max_wakes_per_hour: 6              # Rate limit on agent wakes per hour
  wake_cooldown_seconds: 120         # Min seconds between non-priority wakes
  playbook_cache_ttl: 1800           # Playbook matcher cache refresh interval (seconds, 30 min)

# Market scanner (anomaly detection across ALL Hyperliquid pairs)
scanner:
  enabled: true
  wake_threshold: 0.6              # Min severity to wake agent (0.0-1.0)
  max_anomalies_per_wake: 5
  dedup_ttl_minutes: 30
  price_spike_5min_pct: 3.0        # % move in 5min to flag
  price_spike_15min_pct: 5.0       # % move in 15min to flag
  funding_extreme_percentile: 95   # Percentile cutoff for funding extremes
  oi_surge_pct: 10.0               # % OI change in 5min to flag
  liq_cascade_min_usd: 5000000     # Per-coin 1h liquidation threshold
  liq_wave_min_usd: 50000000       # Market-wide 1h liquidation threshold
  min_oi_usd: 1000000              # Skip pairs with OI below this
  # Micro trading detectors (L2 + 5m candles)
  book_poll_enabled: true            # Fetch L2 orderbooks + 5m candles for tracked symbols
  book_imbalance_flip_pct: 15.0      # Imbalance swing % to trigger book_flip detector
  momentum_5m_pct: 1.5               # 5m candle body % to trigger momentum_burst
  momentum_volume_mult: 2.0          # Volume multiplier vs rolling avg for momentum
  position_adverse_threshold: 0.40   # Imbalance threshold for adverse book signal
  # News integration (CryptoCompare)
  news_poll_enabled: true              # Poll CryptoCompare for news (every deriv cycle)
  news_wake_max_age_minutes: 30        # Only alert on news < 30min old

# Discord bot (chat relay + daemon notifications)
discord:
  enabled: true                                # Master switch
  channel_id: 1469952346028245097              # Discord channel ID for notifications + chat
  stats_channel_id: 1469946713471975476        # Separate channel for stats panel
  allowed_user_ids:                            # Only respond to these users
    - 1415781451474927657                      # David
    - 614868895643205639                       # Kevin

# Data layer (hynous-data service)
data_layer:
  url: "http://127.0.0.1:8100"    # hynous-data REST API
  enabled: true                     # Use data layer signals in briefing/scanner
  timeout: 5                        # HTTP timeout seconds

# Memory (Nous) settings
nous:
  url: "http://localhost:3100"        # Nous server URL
  server_dir: "nous-server/server"  # Path to Nous server (relative to project root)
  db_path: "storage/nous.db"          # Server-side DB path
  auto_retrieve_limit: 5              # Recent memories to auto-load

# Intelligent Retrieval Orchestrator (multi-pass memory search)
orchestrator:
  enabled: true                    # Master switch
  quality_threshold: 0.20          # Min top-result SSA score to accept without retry
  relevance_ratio: 0.4             # Dynamic cutoff: keep results scoring >= top * ratio
  max_results: 20                  # Hard cap on merged results (token budget is the real limiter)
  max_sub_queries: 4               # Max decomposition parts for compound queries
  max_retries: 1                   # Reformulation attempts per sub-query
  timeout_seconds: 3.0             # Total orchestration timeout
  search_limit_per_query: 25       # Results to fetch per sub-query (overfetch for quality gate)

# Tiered memory settings (working window + Nous-backed compression)
memory:
  window_size: 4                 # Complete exchanges to keep in working window
  max_context_tokens: 4000       # Token budget for recalled context injected per call (~1000 words)
  retrieve_limit: 20             # Max memories to retrieve per query (token budget is the real limiter)
  compression_model: "openrouter/anthropic/claude-haiku-4-5-20251001"  # OpenRouter
  compress_enabled: true         # Enable/disable automatic compression

# Memory sections — brain-inspired bias layer
# Sections give different memory types different retrieval weights, decay curves,
# and encoding rules. All nodes stay in one table; sections are a reranking bias.
# See: revisions/memory-sections/executive-summary.md
sections:
  enabled: true                    # Master switch for section-aware behavior
  intent_boost: 1.3               # Score multiplier for query-relevant sections (Issue 6)
  default_section: "KNOWLEDGE"    # Fallback section for unknown subtypes

# ML Satellite — feature engine + inference (SPEC-02/03)
satellite:
  enabled: false                        # Disabled during UI dev — enable when daemon runs stably
  db_path: "storage/satellite.db"       # Satellite SQLite database
  data_layer_db_path: "data-layer/storage/hynous-data.db"  # Read-only access to data-layer for historical queries
  snapshot_interval: 300                 # Feature snapshot frequency (matches deriv_poll_interval)
  coins:                                 # Coins to compute features for
    - "BTC"
    - "ETH"
    - "SOL"
  min_position_size_usd: 1000           # Noise filter for heatmap positions
  liq_cascade_threshold: 2.5            # Liquidation intensity ratio threshold
  liq_cascade_min_usd: 500000           # Min USD for cascade detection
  store_raw_data: true                   # Store raw API responses for retroactive debugging
  funding_settlement_hours:              # Hyperliquid funding settlement times (UTC)
    - 0
    - 8
    - 16

# Event detection thresholds
events:
  funding:
    extreme_positive: 0.001  # 0.10%
    extreme_negative: -0.0005  # -0.05%
  price:
    spike_percent: 0.05      # 5% move triggers event
  cooldown_minutes: 30       # Min time between same event type

# Logging
logging:
  level: "INFO"              # DEBUG | INFO | WARNING | ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
